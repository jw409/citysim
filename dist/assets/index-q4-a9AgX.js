var Bn=Object.defineProperty;var $n=(xt,yt,vt)=>yt in xt?Bn(xt,yt,{enumerable:!0,configurable:!0,writable:!0,value:vt}):xt[yt]=vt;var Bt=(xt,yt,vt)=>$n(xt,typeof yt!="symbol"?yt+"":yt,vt);(function(){const yt=document.createElement("link").relList;if(yt&&yt.supports&&yt.supports("modulepreload"))return;for(const Tt of document.querySelectorAll('link[rel="modulepreload"]'))bt(Tt);new MutationObserver(Tt=>{for(const Et of Tt)if(Et.type==="childList")for(const wt of Et.addedNodes)wt.tagName==="LINK"&&wt.rel==="modulepreload"&&bt(wt)}).observe(document,{childList:!0,subtree:!0});function vt(Tt){const Et={};return Tt.integrity&&(Et.integrity=Tt.integrity),Tt.referrerPolicy&&(Et.referrerPolicy=Tt.referrerPolicy),Tt.crossOrigin==="use-credentials"?Et.credentials="include":Tt.crossOrigin==="anonymous"?Et.credentials="omit":Et.credentials="same-origin",Et}function bt(Tt){if(Tt.ep)return;Tt.ep=!0;const Et=vt(Tt);fetch(Tt.href,Et)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(xt){return xt&&xt.__esModule&&Object.prototype.hasOwnProperty.call(xt,"default")?xt.default:xt}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$2=Symbol.for("react.element"),n$2=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$2=Symbol.for("react.strict_mode"),r$1=Symbol.for("react.profiler"),t$1=Symbol.for("react.provider"),u$1=Symbol.for("react.context"),v$2=Symbol.for("react.forward_ref"),w$1=Symbol.for("react.suspense"),x$1=Symbol.for("react.memo"),y$1=Symbol.for("react.lazy"),z$2=Symbol.iterator;function A$2(xt){return xt===null||typeof xt!="object"?null:(xt=z$2&&xt[z$2]||xt["@@iterator"],typeof xt=="function"?xt:null)}var B$2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$2=Object.assign,D$2={};function E$2(xt,yt,vt){this.props=xt,this.context=yt,this.refs=D$2,this.updater=vt||B$2}E$2.prototype.isReactComponent={};E$2.prototype.setState=function(xt,yt){if(typeof xt!="object"&&typeof xt!="function"&&xt!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xt,yt,"setState")};E$2.prototype.forceUpdate=function(xt){this.updater.enqueueForceUpdate(this,xt,"forceUpdate")};function F$1(){}F$1.prototype=E$2.prototype;function G$2(xt,yt,vt){this.props=xt,this.context=yt,this.refs=D$2,this.updater=vt||B$2}var H$2=G$2.prototype=new F$1;H$2.constructor=G$2;C$2(H$2,E$2.prototype);H$2.isPureReactComponent=!0;var I$2=Array.isArray,J$1=Object.prototype.hasOwnProperty,K$2={current:null},L$2={key:!0,ref:!0,__self:!0,__source:!0};function M$2(xt,yt,vt){var bt,Tt={},Et=null,wt=null;if(yt!=null)for(bt in yt.ref!==void 0&&(wt=yt.ref),yt.key!==void 0&&(Et=""+yt.key),yt)J$1.call(yt,bt)&&!L$2.hasOwnProperty(bt)&&(Tt[bt]=yt[bt]);var St=arguments.length-2;if(St===1)Tt.children=vt;else if(1<St){for(var At=Array(St),Rt=0;Rt<St;Rt++)At[Rt]=arguments[Rt+2];Tt.children=At}if(xt&&xt.defaultProps)for(bt in St=xt.defaultProps,St)Tt[bt]===void 0&&(Tt[bt]=St[bt]);return{$$typeof:l$2,type:xt,key:Et,ref:wt,props:Tt,_owner:K$2.current}}function N$2(xt,yt){return{$$typeof:l$2,type:xt.type,key:yt,ref:xt.ref,props:xt.props,_owner:xt._owner}}function O$2(xt){return typeof xt=="object"&&xt!==null&&xt.$$typeof===l$2}function escape(xt){var yt={"=":"=0",":":"=2"};return"$"+xt.replace(/[=:]/g,function(vt){return yt[vt]})}var P$2=/\/+/g;function Q$2(xt,yt){return typeof xt=="object"&&xt!==null&&xt.key!=null?escape(""+xt.key):yt.toString(36)}function R$2(xt,yt,vt,bt,Tt){var Et=typeof xt;(Et==="undefined"||Et==="boolean")&&(xt=null);var wt=!1;if(xt===null)wt=!0;else switch(Et){case"string":case"number":wt=!0;break;case"object":switch(xt.$$typeof){case l$2:case n$2:wt=!0}}if(wt)return wt=xt,Tt=Tt(wt),xt=bt===""?"."+Q$2(wt,0):bt,I$2(Tt)?(vt="",xt!=null&&(vt=xt.replace(P$2,"$&/")+"/"),R$2(Tt,yt,vt,"",function(Rt){return Rt})):Tt!=null&&(O$2(Tt)&&(Tt=N$2(Tt,vt+(!Tt.key||wt&&wt.key===Tt.key?"":(""+Tt.key).replace(P$2,"$&/")+"/")+xt)),yt.push(Tt)),1;if(wt=0,bt=bt===""?".":bt+":",I$2(xt))for(var St=0;St<xt.length;St++){Et=xt[St];var At=bt+Q$2(Et,St);wt+=R$2(Et,yt,vt,At,Tt)}else if(At=A$2(xt),typeof At=="function")for(xt=At.call(xt),St=0;!(Et=xt.next()).done;)Et=Et.value,At=bt+Q$2(Et,St++),wt+=R$2(Et,yt,vt,At,Tt);else if(Et==="object")throw yt=String(xt),Error("Objects are not valid as a React child (found: "+(yt==="[object Object]"?"object with keys {"+Object.keys(xt).join(", ")+"}":yt)+"). If you meant to render a collection of children, use an array instead.");return wt}function S$2(xt,yt,vt){if(xt==null)return xt;var bt=[],Tt=0;return R$2(xt,bt,"","",function(Et){return yt.call(vt,Et,Tt++)}),bt}function T$2(xt){if(xt._status===-1){var yt=xt._result;yt=yt(),yt.then(function(vt){(xt._status===0||xt._status===-1)&&(xt._status=1,xt._result=vt)},function(vt){(xt._status===0||xt._status===-1)&&(xt._status=2,xt._result=vt)}),xt._status===-1&&(xt._status=0,xt._result=yt)}if(xt._status===1)return xt._result.default;throw xt._result}var U$2={current:null},V$2={transition:null},W$2={ReactCurrentDispatcher:U$2,ReactCurrentBatchConfig:V$2,ReactCurrentOwner:K$2};function X$2(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$2,forEach:function(xt,yt,vt){S$2(xt,function(){yt.apply(this,arguments)},vt)},count:function(xt){var yt=0;return S$2(xt,function(){yt++}),yt},toArray:function(xt){return S$2(xt,function(yt){return yt})||[]},only:function(xt){if(!O$2(xt))throw Error("React.Children.only expected to receive a single React element child.");return xt}};react_production_min.Component=E$2;react_production_min.Fragment=p$3;react_production_min.Profiler=r$1;react_production_min.PureComponent=G$2;react_production_min.StrictMode=q$2;react_production_min.Suspense=w$1;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$2;react_production_min.act=X$2;react_production_min.cloneElement=function(xt,yt,vt){if(xt==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+xt+".");var bt=C$2({},xt.props),Tt=xt.key,Et=xt.ref,wt=xt._owner;if(yt!=null){if(yt.ref!==void 0&&(Et=yt.ref,wt=K$2.current),yt.key!==void 0&&(Tt=""+yt.key),xt.type&&xt.type.defaultProps)var St=xt.type.defaultProps;for(At in yt)J$1.call(yt,At)&&!L$2.hasOwnProperty(At)&&(bt[At]=yt[At]===void 0&&St!==void 0?St[At]:yt[At])}var At=arguments.length-2;if(At===1)bt.children=vt;else if(1<At){St=Array(At);for(var Rt=0;Rt<At;Rt++)St[Rt]=arguments[Rt+2];bt.children=St}return{$$typeof:l$2,type:xt.type,key:Tt,ref:Et,props:bt,_owner:wt}};react_production_min.createContext=function(xt){return xt={$$typeof:u$1,_currentValue:xt,_currentValue2:xt,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},xt.Provider={$$typeof:t$1,_context:xt},xt.Consumer=xt};react_production_min.createElement=M$2;react_production_min.createFactory=function(xt){var yt=M$2.bind(null,xt);return yt.type=xt,yt};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(xt){return{$$typeof:v$2,render:xt}};react_production_min.isValidElement=O$2;react_production_min.lazy=function(xt){return{$$typeof:y$1,_payload:{_status:-1,_result:xt},_init:T$2}};react_production_min.memo=function(xt,yt){return{$$typeof:x$1,type:xt,compare:yt===void 0?null:yt}};react_production_min.startTransition=function(xt){var yt=V$2.transition;V$2.transition={};try{xt()}finally{V$2.transition=yt}};react_production_min.unstable_act=X$2;react_production_min.useCallback=function(xt,yt){return U$2.current.useCallback(xt,yt)};react_production_min.useContext=function(xt){return U$2.current.useContext(xt)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(xt){return U$2.current.useDeferredValue(xt)};react_production_min.useEffect=function(xt,yt){return U$2.current.useEffect(xt,yt)};react_production_min.useId=function(){return U$2.current.useId()};react_production_min.useImperativeHandle=function(xt,yt,vt){return U$2.current.useImperativeHandle(xt,yt,vt)};react_production_min.useInsertionEffect=function(xt,yt){return U$2.current.useInsertionEffect(xt,yt)};react_production_min.useLayoutEffect=function(xt,yt){return U$2.current.useLayoutEffect(xt,yt)};react_production_min.useMemo=function(xt,yt){return U$2.current.useMemo(xt,yt)};react_production_min.useReducer=function(xt,yt,vt){return U$2.current.useReducer(xt,yt,vt)};react_production_min.useRef=function(xt){return U$2.current.useRef(xt)};react_production_min.useState=function(xt){return U$2.current.useState(xt)};react_production_min.useSyncExternalStore=function(xt,yt,vt){return U$2.current.useSyncExternalStore(xt,yt,vt)};react_production_min.useTransition=function(){return U$2.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$1=reactExports,k$1=Symbol.for("react.element"),l$1=Symbol.for("react.fragment"),m$2=Object.prototype.hasOwnProperty,n$1=f$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q$1(xt,yt,vt){var bt,Tt={},Et=null,wt=null;vt!==void 0&&(Et=""+vt),yt.key!==void 0&&(Et=""+yt.key),yt.ref!==void 0&&(wt=yt.ref);for(bt in yt)m$2.call(yt,bt)&&!p$2.hasOwnProperty(bt)&&(Tt[bt]=yt[bt]);if(xt&&xt.defaultProps)for(bt in yt=xt.defaultProps,yt)Tt[bt]===void 0&&(Tt[bt]=yt[bt]);return{$$typeof:k$1,type:xt,key:Et,ref:wt,props:Tt,_owner:n$1.current}}reactJsxRuntime_production_min.Fragment=l$1;reactJsxRuntime_production_min.jsx=q$1;reactJsxRuntime_production_min.jsxs=q$1;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(xt){function yt(qt,Gt){var Qt=qt.length;qt.push(Gt);e:for(;0<Qt;){var Jt=Qt-1>>>1,tn=qt[Jt];if(0<Tt(tn,Gt))qt[Jt]=Gt,qt[Qt]=tn,Qt=Jt;else break e}}function vt(qt){return qt.length===0?null:qt[0]}function bt(qt){if(qt.length===0)return null;var Gt=qt[0],Qt=qt.pop();if(Qt!==Gt){qt[0]=Qt;e:for(var Jt=0,tn=qt.length,yn=tn>>>1;Jt<yn;){var fn=2*(Jt+1)-1,Ln=qt[fn],hn=fn+1,vn=qt[hn];if(0>Tt(Ln,Qt))hn<tn&&0>Tt(vn,Ln)?(qt[Jt]=vn,qt[hn]=Qt,Jt=hn):(qt[Jt]=Ln,qt[fn]=Qt,Jt=fn);else if(hn<tn&&0>Tt(vn,Qt))qt[Jt]=vn,qt[hn]=Qt,Jt=hn;else break e}}return Gt}function Tt(qt,Gt){var Qt=qt.sortIndex-Gt.sortIndex;return Qt!==0?Qt:qt.id-Gt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var Et=performance;xt.unstable_now=function(){return Et.now()}}else{var wt=Date,St=wt.now();xt.unstable_now=function(){return wt.now()-St}}var At=[],Rt=[],Pt=1,Ct=null,It=3,Mt=!1,Ot=!1,kt=!1,Ft=typeof setTimeout=="function"?setTimeout:null,Nt=typeof clearTimeout=="function"?clearTimeout:null,Lt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Dt(qt){for(var Gt=vt(Rt);Gt!==null;){if(Gt.callback===null)bt(Rt);else if(Gt.startTime<=qt)bt(Rt),Gt.sortIndex=Gt.expirationTime,yt(At,Gt);else break;Gt=vt(Rt)}}function $t(qt){if(kt=!1,Dt(qt),!Ot)if(vt(At)!==null)Ot=!0,nn(zt);else{var Gt=vt(Rt);Gt!==null&&rn($t,Gt.startTime-qt)}}function zt(qt,Gt){Ot=!1,kt&&(kt=!1,Nt(Ht),Ht=-1),Mt=!0;var Qt=It;try{for(Dt(Gt),Ct=vt(At);Ct!==null&&(!(Ct.expirationTime>Gt)||qt&&!Yt());){var Jt=Ct.callback;if(typeof Jt=="function"){Ct.callback=null,It=Ct.priorityLevel;var tn=Jt(Ct.expirationTime<=Gt);Gt=xt.unstable_now(),typeof tn=="function"?Ct.callback=tn:Ct===vt(At)&&bt(At),Dt(Gt)}else bt(At);Ct=vt(At)}if(Ct!==null)var yn=!0;else{var fn=vt(Rt);fn!==null&&rn($t,fn.startTime-Gt),yn=!1}return yn}finally{Ct=null,It=Qt,Mt=!1}}var Ut=!1,jt=null,Ht=-1,Vt=5,Wt=-1;function Yt(){return!(xt.unstable_now()-Wt<Vt)}function Kt(){if(jt!==null){var qt=xt.unstable_now();Wt=qt;var Gt=!0;try{Gt=jt(!0,qt)}finally{Gt?Zt():(Ut=!1,jt=null)}}else Ut=!1}var Zt;if(typeof Lt=="function")Zt=function(){Lt(Kt)};else if(typeof MessageChannel<"u"){var Xt=new MessageChannel,en=Xt.port2;Xt.port1.onmessage=Kt,Zt=function(){en.postMessage(null)}}else Zt=function(){Ft(Kt,0)};function nn(qt){jt=qt,Ut||(Ut=!0,Zt())}function rn(qt,Gt){Ht=Ft(function(){qt(xt.unstable_now())},Gt)}xt.unstable_IdlePriority=5,xt.unstable_ImmediatePriority=1,xt.unstable_LowPriority=4,xt.unstable_NormalPriority=3,xt.unstable_Profiling=null,xt.unstable_UserBlockingPriority=2,xt.unstable_cancelCallback=function(qt){qt.callback=null},xt.unstable_continueExecution=function(){Ot||Mt||(Ot=!0,nn(zt))},xt.unstable_forceFrameRate=function(qt){0>qt||125<qt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Vt=0<qt?Math.floor(1e3/qt):5},xt.unstable_getCurrentPriorityLevel=function(){return It},xt.unstable_getFirstCallbackNode=function(){return vt(At)},xt.unstable_next=function(qt){switch(It){case 1:case 2:case 3:var Gt=3;break;default:Gt=It}var Qt=It;It=Gt;try{return qt()}finally{It=Qt}},xt.unstable_pauseExecution=function(){},xt.unstable_requestPaint=function(){},xt.unstable_runWithPriority=function(qt,Gt){switch(qt){case 1:case 2:case 3:case 4:case 5:break;default:qt=3}var Qt=It;It=qt;try{return Gt()}finally{It=Qt}},xt.unstable_scheduleCallback=function(qt,Gt,Qt){var Jt=xt.unstable_now();switch(typeof Qt=="object"&&Qt!==null?(Qt=Qt.delay,Qt=typeof Qt=="number"&&0<Qt?Jt+Qt:Jt):Qt=Jt,qt){case 1:var tn=-1;break;case 2:tn=250;break;case 5:tn=1073741823;break;case 4:tn=1e4;break;default:tn=5e3}return tn=Qt+tn,qt={id:Pt++,callback:Gt,priorityLevel:qt,startTime:Qt,expirationTime:tn,sortIndex:-1},Qt>Jt?(qt.sortIndex=Qt,yt(Rt,qt),vt(At)===null&&qt===vt(Rt)&&(kt?(Nt(Ht),Ht=-1):kt=!0,rn($t,Qt-Jt))):(qt.sortIndex=tn,yt(At,qt),Ot||Mt||(Ot=!0,nn(zt))),qt},xt.unstable_shouldYield=Yt,xt.unstable_wrapCallback=function(qt){var Gt=It;return function(){var Qt=It;It=Gt;try{return qt.apply(this,arguments)}finally{It=Qt}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$1(xt){for(var yt="https://reactjs.org/docs/error-decoder.html?invariant="+xt,vt=1;vt<arguments.length;vt++)yt+="&args[]="+encodeURIComponent(arguments[vt]);return"Minified React error #"+xt+"; visit "+yt+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(xt,yt){ha(xt,yt),ha(xt+"Capture",yt)}function ha(xt,yt){for(ea[xt]=yt,xt=0;xt<yt.length;xt++)da.add(yt[xt])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(xt){return ja.call(ma,xt)?!0:ja.call(la,xt)?!1:ka.test(xt)?ma[xt]=!0:(la[xt]=!0,!1)}function pa(xt,yt,vt,bt){if(vt!==null&&vt.type===0)return!1;switch(typeof yt){case"function":case"symbol":return!0;case"boolean":return bt?!1:vt!==null?!vt.acceptsBooleans:(xt=xt.toLowerCase().slice(0,5),xt!=="data-"&&xt!=="aria-");default:return!1}}function qa(xt,yt,vt,bt){if(yt===null||typeof yt>"u"||pa(xt,yt,vt,bt))return!0;if(bt)return!1;if(vt!==null)switch(vt.type){case 3:return!yt;case 4:return yt===!1;case 5:return isNaN(yt);case 6:return isNaN(yt)||1>yt}return!1}function v$1(xt,yt,vt,bt,Tt,Et,wt){this.acceptsBooleans=yt===2||yt===3||yt===4,this.attributeName=bt,this.attributeNamespace=Tt,this.mustUseProperty=vt,this.propertyName=xt,this.type=yt,this.sanitizeURL=Et,this.removeEmptyString=wt}var z$1={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(xt){z$1[xt]=new v$1(xt,0,!1,xt,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(xt){var yt=xt[0];z$1[yt]=new v$1(yt,1,!1,xt[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(xt){z$1[xt]=new v$1(xt,2,!1,xt.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(xt){z$1[xt]=new v$1(xt,2,!1,xt,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(xt){z$1[xt]=new v$1(xt,3,!1,xt.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(xt){z$1[xt]=new v$1(xt,3,!0,xt,null,!1,!1)});["capture","download"].forEach(function(xt){z$1[xt]=new v$1(xt,4,!1,xt,null,!1,!1)});["cols","rows","size","span"].forEach(function(xt){z$1[xt]=new v$1(xt,6,!1,xt,null,!1,!1)});["rowSpan","start"].forEach(function(xt){z$1[xt]=new v$1(xt,5,!1,xt.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(xt){return xt[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(xt){var yt=xt.replace(ra,sa);z$1[yt]=new v$1(yt,1,!1,xt,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(xt){var yt=xt.replace(ra,sa);z$1[yt]=new v$1(yt,1,!1,xt,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(xt){var yt=xt.replace(ra,sa);z$1[yt]=new v$1(yt,1,!1,xt,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(xt){z$1[xt]=new v$1(xt,1,!1,xt.toLowerCase(),null,!1,!1)});z$1.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(xt){z$1[xt]=new v$1(xt,1,!1,xt.toLowerCase(),null,!0,!0)});function ta(xt,yt,vt,bt){var Tt=z$1.hasOwnProperty(yt)?z$1[yt]:null;(Tt!==null?Tt.type!==0:bt||!(2<yt.length)||yt[0]!=="o"&&yt[0]!=="O"||yt[1]!=="n"&&yt[1]!=="N")&&(qa(yt,vt,Tt,bt)&&(vt=null),bt||Tt===null?oa(yt)&&(vt===null?xt.removeAttribute(yt):xt.setAttribute(yt,""+vt)):Tt.mustUseProperty?xt[Tt.propertyName]=vt===null?Tt.type===3?!1:"":vt:(yt=Tt.attributeName,bt=Tt.attributeNamespace,vt===null?xt.removeAttribute(yt):(Tt=Tt.type,vt=Tt===3||Tt===4&&vt===!0?"":""+vt,bt?xt.setAttributeNS(bt,yt,vt):xt.setAttribute(yt,vt))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(xt){return xt===null||typeof xt!="object"?null:(xt=Ja&&xt[Ja]||xt["@@iterator"],typeof xt=="function"?xt:null)}var A$1=Object.assign,La;function Ma(xt){if(La===void 0)try{throw Error()}catch(vt){var yt=vt.stack.trim().match(/\n( *(at )?)/);La=yt&&yt[1]||""}return`
`+La+xt}var Na=!1;function Oa(xt,yt){if(!xt||Na)return"";Na=!0;var vt=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(yt)if(yt=function(){throw Error()},Object.defineProperty(yt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(yt,[])}catch(Rt){var bt=Rt}Reflect.construct(xt,[],yt)}else{try{yt.call()}catch(Rt){bt=Rt}xt.call(yt.prototype)}else{try{throw Error()}catch(Rt){bt=Rt}xt()}}catch(Rt){if(Rt&&bt&&typeof Rt.stack=="string"){for(var Tt=Rt.stack.split(`
`),Et=bt.stack.split(`
`),wt=Tt.length-1,St=Et.length-1;1<=wt&&0<=St&&Tt[wt]!==Et[St];)St--;for(;1<=wt&&0<=St;wt--,St--)if(Tt[wt]!==Et[St]){if(wt!==1||St!==1)do if(wt--,St--,0>St||Tt[wt]!==Et[St]){var At=`
`+Tt[wt].replace(" at new "," at ");return xt.displayName&&At.includes("<anonymous>")&&(At=At.replace("<anonymous>",xt.displayName)),At}while(1<=wt&&0<=St);break}}}finally{Na=!1,Error.prepareStackTrace=vt}return(xt=xt?xt.displayName||xt.name:"")?Ma(xt):""}function Pa(xt){switch(xt.tag){case 5:return Ma(xt.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return xt=Oa(xt.type,!1),xt;case 11:return xt=Oa(xt.type.render,!1),xt;case 1:return xt=Oa(xt.type,!0),xt;default:return""}}function Qa(xt){if(xt==null)return null;if(typeof xt=="function")return xt.displayName||xt.name||null;if(typeof xt=="string")return xt;switch(xt){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof xt=="object")switch(xt.$$typeof){case Ca:return(xt.displayName||"Context")+".Consumer";case Ba:return(xt._context.displayName||"Context")+".Provider";case Da:var yt=xt.render;return xt=xt.displayName,xt||(xt=yt.displayName||yt.name||"",xt=xt!==""?"ForwardRef("+xt+")":"ForwardRef"),xt;case Ga:return yt=xt.displayName||null,yt!==null?yt:Qa(xt.type)||"Memo";case Ha:yt=xt._payload,xt=xt._init;try{return Qa(xt(yt))}catch{}}return null}function Ra(xt){var yt=xt.type;switch(xt.tag){case 24:return"Cache";case 9:return(yt.displayName||"Context")+".Consumer";case 10:return(yt._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return xt=yt.render,xt=xt.displayName||xt.name||"",yt.displayName||(xt!==""?"ForwardRef("+xt+")":"ForwardRef");case 7:return"Fragment";case 5:return yt;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(yt);case 8:return yt===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof yt=="function")return yt.displayName||yt.name||null;if(typeof yt=="string")return yt}return null}function Sa(xt){switch(typeof xt){case"boolean":case"number":case"string":case"undefined":return xt;case"object":return xt;default:return""}}function Ta(xt){var yt=xt.type;return(xt=xt.nodeName)&&xt.toLowerCase()==="input"&&(yt==="checkbox"||yt==="radio")}function Ua(xt){var yt=Ta(xt)?"checked":"value",vt=Object.getOwnPropertyDescriptor(xt.constructor.prototype,yt),bt=""+xt[yt];if(!xt.hasOwnProperty(yt)&&typeof vt<"u"&&typeof vt.get=="function"&&typeof vt.set=="function"){var Tt=vt.get,Et=vt.set;return Object.defineProperty(xt,yt,{configurable:!0,get:function(){return Tt.call(this)},set:function(wt){bt=""+wt,Et.call(this,wt)}}),Object.defineProperty(xt,yt,{enumerable:vt.enumerable}),{getValue:function(){return bt},setValue:function(wt){bt=""+wt},stopTracking:function(){xt._valueTracker=null,delete xt[yt]}}}}function Va(xt){xt._valueTracker||(xt._valueTracker=Ua(xt))}function Wa(xt){if(!xt)return!1;var yt=xt._valueTracker;if(!yt)return!0;var vt=yt.getValue(),bt="";return xt&&(bt=Ta(xt)?xt.checked?"true":"false":xt.value),xt=bt,xt!==vt?(yt.setValue(xt),!0):!1}function Xa(xt){if(xt=xt||(typeof document<"u"?document:void 0),typeof xt>"u")return null;try{return xt.activeElement||xt.body}catch{return xt.body}}function Ya(xt,yt){var vt=yt.checked;return A$1({},yt,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:vt??xt._wrapperState.initialChecked})}function Za(xt,yt){var vt=yt.defaultValue==null?"":yt.defaultValue,bt=yt.checked!=null?yt.checked:yt.defaultChecked;vt=Sa(yt.value!=null?yt.value:vt),xt._wrapperState={initialChecked:bt,initialValue:vt,controlled:yt.type==="checkbox"||yt.type==="radio"?yt.checked!=null:yt.value!=null}}function ab(xt,yt){yt=yt.checked,yt!=null&&ta(xt,"checked",yt,!1)}function bb(xt,yt){ab(xt,yt);var vt=Sa(yt.value),bt=yt.type;if(vt!=null)bt==="number"?(vt===0&&xt.value===""||xt.value!=vt)&&(xt.value=""+vt):xt.value!==""+vt&&(xt.value=""+vt);else if(bt==="submit"||bt==="reset"){xt.removeAttribute("value");return}yt.hasOwnProperty("value")?cb(xt,yt.type,vt):yt.hasOwnProperty("defaultValue")&&cb(xt,yt.type,Sa(yt.defaultValue)),yt.checked==null&&yt.defaultChecked!=null&&(xt.defaultChecked=!!yt.defaultChecked)}function db(xt,yt,vt){if(yt.hasOwnProperty("value")||yt.hasOwnProperty("defaultValue")){var bt=yt.type;if(!(bt!=="submit"&&bt!=="reset"||yt.value!==void 0&&yt.value!==null))return;yt=""+xt._wrapperState.initialValue,vt||yt===xt.value||(xt.value=yt),xt.defaultValue=yt}vt=xt.name,vt!==""&&(xt.name=""),xt.defaultChecked=!!xt._wrapperState.initialChecked,vt!==""&&(xt.name=vt)}function cb(xt,yt,vt){(yt!=="number"||Xa(xt.ownerDocument)!==xt)&&(vt==null?xt.defaultValue=""+xt._wrapperState.initialValue:xt.defaultValue!==""+vt&&(xt.defaultValue=""+vt))}var eb=Array.isArray;function fb(xt,yt,vt,bt){if(xt=xt.options,yt){yt={};for(var Tt=0;Tt<vt.length;Tt++)yt["$"+vt[Tt]]=!0;for(vt=0;vt<xt.length;vt++)Tt=yt.hasOwnProperty("$"+xt[vt].value),xt[vt].selected!==Tt&&(xt[vt].selected=Tt),Tt&&bt&&(xt[vt].defaultSelected=!0)}else{for(vt=""+Sa(vt),yt=null,Tt=0;Tt<xt.length;Tt++){if(xt[Tt].value===vt){xt[Tt].selected=!0,bt&&(xt[Tt].defaultSelected=!0);return}yt!==null||xt[Tt].disabled||(yt=xt[Tt])}yt!==null&&(yt.selected=!0)}}function gb(xt,yt){if(yt.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A$1({},yt,{value:void 0,defaultValue:void 0,children:""+xt._wrapperState.initialValue})}function hb(xt,yt){var vt=yt.value;if(vt==null){if(vt=yt.children,yt=yt.defaultValue,vt!=null){if(yt!=null)throw Error(p$1(92));if(eb(vt)){if(1<vt.length)throw Error(p$1(93));vt=vt[0]}yt=vt}yt==null&&(yt=""),vt=yt}xt._wrapperState={initialValue:Sa(vt)}}function ib(xt,yt){var vt=Sa(yt.value),bt=Sa(yt.defaultValue);vt!=null&&(vt=""+vt,vt!==xt.value&&(xt.value=vt),yt.defaultValue==null&&xt.defaultValue!==vt&&(xt.defaultValue=vt)),bt!=null&&(xt.defaultValue=""+bt)}function jb(xt){var yt=xt.textContent;yt===xt._wrapperState.initialValue&&yt!==""&&yt!==null&&(xt.value=yt)}function kb(xt){switch(xt){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(xt,yt){return xt==null||xt==="http://www.w3.org/1999/xhtml"?kb(yt):xt==="http://www.w3.org/2000/svg"&&yt==="foreignObject"?"http://www.w3.org/1999/xhtml":xt}var mb,nb=function(xt){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(yt,vt,bt,Tt){MSApp.execUnsafeLocalFunction(function(){return xt(yt,vt,bt,Tt)})}:xt}(function(xt,yt){if(xt.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in xt)xt.innerHTML=yt;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+yt.valueOf().toString()+"</svg>",yt=mb.firstChild;xt.firstChild;)xt.removeChild(xt.firstChild);for(;yt.firstChild;)xt.appendChild(yt.firstChild)}});function ob(xt,yt){if(yt){var vt=xt.firstChild;if(vt&&vt===xt.lastChild&&vt.nodeType===3){vt.nodeValue=yt;return}}xt.textContent=yt}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(xt){qb.forEach(function(yt){yt=yt+xt.charAt(0).toUpperCase()+xt.substring(1),pb[yt]=pb[xt]})});function rb(xt,yt,vt){return yt==null||typeof yt=="boolean"||yt===""?"":vt||typeof yt!="number"||yt===0||pb.hasOwnProperty(xt)&&pb[xt]?(""+yt).trim():yt+"px"}function sb(xt,yt){xt=xt.style;for(var vt in yt)if(yt.hasOwnProperty(vt)){var bt=vt.indexOf("--")===0,Tt=rb(vt,yt[vt],bt);vt==="float"&&(vt="cssFloat"),bt?xt.setProperty(vt,Tt):xt[vt]=Tt}}var tb=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(xt,yt){if(yt){if(tb[xt]&&(yt.children!=null||yt.dangerouslySetInnerHTML!=null))throw Error(p$1(137,xt));if(yt.dangerouslySetInnerHTML!=null){if(yt.children!=null)throw Error(p$1(60));if(typeof yt.dangerouslySetInnerHTML!="object"||!("__html"in yt.dangerouslySetInnerHTML))throw Error(p$1(61))}if(yt.style!=null&&typeof yt.style!="object")throw Error(p$1(62))}}function vb(xt,yt){if(xt.indexOf("-")===-1)return typeof yt.is=="string";switch(xt){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(xt){return xt=xt.target||xt.srcElement||window,xt.correspondingUseElement&&(xt=xt.correspondingUseElement),xt.nodeType===3?xt.parentNode:xt}var yb=null,zb=null,Ab=null;function Bb(xt){if(xt=Cb(xt)){if(typeof yb!="function")throw Error(p$1(280));var yt=xt.stateNode;yt&&(yt=Db(yt),yb(xt.stateNode,xt.type,yt))}}function Eb(xt){zb?Ab?Ab.push(xt):Ab=[xt]:zb=xt}function Fb(){if(zb){var xt=zb,yt=Ab;if(Ab=zb=null,Bb(xt),yt)for(xt=0;xt<yt.length;xt++)Bb(yt[xt])}}function Gb(xt,yt){return xt(yt)}function Hb(){}var Ib=!1;function Jb(xt,yt,vt){if(Ib)return xt(yt,vt);Ib=!0;try{return Gb(xt,yt,vt)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(xt,yt){var vt=xt.stateNode;if(vt===null)return null;var bt=Db(vt);if(bt===null)return null;vt=bt[yt];e:switch(yt){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(bt=!bt.disabled)||(xt=xt.type,bt=!(xt==="button"||xt==="input"||xt==="select"||xt==="textarea")),xt=!bt;break e;default:xt=!1}if(xt)return null;if(vt&&typeof vt!="function")throw Error(p$1(231,yt,typeof vt));return vt}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(xt,yt,vt,bt,Tt,Et,wt,St,At){var Rt=Array.prototype.slice.call(arguments,3);try{yt.apply(vt,Rt)}catch(Pt){this.onError(Pt)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(xt){Ob=!0,Pb=xt}};function Tb(xt,yt,vt,bt,Tt,Et,wt,St,At){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(xt,yt,vt,bt,Tt,Et,wt,St,At){if(Tb.apply(this,arguments),Ob){if(Ob){var Rt=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=Rt)}}function Vb(xt){var yt=xt,vt=xt;if(xt.alternate)for(;yt.return;)yt=yt.return;else{xt=yt;do yt=xt,yt.flags&4098&&(vt=yt.return),xt=yt.return;while(xt)}return yt.tag===3?vt:null}function Wb(xt){if(xt.tag===13){var yt=xt.memoizedState;if(yt===null&&(xt=xt.alternate,xt!==null&&(yt=xt.memoizedState)),yt!==null)return yt.dehydrated}return null}function Xb(xt){if(Vb(xt)!==xt)throw Error(p$1(188))}function Yb(xt){var yt=xt.alternate;if(!yt){if(yt=Vb(xt),yt===null)throw Error(p$1(188));return yt!==xt?null:xt}for(var vt=xt,bt=yt;;){var Tt=vt.return;if(Tt===null)break;var Et=Tt.alternate;if(Et===null){if(bt=Tt.return,bt!==null){vt=bt;continue}break}if(Tt.child===Et.child){for(Et=Tt.child;Et;){if(Et===vt)return Xb(Tt),xt;if(Et===bt)return Xb(Tt),yt;Et=Et.sibling}throw Error(p$1(188))}if(vt.return!==bt.return)vt=Tt,bt=Et;else{for(var wt=!1,St=Tt.child;St;){if(St===vt){wt=!0,vt=Tt,bt=Et;break}if(St===bt){wt=!0,bt=Tt,vt=Et;break}St=St.sibling}if(!wt){for(St=Et.child;St;){if(St===vt){wt=!0,vt=Et,bt=Tt;break}if(St===bt){wt=!0,bt=Et,vt=Tt;break}St=St.sibling}if(!wt)throw Error(p$1(189))}}if(vt.alternate!==bt)throw Error(p$1(190))}if(vt.tag!==3)throw Error(p$1(188));return vt.stateNode.current===vt?xt:yt}function Zb(xt){return xt=Yb(xt),xt!==null?$b(xt):null}function $b(xt){if(xt.tag===5||xt.tag===6)return xt;for(xt=xt.child;xt!==null;){var yt=$b(xt);if(yt!==null)return yt;xt=xt.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B$1=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(xt){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,xt,void 0,(xt.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(xt){return xt>>>=0,xt===0?32:31-(pc(xt)/qc|0)|0}var rc=64,sc=4194304;function tc(xt){switch(xt&-xt){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return xt&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return xt&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return xt}}function uc(xt,yt){var vt=xt.pendingLanes;if(vt===0)return 0;var bt=0,Tt=xt.suspendedLanes,Et=xt.pingedLanes,wt=vt&268435455;if(wt!==0){var St=wt&~Tt;St!==0?bt=tc(St):(Et&=wt,Et!==0&&(bt=tc(Et)))}else wt=vt&~Tt,wt!==0?bt=tc(wt):Et!==0&&(bt=tc(Et));if(bt===0)return 0;if(yt!==0&&yt!==bt&&!(yt&Tt)&&(Tt=bt&-bt,Et=yt&-yt,Tt>=Et||Tt===16&&(Et&4194240)!==0))return yt;if(bt&4&&(bt|=vt&16),yt=xt.entangledLanes,yt!==0)for(xt=xt.entanglements,yt&=bt;0<yt;)vt=31-oc(yt),Tt=1<<vt,bt|=xt[vt],yt&=~Tt;return bt}function vc(xt,yt){switch(xt){case 1:case 2:case 4:return yt+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return yt+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(xt,yt){for(var vt=xt.suspendedLanes,bt=xt.pingedLanes,Tt=xt.expirationTimes,Et=xt.pendingLanes;0<Et;){var wt=31-oc(Et),St=1<<wt,At=Tt[wt];At===-1?(!(St&vt)||St&bt)&&(Tt[wt]=vc(St,yt)):At<=yt&&(xt.expiredLanes|=St),Et&=~St}}function xc(xt){return xt=xt.pendingLanes&-1073741825,xt!==0?xt:xt&1073741824?1073741824:0}function yc(){var xt=rc;return rc<<=1,!(rc&4194240)&&(rc=64),xt}function zc(xt){for(var yt=[],vt=0;31>vt;vt++)yt.push(xt);return yt}function Ac(xt,yt,vt){xt.pendingLanes|=yt,yt!==536870912&&(xt.suspendedLanes=0,xt.pingedLanes=0),xt=xt.eventTimes,yt=31-oc(yt),xt[yt]=vt}function Bc(xt,yt){var vt=xt.pendingLanes&~yt;xt.pendingLanes=yt,xt.suspendedLanes=0,xt.pingedLanes=0,xt.expiredLanes&=yt,xt.mutableReadLanes&=yt,xt.entangledLanes&=yt,yt=xt.entanglements;var bt=xt.eventTimes;for(xt=xt.expirationTimes;0<vt;){var Tt=31-oc(vt),Et=1<<Tt;yt[Tt]=0,bt[Tt]=-1,xt[Tt]=-1,vt&=~Et}}function Cc(xt,yt){var vt=xt.entangledLanes|=yt;for(xt=xt.entanglements;vt;){var bt=31-oc(vt),Tt=1<<bt;Tt&yt|xt[bt]&yt&&(xt[bt]|=yt),vt&=~Tt}}var C$1=0;function Dc(xt){return xt&=-xt,1<xt?4<xt?xt&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(xt,yt){switch(xt){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(yt.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(yt.pointerId)}}function Tc(xt,yt,vt,bt,Tt,Et){return xt===null||xt.nativeEvent!==Et?(xt={blockedOn:yt,domEventName:vt,eventSystemFlags:bt,nativeEvent:Et,targetContainers:[Tt]},yt!==null&&(yt=Cb(yt),yt!==null&&Fc(yt)),xt):(xt.eventSystemFlags|=bt,yt=xt.targetContainers,Tt!==null&&yt.indexOf(Tt)===-1&&yt.push(Tt),xt)}function Uc(xt,yt,vt,bt,Tt){switch(yt){case"focusin":return Lc=Tc(Lc,xt,yt,vt,bt,Tt),!0;case"dragenter":return Mc=Tc(Mc,xt,yt,vt,bt,Tt),!0;case"mouseover":return Nc=Tc(Nc,xt,yt,vt,bt,Tt),!0;case"pointerover":var Et=Tt.pointerId;return Oc.set(Et,Tc(Oc.get(Et)||null,xt,yt,vt,bt,Tt)),!0;case"gotpointercapture":return Et=Tt.pointerId,Pc.set(Et,Tc(Pc.get(Et)||null,xt,yt,vt,bt,Tt)),!0}return!1}function Vc(xt){var yt=Wc(xt.target);if(yt!==null){var vt=Vb(yt);if(vt!==null){if(yt=vt.tag,yt===13){if(yt=Wb(vt),yt!==null){xt.blockedOn=yt,Ic(xt.priority,function(){Gc(vt)});return}}else if(yt===3&&vt.stateNode.current.memoizedState.isDehydrated){xt.blockedOn=vt.tag===3?vt.stateNode.containerInfo:null;return}}}xt.blockedOn=null}function Xc(xt){if(xt.blockedOn!==null)return!1;for(var yt=xt.targetContainers;0<yt.length;){var vt=Yc(xt.domEventName,xt.eventSystemFlags,yt[0],xt.nativeEvent);if(vt===null){vt=xt.nativeEvent;var bt=new vt.constructor(vt.type,vt);wb=bt,vt.target.dispatchEvent(bt),wb=null}else return yt=Cb(vt),yt!==null&&Fc(yt),xt.blockedOn=vt,!1;yt.shift()}return!0}function Zc(xt,yt,vt){Xc(xt)&&vt.delete(yt)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(xt,yt){xt.blockedOn===yt&&(xt.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(xt){function yt(Tt){return ad(Tt,xt)}if(0<Kc.length){ad(Kc[0],xt);for(var vt=1;vt<Kc.length;vt++){var bt=Kc[vt];bt.blockedOn===xt&&(bt.blockedOn=null)}}for(Lc!==null&&ad(Lc,xt),Mc!==null&&ad(Mc,xt),Nc!==null&&ad(Nc,xt),Oc.forEach(yt),Pc.forEach(yt),vt=0;vt<Qc.length;vt++)bt=Qc[vt],bt.blockedOn===xt&&(bt.blockedOn=null);for(;0<Qc.length&&(vt=Qc[0],vt.blockedOn===null);)Vc(vt),vt.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(xt,yt,vt,bt){var Tt=C$1,Et=cd.transition;cd.transition=null;try{C$1=1,fd(xt,yt,vt,bt)}finally{C$1=Tt,cd.transition=Et}}function gd(xt,yt,vt,bt){var Tt=C$1,Et=cd.transition;cd.transition=null;try{C$1=4,fd(xt,yt,vt,bt)}finally{C$1=Tt,cd.transition=Et}}function fd(xt,yt,vt,bt){if(dd){var Tt=Yc(xt,yt,vt,bt);if(Tt===null)hd(xt,yt,bt,id,vt),Sc(xt,bt);else if(Uc(Tt,xt,yt,vt,bt))bt.stopPropagation();else if(Sc(xt,bt),yt&4&&-1<Rc.indexOf(xt)){for(;Tt!==null;){var Et=Cb(Tt);if(Et!==null&&Ec(Et),Et=Yc(xt,yt,vt,bt),Et===null&&hd(xt,yt,bt,id,vt),Et===Tt)break;Tt=Et}Tt!==null&&bt.stopPropagation()}else hd(xt,yt,bt,null,vt)}}var id=null;function Yc(xt,yt,vt,bt){if(id=null,xt=xb(bt),xt=Wc(xt),xt!==null)if(yt=Vb(xt),yt===null)xt=null;else if(vt=yt.tag,vt===13){if(xt=Wb(yt),xt!==null)return xt;xt=null}else if(vt===3){if(yt.stateNode.current.memoizedState.isDehydrated)return yt.tag===3?yt.stateNode.containerInfo:null;xt=null}else yt!==xt&&(xt=null);return id=xt,null}function jd(xt){switch(xt){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var xt,yt=ld,vt=yt.length,bt,Tt="value"in kd?kd.value:kd.textContent,Et=Tt.length;for(xt=0;xt<vt&&yt[xt]===Tt[xt];xt++);var wt=vt-xt;for(bt=1;bt<=wt&&yt[vt-bt]===Tt[Et-bt];bt++);return md=Tt.slice(xt,1<bt?1-bt:void 0)}function od(xt){var yt=xt.keyCode;return"charCode"in xt?(xt=xt.charCode,xt===0&&yt===13&&(xt=13)):xt=yt,xt===10&&(xt=13),32<=xt||xt===13?xt:0}function pd(){return!0}function qd(){return!1}function rd(xt){function yt(vt,bt,Tt,Et,wt){this._reactName=vt,this._targetInst=Tt,this.type=bt,this.nativeEvent=Et,this.target=wt,this.currentTarget=null;for(var St in xt)xt.hasOwnProperty(St)&&(vt=xt[St],this[St]=vt?vt(Et):Et[St]);return this.isDefaultPrevented=(Et.defaultPrevented!=null?Et.defaultPrevented:Et.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A$1(yt.prototype,{preventDefault:function(){this.defaultPrevented=!0;var vt=this.nativeEvent;vt&&(vt.preventDefault?vt.preventDefault():typeof vt.returnValue!="unknown"&&(vt.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var vt=this.nativeEvent;vt&&(vt.stopPropagation?vt.stopPropagation():typeof vt.cancelBubble!="unknown"&&(vt.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),yt}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(xt){return xt.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A$1({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A$1({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(xt){return xt.relatedTarget===void 0?xt.fromElement===xt.srcElement?xt.toElement:xt.fromElement:xt.relatedTarget},movementX:function(xt){return"movementX"in xt?xt.movementX:(xt!==yd&&(yd&&xt.type==="mousemove"?(wd=xt.screenX-yd.screenX,xd=xt.screenY-yd.screenY):xd=wd=0,yd=xt),wd)},movementY:function(xt){return"movementY"in xt?xt.movementY:xd}}),Bd=rd(Ad),Cd=A$1({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A$1({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A$1({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A$1({},sd,{clipboardData:function(xt){return"clipboardData"in xt?xt.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A$1({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(xt){var yt=this.nativeEvent;return yt.getModifierState?yt.getModifierState(xt):(xt=Od[xt])?!!yt[xt]:!1}function zd(){return Pd}var Qd=A$1({},ud,{key:function(xt){if(xt.key){var yt=Md[xt.key]||xt.key;if(yt!=="Unidentified")return yt}return xt.type==="keypress"?(xt=od(xt),xt===13?"Enter":String.fromCharCode(xt)):xt.type==="keydown"||xt.type==="keyup"?Nd[xt.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(xt){return xt.type==="keypress"?od(xt):0},keyCode:function(xt){return xt.type==="keydown"||xt.type==="keyup"?xt.keyCode:0},which:function(xt){return xt.type==="keypress"?od(xt):xt.type==="keydown"||xt.type==="keyup"?xt.keyCode:0}}),Rd=rd(Qd),Sd=A$1({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A$1({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A$1({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A$1({},Ad,{deltaX:function(xt){return"deltaX"in xt?xt.deltaX:"wheelDeltaX"in xt?-xt.wheelDeltaX:0},deltaY:function(xt){return"deltaY"in xt?xt.deltaY:"wheelDeltaY"in xt?-xt.wheelDeltaY:"wheelDelta"in xt?-xt.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae$1=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce$1=ia&&"TextEvent"in window&&!be,de$1=ia&&(!ae$1||be&&8<be&&11>=be),ee$1=" ",fe$1=!1;function ge$1(xt,yt){switch(xt){case"keyup":return $d.indexOf(yt.keyCode)!==-1;case"keydown":return yt.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(xt){return xt=xt.detail,typeof xt=="object"&&"data"in xt?xt.data:null}var ie$1=!1;function je$1(xt,yt){switch(xt){case"compositionend":return he$1(yt);case"keypress":return yt.which!==32?null:(fe$1=!0,ee$1);case"textInput":return xt=yt.data,xt===ee$1&&fe$1?null:xt;default:return null}}function ke$1(xt,yt){if(ie$1)return xt==="compositionend"||!ae$1&&ge$1(xt,yt)?(xt=nd(),md=ld=kd=null,ie$1=!1,xt):null;switch(xt){case"paste":return null;case"keypress":if(!(yt.ctrlKey||yt.altKey||yt.metaKey)||yt.ctrlKey&&yt.altKey){if(yt.char&&1<yt.char.length)return yt.char;if(yt.which)return String.fromCharCode(yt.which)}return null;case"compositionend":return de$1&&yt.locale!=="ko"?null:yt.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$1(xt){var yt=xt&&xt.nodeName&&xt.nodeName.toLowerCase();return yt==="input"?!!le$1[xt.type]:yt==="textarea"}function ne$1(xt,yt,vt,bt){Eb(bt),yt=oe$1(yt,"onChange"),0<yt.length&&(vt=new td("onChange","change",null,vt,bt),xt.push({event:vt,listeners:yt}))}var pe$1=null,qe$1=null;function re$1(xt){se$1(xt,0)}function te$1(xt){var yt=ue$1(xt);if(Wa(yt))return xt}function ve$1(xt,yt){if(xt==="change")return yt}var we$1=!1;if(ia){var xe$1;if(ia){var ye$1="oninput"in document;if(!ye$1){var ze$1=document.createElement("div");ze$1.setAttribute("oninput","return;"),ye$1=typeof ze$1.oninput=="function"}xe$1=ye$1}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae$1(){pe$1&&(pe$1.detachEvent("onpropertychange",Be$1),qe$1=pe$1=null)}function Be$1(xt){if(xt.propertyName==="value"&&te$1(qe$1)){var yt=[];ne$1(yt,qe$1,xt,xb(xt)),Jb(re$1,yt)}}function Ce$1(xt,yt,vt){xt==="focusin"?(Ae$1(),pe$1=yt,qe$1=vt,pe$1.attachEvent("onpropertychange",Be$1)):xt==="focusout"&&Ae$1()}function De$1(xt){if(xt==="selectionchange"||xt==="keyup"||xt==="keydown")return te$1(qe$1)}function Ee$1(xt,yt){if(xt==="click")return te$1(yt)}function Fe$1(xt,yt){if(xt==="input"||xt==="change")return te$1(yt)}function Ge$1(xt,yt){return xt===yt&&(xt!==0||1/xt===1/yt)||xt!==xt&&yt!==yt}var He$1=typeof Object.is=="function"?Object.is:Ge$1;function Ie$1(xt,yt){if(He$1(xt,yt))return!0;if(typeof xt!="object"||xt===null||typeof yt!="object"||yt===null)return!1;var vt=Object.keys(xt),bt=Object.keys(yt);if(vt.length!==bt.length)return!1;for(bt=0;bt<vt.length;bt++){var Tt=vt[bt];if(!ja.call(yt,Tt)||!He$1(xt[Tt],yt[Tt]))return!1}return!0}function Je$1(xt){for(;xt&&xt.firstChild;)xt=xt.firstChild;return xt}function Ke$1(xt,yt){var vt=Je$1(xt);xt=0;for(var bt;vt;){if(vt.nodeType===3){if(bt=xt+vt.textContent.length,xt<=yt&&bt>=yt)return{node:vt,offset:yt-xt};xt=bt}e:{for(;vt;){if(vt.nextSibling){vt=vt.nextSibling;break e}vt=vt.parentNode}vt=void 0}vt=Je$1(vt)}}function Le$1(xt,yt){return xt&&yt?xt===yt?!0:xt&&xt.nodeType===3?!1:yt&&yt.nodeType===3?Le$1(xt,yt.parentNode):"contains"in xt?xt.contains(yt):xt.compareDocumentPosition?!!(xt.compareDocumentPosition(yt)&16):!1:!1}function Me$1(){for(var xt=window,yt=Xa();yt instanceof xt.HTMLIFrameElement;){try{var vt=typeof yt.contentWindow.location.href=="string"}catch{vt=!1}if(vt)xt=yt.contentWindow;else break;yt=Xa(xt.document)}return yt}function Ne$1(xt){var yt=xt&&xt.nodeName&&xt.nodeName.toLowerCase();return yt&&(yt==="input"&&(xt.type==="text"||xt.type==="search"||xt.type==="tel"||xt.type==="url"||xt.type==="password")||yt==="textarea"||xt.contentEditable==="true")}function Oe$1(xt){var yt=Me$1(),vt=xt.focusedElem,bt=xt.selectionRange;if(yt!==vt&&vt&&vt.ownerDocument&&Le$1(vt.ownerDocument.documentElement,vt)){if(bt!==null&&Ne$1(vt)){if(yt=bt.start,xt=bt.end,xt===void 0&&(xt=yt),"selectionStart"in vt)vt.selectionStart=yt,vt.selectionEnd=Math.min(xt,vt.value.length);else if(xt=(yt=vt.ownerDocument||document)&&yt.defaultView||window,xt.getSelection){xt=xt.getSelection();var Tt=vt.textContent.length,Et=Math.min(bt.start,Tt);bt=bt.end===void 0?Et:Math.min(bt.end,Tt),!xt.extend&&Et>bt&&(Tt=bt,bt=Et,Et=Tt),Tt=Ke$1(vt,Et);var wt=Ke$1(vt,bt);Tt&&wt&&(xt.rangeCount!==1||xt.anchorNode!==Tt.node||xt.anchorOffset!==Tt.offset||xt.focusNode!==wt.node||xt.focusOffset!==wt.offset)&&(yt=yt.createRange(),yt.setStart(Tt.node,Tt.offset),xt.removeAllRanges(),Et>bt?(xt.addRange(yt),xt.extend(wt.node,wt.offset)):(yt.setEnd(wt.node,wt.offset),xt.addRange(yt)))}}for(yt=[],xt=vt;xt=xt.parentNode;)xt.nodeType===1&&yt.push({element:xt,left:xt.scrollLeft,top:xt.scrollTop});for(typeof vt.focus=="function"&&vt.focus(),vt=0;vt<yt.length;vt++)xt=yt[vt],xt.element.scrollLeft=xt.left,xt.element.scrollTop=xt.top}}var Pe$1=ia&&"documentMode"in document&&11>=document.documentMode,Qe$1=null,Re$1=null,Se$1=null,Te$1=!1;function Ue$1(xt,yt,vt){var bt=vt.window===vt?vt.document:vt.nodeType===9?vt:vt.ownerDocument;Te$1||Qe$1==null||Qe$1!==Xa(bt)||(bt=Qe$1,"selectionStart"in bt&&Ne$1(bt)?bt={start:bt.selectionStart,end:bt.selectionEnd}:(bt=(bt.ownerDocument&&bt.ownerDocument.defaultView||window).getSelection(),bt={anchorNode:bt.anchorNode,anchorOffset:bt.anchorOffset,focusNode:bt.focusNode,focusOffset:bt.focusOffset}),Se$1&&Ie$1(Se$1,bt)||(Se$1=bt,bt=oe$1(Re$1,"onSelect"),0<bt.length&&(yt=new td("onSelect","select",null,yt,vt),xt.push({event:yt,listeners:bt}),yt.target=Qe$1)))}function Ve$1(xt,yt){var vt={};return vt[xt.toLowerCase()]=yt.toLowerCase(),vt["Webkit"+xt]="webkit"+yt,vt["Moz"+xt]="moz"+yt,vt}var We$1={animationend:Ve$1("Animation","AnimationEnd"),animationiteration:Ve$1("Animation","AnimationIteration"),animationstart:Ve$1("Animation","AnimationStart"),transitionend:Ve$1("Transition","TransitionEnd")},Xe$1={},Ye$1={};ia&&(Ye$1=document.createElement("div").style,"AnimationEvent"in window||(delete We$1.animationend.animation,delete We$1.animationiteration.animation,delete We$1.animationstart.animation),"TransitionEvent"in window||delete We$1.transitionend.transition);function Ze$1(xt){if(Xe$1[xt])return Xe$1[xt];if(!We$1[xt])return xt;var yt=We$1[xt],vt;for(vt in yt)if(yt.hasOwnProperty(vt)&&vt in Ye$1)return Xe$1[xt]=yt[vt];return xt}var $e$1=Ze$1("animationend"),af=Ze$1("animationiteration"),bf=Ze$1("animationstart"),cf=Ze$1("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(xt,yt){df.set(xt,yt),fa(yt,[xt])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e$1,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(xt,yt,vt){var bt=xt.type||"unknown-event";xt.currentTarget=vt,Ub(bt,yt,void 0,xt),xt.currentTarget=null}function se$1(xt,yt){yt=(yt&4)!==0;for(var vt=0;vt<xt.length;vt++){var bt=xt[vt],Tt=bt.event;bt=bt.listeners;e:{var Et=void 0;if(yt)for(var wt=bt.length-1;0<=wt;wt--){var St=bt[wt],At=St.instance,Rt=St.currentTarget;if(St=St.listener,At!==Et&&Tt.isPropagationStopped())break e;nf(Tt,St,Rt),Et=At}else for(wt=0;wt<bt.length;wt++){if(St=bt[wt],At=St.instance,Rt=St.currentTarget,St=St.listener,At!==Et&&Tt.isPropagationStopped())break e;nf(Tt,St,Rt),Et=At}}}if(Qb)throw xt=Rb,Qb=!1,Rb=null,xt}function D$1(xt,yt){var vt=yt[of];vt===void 0&&(vt=yt[of]=new Set);var bt=xt+"__bubble";vt.has(bt)||(pf(yt,xt,2,!1),vt.add(bt))}function qf(xt,yt,vt){var bt=0;yt&&(bt|=4),pf(vt,xt,bt,yt)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(xt){if(!xt[rf]){xt[rf]=!0,da.forEach(function(vt){vt!=="selectionchange"&&(mf.has(vt)||qf(vt,!1,xt),qf(vt,!0,xt))});var yt=xt.nodeType===9?xt:xt.ownerDocument;yt===null||yt[rf]||(yt[rf]=!0,qf("selectionchange",!1,yt))}}function pf(xt,yt,vt,bt){switch(jd(yt)){case 1:var Tt=ed;break;case 4:Tt=gd;break;default:Tt=fd}vt=Tt.bind(null,yt,vt,xt),Tt=void 0,!Lb||yt!=="touchstart"&&yt!=="touchmove"&&yt!=="wheel"||(Tt=!0),bt?Tt!==void 0?xt.addEventListener(yt,vt,{capture:!0,passive:Tt}):xt.addEventListener(yt,vt,!0):Tt!==void 0?xt.addEventListener(yt,vt,{passive:Tt}):xt.addEventListener(yt,vt,!1)}function hd(xt,yt,vt,bt,Tt){var Et=bt;if(!(yt&1)&&!(yt&2)&&bt!==null)e:for(;;){if(bt===null)return;var wt=bt.tag;if(wt===3||wt===4){var St=bt.stateNode.containerInfo;if(St===Tt||St.nodeType===8&&St.parentNode===Tt)break;if(wt===4)for(wt=bt.return;wt!==null;){var At=wt.tag;if((At===3||At===4)&&(At=wt.stateNode.containerInfo,At===Tt||At.nodeType===8&&At.parentNode===Tt))return;wt=wt.return}for(;St!==null;){if(wt=Wc(St),wt===null)return;if(At=wt.tag,At===5||At===6){bt=Et=wt;continue e}St=St.parentNode}}bt=bt.return}Jb(function(){var Rt=Et,Pt=xb(vt),Ct=[];e:{var It=df.get(xt);if(It!==void 0){var Mt=td,Ot=xt;switch(xt){case"keypress":if(od(vt)===0)break e;case"keydown":case"keyup":Mt=Rd;break;case"focusin":Ot="focus",Mt=Fd;break;case"focusout":Ot="blur",Mt=Fd;break;case"beforeblur":case"afterblur":Mt=Fd;break;case"click":if(vt.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Mt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Mt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Mt=Vd;break;case $e$1:case af:case bf:Mt=Hd;break;case cf:Mt=Xd;break;case"scroll":Mt=vd;break;case"wheel":Mt=Zd;break;case"copy":case"cut":case"paste":Mt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Mt=Td}var kt=(yt&4)!==0,Ft=!kt&&xt==="scroll",Nt=kt?It!==null?It+"Capture":null:It;kt=[];for(var Lt=Rt,Dt;Lt!==null;){Dt=Lt;var $t=Dt.stateNode;if(Dt.tag===5&&$t!==null&&(Dt=$t,Nt!==null&&($t=Kb(Lt,Nt),$t!=null&&kt.push(tf(Lt,$t,Dt)))),Ft)break;Lt=Lt.return}0<kt.length&&(It=new Mt(It,Ot,null,vt,Pt),Ct.push({event:It,listeners:kt}))}}if(!(yt&7)){e:{if(It=xt==="mouseover"||xt==="pointerover",Mt=xt==="mouseout"||xt==="pointerout",It&&vt!==wb&&(Ot=vt.relatedTarget||vt.fromElement)&&(Wc(Ot)||Ot[uf]))break e;if((Mt||It)&&(It=Pt.window===Pt?Pt:(It=Pt.ownerDocument)?It.defaultView||It.parentWindow:window,Mt?(Ot=vt.relatedTarget||vt.toElement,Mt=Rt,Ot=Ot?Wc(Ot):null,Ot!==null&&(Ft=Vb(Ot),Ot!==Ft||Ot.tag!==5&&Ot.tag!==6)&&(Ot=null)):(Mt=null,Ot=Rt),Mt!==Ot)){if(kt=Bd,$t="onMouseLeave",Nt="onMouseEnter",Lt="mouse",(xt==="pointerout"||xt==="pointerover")&&(kt=Td,$t="onPointerLeave",Nt="onPointerEnter",Lt="pointer"),Ft=Mt==null?It:ue$1(Mt),Dt=Ot==null?It:ue$1(Ot),It=new kt($t,Lt+"leave",Mt,vt,Pt),It.target=Ft,It.relatedTarget=Dt,$t=null,Wc(Pt)===Rt&&(kt=new kt(Nt,Lt+"enter",Ot,vt,Pt),kt.target=Dt,kt.relatedTarget=Ft,$t=kt),Ft=$t,Mt&&Ot)t:{for(kt=Mt,Nt=Ot,Lt=0,Dt=kt;Dt;Dt=vf(Dt))Lt++;for(Dt=0,$t=Nt;$t;$t=vf($t))Dt++;for(;0<Lt-Dt;)kt=vf(kt),Lt--;for(;0<Dt-Lt;)Nt=vf(Nt),Dt--;for(;Lt--;){if(kt===Nt||Nt!==null&&kt===Nt.alternate)break t;kt=vf(kt),Nt=vf(Nt)}kt=null}else kt=null;Mt!==null&&wf(Ct,It,Mt,kt,!1),Ot!==null&&Ft!==null&&wf(Ct,Ft,Ot,kt,!0)}}e:{if(It=Rt?ue$1(Rt):window,Mt=It.nodeName&&It.nodeName.toLowerCase(),Mt==="select"||Mt==="input"&&It.type==="file")var zt=ve$1;else if(me$1(It))if(we$1)zt=Fe$1;else{zt=De$1;var Ut=Ce$1}else(Mt=It.nodeName)&&Mt.toLowerCase()==="input"&&(It.type==="checkbox"||It.type==="radio")&&(zt=Ee$1);if(zt&&(zt=zt(xt,Rt))){ne$1(Ct,zt,vt,Pt);break e}Ut&&Ut(xt,It,Rt),xt==="focusout"&&(Ut=It._wrapperState)&&Ut.controlled&&It.type==="number"&&cb(It,"number",It.value)}switch(Ut=Rt?ue$1(Rt):window,xt){case"focusin":(me$1(Ut)||Ut.contentEditable==="true")&&(Qe$1=Ut,Re$1=Rt,Se$1=null);break;case"focusout":Se$1=Re$1=Qe$1=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue$1(Ct,vt,Pt);break;case"selectionchange":if(Pe$1)break;case"keydown":case"keyup":Ue$1(Ct,vt,Pt)}var jt;if(ae$1)e:{switch(xt){case"compositionstart":var Ht="onCompositionStart";break e;case"compositionend":Ht="onCompositionEnd";break e;case"compositionupdate":Ht="onCompositionUpdate";break e}Ht=void 0}else ie$1?ge$1(xt,vt)&&(Ht="onCompositionEnd"):xt==="keydown"&&vt.keyCode===229&&(Ht="onCompositionStart");Ht&&(de$1&&vt.locale!=="ko"&&(ie$1||Ht!=="onCompositionStart"?Ht==="onCompositionEnd"&&ie$1&&(jt=nd()):(kd=Pt,ld="value"in kd?kd.value:kd.textContent,ie$1=!0)),Ut=oe$1(Rt,Ht),0<Ut.length&&(Ht=new Ld(Ht,xt,null,vt,Pt),Ct.push({event:Ht,listeners:Ut}),jt?Ht.data=jt:(jt=he$1(vt),jt!==null&&(Ht.data=jt)))),(jt=ce$1?je$1(xt,vt):ke$1(xt,vt))&&(Rt=oe$1(Rt,"onBeforeInput"),0<Rt.length&&(Pt=new Ld("onBeforeInput","beforeinput",null,vt,Pt),Ct.push({event:Pt,listeners:Rt}),Pt.data=jt))}se$1(Ct,yt)})}function tf(xt,yt,vt){return{instance:xt,listener:yt,currentTarget:vt}}function oe$1(xt,yt){for(var vt=yt+"Capture",bt=[];xt!==null;){var Tt=xt,Et=Tt.stateNode;Tt.tag===5&&Et!==null&&(Tt=Et,Et=Kb(xt,vt),Et!=null&&bt.unshift(tf(xt,Et,Tt)),Et=Kb(xt,yt),Et!=null&&bt.push(tf(xt,Et,Tt))),xt=xt.return}return bt}function vf(xt){if(xt===null)return null;do xt=xt.return;while(xt&&xt.tag!==5);return xt||null}function wf(xt,yt,vt,bt,Tt){for(var Et=yt._reactName,wt=[];vt!==null&&vt!==bt;){var St=vt,At=St.alternate,Rt=St.stateNode;if(At!==null&&At===bt)break;St.tag===5&&Rt!==null&&(St=Rt,Tt?(At=Kb(vt,Et),At!=null&&wt.unshift(tf(vt,At,St))):Tt||(At=Kb(vt,Et),At!=null&&wt.push(tf(vt,At,St)))),vt=vt.return}wt.length!==0&&xt.push({event:yt,listeners:wt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(xt){return(typeof xt=="string"?xt:""+xt).replace(xf,`
`).replace(yf,"")}function Af(xt,yt,vt){if(yt=zf(yt),zf(xt)!==yt&&vt)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef(xt,yt){return xt==="textarea"||xt==="noscript"||typeof yt.children=="string"||typeof yt.children=="number"||typeof yt.dangerouslySetInnerHTML=="object"&&yt.dangerouslySetInnerHTML!==null&&yt.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(xt){return Hf.resolve(null).then(xt).catch(If)}:Ff;function If(xt){setTimeout(function(){throw xt})}function Kf(xt,yt){var vt=yt,bt=0;do{var Tt=vt.nextSibling;if(xt.removeChild(vt),Tt&&Tt.nodeType===8)if(vt=Tt.data,vt==="/$"){if(bt===0){xt.removeChild(Tt),bd(yt);return}bt--}else vt!=="$"&&vt!=="$?"&&vt!=="$!"||bt++;vt=Tt}while(vt);bd(yt)}function Lf(xt){for(;xt!=null;xt=xt.nextSibling){var yt=xt.nodeType;if(yt===1||yt===3)break;if(yt===8){if(yt=xt.data,yt==="$"||yt==="$!"||yt==="$?")break;if(yt==="/$")return null}}return xt}function Mf(xt){xt=xt.previousSibling;for(var yt=0;xt;){if(xt.nodeType===8){var vt=xt.data;if(vt==="$"||vt==="$!"||vt==="$?"){if(yt===0)return xt;yt--}else vt==="/$"&&yt++}xt=xt.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(xt){var yt=xt[Of];if(yt)return yt;for(var vt=xt.parentNode;vt;){if(yt=vt[uf]||vt[Of]){if(vt=yt.alternate,yt.child!==null||vt!==null&&vt.child!==null)for(xt=Mf(xt);xt!==null;){if(vt=xt[Of])return vt;xt=Mf(xt)}return yt}xt=vt,vt=xt.parentNode}return null}function Cb(xt){return xt=xt[Of]||xt[uf],!xt||xt.tag!==5&&xt.tag!==6&&xt.tag!==13&&xt.tag!==3?null:xt}function ue$1(xt){if(xt.tag===5||xt.tag===6)return xt.stateNode;throw Error(p$1(33))}function Db(xt){return xt[Pf]||null}var Sf=[],Tf=-1;function Uf(xt){return{current:xt}}function E$1(xt){0>Tf||(xt.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G$1(xt,yt){Tf++,Sf[Tf]=xt.current,xt.current=yt}var Vf={},H$1=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(xt,yt){var vt=xt.type.contextTypes;if(!vt)return Vf;var bt=xt.stateNode;if(bt&&bt.__reactInternalMemoizedUnmaskedChildContext===yt)return bt.__reactInternalMemoizedMaskedChildContext;var Tt={},Et;for(Et in vt)Tt[Et]=yt[Et];return bt&&(xt=xt.stateNode,xt.__reactInternalMemoizedUnmaskedChildContext=yt,xt.__reactInternalMemoizedMaskedChildContext=Tt),Tt}function Zf(xt){return xt=xt.childContextTypes,xt!=null}function $f(){E$1(Wf),E$1(H$1)}function ag(xt,yt,vt){if(H$1.current!==Vf)throw Error(p$1(168));G$1(H$1,yt),G$1(Wf,vt)}function bg(xt,yt,vt){var bt=xt.stateNode;if(yt=yt.childContextTypes,typeof bt.getChildContext!="function")return vt;bt=bt.getChildContext();for(var Tt in bt)if(!(Tt in yt))throw Error(p$1(108,Ra(xt)||"Unknown",Tt));return A$1({},vt,bt)}function cg(xt){return xt=(xt=xt.stateNode)&&xt.__reactInternalMemoizedMergedChildContext||Vf,Xf=H$1.current,G$1(H$1,xt),G$1(Wf,Wf.current),!0}function dg(xt,yt,vt){var bt=xt.stateNode;if(!bt)throw Error(p$1(169));vt?(xt=bg(xt,yt,Xf),bt.__reactInternalMemoizedMergedChildContext=xt,E$1(Wf),E$1(H$1),G$1(H$1,xt)):E$1(Wf),G$1(Wf,vt)}var eg=null,fg=!1,gg=!1;function hg(xt){eg===null?eg=[xt]:eg.push(xt)}function ig(xt){fg=!0,hg(xt)}function jg(){if(!gg&&eg!==null){gg=!0;var xt=0,yt=C$1;try{var vt=eg;for(C$1=1;xt<vt.length;xt++){var bt=vt[xt];do bt=bt(!0);while(bt!==null)}eg=null,fg=!1}catch(Tt){throw eg!==null&&(eg=eg.slice(xt+1)),ac(fc,jg),Tt}finally{C$1=yt,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(xt,yt){kg[lg++]=ng,kg[lg++]=mg,mg=xt,ng=yt}function ug(xt,yt,vt){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=xt;var bt=rg;xt=sg;var Tt=32-oc(bt)-1;bt&=~(1<<Tt),vt+=1;var Et=32-oc(yt)+Tt;if(30<Et){var wt=Tt-Tt%5;Et=(bt&(1<<wt)-1).toString(32),bt>>=wt,Tt-=wt,rg=1<<32-oc(yt)+Tt|vt<<Tt|bt,sg=Et+xt}else rg=1<<Et|vt<<Tt|bt,sg=xt}function vg(xt){xt.return!==null&&(tg(xt,1),ug(xt,1,0))}function wg(xt){for(;xt===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;xt===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I$1=!1,zg=null;function Ag(xt,yt){var vt=Bg(5,null,null,0);vt.elementType="DELETED",vt.stateNode=yt,vt.return=xt,yt=xt.deletions,yt===null?(xt.deletions=[vt],xt.flags|=16):yt.push(vt)}function Cg(xt,yt){switch(xt.tag){case 5:var vt=xt.type;return yt=yt.nodeType!==1||vt.toLowerCase()!==yt.nodeName.toLowerCase()?null:yt,yt!==null?(xt.stateNode=yt,xg=xt,yg=Lf(yt.firstChild),!0):!1;case 6:return yt=xt.pendingProps===""||yt.nodeType!==3?null:yt,yt!==null?(xt.stateNode=yt,xg=xt,yg=null,!0):!1;case 13:return yt=yt.nodeType!==8?null:yt,yt!==null?(vt=qg!==null?{id:rg,overflow:sg}:null,xt.memoizedState={dehydrated:yt,treeContext:vt,retryLane:1073741824},vt=Bg(18,null,null,0),vt.stateNode=yt,vt.return=xt,xt.child=vt,xg=xt,yg=null,!0):!1;default:return!1}}function Dg(xt){return(xt.mode&1)!==0&&(xt.flags&128)===0}function Eg(xt){if(I$1){var yt=yg;if(yt){var vt=yt;if(!Cg(xt,yt)){if(Dg(xt))throw Error(p$1(418));yt=Lf(vt.nextSibling);var bt=xg;yt&&Cg(xt,yt)?Ag(bt,vt):(xt.flags=xt.flags&-4097|2,I$1=!1,xg=xt)}}else{if(Dg(xt))throw Error(p$1(418));xt.flags=xt.flags&-4097|2,I$1=!1,xg=xt}}}function Fg(xt){for(xt=xt.return;xt!==null&&xt.tag!==5&&xt.tag!==3&&xt.tag!==13;)xt=xt.return;xg=xt}function Gg(xt){if(xt!==xg)return!1;if(!I$1)return Fg(xt),I$1=!0,!1;var yt;if((yt=xt.tag!==3)&&!(yt=xt.tag!==5)&&(yt=xt.type,yt=yt!=="head"&&yt!=="body"&&!Ef(xt.type,xt.memoizedProps)),yt&&(yt=yg)){if(Dg(xt))throw Hg(),Error(p$1(418));for(;yt;)Ag(xt,yt),yt=Lf(yt.nextSibling)}if(Fg(xt),xt.tag===13){if(xt=xt.memoizedState,xt=xt!==null?xt.dehydrated:null,!xt)throw Error(p$1(317));e:{for(xt=xt.nextSibling,yt=0;xt;){if(xt.nodeType===8){var vt=xt.data;if(vt==="/$"){if(yt===0){yg=Lf(xt.nextSibling);break e}yt--}else vt!=="$"&&vt!=="$!"&&vt!=="$?"||yt++}xt=xt.nextSibling}yg=null}}else yg=xg?Lf(xt.stateNode.nextSibling):null;return!0}function Hg(){for(var xt=yg;xt;)xt=Lf(xt.nextSibling)}function Ig(){yg=xg=null,I$1=!1}function Jg(xt){zg===null?zg=[xt]:zg.push(xt)}var Kg=ua.ReactCurrentBatchConfig;function Lg(xt,yt,vt){if(xt=vt.ref,xt!==null&&typeof xt!="function"&&typeof xt!="object"){if(vt._owner){if(vt=vt._owner,vt){if(vt.tag!==1)throw Error(p$1(309));var bt=vt.stateNode}if(!bt)throw Error(p$1(147,xt));var Tt=bt,Et=""+xt;return yt!==null&&yt.ref!==null&&typeof yt.ref=="function"&&yt.ref._stringRef===Et?yt.ref:(yt=function(wt){var St=Tt.refs;wt===null?delete St[Et]:St[Et]=wt},yt._stringRef=Et,yt)}if(typeof xt!="string")throw Error(p$1(284));if(!vt._owner)throw Error(p$1(290,xt))}return xt}function Mg(xt,yt){throw xt=Object.prototype.toString.call(yt),Error(p$1(31,xt==="[object Object]"?"object with keys {"+Object.keys(yt).join(", ")+"}":xt))}function Ng(xt){var yt=xt._init;return yt(xt._payload)}function Og(xt){function yt(Nt,Lt){if(xt){var Dt=Nt.deletions;Dt===null?(Nt.deletions=[Lt],Nt.flags|=16):Dt.push(Lt)}}function vt(Nt,Lt){if(!xt)return null;for(;Lt!==null;)yt(Nt,Lt),Lt=Lt.sibling;return null}function bt(Nt,Lt){for(Nt=new Map;Lt!==null;)Lt.key!==null?Nt.set(Lt.key,Lt):Nt.set(Lt.index,Lt),Lt=Lt.sibling;return Nt}function Tt(Nt,Lt){return Nt=Pg(Nt,Lt),Nt.index=0,Nt.sibling=null,Nt}function Et(Nt,Lt,Dt){return Nt.index=Dt,xt?(Dt=Nt.alternate,Dt!==null?(Dt=Dt.index,Dt<Lt?(Nt.flags|=2,Lt):Dt):(Nt.flags|=2,Lt)):(Nt.flags|=1048576,Lt)}function wt(Nt){return xt&&Nt.alternate===null&&(Nt.flags|=2),Nt}function St(Nt,Lt,Dt,$t){return Lt===null||Lt.tag!==6?(Lt=Qg(Dt,Nt.mode,$t),Lt.return=Nt,Lt):(Lt=Tt(Lt,Dt),Lt.return=Nt,Lt)}function At(Nt,Lt,Dt,$t){var zt=Dt.type;return zt===ya?Pt(Nt,Lt,Dt.props.children,$t,Dt.key):Lt!==null&&(Lt.elementType===zt||typeof zt=="object"&&zt!==null&&zt.$$typeof===Ha&&Ng(zt)===Lt.type)?($t=Tt(Lt,Dt.props),$t.ref=Lg(Nt,Lt,Dt),$t.return=Nt,$t):($t=Rg(Dt.type,Dt.key,Dt.props,null,Nt.mode,$t),$t.ref=Lg(Nt,Lt,Dt),$t.return=Nt,$t)}function Rt(Nt,Lt,Dt,$t){return Lt===null||Lt.tag!==4||Lt.stateNode.containerInfo!==Dt.containerInfo||Lt.stateNode.implementation!==Dt.implementation?(Lt=Sg(Dt,Nt.mode,$t),Lt.return=Nt,Lt):(Lt=Tt(Lt,Dt.children||[]),Lt.return=Nt,Lt)}function Pt(Nt,Lt,Dt,$t,zt){return Lt===null||Lt.tag!==7?(Lt=Tg(Dt,Nt.mode,$t,zt),Lt.return=Nt,Lt):(Lt=Tt(Lt,Dt),Lt.return=Nt,Lt)}function Ct(Nt,Lt,Dt){if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number")return Lt=Qg(""+Lt,Nt.mode,Dt),Lt.return=Nt,Lt;if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case va:return Dt=Rg(Lt.type,Lt.key,Lt.props,null,Nt.mode,Dt),Dt.ref=Lg(Nt,null,Lt),Dt.return=Nt,Dt;case wa:return Lt=Sg(Lt,Nt.mode,Dt),Lt.return=Nt,Lt;case Ha:var $t=Lt._init;return Ct(Nt,$t(Lt._payload),Dt)}if(eb(Lt)||Ka(Lt))return Lt=Tg(Lt,Nt.mode,Dt,null),Lt.return=Nt,Lt;Mg(Nt,Lt)}return null}function It(Nt,Lt,Dt,$t){var zt=Lt!==null?Lt.key:null;if(typeof Dt=="string"&&Dt!==""||typeof Dt=="number")return zt!==null?null:St(Nt,Lt,""+Dt,$t);if(typeof Dt=="object"&&Dt!==null){switch(Dt.$$typeof){case va:return Dt.key===zt?At(Nt,Lt,Dt,$t):null;case wa:return Dt.key===zt?Rt(Nt,Lt,Dt,$t):null;case Ha:return zt=Dt._init,It(Nt,Lt,zt(Dt._payload),$t)}if(eb(Dt)||Ka(Dt))return zt!==null?null:Pt(Nt,Lt,Dt,$t,null);Mg(Nt,Dt)}return null}function Mt(Nt,Lt,Dt,$t,zt){if(typeof $t=="string"&&$t!==""||typeof $t=="number")return Nt=Nt.get(Dt)||null,St(Lt,Nt,""+$t,zt);if(typeof $t=="object"&&$t!==null){switch($t.$$typeof){case va:return Nt=Nt.get($t.key===null?Dt:$t.key)||null,At(Lt,Nt,$t,zt);case wa:return Nt=Nt.get($t.key===null?Dt:$t.key)||null,Rt(Lt,Nt,$t,zt);case Ha:var Ut=$t._init;return Mt(Nt,Lt,Dt,Ut($t._payload),zt)}if(eb($t)||Ka($t))return Nt=Nt.get(Dt)||null,Pt(Lt,Nt,$t,zt,null);Mg(Lt,$t)}return null}function Ot(Nt,Lt,Dt,$t){for(var zt=null,Ut=null,jt=Lt,Ht=Lt=0,Vt=null;jt!==null&&Ht<Dt.length;Ht++){jt.index>Ht?(Vt=jt,jt=null):Vt=jt.sibling;var Wt=It(Nt,jt,Dt[Ht],$t);if(Wt===null){jt===null&&(jt=Vt);break}xt&&jt&&Wt.alternate===null&&yt(Nt,jt),Lt=Et(Wt,Lt,Ht),Ut===null?zt=Wt:Ut.sibling=Wt,Ut=Wt,jt=Vt}if(Ht===Dt.length)return vt(Nt,jt),I$1&&tg(Nt,Ht),zt;if(jt===null){for(;Ht<Dt.length;Ht++)jt=Ct(Nt,Dt[Ht],$t),jt!==null&&(Lt=Et(jt,Lt,Ht),Ut===null?zt=jt:Ut.sibling=jt,Ut=jt);return I$1&&tg(Nt,Ht),zt}for(jt=bt(Nt,jt);Ht<Dt.length;Ht++)Vt=Mt(jt,Nt,Ht,Dt[Ht],$t),Vt!==null&&(xt&&Vt.alternate!==null&&jt.delete(Vt.key===null?Ht:Vt.key),Lt=Et(Vt,Lt,Ht),Ut===null?zt=Vt:Ut.sibling=Vt,Ut=Vt);return xt&&jt.forEach(function(Yt){return yt(Nt,Yt)}),I$1&&tg(Nt,Ht),zt}function kt(Nt,Lt,Dt,$t){var zt=Ka(Dt);if(typeof zt!="function")throw Error(p$1(150));if(Dt=zt.call(Dt),Dt==null)throw Error(p$1(151));for(var Ut=zt=null,jt=Lt,Ht=Lt=0,Vt=null,Wt=Dt.next();jt!==null&&!Wt.done;Ht++,Wt=Dt.next()){jt.index>Ht?(Vt=jt,jt=null):Vt=jt.sibling;var Yt=It(Nt,jt,Wt.value,$t);if(Yt===null){jt===null&&(jt=Vt);break}xt&&jt&&Yt.alternate===null&&yt(Nt,jt),Lt=Et(Yt,Lt,Ht),Ut===null?zt=Yt:Ut.sibling=Yt,Ut=Yt,jt=Vt}if(Wt.done)return vt(Nt,jt),I$1&&tg(Nt,Ht),zt;if(jt===null){for(;!Wt.done;Ht++,Wt=Dt.next())Wt=Ct(Nt,Wt.value,$t),Wt!==null&&(Lt=Et(Wt,Lt,Ht),Ut===null?zt=Wt:Ut.sibling=Wt,Ut=Wt);return I$1&&tg(Nt,Ht),zt}for(jt=bt(Nt,jt);!Wt.done;Ht++,Wt=Dt.next())Wt=Mt(jt,Nt,Ht,Wt.value,$t),Wt!==null&&(xt&&Wt.alternate!==null&&jt.delete(Wt.key===null?Ht:Wt.key),Lt=Et(Wt,Lt,Ht),Ut===null?zt=Wt:Ut.sibling=Wt,Ut=Wt);return xt&&jt.forEach(function(Kt){return yt(Nt,Kt)}),I$1&&tg(Nt,Ht),zt}function Ft(Nt,Lt,Dt,$t){if(typeof Dt=="object"&&Dt!==null&&Dt.type===ya&&Dt.key===null&&(Dt=Dt.props.children),typeof Dt=="object"&&Dt!==null){switch(Dt.$$typeof){case va:e:{for(var zt=Dt.key,Ut=Lt;Ut!==null;){if(Ut.key===zt){if(zt=Dt.type,zt===ya){if(Ut.tag===7){vt(Nt,Ut.sibling),Lt=Tt(Ut,Dt.props.children),Lt.return=Nt,Nt=Lt;break e}}else if(Ut.elementType===zt||typeof zt=="object"&&zt!==null&&zt.$$typeof===Ha&&Ng(zt)===Ut.type){vt(Nt,Ut.sibling),Lt=Tt(Ut,Dt.props),Lt.ref=Lg(Nt,Ut,Dt),Lt.return=Nt,Nt=Lt;break e}vt(Nt,Ut);break}else yt(Nt,Ut);Ut=Ut.sibling}Dt.type===ya?(Lt=Tg(Dt.props.children,Nt.mode,$t,Dt.key),Lt.return=Nt,Nt=Lt):($t=Rg(Dt.type,Dt.key,Dt.props,null,Nt.mode,$t),$t.ref=Lg(Nt,Lt,Dt),$t.return=Nt,Nt=$t)}return wt(Nt);case wa:e:{for(Ut=Dt.key;Lt!==null;){if(Lt.key===Ut)if(Lt.tag===4&&Lt.stateNode.containerInfo===Dt.containerInfo&&Lt.stateNode.implementation===Dt.implementation){vt(Nt,Lt.sibling),Lt=Tt(Lt,Dt.children||[]),Lt.return=Nt,Nt=Lt;break e}else{vt(Nt,Lt);break}else yt(Nt,Lt);Lt=Lt.sibling}Lt=Sg(Dt,Nt.mode,$t),Lt.return=Nt,Nt=Lt}return wt(Nt);case Ha:return Ut=Dt._init,Ft(Nt,Lt,Ut(Dt._payload),$t)}if(eb(Dt))return Ot(Nt,Lt,Dt,$t);if(Ka(Dt))return kt(Nt,Lt,Dt,$t);Mg(Nt,Dt)}return typeof Dt=="string"&&Dt!==""||typeof Dt=="number"?(Dt=""+Dt,Lt!==null&&Lt.tag===6?(vt(Nt,Lt.sibling),Lt=Tt(Lt,Dt),Lt.return=Nt,Nt=Lt):(vt(Nt,Lt),Lt=Qg(Dt,Nt.mode,$t),Lt.return=Nt,Nt=Lt),wt(Nt)):vt(Nt,Lt)}return Ft}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(xt){var yt=Wg.current;E$1(Wg),xt._currentValue=yt}function bh(xt,yt,vt){for(;xt!==null;){var bt=xt.alternate;if((xt.childLanes&yt)!==yt?(xt.childLanes|=yt,bt!==null&&(bt.childLanes|=yt)):bt!==null&&(bt.childLanes&yt)!==yt&&(bt.childLanes|=yt),xt===vt)break;xt=xt.return}}function ch(xt,yt){Xg=xt,Zg=Yg=null,xt=xt.dependencies,xt!==null&&xt.firstContext!==null&&(xt.lanes&yt&&(dh=!0),xt.firstContext=null)}function eh(xt){var yt=xt._currentValue;if(Zg!==xt)if(xt={context:xt,memoizedValue:yt,next:null},Yg===null){if(Xg===null)throw Error(p$1(308));Yg=xt,Xg.dependencies={lanes:0,firstContext:xt}}else Yg=Yg.next=xt;return yt}var fh=null;function gh(xt){fh===null?fh=[xt]:fh.push(xt)}function hh(xt,yt,vt,bt){var Tt=yt.interleaved;return Tt===null?(vt.next=vt,gh(yt)):(vt.next=Tt.next,Tt.next=vt),yt.interleaved=vt,ih(xt,bt)}function ih(xt,yt){xt.lanes|=yt;var vt=xt.alternate;for(vt!==null&&(vt.lanes|=yt),vt=xt,xt=xt.return;xt!==null;)xt.childLanes|=yt,vt=xt.alternate,vt!==null&&(vt.childLanes|=yt),vt=xt,xt=xt.return;return vt.tag===3?vt.stateNode:null}var jh=!1;function kh(xt){xt.updateQueue={baseState:xt.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(xt,yt){xt=xt.updateQueue,yt.updateQueue===xt&&(yt.updateQueue={baseState:xt.baseState,firstBaseUpdate:xt.firstBaseUpdate,lastBaseUpdate:xt.lastBaseUpdate,shared:xt.shared,effects:xt.effects})}function mh(xt,yt){return{eventTime:xt,lane:yt,tag:0,payload:null,callback:null,next:null}}function nh(xt,yt,vt){var bt=xt.updateQueue;if(bt===null)return null;if(bt=bt.shared,K$1&2){var Tt=bt.pending;return Tt===null?yt.next=yt:(yt.next=Tt.next,Tt.next=yt),bt.pending=yt,ih(xt,vt)}return Tt=bt.interleaved,Tt===null?(yt.next=yt,gh(bt)):(yt.next=Tt.next,Tt.next=yt),bt.interleaved=yt,ih(xt,vt)}function oh(xt,yt,vt){if(yt=yt.updateQueue,yt!==null&&(yt=yt.shared,(vt&4194240)!==0)){var bt=yt.lanes;bt&=xt.pendingLanes,vt|=bt,yt.lanes=vt,Cc(xt,vt)}}function ph(xt,yt){var vt=xt.updateQueue,bt=xt.alternate;if(bt!==null&&(bt=bt.updateQueue,vt===bt)){var Tt=null,Et=null;if(vt=vt.firstBaseUpdate,vt!==null){do{var wt={eventTime:vt.eventTime,lane:vt.lane,tag:vt.tag,payload:vt.payload,callback:vt.callback,next:null};Et===null?Tt=Et=wt:Et=Et.next=wt,vt=vt.next}while(vt!==null);Et===null?Tt=Et=yt:Et=Et.next=yt}else Tt=Et=yt;vt={baseState:bt.baseState,firstBaseUpdate:Tt,lastBaseUpdate:Et,shared:bt.shared,effects:bt.effects},xt.updateQueue=vt;return}xt=vt.lastBaseUpdate,xt===null?vt.firstBaseUpdate=yt:xt.next=yt,vt.lastBaseUpdate=yt}function qh(xt,yt,vt,bt){var Tt=xt.updateQueue;jh=!1;var Et=Tt.firstBaseUpdate,wt=Tt.lastBaseUpdate,St=Tt.shared.pending;if(St!==null){Tt.shared.pending=null;var At=St,Rt=At.next;At.next=null,wt===null?Et=Rt:wt.next=Rt,wt=At;var Pt=xt.alternate;Pt!==null&&(Pt=Pt.updateQueue,St=Pt.lastBaseUpdate,St!==wt&&(St===null?Pt.firstBaseUpdate=Rt:St.next=Rt,Pt.lastBaseUpdate=At))}if(Et!==null){var Ct=Tt.baseState;wt=0,Pt=Rt=At=null,St=Et;do{var It=St.lane,Mt=St.eventTime;if((bt&It)===It){Pt!==null&&(Pt=Pt.next={eventTime:Mt,lane:0,tag:St.tag,payload:St.payload,callback:St.callback,next:null});e:{var Ot=xt,kt=St;switch(It=yt,Mt=vt,kt.tag){case 1:if(Ot=kt.payload,typeof Ot=="function"){Ct=Ot.call(Mt,Ct,It);break e}Ct=Ot;break e;case 3:Ot.flags=Ot.flags&-65537|128;case 0:if(Ot=kt.payload,It=typeof Ot=="function"?Ot.call(Mt,Ct,It):Ot,It==null)break e;Ct=A$1({},Ct,It);break e;case 2:jh=!0}}St.callback!==null&&St.lane!==0&&(xt.flags|=64,It=Tt.effects,It===null?Tt.effects=[St]:It.push(St))}else Mt={eventTime:Mt,lane:It,tag:St.tag,payload:St.payload,callback:St.callback,next:null},Pt===null?(Rt=Pt=Mt,At=Ct):Pt=Pt.next=Mt,wt|=It;if(St=St.next,St===null){if(St=Tt.shared.pending,St===null)break;It=St,St=It.next,It.next=null,Tt.lastBaseUpdate=It,Tt.shared.pending=null}}while(!0);if(Pt===null&&(At=Ct),Tt.baseState=At,Tt.firstBaseUpdate=Rt,Tt.lastBaseUpdate=Pt,yt=Tt.shared.interleaved,yt!==null){Tt=yt;do wt|=Tt.lane,Tt=Tt.next;while(Tt!==yt)}else Et===null&&(Tt.shared.lanes=0);rh|=wt,xt.lanes=wt,xt.memoizedState=Ct}}function sh(xt,yt,vt){if(xt=yt.effects,yt.effects=null,xt!==null)for(yt=0;yt<xt.length;yt++){var bt=xt[yt],Tt=bt.callback;if(Tt!==null){if(bt.callback=null,bt=vt,typeof Tt!="function")throw Error(p$1(191,Tt));Tt.call(bt)}}}var th={},uh=Uf(th),vh=Uf(th),wh=Uf(th);function xh(xt){if(xt===th)throw Error(p$1(174));return xt}function yh(xt,yt){switch(G$1(wh,yt),G$1(vh,xt),G$1(uh,th),xt=yt.nodeType,xt){case 9:case 11:yt=(yt=yt.documentElement)?yt.namespaceURI:lb(null,"");break;default:xt=xt===8?yt.parentNode:yt,yt=xt.namespaceURI||null,xt=xt.tagName,yt=lb(yt,xt)}E$1(uh),G$1(uh,yt)}function zh(){E$1(uh),E$1(vh),E$1(wh)}function Ah(xt){xh(wh.current);var yt=xh(uh.current),vt=lb(yt,xt.type);yt!==vt&&(G$1(vh,xt),G$1(uh,vt))}function Bh(xt){vh.current===xt&&(E$1(uh),E$1(vh))}var L$1=Uf(0);function Ch(xt){for(var yt=xt;yt!==null;){if(yt.tag===13){var vt=yt.memoizedState;if(vt!==null&&(vt=vt.dehydrated,vt===null||vt.data==="$?"||vt.data==="$!"))return yt}else if(yt.tag===19&&yt.memoizedProps.revealOrder!==void 0){if(yt.flags&128)return yt}else if(yt.child!==null){yt.child.return=yt,yt=yt.child;continue}if(yt===xt)break;for(;yt.sibling===null;){if(yt.return===null||yt.return===xt)return null;yt=yt.return}yt.sibling.return=yt.return,yt=yt.sibling}return null}var Dh=[];function Eh(){for(var xt=0;xt<Dh.length;xt++)Dh[xt]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M$1=null,N$1=null,O$1=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P$1(){throw Error(p$1(321))}function Mh(xt,yt){if(yt===null)return!1;for(var vt=0;vt<yt.length&&vt<xt.length;vt++)if(!He$1(xt[vt],yt[vt]))return!1;return!0}function Nh(xt,yt,vt,bt,Tt,Et){if(Hh=Et,M$1=yt,yt.memoizedState=null,yt.updateQueue=null,yt.lanes=0,Fh.current=xt===null||xt.memoizedState===null?Oh:Ph,xt=vt(bt,Tt),Jh){Et=0;do{if(Jh=!1,Kh=0,25<=Et)throw Error(p$1(301));Et+=1,O$1=N$1=null,yt.updateQueue=null,Fh.current=Qh,xt=vt(bt,Tt)}while(Jh)}if(Fh.current=Rh,yt=N$1!==null&&N$1.next!==null,Hh=0,O$1=N$1=M$1=null,Ih=!1,yt)throw Error(p$1(300));return xt}function Sh(){var xt=Kh!==0;return Kh=0,xt}function Th(){var xt={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O$1===null?M$1.memoizedState=O$1=xt:O$1=O$1.next=xt,O$1}function Uh(){if(N$1===null){var xt=M$1.alternate;xt=xt!==null?xt.memoizedState:null}else xt=N$1.next;var yt=O$1===null?M$1.memoizedState:O$1.next;if(yt!==null)O$1=yt,N$1=xt;else{if(xt===null)throw Error(p$1(310));N$1=xt,xt={memoizedState:N$1.memoizedState,baseState:N$1.baseState,baseQueue:N$1.baseQueue,queue:N$1.queue,next:null},O$1===null?M$1.memoizedState=O$1=xt:O$1=O$1.next=xt}return O$1}function Vh(xt,yt){return typeof yt=="function"?yt(xt):yt}function Wh(xt){var yt=Uh(),vt=yt.queue;if(vt===null)throw Error(p$1(311));vt.lastRenderedReducer=xt;var bt=N$1,Tt=bt.baseQueue,Et=vt.pending;if(Et!==null){if(Tt!==null){var wt=Tt.next;Tt.next=Et.next,Et.next=wt}bt.baseQueue=Tt=Et,vt.pending=null}if(Tt!==null){Et=Tt.next,bt=bt.baseState;var St=wt=null,At=null,Rt=Et;do{var Pt=Rt.lane;if((Hh&Pt)===Pt)At!==null&&(At=At.next={lane:0,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null}),bt=Rt.hasEagerState?Rt.eagerState:xt(bt,Rt.action);else{var Ct={lane:Pt,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null};At===null?(St=At=Ct,wt=bt):At=At.next=Ct,M$1.lanes|=Pt,rh|=Pt}Rt=Rt.next}while(Rt!==null&&Rt!==Et);At===null?wt=bt:At.next=St,He$1(bt,yt.memoizedState)||(dh=!0),yt.memoizedState=bt,yt.baseState=wt,yt.baseQueue=At,vt.lastRenderedState=bt}if(xt=vt.interleaved,xt!==null){Tt=xt;do Et=Tt.lane,M$1.lanes|=Et,rh|=Et,Tt=Tt.next;while(Tt!==xt)}else Tt===null&&(vt.lanes=0);return[yt.memoizedState,vt.dispatch]}function Xh(xt){var yt=Uh(),vt=yt.queue;if(vt===null)throw Error(p$1(311));vt.lastRenderedReducer=xt;var bt=vt.dispatch,Tt=vt.pending,Et=yt.memoizedState;if(Tt!==null){vt.pending=null;var wt=Tt=Tt.next;do Et=xt(Et,wt.action),wt=wt.next;while(wt!==Tt);He$1(Et,yt.memoizedState)||(dh=!0),yt.memoizedState=Et,yt.baseQueue===null&&(yt.baseState=Et),vt.lastRenderedState=Et}return[Et,bt]}function Yh(){}function Zh(xt,yt){var vt=M$1,bt=Uh(),Tt=yt(),Et=!He$1(bt.memoizedState,Tt);if(Et&&(bt.memoizedState=Tt,dh=!0),bt=bt.queue,$h(ai.bind(null,vt,bt,xt),[xt]),bt.getSnapshot!==yt||Et||O$1!==null&&O$1.memoizedState.tag&1){if(vt.flags|=2048,bi(9,ci.bind(null,vt,bt,Tt,yt),void 0,null),Q$1===null)throw Error(p$1(349));Hh&30||di(vt,yt,Tt)}return Tt}function di(xt,yt,vt){xt.flags|=16384,xt={getSnapshot:yt,value:vt},yt=M$1.updateQueue,yt===null?(yt={lastEffect:null,stores:null},M$1.updateQueue=yt,yt.stores=[xt]):(vt=yt.stores,vt===null?yt.stores=[xt]:vt.push(xt))}function ci(xt,yt,vt,bt){yt.value=vt,yt.getSnapshot=bt,ei(yt)&&fi(xt)}function ai(xt,yt,vt){return vt(function(){ei(yt)&&fi(xt)})}function ei(xt){var yt=xt.getSnapshot;xt=xt.value;try{var vt=yt();return!He$1(xt,vt)}catch{return!0}}function fi(xt){var yt=ih(xt,1);yt!==null&&gi(yt,xt,1,-1)}function hi(xt){var yt=Th();return typeof xt=="function"&&(xt=xt()),yt.memoizedState=yt.baseState=xt,xt={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:xt},yt.queue=xt,xt=xt.dispatch=ii.bind(null,M$1,xt),[yt.memoizedState,xt]}function bi(xt,yt,vt,bt){return xt={tag:xt,create:yt,destroy:vt,deps:bt,next:null},yt=M$1.updateQueue,yt===null?(yt={lastEffect:null,stores:null},M$1.updateQueue=yt,yt.lastEffect=xt.next=xt):(vt=yt.lastEffect,vt===null?yt.lastEffect=xt.next=xt:(bt=vt.next,vt.next=xt,xt.next=bt,yt.lastEffect=xt)),xt}function ji(){return Uh().memoizedState}function ki(xt,yt,vt,bt){var Tt=Th();M$1.flags|=xt,Tt.memoizedState=bi(1|yt,vt,void 0,bt===void 0?null:bt)}function li(xt,yt,vt,bt){var Tt=Uh();bt=bt===void 0?null:bt;var Et=void 0;if(N$1!==null){var wt=N$1.memoizedState;if(Et=wt.destroy,bt!==null&&Mh(bt,wt.deps)){Tt.memoizedState=bi(yt,vt,Et,bt);return}}M$1.flags|=xt,Tt.memoizedState=bi(1|yt,vt,Et,bt)}function mi(xt,yt){return ki(8390656,8,xt,yt)}function $h(xt,yt){return li(2048,8,xt,yt)}function ni(xt,yt){return li(4,2,xt,yt)}function oi(xt,yt){return li(4,4,xt,yt)}function pi(xt,yt){if(typeof yt=="function")return xt=xt(),yt(xt),function(){yt(null)};if(yt!=null)return xt=xt(),yt.current=xt,function(){yt.current=null}}function qi(xt,yt,vt){return vt=vt!=null?vt.concat([xt]):null,li(4,4,pi.bind(null,yt,xt),vt)}function ri(){}function si(xt,yt){var vt=Uh();yt=yt===void 0?null:yt;var bt=vt.memoizedState;return bt!==null&&yt!==null&&Mh(yt,bt[1])?bt[0]:(vt.memoizedState=[xt,yt],xt)}function ti(xt,yt){var vt=Uh();yt=yt===void 0?null:yt;var bt=vt.memoizedState;return bt!==null&&yt!==null&&Mh(yt,bt[1])?bt[0]:(xt=xt(),vt.memoizedState=[xt,yt],xt)}function ui(xt,yt,vt){return Hh&21?(He$1(vt,yt)||(vt=yc(),M$1.lanes|=vt,rh|=vt,xt.baseState=!0),yt):(xt.baseState&&(xt.baseState=!1,dh=!0),xt.memoizedState=vt)}function vi(xt,yt){var vt=C$1;C$1=vt!==0&&4>vt?vt:4,xt(!0);var bt=Gh.transition;Gh.transition={};try{xt(!1),yt()}finally{C$1=vt,Gh.transition=bt}}function wi(){return Uh().memoizedState}function xi(xt,yt,vt){var bt=yi(xt);if(vt={lane:bt,action:vt,hasEagerState:!1,eagerState:null,next:null},zi(xt))Ai(yt,vt);else if(vt=hh(xt,yt,vt,bt),vt!==null){var Tt=R$1();gi(vt,xt,bt,Tt),Bi(vt,yt,bt)}}function ii(xt,yt,vt){var bt=yi(xt),Tt={lane:bt,action:vt,hasEagerState:!1,eagerState:null,next:null};if(zi(xt))Ai(yt,Tt);else{var Et=xt.alternate;if(xt.lanes===0&&(Et===null||Et.lanes===0)&&(Et=yt.lastRenderedReducer,Et!==null))try{var wt=yt.lastRenderedState,St=Et(wt,vt);if(Tt.hasEagerState=!0,Tt.eagerState=St,He$1(St,wt)){var At=yt.interleaved;At===null?(Tt.next=Tt,gh(yt)):(Tt.next=At.next,At.next=Tt),yt.interleaved=Tt;return}}catch{}finally{}vt=hh(xt,yt,Tt,bt),vt!==null&&(Tt=R$1(),gi(vt,xt,bt,Tt),Bi(vt,yt,bt))}}function zi(xt){var yt=xt.alternate;return xt===M$1||yt!==null&&yt===M$1}function Ai(xt,yt){Jh=Ih=!0;var vt=xt.pending;vt===null?yt.next=yt:(yt.next=vt.next,vt.next=yt),xt.pending=yt}function Bi(xt,yt,vt){if(vt&4194240){var bt=yt.lanes;bt&=xt.pendingLanes,vt|=bt,yt.lanes=vt,Cc(xt,vt)}}var Rh={readContext:eh,useCallback:P$1,useContext:P$1,useEffect:P$1,useImperativeHandle:P$1,useInsertionEffect:P$1,useLayoutEffect:P$1,useMemo:P$1,useReducer:P$1,useRef:P$1,useState:P$1,useDebugValue:P$1,useDeferredValue:P$1,useTransition:P$1,useMutableSource:P$1,useSyncExternalStore:P$1,useId:P$1,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(xt,yt){return Th().memoizedState=[xt,yt===void 0?null:yt],xt},useContext:eh,useEffect:mi,useImperativeHandle:function(xt,yt,vt){return vt=vt!=null?vt.concat([xt]):null,ki(4194308,4,pi.bind(null,yt,xt),vt)},useLayoutEffect:function(xt,yt){return ki(4194308,4,xt,yt)},useInsertionEffect:function(xt,yt){return ki(4,2,xt,yt)},useMemo:function(xt,yt){var vt=Th();return yt=yt===void 0?null:yt,xt=xt(),vt.memoizedState=[xt,yt],xt},useReducer:function(xt,yt,vt){var bt=Th();return yt=vt!==void 0?vt(yt):yt,bt.memoizedState=bt.baseState=yt,xt={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xt,lastRenderedState:yt},bt.queue=xt,xt=xt.dispatch=xi.bind(null,M$1,xt),[bt.memoizedState,xt]},useRef:function(xt){var yt=Th();return xt={current:xt},yt.memoizedState=xt},useState:hi,useDebugValue:ri,useDeferredValue:function(xt){return Th().memoizedState=xt},useTransition:function(){var xt=hi(!1),yt=xt[0];return xt=vi.bind(null,xt[1]),Th().memoizedState=xt,[yt,xt]},useMutableSource:function(){},useSyncExternalStore:function(xt,yt,vt){var bt=M$1,Tt=Th();if(I$1){if(vt===void 0)throw Error(p$1(407));vt=vt()}else{if(vt=yt(),Q$1===null)throw Error(p$1(349));Hh&30||di(bt,yt,vt)}Tt.memoizedState=vt;var Et={value:vt,getSnapshot:yt};return Tt.queue=Et,mi(ai.bind(null,bt,Et,xt),[xt]),bt.flags|=2048,bi(9,ci.bind(null,bt,Et,vt,yt),void 0,null),vt},useId:function(){var xt=Th(),yt=Q$1.identifierPrefix;if(I$1){var vt=sg,bt=rg;vt=(bt&~(1<<32-oc(bt)-1)).toString(32)+vt,yt=":"+yt+"R"+vt,vt=Kh++,0<vt&&(yt+="H"+vt.toString(32)),yt+=":"}else vt=Lh++,yt=":"+yt+"r"+vt.toString(32)+":";return xt.memoizedState=yt},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(xt){var yt=Uh();return ui(yt,N$1.memoizedState,xt)},useTransition:function(){var xt=Wh(Vh)[0],yt=Uh().memoizedState;return[xt,yt]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(xt){var yt=Uh();return N$1===null?yt.memoizedState=xt:ui(yt,N$1.memoizedState,xt)},useTransition:function(){var xt=Xh(Vh)[0],yt=Uh().memoizedState;return[xt,yt]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(xt,yt){if(xt&&xt.defaultProps){yt=A$1({},yt),xt=xt.defaultProps;for(var vt in xt)yt[vt]===void 0&&(yt[vt]=xt[vt]);return yt}return yt}function Di(xt,yt,vt,bt){yt=xt.memoizedState,vt=vt(bt,yt),vt=vt==null?yt:A$1({},yt,vt),xt.memoizedState=vt,xt.lanes===0&&(xt.updateQueue.baseState=vt)}var Ei={isMounted:function(xt){return(xt=xt._reactInternals)?Vb(xt)===xt:!1},enqueueSetState:function(xt,yt,vt){xt=xt._reactInternals;var bt=R$1(),Tt=yi(xt),Et=mh(bt,Tt);Et.payload=yt,vt!=null&&(Et.callback=vt),yt=nh(xt,Et,Tt),yt!==null&&(gi(yt,xt,Tt,bt),oh(yt,xt,Tt))},enqueueReplaceState:function(xt,yt,vt){xt=xt._reactInternals;var bt=R$1(),Tt=yi(xt),Et=mh(bt,Tt);Et.tag=1,Et.payload=yt,vt!=null&&(Et.callback=vt),yt=nh(xt,Et,Tt),yt!==null&&(gi(yt,xt,Tt,bt),oh(yt,xt,Tt))},enqueueForceUpdate:function(xt,yt){xt=xt._reactInternals;var vt=R$1(),bt=yi(xt),Tt=mh(vt,bt);Tt.tag=2,yt!=null&&(Tt.callback=yt),yt=nh(xt,Tt,bt),yt!==null&&(gi(yt,xt,bt,vt),oh(yt,xt,bt))}};function Fi(xt,yt,vt,bt,Tt,Et,wt){return xt=xt.stateNode,typeof xt.shouldComponentUpdate=="function"?xt.shouldComponentUpdate(bt,Et,wt):yt.prototype&&yt.prototype.isPureReactComponent?!Ie$1(vt,bt)||!Ie$1(Tt,Et):!0}function Gi(xt,yt,vt){var bt=!1,Tt=Vf,Et=yt.contextType;return typeof Et=="object"&&Et!==null?Et=eh(Et):(Tt=Zf(yt)?Xf:H$1.current,bt=yt.contextTypes,Et=(bt=bt!=null)?Yf(xt,Tt):Vf),yt=new yt(vt,Et),xt.memoizedState=yt.state!==null&&yt.state!==void 0?yt.state:null,yt.updater=Ei,xt.stateNode=yt,yt._reactInternals=xt,bt&&(xt=xt.stateNode,xt.__reactInternalMemoizedUnmaskedChildContext=Tt,xt.__reactInternalMemoizedMaskedChildContext=Et),yt}function Hi(xt,yt,vt,bt){xt=yt.state,typeof yt.componentWillReceiveProps=="function"&&yt.componentWillReceiveProps(vt,bt),typeof yt.UNSAFE_componentWillReceiveProps=="function"&&yt.UNSAFE_componentWillReceiveProps(vt,bt),yt.state!==xt&&Ei.enqueueReplaceState(yt,yt.state,null)}function Ii(xt,yt,vt,bt){var Tt=xt.stateNode;Tt.props=vt,Tt.state=xt.memoizedState,Tt.refs={},kh(xt);var Et=yt.contextType;typeof Et=="object"&&Et!==null?Tt.context=eh(Et):(Et=Zf(yt)?Xf:H$1.current,Tt.context=Yf(xt,Et)),Tt.state=xt.memoizedState,Et=yt.getDerivedStateFromProps,typeof Et=="function"&&(Di(xt,yt,Et,vt),Tt.state=xt.memoizedState),typeof yt.getDerivedStateFromProps=="function"||typeof Tt.getSnapshotBeforeUpdate=="function"||typeof Tt.UNSAFE_componentWillMount!="function"&&typeof Tt.componentWillMount!="function"||(yt=Tt.state,typeof Tt.componentWillMount=="function"&&Tt.componentWillMount(),typeof Tt.UNSAFE_componentWillMount=="function"&&Tt.UNSAFE_componentWillMount(),yt!==Tt.state&&Ei.enqueueReplaceState(Tt,Tt.state,null),qh(xt,vt,Tt,bt),Tt.state=xt.memoizedState),typeof Tt.componentDidMount=="function"&&(xt.flags|=4194308)}function Ji(xt,yt){try{var vt="",bt=yt;do vt+=Pa(bt),bt=bt.return;while(bt);var Tt=vt}catch(Et){Tt=`
Error generating stack: `+Et.message+`
`+Et.stack}return{value:xt,source:yt,stack:Tt,digest:null}}function Ki(xt,yt,vt){return{value:xt,source:null,stack:vt??null,digest:yt??null}}function Li(xt,yt){try{console.error(yt.value)}catch(vt){setTimeout(function(){throw vt})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(xt,yt,vt){vt=mh(-1,vt),vt.tag=3,vt.payload={element:null};var bt=yt.value;return vt.callback=function(){Oi||(Oi=!0,Pi=bt),Li(xt,yt)},vt}function Qi(xt,yt,vt){vt=mh(-1,vt),vt.tag=3;var bt=xt.type.getDerivedStateFromError;if(typeof bt=="function"){var Tt=yt.value;vt.payload=function(){return bt(Tt)},vt.callback=function(){Li(xt,yt)}}var Et=xt.stateNode;return Et!==null&&typeof Et.componentDidCatch=="function"&&(vt.callback=function(){Li(xt,yt),typeof bt!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var wt=yt.stack;this.componentDidCatch(yt.value,{componentStack:wt!==null?wt:""})}),vt}function Si(xt,yt,vt){var bt=xt.pingCache;if(bt===null){bt=xt.pingCache=new Mi;var Tt=new Set;bt.set(yt,Tt)}else Tt=bt.get(yt),Tt===void 0&&(Tt=new Set,bt.set(yt,Tt));Tt.has(vt)||(Tt.add(vt),xt=Ti.bind(null,xt,yt,vt),yt.then(xt,xt))}function Ui(xt){do{var yt;if((yt=xt.tag===13)&&(yt=xt.memoizedState,yt=yt!==null?yt.dehydrated!==null:!0),yt)return xt;xt=xt.return}while(xt!==null);return null}function Vi(xt,yt,vt,bt,Tt){return xt.mode&1?(xt.flags|=65536,xt.lanes=Tt,xt):(xt===yt?xt.flags|=65536:(xt.flags|=128,vt.flags|=131072,vt.flags&=-52805,vt.tag===1&&(vt.alternate===null?vt.tag=17:(yt=mh(-1,1),yt.tag=2,nh(vt,yt,1))),vt.lanes|=1),xt)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(xt,yt,vt,bt){yt.child=xt===null?Vg(yt,null,vt,bt):Ug(yt,xt.child,vt,bt)}function Yi(xt,yt,vt,bt,Tt){vt=vt.render;var Et=yt.ref;return ch(yt,Tt),bt=Nh(xt,yt,vt,bt,Et,Tt),vt=Sh(),xt!==null&&!dh?(yt.updateQueue=xt.updateQueue,yt.flags&=-2053,xt.lanes&=~Tt,Zi(xt,yt,Tt)):(I$1&&vt&&vg(yt),yt.flags|=1,Xi(xt,yt,bt,Tt),yt.child)}function $i(xt,yt,vt,bt,Tt){if(xt===null){var Et=vt.type;return typeof Et=="function"&&!aj(Et)&&Et.defaultProps===void 0&&vt.compare===null&&vt.defaultProps===void 0?(yt.tag=15,yt.type=Et,bj(xt,yt,Et,bt,Tt)):(xt=Rg(vt.type,null,bt,yt,yt.mode,Tt),xt.ref=yt.ref,xt.return=yt,yt.child=xt)}if(Et=xt.child,!(xt.lanes&Tt)){var wt=Et.memoizedProps;if(vt=vt.compare,vt=vt!==null?vt:Ie$1,vt(wt,bt)&&xt.ref===yt.ref)return Zi(xt,yt,Tt)}return yt.flags|=1,xt=Pg(Et,bt),xt.ref=yt.ref,xt.return=yt,yt.child=xt}function bj(xt,yt,vt,bt,Tt){if(xt!==null){var Et=xt.memoizedProps;if(Ie$1(Et,bt)&&xt.ref===yt.ref)if(dh=!1,yt.pendingProps=bt=Et,(xt.lanes&Tt)!==0)xt.flags&131072&&(dh=!0);else return yt.lanes=xt.lanes,Zi(xt,yt,Tt)}return cj(xt,yt,vt,bt,Tt)}function dj(xt,yt,vt){var bt=yt.pendingProps,Tt=bt.children,Et=xt!==null?xt.memoizedState:null;if(bt.mode==="hidden")if(!(yt.mode&1))yt.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$1(ej,fj),fj|=vt;else{if(!(vt&1073741824))return xt=Et!==null?Et.baseLanes|vt:vt,yt.lanes=yt.childLanes=1073741824,yt.memoizedState={baseLanes:xt,cachePool:null,transitions:null},yt.updateQueue=null,G$1(ej,fj),fj|=xt,null;yt.memoizedState={baseLanes:0,cachePool:null,transitions:null},bt=Et!==null?Et.baseLanes:vt,G$1(ej,fj),fj|=bt}else Et!==null?(bt=Et.baseLanes|vt,yt.memoizedState=null):bt=vt,G$1(ej,fj),fj|=bt;return Xi(xt,yt,Tt,vt),yt.child}function gj(xt,yt){var vt=yt.ref;(xt===null&&vt!==null||xt!==null&&xt.ref!==vt)&&(yt.flags|=512,yt.flags|=2097152)}function cj(xt,yt,vt,bt,Tt){var Et=Zf(vt)?Xf:H$1.current;return Et=Yf(yt,Et),ch(yt,Tt),vt=Nh(xt,yt,vt,bt,Et,Tt),bt=Sh(),xt!==null&&!dh?(yt.updateQueue=xt.updateQueue,yt.flags&=-2053,xt.lanes&=~Tt,Zi(xt,yt,Tt)):(I$1&&bt&&vg(yt),yt.flags|=1,Xi(xt,yt,vt,Tt),yt.child)}function hj(xt,yt,vt,bt,Tt){if(Zf(vt)){var Et=!0;cg(yt)}else Et=!1;if(ch(yt,Tt),yt.stateNode===null)ij(xt,yt),Gi(yt,vt,bt),Ii(yt,vt,bt,Tt),bt=!0;else if(xt===null){var wt=yt.stateNode,St=yt.memoizedProps;wt.props=St;var At=wt.context,Rt=vt.contextType;typeof Rt=="object"&&Rt!==null?Rt=eh(Rt):(Rt=Zf(vt)?Xf:H$1.current,Rt=Yf(yt,Rt));var Pt=vt.getDerivedStateFromProps,Ct=typeof Pt=="function"||typeof wt.getSnapshotBeforeUpdate=="function";Ct||typeof wt.UNSAFE_componentWillReceiveProps!="function"&&typeof wt.componentWillReceiveProps!="function"||(St!==bt||At!==Rt)&&Hi(yt,wt,bt,Rt),jh=!1;var It=yt.memoizedState;wt.state=It,qh(yt,bt,wt,Tt),At=yt.memoizedState,St!==bt||It!==At||Wf.current||jh?(typeof Pt=="function"&&(Di(yt,vt,Pt,bt),At=yt.memoizedState),(St=jh||Fi(yt,vt,St,bt,It,At,Rt))?(Ct||typeof wt.UNSAFE_componentWillMount!="function"&&typeof wt.componentWillMount!="function"||(typeof wt.componentWillMount=="function"&&wt.componentWillMount(),typeof wt.UNSAFE_componentWillMount=="function"&&wt.UNSAFE_componentWillMount()),typeof wt.componentDidMount=="function"&&(yt.flags|=4194308)):(typeof wt.componentDidMount=="function"&&(yt.flags|=4194308),yt.memoizedProps=bt,yt.memoizedState=At),wt.props=bt,wt.state=At,wt.context=Rt,bt=St):(typeof wt.componentDidMount=="function"&&(yt.flags|=4194308),bt=!1)}else{wt=yt.stateNode,lh(xt,yt),St=yt.memoizedProps,Rt=yt.type===yt.elementType?St:Ci(yt.type,St),wt.props=Rt,Ct=yt.pendingProps,It=wt.context,At=vt.contextType,typeof At=="object"&&At!==null?At=eh(At):(At=Zf(vt)?Xf:H$1.current,At=Yf(yt,At));var Mt=vt.getDerivedStateFromProps;(Pt=typeof Mt=="function"||typeof wt.getSnapshotBeforeUpdate=="function")||typeof wt.UNSAFE_componentWillReceiveProps!="function"&&typeof wt.componentWillReceiveProps!="function"||(St!==Ct||It!==At)&&Hi(yt,wt,bt,At),jh=!1,It=yt.memoizedState,wt.state=It,qh(yt,bt,wt,Tt);var Ot=yt.memoizedState;St!==Ct||It!==Ot||Wf.current||jh?(typeof Mt=="function"&&(Di(yt,vt,Mt,bt),Ot=yt.memoizedState),(Rt=jh||Fi(yt,vt,Rt,bt,It,Ot,At)||!1)?(Pt||typeof wt.UNSAFE_componentWillUpdate!="function"&&typeof wt.componentWillUpdate!="function"||(typeof wt.componentWillUpdate=="function"&&wt.componentWillUpdate(bt,Ot,At),typeof wt.UNSAFE_componentWillUpdate=="function"&&wt.UNSAFE_componentWillUpdate(bt,Ot,At)),typeof wt.componentDidUpdate=="function"&&(yt.flags|=4),typeof wt.getSnapshotBeforeUpdate=="function"&&(yt.flags|=1024)):(typeof wt.componentDidUpdate!="function"||St===xt.memoizedProps&&It===xt.memoizedState||(yt.flags|=4),typeof wt.getSnapshotBeforeUpdate!="function"||St===xt.memoizedProps&&It===xt.memoizedState||(yt.flags|=1024),yt.memoizedProps=bt,yt.memoizedState=Ot),wt.props=bt,wt.state=Ot,wt.context=At,bt=Rt):(typeof wt.componentDidUpdate!="function"||St===xt.memoizedProps&&It===xt.memoizedState||(yt.flags|=4),typeof wt.getSnapshotBeforeUpdate!="function"||St===xt.memoizedProps&&It===xt.memoizedState||(yt.flags|=1024),bt=!1)}return jj(xt,yt,vt,bt,Et,Tt)}function jj(xt,yt,vt,bt,Tt,Et){gj(xt,yt);var wt=(yt.flags&128)!==0;if(!bt&&!wt)return Tt&&dg(yt,vt,!1),Zi(xt,yt,Et);bt=yt.stateNode,Wi.current=yt;var St=wt&&typeof vt.getDerivedStateFromError!="function"?null:bt.render();return yt.flags|=1,xt!==null&&wt?(yt.child=Ug(yt,xt.child,null,Et),yt.child=Ug(yt,null,St,Et)):Xi(xt,yt,St,Et),yt.memoizedState=bt.state,Tt&&dg(yt,vt,!0),yt.child}function kj(xt){var yt=xt.stateNode;yt.pendingContext?ag(xt,yt.pendingContext,yt.pendingContext!==yt.context):yt.context&&ag(xt,yt.context,!1),yh(xt,yt.containerInfo)}function lj(xt,yt,vt,bt,Tt){return Ig(),Jg(Tt),yt.flags|=256,Xi(xt,yt,vt,bt),yt.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(xt){return{baseLanes:xt,cachePool:null,transitions:null}}function oj(xt,yt,vt){var bt=yt.pendingProps,Tt=L$1.current,Et=!1,wt=(yt.flags&128)!==0,St;if((St=wt)||(St=xt!==null&&xt.memoizedState===null?!1:(Tt&2)!==0),St?(Et=!0,yt.flags&=-129):(xt===null||xt.memoizedState!==null)&&(Tt|=1),G$1(L$1,Tt&1),xt===null)return Eg(yt),xt=yt.memoizedState,xt!==null&&(xt=xt.dehydrated,xt!==null)?(yt.mode&1?xt.data==="$!"?yt.lanes=8:yt.lanes=1073741824:yt.lanes=1,null):(wt=bt.children,xt=bt.fallback,Et?(bt=yt.mode,Et=yt.child,wt={mode:"hidden",children:wt},!(bt&1)&&Et!==null?(Et.childLanes=0,Et.pendingProps=wt):Et=pj(wt,bt,0,null),xt=Tg(xt,bt,vt,null),Et.return=yt,xt.return=yt,Et.sibling=xt,yt.child=Et,yt.child.memoizedState=nj(vt),yt.memoizedState=mj,xt):qj(yt,wt));if(Tt=xt.memoizedState,Tt!==null&&(St=Tt.dehydrated,St!==null))return rj(xt,yt,wt,bt,St,Tt,vt);if(Et){Et=bt.fallback,wt=yt.mode,Tt=xt.child,St=Tt.sibling;var At={mode:"hidden",children:bt.children};return!(wt&1)&&yt.child!==Tt?(bt=yt.child,bt.childLanes=0,bt.pendingProps=At,yt.deletions=null):(bt=Pg(Tt,At),bt.subtreeFlags=Tt.subtreeFlags&14680064),St!==null?Et=Pg(St,Et):(Et=Tg(Et,wt,vt,null),Et.flags|=2),Et.return=yt,bt.return=yt,bt.sibling=Et,yt.child=bt,bt=Et,Et=yt.child,wt=xt.child.memoizedState,wt=wt===null?nj(vt):{baseLanes:wt.baseLanes|vt,cachePool:null,transitions:wt.transitions},Et.memoizedState=wt,Et.childLanes=xt.childLanes&~vt,yt.memoizedState=mj,bt}return Et=xt.child,xt=Et.sibling,bt=Pg(Et,{mode:"visible",children:bt.children}),!(yt.mode&1)&&(bt.lanes=vt),bt.return=yt,bt.sibling=null,xt!==null&&(vt=yt.deletions,vt===null?(yt.deletions=[xt],yt.flags|=16):vt.push(xt)),yt.child=bt,yt.memoizedState=null,bt}function qj(xt,yt){return yt=pj({mode:"visible",children:yt},xt.mode,0,null),yt.return=xt,xt.child=yt}function sj(xt,yt,vt,bt){return bt!==null&&Jg(bt),Ug(yt,xt.child,null,vt),xt=qj(yt,yt.pendingProps.children),xt.flags|=2,yt.memoizedState=null,xt}function rj(xt,yt,vt,bt,Tt,Et,wt){if(vt)return yt.flags&256?(yt.flags&=-257,bt=Ki(Error(p$1(422))),sj(xt,yt,wt,bt)):yt.memoizedState!==null?(yt.child=xt.child,yt.flags|=128,null):(Et=bt.fallback,Tt=yt.mode,bt=pj({mode:"visible",children:bt.children},Tt,0,null),Et=Tg(Et,Tt,wt,null),Et.flags|=2,bt.return=yt,Et.return=yt,bt.sibling=Et,yt.child=bt,yt.mode&1&&Ug(yt,xt.child,null,wt),yt.child.memoizedState=nj(wt),yt.memoizedState=mj,Et);if(!(yt.mode&1))return sj(xt,yt,wt,null);if(Tt.data==="$!"){if(bt=Tt.nextSibling&&Tt.nextSibling.dataset,bt)var St=bt.dgst;return bt=St,Et=Error(p$1(419)),bt=Ki(Et,bt,void 0),sj(xt,yt,wt,bt)}if(St=(wt&xt.childLanes)!==0,dh||St){if(bt=Q$1,bt!==null){switch(wt&-wt){case 4:Tt=2;break;case 16:Tt=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Tt=32;break;case 536870912:Tt=268435456;break;default:Tt=0}Tt=Tt&(bt.suspendedLanes|wt)?0:Tt,Tt!==0&&Tt!==Et.retryLane&&(Et.retryLane=Tt,ih(xt,Tt),gi(bt,xt,Tt,-1))}return tj(),bt=Ki(Error(p$1(421))),sj(xt,yt,wt,bt)}return Tt.data==="$?"?(yt.flags|=128,yt.child=xt.child,yt=uj.bind(null,xt),Tt._reactRetry=yt,null):(xt=Et.treeContext,yg=Lf(Tt.nextSibling),xg=yt,I$1=!0,zg=null,xt!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=xt.id,sg=xt.overflow,qg=yt),yt=qj(yt,bt.children),yt.flags|=4096,yt)}function vj(xt,yt,vt){xt.lanes|=yt;var bt=xt.alternate;bt!==null&&(bt.lanes|=yt),bh(xt.return,yt,vt)}function wj(xt,yt,vt,bt,Tt){var Et=xt.memoizedState;Et===null?xt.memoizedState={isBackwards:yt,rendering:null,renderingStartTime:0,last:bt,tail:vt,tailMode:Tt}:(Et.isBackwards=yt,Et.rendering=null,Et.renderingStartTime=0,Et.last=bt,Et.tail=vt,Et.tailMode=Tt)}function xj(xt,yt,vt){var bt=yt.pendingProps,Tt=bt.revealOrder,Et=bt.tail;if(Xi(xt,yt,bt.children,vt),bt=L$1.current,bt&2)bt=bt&1|2,yt.flags|=128;else{if(xt!==null&&xt.flags&128)e:for(xt=yt.child;xt!==null;){if(xt.tag===13)xt.memoizedState!==null&&vj(xt,vt,yt);else if(xt.tag===19)vj(xt,vt,yt);else if(xt.child!==null){xt.child.return=xt,xt=xt.child;continue}if(xt===yt)break e;for(;xt.sibling===null;){if(xt.return===null||xt.return===yt)break e;xt=xt.return}xt.sibling.return=xt.return,xt=xt.sibling}bt&=1}if(G$1(L$1,bt),!(yt.mode&1))yt.memoizedState=null;else switch(Tt){case"forwards":for(vt=yt.child,Tt=null;vt!==null;)xt=vt.alternate,xt!==null&&Ch(xt)===null&&(Tt=vt),vt=vt.sibling;vt=Tt,vt===null?(Tt=yt.child,yt.child=null):(Tt=vt.sibling,vt.sibling=null),wj(yt,!1,Tt,vt,Et);break;case"backwards":for(vt=null,Tt=yt.child,yt.child=null;Tt!==null;){if(xt=Tt.alternate,xt!==null&&Ch(xt)===null){yt.child=Tt;break}xt=Tt.sibling,Tt.sibling=vt,vt=Tt,Tt=xt}wj(yt,!0,vt,null,Et);break;case"together":wj(yt,!1,null,null,void 0);break;default:yt.memoizedState=null}return yt.child}function ij(xt,yt){!(yt.mode&1)&&xt!==null&&(xt.alternate=null,yt.alternate=null,yt.flags|=2)}function Zi(xt,yt,vt){if(xt!==null&&(yt.dependencies=xt.dependencies),rh|=yt.lanes,!(vt&yt.childLanes))return null;if(xt!==null&&yt.child!==xt.child)throw Error(p$1(153));if(yt.child!==null){for(xt=yt.child,vt=Pg(xt,xt.pendingProps),yt.child=vt,vt.return=yt;xt.sibling!==null;)xt=xt.sibling,vt=vt.sibling=Pg(xt,xt.pendingProps),vt.return=yt;vt.sibling=null}return yt.child}function yj(xt,yt,vt){switch(yt.tag){case 3:kj(yt),Ig();break;case 5:Ah(yt);break;case 1:Zf(yt.type)&&cg(yt);break;case 4:yh(yt,yt.stateNode.containerInfo);break;case 10:var bt=yt.type._context,Tt=yt.memoizedProps.value;G$1(Wg,bt._currentValue),bt._currentValue=Tt;break;case 13:if(bt=yt.memoizedState,bt!==null)return bt.dehydrated!==null?(G$1(L$1,L$1.current&1),yt.flags|=128,null):vt&yt.child.childLanes?oj(xt,yt,vt):(G$1(L$1,L$1.current&1),xt=Zi(xt,yt,vt),xt!==null?xt.sibling:null);G$1(L$1,L$1.current&1);break;case 19:if(bt=(vt&yt.childLanes)!==0,xt.flags&128){if(bt)return xj(xt,yt,vt);yt.flags|=128}if(Tt=yt.memoizedState,Tt!==null&&(Tt.rendering=null,Tt.tail=null,Tt.lastEffect=null),G$1(L$1,L$1.current),bt)break;return null;case 22:case 23:return yt.lanes=0,dj(xt,yt,vt)}return Zi(xt,yt,vt)}var zj,Aj,Bj,Cj;zj=function(xt,yt){for(var vt=yt.child;vt!==null;){if(vt.tag===5||vt.tag===6)xt.appendChild(vt.stateNode);else if(vt.tag!==4&&vt.child!==null){vt.child.return=vt,vt=vt.child;continue}if(vt===yt)break;for(;vt.sibling===null;){if(vt.return===null||vt.return===yt)return;vt=vt.return}vt.sibling.return=vt.return,vt=vt.sibling}};Aj=function(){};Bj=function(xt,yt,vt,bt){var Tt=xt.memoizedProps;if(Tt!==bt){xt=yt.stateNode,xh(uh.current);var Et=null;switch(vt){case"input":Tt=Ya(xt,Tt),bt=Ya(xt,bt),Et=[];break;case"select":Tt=A$1({},Tt,{value:void 0}),bt=A$1({},bt,{value:void 0}),Et=[];break;case"textarea":Tt=gb(xt,Tt),bt=gb(xt,bt),Et=[];break;default:typeof Tt.onClick!="function"&&typeof bt.onClick=="function"&&(xt.onclick=Bf)}ub(vt,bt);var wt;vt=null;for(Rt in Tt)if(!bt.hasOwnProperty(Rt)&&Tt.hasOwnProperty(Rt)&&Tt[Rt]!=null)if(Rt==="style"){var St=Tt[Rt];for(wt in St)St.hasOwnProperty(wt)&&(vt||(vt={}),vt[wt]="")}else Rt!=="dangerouslySetInnerHTML"&&Rt!=="children"&&Rt!=="suppressContentEditableWarning"&&Rt!=="suppressHydrationWarning"&&Rt!=="autoFocus"&&(ea.hasOwnProperty(Rt)?Et||(Et=[]):(Et=Et||[]).push(Rt,null));for(Rt in bt){var At=bt[Rt];if(St=Tt!=null?Tt[Rt]:void 0,bt.hasOwnProperty(Rt)&&At!==St&&(At!=null||St!=null))if(Rt==="style")if(St){for(wt in St)!St.hasOwnProperty(wt)||At&&At.hasOwnProperty(wt)||(vt||(vt={}),vt[wt]="");for(wt in At)At.hasOwnProperty(wt)&&St[wt]!==At[wt]&&(vt||(vt={}),vt[wt]=At[wt])}else vt||(Et||(Et=[]),Et.push(Rt,vt)),vt=At;else Rt==="dangerouslySetInnerHTML"?(At=At?At.__html:void 0,St=St?St.__html:void 0,At!=null&&St!==At&&(Et=Et||[]).push(Rt,At)):Rt==="children"?typeof At!="string"&&typeof At!="number"||(Et=Et||[]).push(Rt,""+At):Rt!=="suppressContentEditableWarning"&&Rt!=="suppressHydrationWarning"&&(ea.hasOwnProperty(Rt)?(At!=null&&Rt==="onScroll"&&D$1("scroll",xt),Et||St===At||(Et=[])):(Et=Et||[]).push(Rt,At))}vt&&(Et=Et||[]).push("style",vt);var Rt=Et;(yt.updateQueue=Rt)&&(yt.flags|=4)}};Cj=function(xt,yt,vt,bt){vt!==bt&&(yt.flags|=4)};function Dj(xt,yt){if(!I$1)switch(xt.tailMode){case"hidden":yt=xt.tail;for(var vt=null;yt!==null;)yt.alternate!==null&&(vt=yt),yt=yt.sibling;vt===null?xt.tail=null:vt.sibling=null;break;case"collapsed":vt=xt.tail;for(var bt=null;vt!==null;)vt.alternate!==null&&(bt=vt),vt=vt.sibling;bt===null?yt||xt.tail===null?xt.tail=null:xt.tail.sibling=null:bt.sibling=null}}function S$1(xt){var yt=xt.alternate!==null&&xt.alternate.child===xt.child,vt=0,bt=0;if(yt)for(var Tt=xt.child;Tt!==null;)vt|=Tt.lanes|Tt.childLanes,bt|=Tt.subtreeFlags&14680064,bt|=Tt.flags&14680064,Tt.return=xt,Tt=Tt.sibling;else for(Tt=xt.child;Tt!==null;)vt|=Tt.lanes|Tt.childLanes,bt|=Tt.subtreeFlags,bt|=Tt.flags,Tt.return=xt,Tt=Tt.sibling;return xt.subtreeFlags|=bt,xt.childLanes=vt,yt}function Ej(xt,yt,vt){var bt=yt.pendingProps;switch(wg(yt),yt.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(yt),null;case 1:return Zf(yt.type)&&$f(),S$1(yt),null;case 3:return bt=yt.stateNode,zh(),E$1(Wf),E$1(H$1),Eh(),bt.pendingContext&&(bt.context=bt.pendingContext,bt.pendingContext=null),(xt===null||xt.child===null)&&(Gg(yt)?yt.flags|=4:xt===null||xt.memoizedState.isDehydrated&&!(yt.flags&256)||(yt.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(xt,yt),S$1(yt),null;case 5:Bh(yt);var Tt=xh(wh.current);if(vt=yt.type,xt!==null&&yt.stateNode!=null)Bj(xt,yt,vt,bt,Tt),xt.ref!==yt.ref&&(yt.flags|=512,yt.flags|=2097152);else{if(!bt){if(yt.stateNode===null)throw Error(p$1(166));return S$1(yt),null}if(xt=xh(uh.current),Gg(yt)){bt=yt.stateNode,vt=yt.type;var Et=yt.memoizedProps;switch(bt[Of]=yt,bt[Pf]=Et,xt=(yt.mode&1)!==0,vt){case"dialog":D$1("cancel",bt),D$1("close",bt);break;case"iframe":case"object":case"embed":D$1("load",bt);break;case"video":case"audio":for(Tt=0;Tt<lf.length;Tt++)D$1(lf[Tt],bt);break;case"source":D$1("error",bt);break;case"img":case"image":case"link":D$1("error",bt),D$1("load",bt);break;case"details":D$1("toggle",bt);break;case"input":Za(bt,Et),D$1("invalid",bt);break;case"select":bt._wrapperState={wasMultiple:!!Et.multiple},D$1("invalid",bt);break;case"textarea":hb(bt,Et),D$1("invalid",bt)}ub(vt,Et),Tt=null;for(var wt in Et)if(Et.hasOwnProperty(wt)){var St=Et[wt];wt==="children"?typeof St=="string"?bt.textContent!==St&&(Et.suppressHydrationWarning!==!0&&Af(bt.textContent,St,xt),Tt=["children",St]):typeof St=="number"&&bt.textContent!==""+St&&(Et.suppressHydrationWarning!==!0&&Af(bt.textContent,St,xt),Tt=["children",""+St]):ea.hasOwnProperty(wt)&&St!=null&&wt==="onScroll"&&D$1("scroll",bt)}switch(vt){case"input":Va(bt),db(bt,Et,!0);break;case"textarea":Va(bt),jb(bt);break;case"select":case"option":break;default:typeof Et.onClick=="function"&&(bt.onclick=Bf)}bt=Tt,yt.updateQueue=bt,bt!==null&&(yt.flags|=4)}else{wt=Tt.nodeType===9?Tt:Tt.ownerDocument,xt==="http://www.w3.org/1999/xhtml"&&(xt=kb(vt)),xt==="http://www.w3.org/1999/xhtml"?vt==="script"?(xt=wt.createElement("div"),xt.innerHTML="<script><\/script>",xt=xt.removeChild(xt.firstChild)):typeof bt.is=="string"?xt=wt.createElement(vt,{is:bt.is}):(xt=wt.createElement(vt),vt==="select"&&(wt=xt,bt.multiple?wt.multiple=!0:bt.size&&(wt.size=bt.size))):xt=wt.createElementNS(xt,vt),xt[Of]=yt,xt[Pf]=bt,zj(xt,yt,!1,!1),yt.stateNode=xt;e:{switch(wt=vb(vt,bt),vt){case"dialog":D$1("cancel",xt),D$1("close",xt),Tt=bt;break;case"iframe":case"object":case"embed":D$1("load",xt),Tt=bt;break;case"video":case"audio":for(Tt=0;Tt<lf.length;Tt++)D$1(lf[Tt],xt);Tt=bt;break;case"source":D$1("error",xt),Tt=bt;break;case"img":case"image":case"link":D$1("error",xt),D$1("load",xt),Tt=bt;break;case"details":D$1("toggle",xt),Tt=bt;break;case"input":Za(xt,bt),Tt=Ya(xt,bt),D$1("invalid",xt);break;case"option":Tt=bt;break;case"select":xt._wrapperState={wasMultiple:!!bt.multiple},Tt=A$1({},bt,{value:void 0}),D$1("invalid",xt);break;case"textarea":hb(xt,bt),Tt=gb(xt,bt),D$1("invalid",xt);break;default:Tt=bt}ub(vt,Tt),St=Tt;for(Et in St)if(St.hasOwnProperty(Et)){var At=St[Et];Et==="style"?sb(xt,At):Et==="dangerouslySetInnerHTML"?(At=At?At.__html:void 0,At!=null&&nb(xt,At)):Et==="children"?typeof At=="string"?(vt!=="textarea"||At!=="")&&ob(xt,At):typeof At=="number"&&ob(xt,""+At):Et!=="suppressContentEditableWarning"&&Et!=="suppressHydrationWarning"&&Et!=="autoFocus"&&(ea.hasOwnProperty(Et)?At!=null&&Et==="onScroll"&&D$1("scroll",xt):At!=null&&ta(xt,Et,At,wt))}switch(vt){case"input":Va(xt),db(xt,bt,!1);break;case"textarea":Va(xt),jb(xt);break;case"option":bt.value!=null&&xt.setAttribute("value",""+Sa(bt.value));break;case"select":xt.multiple=!!bt.multiple,Et=bt.value,Et!=null?fb(xt,!!bt.multiple,Et,!1):bt.defaultValue!=null&&fb(xt,!!bt.multiple,bt.defaultValue,!0);break;default:typeof Tt.onClick=="function"&&(xt.onclick=Bf)}switch(vt){case"button":case"input":case"select":case"textarea":bt=!!bt.autoFocus;break e;case"img":bt=!0;break e;default:bt=!1}}bt&&(yt.flags|=4)}yt.ref!==null&&(yt.flags|=512,yt.flags|=2097152)}return S$1(yt),null;case 6:if(xt&&yt.stateNode!=null)Cj(xt,yt,xt.memoizedProps,bt);else{if(typeof bt!="string"&&yt.stateNode===null)throw Error(p$1(166));if(vt=xh(wh.current),xh(uh.current),Gg(yt)){if(bt=yt.stateNode,vt=yt.memoizedProps,bt[Of]=yt,(Et=bt.nodeValue!==vt)&&(xt=xg,xt!==null))switch(xt.tag){case 3:Af(bt.nodeValue,vt,(xt.mode&1)!==0);break;case 5:xt.memoizedProps.suppressHydrationWarning!==!0&&Af(bt.nodeValue,vt,(xt.mode&1)!==0)}Et&&(yt.flags|=4)}else bt=(vt.nodeType===9?vt:vt.ownerDocument).createTextNode(bt),bt[Of]=yt,yt.stateNode=bt}return S$1(yt),null;case 13:if(E$1(L$1),bt=yt.memoizedState,xt===null||xt.memoizedState!==null&&xt.memoizedState.dehydrated!==null){if(I$1&&yg!==null&&yt.mode&1&&!(yt.flags&128))Hg(),Ig(),yt.flags|=98560,Et=!1;else if(Et=Gg(yt),bt!==null&&bt.dehydrated!==null){if(xt===null){if(!Et)throw Error(p$1(318));if(Et=yt.memoizedState,Et=Et!==null?Et.dehydrated:null,!Et)throw Error(p$1(317));Et[Of]=yt}else Ig(),!(yt.flags&128)&&(yt.memoizedState=null),yt.flags|=4;S$1(yt),Et=!1}else zg!==null&&(Fj(zg),zg=null),Et=!0;if(!Et)return yt.flags&65536?yt:null}return yt.flags&128?(yt.lanes=vt,yt):(bt=bt!==null,bt!==(xt!==null&&xt.memoizedState!==null)&&bt&&(yt.child.flags|=8192,yt.mode&1&&(xt===null||L$1.current&1?T$1===0&&(T$1=3):tj())),yt.updateQueue!==null&&(yt.flags|=4),S$1(yt),null);case 4:return zh(),Aj(xt,yt),xt===null&&sf(yt.stateNode.containerInfo),S$1(yt),null;case 10:return ah(yt.type._context),S$1(yt),null;case 17:return Zf(yt.type)&&$f(),S$1(yt),null;case 19:if(E$1(L$1),Et=yt.memoizedState,Et===null)return S$1(yt),null;if(bt=(yt.flags&128)!==0,wt=Et.rendering,wt===null)if(bt)Dj(Et,!1);else{if(T$1!==0||xt!==null&&xt.flags&128)for(xt=yt.child;xt!==null;){if(wt=Ch(xt),wt!==null){for(yt.flags|=128,Dj(Et,!1),bt=wt.updateQueue,bt!==null&&(yt.updateQueue=bt,yt.flags|=4),yt.subtreeFlags=0,bt=vt,vt=yt.child;vt!==null;)Et=vt,xt=bt,Et.flags&=14680066,wt=Et.alternate,wt===null?(Et.childLanes=0,Et.lanes=xt,Et.child=null,Et.subtreeFlags=0,Et.memoizedProps=null,Et.memoizedState=null,Et.updateQueue=null,Et.dependencies=null,Et.stateNode=null):(Et.childLanes=wt.childLanes,Et.lanes=wt.lanes,Et.child=wt.child,Et.subtreeFlags=0,Et.deletions=null,Et.memoizedProps=wt.memoizedProps,Et.memoizedState=wt.memoizedState,Et.updateQueue=wt.updateQueue,Et.type=wt.type,xt=wt.dependencies,Et.dependencies=xt===null?null:{lanes:xt.lanes,firstContext:xt.firstContext}),vt=vt.sibling;return G$1(L$1,L$1.current&1|2),yt.child}xt=xt.sibling}Et.tail!==null&&B$1()>Gj&&(yt.flags|=128,bt=!0,Dj(Et,!1),yt.lanes=4194304)}else{if(!bt)if(xt=Ch(wt),xt!==null){if(yt.flags|=128,bt=!0,vt=xt.updateQueue,vt!==null&&(yt.updateQueue=vt,yt.flags|=4),Dj(Et,!0),Et.tail===null&&Et.tailMode==="hidden"&&!wt.alternate&&!I$1)return S$1(yt),null}else 2*B$1()-Et.renderingStartTime>Gj&&vt!==1073741824&&(yt.flags|=128,bt=!0,Dj(Et,!1),yt.lanes=4194304);Et.isBackwards?(wt.sibling=yt.child,yt.child=wt):(vt=Et.last,vt!==null?vt.sibling=wt:yt.child=wt,Et.last=wt)}return Et.tail!==null?(yt=Et.tail,Et.rendering=yt,Et.tail=yt.sibling,Et.renderingStartTime=B$1(),yt.sibling=null,vt=L$1.current,G$1(L$1,bt?vt&1|2:vt&1),yt):(S$1(yt),null);case 22:case 23:return Hj(),bt=yt.memoizedState!==null,xt!==null&&xt.memoizedState!==null!==bt&&(yt.flags|=8192),bt&&yt.mode&1?fj&1073741824&&(S$1(yt),yt.subtreeFlags&6&&(yt.flags|=8192)):S$1(yt),null;case 24:return null;case 25:return null}throw Error(p$1(156,yt.tag))}function Ij(xt,yt){switch(wg(yt),yt.tag){case 1:return Zf(yt.type)&&$f(),xt=yt.flags,xt&65536?(yt.flags=xt&-65537|128,yt):null;case 3:return zh(),E$1(Wf),E$1(H$1),Eh(),xt=yt.flags,xt&65536&&!(xt&128)?(yt.flags=xt&-65537|128,yt):null;case 5:return Bh(yt),null;case 13:if(E$1(L$1),xt=yt.memoizedState,xt!==null&&xt.dehydrated!==null){if(yt.alternate===null)throw Error(p$1(340));Ig()}return xt=yt.flags,xt&65536?(yt.flags=xt&-65537|128,yt):null;case 19:return E$1(L$1),null;case 4:return zh(),null;case 10:return ah(yt.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U$1=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V$1=null;function Lj(xt,yt){var vt=xt.ref;if(vt!==null)if(typeof vt=="function")try{vt(null)}catch(bt){W$1(xt,yt,bt)}else vt.current=null}function Mj(xt,yt,vt){try{vt()}catch(bt){W$1(xt,yt,bt)}}var Nj=!1;function Oj(xt,yt){if(Cf=dd,xt=Me$1(),Ne$1(xt)){if("selectionStart"in xt)var vt={start:xt.selectionStart,end:xt.selectionEnd};else e:{vt=(vt=xt.ownerDocument)&&vt.defaultView||window;var bt=vt.getSelection&&vt.getSelection();if(bt&&bt.rangeCount!==0){vt=bt.anchorNode;var Tt=bt.anchorOffset,Et=bt.focusNode;bt=bt.focusOffset;try{vt.nodeType,Et.nodeType}catch{vt=null;break e}var wt=0,St=-1,At=-1,Rt=0,Pt=0,Ct=xt,It=null;t:for(;;){for(var Mt;Ct!==vt||Tt!==0&&Ct.nodeType!==3||(St=wt+Tt),Ct!==Et||bt!==0&&Ct.nodeType!==3||(At=wt+bt),Ct.nodeType===3&&(wt+=Ct.nodeValue.length),(Mt=Ct.firstChild)!==null;)It=Ct,Ct=Mt;for(;;){if(Ct===xt)break t;if(It===vt&&++Rt===Tt&&(St=wt),It===Et&&++Pt===bt&&(At=wt),(Mt=Ct.nextSibling)!==null)break;Ct=It,It=Ct.parentNode}Ct=Mt}vt=St===-1||At===-1?null:{start:St,end:At}}else vt=null}vt=vt||{start:0,end:0}}else vt=null;for(Df={focusedElem:xt,selectionRange:vt},dd=!1,V$1=yt;V$1!==null;)if(yt=V$1,xt=yt.child,(yt.subtreeFlags&1028)!==0&&xt!==null)xt.return=yt,V$1=xt;else for(;V$1!==null;){yt=V$1;try{var Ot=yt.alternate;if(yt.flags&1024)switch(yt.tag){case 0:case 11:case 15:break;case 1:if(Ot!==null){var kt=Ot.memoizedProps,Ft=Ot.memoizedState,Nt=yt.stateNode,Lt=Nt.getSnapshotBeforeUpdate(yt.elementType===yt.type?kt:Ci(yt.type,kt),Ft);Nt.__reactInternalSnapshotBeforeUpdate=Lt}break;case 3:var Dt=yt.stateNode.containerInfo;Dt.nodeType===1?Dt.textContent="":Dt.nodeType===9&&Dt.documentElement&&Dt.removeChild(Dt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch($t){W$1(yt,yt.return,$t)}if(xt=yt.sibling,xt!==null){xt.return=yt.return,V$1=xt;break}V$1=yt.return}return Ot=Nj,Nj=!1,Ot}function Pj(xt,yt,vt){var bt=yt.updateQueue;if(bt=bt!==null?bt.lastEffect:null,bt!==null){var Tt=bt=bt.next;do{if((Tt.tag&xt)===xt){var Et=Tt.destroy;Tt.destroy=void 0,Et!==void 0&&Mj(yt,vt,Et)}Tt=Tt.next}while(Tt!==bt)}}function Qj(xt,yt){if(yt=yt.updateQueue,yt=yt!==null?yt.lastEffect:null,yt!==null){var vt=yt=yt.next;do{if((vt.tag&xt)===xt){var bt=vt.create;vt.destroy=bt()}vt=vt.next}while(vt!==yt)}}function Rj(xt){var yt=xt.ref;if(yt!==null){var vt=xt.stateNode;switch(xt.tag){case 5:xt=vt;break;default:xt=vt}typeof yt=="function"?yt(xt):yt.current=xt}}function Sj(xt){var yt=xt.alternate;yt!==null&&(xt.alternate=null,Sj(yt)),xt.child=null,xt.deletions=null,xt.sibling=null,xt.tag===5&&(yt=xt.stateNode,yt!==null&&(delete yt[Of],delete yt[Pf],delete yt[of],delete yt[Qf],delete yt[Rf])),xt.stateNode=null,xt.return=null,xt.dependencies=null,xt.memoizedProps=null,xt.memoizedState=null,xt.pendingProps=null,xt.stateNode=null,xt.updateQueue=null}function Tj(xt){return xt.tag===5||xt.tag===3||xt.tag===4}function Uj(xt){e:for(;;){for(;xt.sibling===null;){if(xt.return===null||Tj(xt.return))return null;xt=xt.return}for(xt.sibling.return=xt.return,xt=xt.sibling;xt.tag!==5&&xt.tag!==6&&xt.tag!==18;){if(xt.flags&2||xt.child===null||xt.tag===4)continue e;xt.child.return=xt,xt=xt.child}if(!(xt.flags&2))return xt.stateNode}}function Vj(xt,yt,vt){var bt=xt.tag;if(bt===5||bt===6)xt=xt.stateNode,yt?vt.nodeType===8?vt.parentNode.insertBefore(xt,yt):vt.insertBefore(xt,yt):(vt.nodeType===8?(yt=vt.parentNode,yt.insertBefore(xt,vt)):(yt=vt,yt.appendChild(xt)),vt=vt._reactRootContainer,vt!=null||yt.onclick!==null||(yt.onclick=Bf));else if(bt!==4&&(xt=xt.child,xt!==null))for(Vj(xt,yt,vt),xt=xt.sibling;xt!==null;)Vj(xt,yt,vt),xt=xt.sibling}function Wj(xt,yt,vt){var bt=xt.tag;if(bt===5||bt===6)xt=xt.stateNode,yt?vt.insertBefore(xt,yt):vt.appendChild(xt);else if(bt!==4&&(xt=xt.child,xt!==null))for(Wj(xt,yt,vt),xt=xt.sibling;xt!==null;)Wj(xt,yt,vt),xt=xt.sibling}var X$1=null,Xj=!1;function Yj(xt,yt,vt){for(vt=vt.child;vt!==null;)Zj(xt,yt,vt),vt=vt.sibling}function Zj(xt,yt,vt){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,vt)}catch{}switch(vt.tag){case 5:U$1||Lj(vt,yt);case 6:var bt=X$1,Tt=Xj;X$1=null,Yj(xt,yt,vt),X$1=bt,Xj=Tt,X$1!==null&&(Xj?(xt=X$1,vt=vt.stateNode,xt.nodeType===8?xt.parentNode.removeChild(vt):xt.removeChild(vt)):X$1.removeChild(vt.stateNode));break;case 18:X$1!==null&&(Xj?(xt=X$1,vt=vt.stateNode,xt.nodeType===8?Kf(xt.parentNode,vt):xt.nodeType===1&&Kf(xt,vt),bd(xt)):Kf(X$1,vt.stateNode));break;case 4:bt=X$1,Tt=Xj,X$1=vt.stateNode.containerInfo,Xj=!0,Yj(xt,yt,vt),X$1=bt,Xj=Tt;break;case 0:case 11:case 14:case 15:if(!U$1&&(bt=vt.updateQueue,bt!==null&&(bt=bt.lastEffect,bt!==null))){Tt=bt=bt.next;do{var Et=Tt,wt=Et.destroy;Et=Et.tag,wt!==void 0&&(Et&2||Et&4)&&Mj(vt,yt,wt),Tt=Tt.next}while(Tt!==bt)}Yj(xt,yt,vt);break;case 1:if(!U$1&&(Lj(vt,yt),bt=vt.stateNode,typeof bt.componentWillUnmount=="function"))try{bt.props=vt.memoizedProps,bt.state=vt.memoizedState,bt.componentWillUnmount()}catch(St){W$1(vt,yt,St)}Yj(xt,yt,vt);break;case 21:Yj(xt,yt,vt);break;case 22:vt.mode&1?(U$1=(bt=U$1)||vt.memoizedState!==null,Yj(xt,yt,vt),U$1=bt):Yj(xt,yt,vt);break;default:Yj(xt,yt,vt)}}function ak(xt){var yt=xt.updateQueue;if(yt!==null){xt.updateQueue=null;var vt=xt.stateNode;vt===null&&(vt=xt.stateNode=new Kj),yt.forEach(function(bt){var Tt=bk.bind(null,xt,bt);vt.has(bt)||(vt.add(bt),bt.then(Tt,Tt))})}}function ck(xt,yt){var vt=yt.deletions;if(vt!==null)for(var bt=0;bt<vt.length;bt++){var Tt=vt[bt];try{var Et=xt,wt=yt,St=wt;e:for(;St!==null;){switch(St.tag){case 5:X$1=St.stateNode,Xj=!1;break e;case 3:X$1=St.stateNode.containerInfo,Xj=!0;break e;case 4:X$1=St.stateNode.containerInfo,Xj=!0;break e}St=St.return}if(X$1===null)throw Error(p$1(160));Zj(Et,wt,Tt),X$1=null,Xj=!1;var At=Tt.alternate;At!==null&&(At.return=null),Tt.return=null}catch(Rt){W$1(Tt,yt,Rt)}}if(yt.subtreeFlags&12854)for(yt=yt.child;yt!==null;)dk(yt,xt),yt=yt.sibling}function dk(xt,yt){var vt=xt.alternate,bt=xt.flags;switch(xt.tag){case 0:case 11:case 14:case 15:if(ck(yt,xt),ek(xt),bt&4){try{Pj(3,xt,xt.return),Qj(3,xt)}catch(kt){W$1(xt,xt.return,kt)}try{Pj(5,xt,xt.return)}catch(kt){W$1(xt,xt.return,kt)}}break;case 1:ck(yt,xt),ek(xt),bt&512&&vt!==null&&Lj(vt,vt.return);break;case 5:if(ck(yt,xt),ek(xt),bt&512&&vt!==null&&Lj(vt,vt.return),xt.flags&32){var Tt=xt.stateNode;try{ob(Tt,"")}catch(kt){W$1(xt,xt.return,kt)}}if(bt&4&&(Tt=xt.stateNode,Tt!=null)){var Et=xt.memoizedProps,wt=vt!==null?vt.memoizedProps:Et,St=xt.type,At=xt.updateQueue;if(xt.updateQueue=null,At!==null)try{St==="input"&&Et.type==="radio"&&Et.name!=null&&ab(Tt,Et),vb(St,wt);var Rt=vb(St,Et);for(wt=0;wt<At.length;wt+=2){var Pt=At[wt],Ct=At[wt+1];Pt==="style"?sb(Tt,Ct):Pt==="dangerouslySetInnerHTML"?nb(Tt,Ct):Pt==="children"?ob(Tt,Ct):ta(Tt,Pt,Ct,Rt)}switch(St){case"input":bb(Tt,Et);break;case"textarea":ib(Tt,Et);break;case"select":var It=Tt._wrapperState.wasMultiple;Tt._wrapperState.wasMultiple=!!Et.multiple;var Mt=Et.value;Mt!=null?fb(Tt,!!Et.multiple,Mt,!1):It!==!!Et.multiple&&(Et.defaultValue!=null?fb(Tt,!!Et.multiple,Et.defaultValue,!0):fb(Tt,!!Et.multiple,Et.multiple?[]:"",!1))}Tt[Pf]=Et}catch(kt){W$1(xt,xt.return,kt)}}break;case 6:if(ck(yt,xt),ek(xt),bt&4){if(xt.stateNode===null)throw Error(p$1(162));Tt=xt.stateNode,Et=xt.memoizedProps;try{Tt.nodeValue=Et}catch(kt){W$1(xt,xt.return,kt)}}break;case 3:if(ck(yt,xt),ek(xt),bt&4&&vt!==null&&vt.memoizedState.isDehydrated)try{bd(yt.containerInfo)}catch(kt){W$1(xt,xt.return,kt)}break;case 4:ck(yt,xt),ek(xt);break;case 13:ck(yt,xt),ek(xt),Tt=xt.child,Tt.flags&8192&&(Et=Tt.memoizedState!==null,Tt.stateNode.isHidden=Et,!Et||Tt.alternate!==null&&Tt.alternate.memoizedState!==null||(fk=B$1())),bt&4&&ak(xt);break;case 22:if(Pt=vt!==null&&vt.memoizedState!==null,xt.mode&1?(U$1=(Rt=U$1)||Pt,ck(yt,xt),U$1=Rt):ck(yt,xt),ek(xt),bt&8192){if(Rt=xt.memoizedState!==null,(xt.stateNode.isHidden=Rt)&&!Pt&&xt.mode&1)for(V$1=xt,Pt=xt.child;Pt!==null;){for(Ct=V$1=Pt;V$1!==null;){switch(It=V$1,Mt=It.child,It.tag){case 0:case 11:case 14:case 15:Pj(4,It,It.return);break;case 1:Lj(It,It.return);var Ot=It.stateNode;if(typeof Ot.componentWillUnmount=="function"){bt=It,vt=It.return;try{yt=bt,Ot.props=yt.memoizedProps,Ot.state=yt.memoizedState,Ot.componentWillUnmount()}catch(kt){W$1(bt,vt,kt)}}break;case 5:Lj(It,It.return);break;case 22:if(It.memoizedState!==null){gk(Ct);continue}}Mt!==null?(Mt.return=It,V$1=Mt):gk(Ct)}Pt=Pt.sibling}e:for(Pt=null,Ct=xt;;){if(Ct.tag===5){if(Pt===null){Pt=Ct;try{Tt=Ct.stateNode,Rt?(Et=Tt.style,typeof Et.setProperty=="function"?Et.setProperty("display","none","important"):Et.display="none"):(St=Ct.stateNode,At=Ct.memoizedProps.style,wt=At!=null&&At.hasOwnProperty("display")?At.display:null,St.style.display=rb("display",wt))}catch(kt){W$1(xt,xt.return,kt)}}}else if(Ct.tag===6){if(Pt===null)try{Ct.stateNode.nodeValue=Rt?"":Ct.memoizedProps}catch(kt){W$1(xt,xt.return,kt)}}else if((Ct.tag!==22&&Ct.tag!==23||Ct.memoizedState===null||Ct===xt)&&Ct.child!==null){Ct.child.return=Ct,Ct=Ct.child;continue}if(Ct===xt)break e;for(;Ct.sibling===null;){if(Ct.return===null||Ct.return===xt)break e;Pt===Ct&&(Pt=null),Ct=Ct.return}Pt===Ct&&(Pt=null),Ct.sibling.return=Ct.return,Ct=Ct.sibling}}break;case 19:ck(yt,xt),ek(xt),bt&4&&ak(xt);break;case 21:break;default:ck(yt,xt),ek(xt)}}function ek(xt){var yt=xt.flags;if(yt&2){try{e:{for(var vt=xt.return;vt!==null;){if(Tj(vt)){var bt=vt;break e}vt=vt.return}throw Error(p$1(160))}switch(bt.tag){case 5:var Tt=bt.stateNode;bt.flags&32&&(ob(Tt,""),bt.flags&=-33);var Et=Uj(xt);Wj(xt,Et,Tt);break;case 3:case 4:var wt=bt.stateNode.containerInfo,St=Uj(xt);Vj(xt,St,wt);break;default:throw Error(p$1(161))}}catch(At){W$1(xt,xt.return,At)}xt.flags&=-3}yt&4096&&(xt.flags&=-4097)}function hk(xt,yt,vt){V$1=xt,ik(xt)}function ik(xt,yt,vt){for(var bt=(xt.mode&1)!==0;V$1!==null;){var Tt=V$1,Et=Tt.child;if(Tt.tag===22&&bt){var wt=Tt.memoizedState!==null||Jj;if(!wt){var St=Tt.alternate,At=St!==null&&St.memoizedState!==null||U$1;St=Jj;var Rt=U$1;if(Jj=wt,(U$1=At)&&!Rt)for(V$1=Tt;V$1!==null;)wt=V$1,At=wt.child,wt.tag===22&&wt.memoizedState!==null?jk(Tt):At!==null?(At.return=wt,V$1=At):jk(Tt);for(;Et!==null;)V$1=Et,ik(Et),Et=Et.sibling;V$1=Tt,Jj=St,U$1=Rt}kk(xt)}else Tt.subtreeFlags&8772&&Et!==null?(Et.return=Tt,V$1=Et):kk(xt)}}function kk(xt){for(;V$1!==null;){var yt=V$1;if(yt.flags&8772){var vt=yt.alternate;try{if(yt.flags&8772)switch(yt.tag){case 0:case 11:case 15:U$1||Qj(5,yt);break;case 1:var bt=yt.stateNode;if(yt.flags&4&&!U$1)if(vt===null)bt.componentDidMount();else{var Tt=yt.elementType===yt.type?vt.memoizedProps:Ci(yt.type,vt.memoizedProps);bt.componentDidUpdate(Tt,vt.memoizedState,bt.__reactInternalSnapshotBeforeUpdate)}var Et=yt.updateQueue;Et!==null&&sh(yt,Et,bt);break;case 3:var wt=yt.updateQueue;if(wt!==null){if(vt=null,yt.child!==null)switch(yt.child.tag){case 5:vt=yt.child.stateNode;break;case 1:vt=yt.child.stateNode}sh(yt,wt,vt)}break;case 5:var St=yt.stateNode;if(vt===null&&yt.flags&4){vt=St;var At=yt.memoizedProps;switch(yt.type){case"button":case"input":case"select":case"textarea":At.autoFocus&&vt.focus();break;case"img":At.src&&(vt.src=At.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(yt.memoizedState===null){var Rt=yt.alternate;if(Rt!==null){var Pt=Rt.memoizedState;if(Pt!==null){var Ct=Pt.dehydrated;Ct!==null&&bd(Ct)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U$1||yt.flags&512&&Rj(yt)}catch(It){W$1(yt,yt.return,It)}}if(yt===xt){V$1=null;break}if(vt=yt.sibling,vt!==null){vt.return=yt.return,V$1=vt;break}V$1=yt.return}}function gk(xt){for(;V$1!==null;){var yt=V$1;if(yt===xt){V$1=null;break}var vt=yt.sibling;if(vt!==null){vt.return=yt.return,V$1=vt;break}V$1=yt.return}}function jk(xt){for(;V$1!==null;){var yt=V$1;try{switch(yt.tag){case 0:case 11:case 15:var vt=yt.return;try{Qj(4,yt)}catch(At){W$1(yt,vt,At)}break;case 1:var bt=yt.stateNode;if(typeof bt.componentDidMount=="function"){var Tt=yt.return;try{bt.componentDidMount()}catch(At){W$1(yt,Tt,At)}}var Et=yt.return;try{Rj(yt)}catch(At){W$1(yt,Et,At)}break;case 5:var wt=yt.return;try{Rj(yt)}catch(At){W$1(yt,wt,At)}}}catch(At){W$1(yt,yt.return,At)}if(yt===xt){V$1=null;break}var St=yt.sibling;if(St!==null){St.return=yt.return,V$1=St;break}V$1=yt.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K$1=0,Q$1=null,Y$1=null,Z$1=0,fj=0,ej=Uf(0),T$1=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R$1(){return K$1&6?B$1():Ak!==-1?Ak:Ak=B$1()}function yi(xt){return xt.mode&1?K$1&2&&Z$1!==0?Z$1&-Z$1:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(xt=C$1,xt!==0||(xt=window.event,xt=xt===void 0?16:jd(xt.type)),xt):1}function gi(xt,yt,vt,bt){if(50<yk)throw yk=0,zk=null,Error(p$1(185));Ac(xt,vt,bt),(!(K$1&2)||xt!==Q$1)&&(xt===Q$1&&(!(K$1&2)&&(qk|=vt),T$1===4&&Ck(xt,Z$1)),Dk(xt,bt),vt===1&&K$1===0&&!(yt.mode&1)&&(Gj=B$1()+500,fg&&jg()))}function Dk(xt,yt){var vt=xt.callbackNode;wc(xt,yt);var bt=uc(xt,xt===Q$1?Z$1:0);if(bt===0)vt!==null&&bc(vt),xt.callbackNode=null,xt.callbackPriority=0;else if(yt=bt&-bt,xt.callbackPriority!==yt){if(vt!=null&&bc(vt),yt===1)xt.tag===0?ig(Ek.bind(null,xt)):hg(Ek.bind(null,xt)),Jf(function(){!(K$1&6)&&jg()}),vt=null;else{switch(Dc(bt)){case 1:vt=fc;break;case 4:vt=gc;break;case 16:vt=hc;break;case 536870912:vt=jc;break;default:vt=hc}vt=Fk(vt,Gk.bind(null,xt))}xt.callbackPriority=yt,xt.callbackNode=vt}}function Gk(xt,yt){if(Ak=-1,Bk=0,K$1&6)throw Error(p$1(327));var vt=xt.callbackNode;if(Hk()&&xt.callbackNode!==vt)return null;var bt=uc(xt,xt===Q$1?Z$1:0);if(bt===0)return null;if(bt&30||bt&xt.expiredLanes||yt)yt=Ik(xt,bt);else{yt=bt;var Tt=K$1;K$1|=2;var Et=Jk();(Q$1!==xt||Z$1!==yt)&&(uk=null,Gj=B$1()+500,Kk(xt,yt));do try{Lk();break}catch(St){Mk(xt,St)}while(!0);$g(),mk.current=Et,K$1=Tt,Y$1!==null?yt=0:(Q$1=null,Z$1=0,yt=T$1)}if(yt!==0){if(yt===2&&(Tt=xc(xt),Tt!==0&&(bt=Tt,yt=Nk(xt,Tt))),yt===1)throw vt=pk,Kk(xt,0),Ck(xt,bt),Dk(xt,B$1()),vt;if(yt===6)Ck(xt,bt);else{if(Tt=xt.current.alternate,!(bt&30)&&!Ok(Tt)&&(yt=Ik(xt,bt),yt===2&&(Et=xc(xt),Et!==0&&(bt=Et,yt=Nk(xt,Et))),yt===1))throw vt=pk,Kk(xt,0),Ck(xt,bt),Dk(xt,B$1()),vt;switch(xt.finishedWork=Tt,xt.finishedLanes=bt,yt){case 0:case 1:throw Error(p$1(345));case 2:Pk(xt,tk,uk);break;case 3:if(Ck(xt,bt),(bt&130023424)===bt&&(yt=fk+500-B$1(),10<yt)){if(uc(xt,0)!==0)break;if(Tt=xt.suspendedLanes,(Tt&bt)!==bt){R$1(),xt.pingedLanes|=xt.suspendedLanes&Tt;break}xt.timeoutHandle=Ff(Pk.bind(null,xt,tk,uk),yt);break}Pk(xt,tk,uk);break;case 4:if(Ck(xt,bt),(bt&4194240)===bt)break;for(yt=xt.eventTimes,Tt=-1;0<bt;){var wt=31-oc(bt);Et=1<<wt,wt=yt[wt],wt>Tt&&(Tt=wt),bt&=~Et}if(bt=Tt,bt=B$1()-bt,bt=(120>bt?120:480>bt?480:1080>bt?1080:1920>bt?1920:3e3>bt?3e3:4320>bt?4320:1960*lk(bt/1960))-bt,10<bt){xt.timeoutHandle=Ff(Pk.bind(null,xt,tk,uk),bt);break}Pk(xt,tk,uk);break;case 5:Pk(xt,tk,uk);break;default:throw Error(p$1(329))}}}return Dk(xt,B$1()),xt.callbackNode===vt?Gk.bind(null,xt):null}function Nk(xt,yt){var vt=sk;return xt.current.memoizedState.isDehydrated&&(Kk(xt,yt).flags|=256),xt=Ik(xt,yt),xt!==2&&(yt=tk,tk=vt,yt!==null&&Fj(yt)),xt}function Fj(xt){tk===null?tk=xt:tk.push.apply(tk,xt)}function Ok(xt){for(var yt=xt;;){if(yt.flags&16384){var vt=yt.updateQueue;if(vt!==null&&(vt=vt.stores,vt!==null))for(var bt=0;bt<vt.length;bt++){var Tt=vt[bt],Et=Tt.getSnapshot;Tt=Tt.value;try{if(!He$1(Et(),Tt))return!1}catch{return!1}}}if(vt=yt.child,yt.subtreeFlags&16384&&vt!==null)vt.return=yt,yt=vt;else{if(yt===xt)break;for(;yt.sibling===null;){if(yt.return===null||yt.return===xt)return!0;yt=yt.return}yt.sibling.return=yt.return,yt=yt.sibling}}return!0}function Ck(xt,yt){for(yt&=~rk,yt&=~qk,xt.suspendedLanes|=yt,xt.pingedLanes&=~yt,xt=xt.expirationTimes;0<yt;){var vt=31-oc(yt),bt=1<<vt;xt[vt]=-1,yt&=~bt}}function Ek(xt){if(K$1&6)throw Error(p$1(327));Hk();var yt=uc(xt,0);if(!(yt&1))return Dk(xt,B$1()),null;var vt=Ik(xt,yt);if(xt.tag!==0&&vt===2){var bt=xc(xt);bt!==0&&(yt=bt,vt=Nk(xt,bt))}if(vt===1)throw vt=pk,Kk(xt,0),Ck(xt,yt),Dk(xt,B$1()),vt;if(vt===6)throw Error(p$1(345));return xt.finishedWork=xt.current.alternate,xt.finishedLanes=yt,Pk(xt,tk,uk),Dk(xt,B$1()),null}function Qk(xt,yt){var vt=K$1;K$1|=1;try{return xt(yt)}finally{K$1=vt,K$1===0&&(Gj=B$1()+500,fg&&jg())}}function Rk(xt){wk!==null&&wk.tag===0&&!(K$1&6)&&Hk();var yt=K$1;K$1|=1;var vt=ok.transition,bt=C$1;try{if(ok.transition=null,C$1=1,xt)return xt()}finally{C$1=bt,ok.transition=vt,K$1=yt,!(K$1&6)&&jg()}}function Hj(){fj=ej.current,E$1(ej)}function Kk(xt,yt){xt.finishedWork=null,xt.finishedLanes=0;var vt=xt.timeoutHandle;if(vt!==-1&&(xt.timeoutHandle=-1,Gf(vt)),Y$1!==null)for(vt=Y$1.return;vt!==null;){var bt=vt;switch(wg(bt),bt.tag){case 1:bt=bt.type.childContextTypes,bt!=null&&$f();break;case 3:zh(),E$1(Wf),E$1(H$1),Eh();break;case 5:Bh(bt);break;case 4:zh();break;case 13:E$1(L$1);break;case 19:E$1(L$1);break;case 10:ah(bt.type._context);break;case 22:case 23:Hj()}vt=vt.return}if(Q$1=xt,Y$1=xt=Pg(xt.current,null),Z$1=fj=yt,T$1=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(yt=0;yt<fh.length;yt++)if(vt=fh[yt],bt=vt.interleaved,bt!==null){vt.interleaved=null;var Tt=bt.next,Et=vt.pending;if(Et!==null){var wt=Et.next;Et.next=Tt,bt.next=wt}vt.pending=bt}fh=null}return xt}function Mk(xt,yt){do{var vt=Y$1;try{if($g(),Fh.current=Rh,Ih){for(var bt=M$1.memoizedState;bt!==null;){var Tt=bt.queue;Tt!==null&&(Tt.pending=null),bt=bt.next}Ih=!1}if(Hh=0,O$1=N$1=M$1=null,Jh=!1,Kh=0,nk.current=null,vt===null||vt.return===null){T$1=1,pk=yt,Y$1=null;break}e:{var Et=xt,wt=vt.return,St=vt,At=yt;if(yt=Z$1,St.flags|=32768,At!==null&&typeof At=="object"&&typeof At.then=="function"){var Rt=At,Pt=St,Ct=Pt.tag;if(!(Pt.mode&1)&&(Ct===0||Ct===11||Ct===15)){var It=Pt.alternate;It?(Pt.updateQueue=It.updateQueue,Pt.memoizedState=It.memoizedState,Pt.lanes=It.lanes):(Pt.updateQueue=null,Pt.memoizedState=null)}var Mt=Ui(wt);if(Mt!==null){Mt.flags&=-257,Vi(Mt,wt,St,Et,yt),Mt.mode&1&&Si(Et,Rt,yt),yt=Mt,At=Rt;var Ot=yt.updateQueue;if(Ot===null){var kt=new Set;kt.add(At),yt.updateQueue=kt}else Ot.add(At);break e}else{if(!(yt&1)){Si(Et,Rt,yt),tj();break e}At=Error(p$1(426))}}else if(I$1&&St.mode&1){var Ft=Ui(wt);if(Ft!==null){!(Ft.flags&65536)&&(Ft.flags|=256),Vi(Ft,wt,St,Et,yt),Jg(Ji(At,St));break e}}Et=At=Ji(At,St),T$1!==4&&(T$1=2),sk===null?sk=[Et]:sk.push(Et),Et=wt;do{switch(Et.tag){case 3:Et.flags|=65536,yt&=-yt,Et.lanes|=yt;var Nt=Ni(Et,At,yt);ph(Et,Nt);break e;case 1:St=At;var Lt=Et.type,Dt=Et.stateNode;if(!(Et.flags&128)&&(typeof Lt.getDerivedStateFromError=="function"||Dt!==null&&typeof Dt.componentDidCatch=="function"&&(Ri===null||!Ri.has(Dt)))){Et.flags|=65536,yt&=-yt,Et.lanes|=yt;var $t=Qi(Et,St,yt);ph(Et,$t);break e}}Et=Et.return}while(Et!==null)}Sk(vt)}catch(zt){yt=zt,Y$1===vt&&vt!==null&&(Y$1=vt=vt.return);continue}break}while(!0)}function Jk(){var xt=mk.current;return mk.current=Rh,xt===null?Rh:xt}function tj(){(T$1===0||T$1===3||T$1===2)&&(T$1=4),Q$1===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q$1,Z$1)}function Ik(xt,yt){var vt=K$1;K$1|=2;var bt=Jk();(Q$1!==xt||Z$1!==yt)&&(uk=null,Kk(xt,yt));do try{Tk();break}catch(Tt){Mk(xt,Tt)}while(!0);if($g(),K$1=vt,mk.current=bt,Y$1!==null)throw Error(p$1(261));return Q$1=null,Z$1=0,T$1}function Tk(){for(;Y$1!==null;)Uk(Y$1)}function Lk(){for(;Y$1!==null&&!cc();)Uk(Y$1)}function Uk(xt){var yt=Vk(xt.alternate,xt,fj);xt.memoizedProps=xt.pendingProps,yt===null?Sk(xt):Y$1=yt,nk.current=null}function Sk(xt){var yt=xt;do{var vt=yt.alternate;if(xt=yt.return,yt.flags&32768){if(vt=Ij(vt,yt),vt!==null){vt.flags&=32767,Y$1=vt;return}if(xt!==null)xt.flags|=32768,xt.subtreeFlags=0,xt.deletions=null;else{T$1=6,Y$1=null;return}}else if(vt=Ej(vt,yt,fj),vt!==null){Y$1=vt;return}if(yt=yt.sibling,yt!==null){Y$1=yt;return}Y$1=yt=xt}while(yt!==null);T$1===0&&(T$1=5)}function Pk(xt,yt,vt){var bt=C$1,Tt=ok.transition;try{ok.transition=null,C$1=1,Wk(xt,yt,vt,bt)}finally{ok.transition=Tt,C$1=bt}return null}function Wk(xt,yt,vt,bt){do Hk();while(wk!==null);if(K$1&6)throw Error(p$1(327));vt=xt.finishedWork;var Tt=xt.finishedLanes;if(vt===null)return null;if(xt.finishedWork=null,xt.finishedLanes=0,vt===xt.current)throw Error(p$1(177));xt.callbackNode=null,xt.callbackPriority=0;var Et=vt.lanes|vt.childLanes;if(Bc(xt,Et),xt===Q$1&&(Y$1=Q$1=null,Z$1=0),!(vt.subtreeFlags&2064)&&!(vt.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),Et=(vt.flags&15990)!==0,vt.subtreeFlags&15990||Et){Et=ok.transition,ok.transition=null;var wt=C$1;C$1=1;var St=K$1;K$1|=4,nk.current=null,Oj(xt,vt),dk(vt,xt),Oe$1(Df),dd=!!Cf,Df=Cf=null,xt.current=vt,hk(vt),dc(),K$1=St,C$1=wt,ok.transition=Et}else xt.current=vt;if(vk&&(vk=!1,wk=xt,xk=Tt),Et=xt.pendingLanes,Et===0&&(Ri=null),mc(vt.stateNode),Dk(xt,B$1()),yt!==null)for(bt=xt.onRecoverableError,vt=0;vt<yt.length;vt++)Tt=yt[vt],bt(Tt.value,{componentStack:Tt.stack,digest:Tt.digest});if(Oi)throw Oi=!1,xt=Pi,Pi=null,xt;return xk&1&&xt.tag!==0&&Hk(),Et=xt.pendingLanes,Et&1?xt===zk?yk++:(yk=0,zk=xt):yk=0,jg(),null}function Hk(){if(wk!==null){var xt=Dc(xk),yt=ok.transition,vt=C$1;try{if(ok.transition=null,C$1=16>xt?16:xt,wk===null)var bt=!1;else{if(xt=wk,wk=null,xk=0,K$1&6)throw Error(p$1(331));var Tt=K$1;for(K$1|=4,V$1=xt.current;V$1!==null;){var Et=V$1,wt=Et.child;if(V$1.flags&16){var St=Et.deletions;if(St!==null){for(var At=0;At<St.length;At++){var Rt=St[At];for(V$1=Rt;V$1!==null;){var Pt=V$1;switch(Pt.tag){case 0:case 11:case 15:Pj(8,Pt,Et)}var Ct=Pt.child;if(Ct!==null)Ct.return=Pt,V$1=Ct;else for(;V$1!==null;){Pt=V$1;var It=Pt.sibling,Mt=Pt.return;if(Sj(Pt),Pt===Rt){V$1=null;break}if(It!==null){It.return=Mt,V$1=It;break}V$1=Mt}}}var Ot=Et.alternate;if(Ot!==null){var kt=Ot.child;if(kt!==null){Ot.child=null;do{var Ft=kt.sibling;kt.sibling=null,kt=Ft}while(kt!==null)}}V$1=Et}}if(Et.subtreeFlags&2064&&wt!==null)wt.return=Et,V$1=wt;else e:for(;V$1!==null;){if(Et=V$1,Et.flags&2048)switch(Et.tag){case 0:case 11:case 15:Pj(9,Et,Et.return)}var Nt=Et.sibling;if(Nt!==null){Nt.return=Et.return,V$1=Nt;break e}V$1=Et.return}}var Lt=xt.current;for(V$1=Lt;V$1!==null;){wt=V$1;var Dt=wt.child;if(wt.subtreeFlags&2064&&Dt!==null)Dt.return=wt,V$1=Dt;else e:for(wt=Lt;V$1!==null;){if(St=V$1,St.flags&2048)try{switch(St.tag){case 0:case 11:case 15:Qj(9,St)}}catch(zt){W$1(St,St.return,zt)}if(St===wt){V$1=null;break e}var $t=St.sibling;if($t!==null){$t.return=St.return,V$1=$t;break e}V$1=St.return}}if(K$1=Tt,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,xt)}catch{}bt=!0}return bt}finally{C$1=vt,ok.transition=yt}}return!1}function Xk(xt,yt,vt){yt=Ji(vt,yt),yt=Ni(xt,yt,1),xt=nh(xt,yt,1),yt=R$1(),xt!==null&&(Ac(xt,1,yt),Dk(xt,yt))}function W$1(xt,yt,vt){if(xt.tag===3)Xk(xt,xt,vt);else for(;yt!==null;){if(yt.tag===3){Xk(yt,xt,vt);break}else if(yt.tag===1){var bt=yt.stateNode;if(typeof yt.type.getDerivedStateFromError=="function"||typeof bt.componentDidCatch=="function"&&(Ri===null||!Ri.has(bt))){xt=Ji(vt,xt),xt=Qi(yt,xt,1),yt=nh(yt,xt,1),xt=R$1(),yt!==null&&(Ac(yt,1,xt),Dk(yt,xt));break}}yt=yt.return}}function Ti(xt,yt,vt){var bt=xt.pingCache;bt!==null&&bt.delete(yt),yt=R$1(),xt.pingedLanes|=xt.suspendedLanes&vt,Q$1===xt&&(Z$1&vt)===vt&&(T$1===4||T$1===3&&(Z$1&130023424)===Z$1&&500>B$1()-fk?Kk(xt,0):rk|=vt),Dk(xt,yt)}function Yk(xt,yt){yt===0&&(xt.mode&1?(yt=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):yt=1);var vt=R$1();xt=ih(xt,yt),xt!==null&&(Ac(xt,yt,vt),Dk(xt,vt))}function uj(xt){var yt=xt.memoizedState,vt=0;yt!==null&&(vt=yt.retryLane),Yk(xt,vt)}function bk(xt,yt){var vt=0;switch(xt.tag){case 13:var bt=xt.stateNode,Tt=xt.memoizedState;Tt!==null&&(vt=Tt.retryLane);break;case 19:bt=xt.stateNode;break;default:throw Error(p$1(314))}bt!==null&&bt.delete(yt),Yk(xt,vt)}var Vk;Vk=function(xt,yt,vt){if(xt!==null)if(xt.memoizedProps!==yt.pendingProps||Wf.current)dh=!0;else{if(!(xt.lanes&vt)&&!(yt.flags&128))return dh=!1,yj(xt,yt,vt);dh=!!(xt.flags&131072)}else dh=!1,I$1&&yt.flags&1048576&&ug(yt,ng,yt.index);switch(yt.lanes=0,yt.tag){case 2:var bt=yt.type;ij(xt,yt),xt=yt.pendingProps;var Tt=Yf(yt,H$1.current);ch(yt,vt),Tt=Nh(null,yt,bt,xt,Tt,vt);var Et=Sh();return yt.flags|=1,typeof Tt=="object"&&Tt!==null&&typeof Tt.render=="function"&&Tt.$$typeof===void 0?(yt.tag=1,yt.memoizedState=null,yt.updateQueue=null,Zf(bt)?(Et=!0,cg(yt)):Et=!1,yt.memoizedState=Tt.state!==null&&Tt.state!==void 0?Tt.state:null,kh(yt),Tt.updater=Ei,yt.stateNode=Tt,Tt._reactInternals=yt,Ii(yt,bt,xt,vt),yt=jj(null,yt,bt,!0,Et,vt)):(yt.tag=0,I$1&&Et&&vg(yt),Xi(null,yt,Tt,vt),yt=yt.child),yt;case 16:bt=yt.elementType;e:{switch(ij(xt,yt),xt=yt.pendingProps,Tt=bt._init,bt=Tt(bt._payload),yt.type=bt,Tt=yt.tag=Zk(bt),xt=Ci(bt,xt),Tt){case 0:yt=cj(null,yt,bt,xt,vt);break e;case 1:yt=hj(null,yt,bt,xt,vt);break e;case 11:yt=Yi(null,yt,bt,xt,vt);break e;case 14:yt=$i(null,yt,bt,Ci(bt.type,xt),vt);break e}throw Error(p$1(306,bt,""))}return yt;case 0:return bt=yt.type,Tt=yt.pendingProps,Tt=yt.elementType===bt?Tt:Ci(bt,Tt),cj(xt,yt,bt,Tt,vt);case 1:return bt=yt.type,Tt=yt.pendingProps,Tt=yt.elementType===bt?Tt:Ci(bt,Tt),hj(xt,yt,bt,Tt,vt);case 3:e:{if(kj(yt),xt===null)throw Error(p$1(387));bt=yt.pendingProps,Et=yt.memoizedState,Tt=Et.element,lh(xt,yt),qh(yt,bt,null,vt);var wt=yt.memoizedState;if(bt=wt.element,Et.isDehydrated)if(Et={element:bt,isDehydrated:!1,cache:wt.cache,pendingSuspenseBoundaries:wt.pendingSuspenseBoundaries,transitions:wt.transitions},yt.updateQueue.baseState=Et,yt.memoizedState=Et,yt.flags&256){Tt=Ji(Error(p$1(423)),yt),yt=lj(xt,yt,bt,vt,Tt);break e}else if(bt!==Tt){Tt=Ji(Error(p$1(424)),yt),yt=lj(xt,yt,bt,vt,Tt);break e}else for(yg=Lf(yt.stateNode.containerInfo.firstChild),xg=yt,I$1=!0,zg=null,vt=Vg(yt,null,bt,vt),yt.child=vt;vt;)vt.flags=vt.flags&-3|4096,vt=vt.sibling;else{if(Ig(),bt===Tt){yt=Zi(xt,yt,vt);break e}Xi(xt,yt,bt,vt)}yt=yt.child}return yt;case 5:return Ah(yt),xt===null&&Eg(yt),bt=yt.type,Tt=yt.pendingProps,Et=xt!==null?xt.memoizedProps:null,wt=Tt.children,Ef(bt,Tt)?wt=null:Et!==null&&Ef(bt,Et)&&(yt.flags|=32),gj(xt,yt),Xi(xt,yt,wt,vt),yt.child;case 6:return xt===null&&Eg(yt),null;case 13:return oj(xt,yt,vt);case 4:return yh(yt,yt.stateNode.containerInfo),bt=yt.pendingProps,xt===null?yt.child=Ug(yt,null,bt,vt):Xi(xt,yt,bt,vt),yt.child;case 11:return bt=yt.type,Tt=yt.pendingProps,Tt=yt.elementType===bt?Tt:Ci(bt,Tt),Yi(xt,yt,bt,Tt,vt);case 7:return Xi(xt,yt,yt.pendingProps,vt),yt.child;case 8:return Xi(xt,yt,yt.pendingProps.children,vt),yt.child;case 12:return Xi(xt,yt,yt.pendingProps.children,vt),yt.child;case 10:e:{if(bt=yt.type._context,Tt=yt.pendingProps,Et=yt.memoizedProps,wt=Tt.value,G$1(Wg,bt._currentValue),bt._currentValue=wt,Et!==null)if(He$1(Et.value,wt)){if(Et.children===Tt.children&&!Wf.current){yt=Zi(xt,yt,vt);break e}}else for(Et=yt.child,Et!==null&&(Et.return=yt);Et!==null;){var St=Et.dependencies;if(St!==null){wt=Et.child;for(var At=St.firstContext;At!==null;){if(At.context===bt){if(Et.tag===1){At=mh(-1,vt&-vt),At.tag=2;var Rt=Et.updateQueue;if(Rt!==null){Rt=Rt.shared;var Pt=Rt.pending;Pt===null?At.next=At:(At.next=Pt.next,Pt.next=At),Rt.pending=At}}Et.lanes|=vt,At=Et.alternate,At!==null&&(At.lanes|=vt),bh(Et.return,vt,yt),St.lanes|=vt;break}At=At.next}}else if(Et.tag===10)wt=Et.type===yt.type?null:Et.child;else if(Et.tag===18){if(wt=Et.return,wt===null)throw Error(p$1(341));wt.lanes|=vt,St=wt.alternate,St!==null&&(St.lanes|=vt),bh(wt,vt,yt),wt=Et.sibling}else wt=Et.child;if(wt!==null)wt.return=Et;else for(wt=Et;wt!==null;){if(wt===yt){wt=null;break}if(Et=wt.sibling,Et!==null){Et.return=wt.return,wt=Et;break}wt=wt.return}Et=wt}Xi(xt,yt,Tt.children,vt),yt=yt.child}return yt;case 9:return Tt=yt.type,bt=yt.pendingProps.children,ch(yt,vt),Tt=eh(Tt),bt=bt(Tt),yt.flags|=1,Xi(xt,yt,bt,vt),yt.child;case 14:return bt=yt.type,Tt=Ci(bt,yt.pendingProps),Tt=Ci(bt.type,Tt),$i(xt,yt,bt,Tt,vt);case 15:return bj(xt,yt,yt.type,yt.pendingProps,vt);case 17:return bt=yt.type,Tt=yt.pendingProps,Tt=yt.elementType===bt?Tt:Ci(bt,Tt),ij(xt,yt),yt.tag=1,Zf(bt)?(xt=!0,cg(yt)):xt=!1,ch(yt,vt),Gi(yt,bt,Tt),Ii(yt,bt,Tt,vt),jj(null,yt,bt,!0,xt,vt);case 19:return xj(xt,yt,vt);case 22:return dj(xt,yt,vt)}throw Error(p$1(156,yt.tag))};function Fk(xt,yt){return ac(xt,yt)}function $k(xt,yt,vt,bt){this.tag=xt,this.key=vt,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=yt,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=bt,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(xt,yt,vt,bt){return new $k(xt,yt,vt,bt)}function aj(xt){return xt=xt.prototype,!(!xt||!xt.isReactComponent)}function Zk(xt){if(typeof xt=="function")return aj(xt)?1:0;if(xt!=null){if(xt=xt.$$typeof,xt===Da)return 11;if(xt===Ga)return 14}return 2}function Pg(xt,yt){var vt=xt.alternate;return vt===null?(vt=Bg(xt.tag,yt,xt.key,xt.mode),vt.elementType=xt.elementType,vt.type=xt.type,vt.stateNode=xt.stateNode,vt.alternate=xt,xt.alternate=vt):(vt.pendingProps=yt,vt.type=xt.type,vt.flags=0,vt.subtreeFlags=0,vt.deletions=null),vt.flags=xt.flags&14680064,vt.childLanes=xt.childLanes,vt.lanes=xt.lanes,vt.child=xt.child,vt.memoizedProps=xt.memoizedProps,vt.memoizedState=xt.memoizedState,vt.updateQueue=xt.updateQueue,yt=xt.dependencies,vt.dependencies=yt===null?null:{lanes:yt.lanes,firstContext:yt.firstContext},vt.sibling=xt.sibling,vt.index=xt.index,vt.ref=xt.ref,vt}function Rg(xt,yt,vt,bt,Tt,Et){var wt=2;if(bt=xt,typeof xt=="function")aj(xt)&&(wt=1);else if(typeof xt=="string")wt=5;else e:switch(xt){case ya:return Tg(vt.children,Tt,Et,yt);case za:wt=8,Tt|=8;break;case Aa:return xt=Bg(12,vt,yt,Tt|2),xt.elementType=Aa,xt.lanes=Et,xt;case Ea:return xt=Bg(13,vt,yt,Tt),xt.elementType=Ea,xt.lanes=Et,xt;case Fa:return xt=Bg(19,vt,yt,Tt),xt.elementType=Fa,xt.lanes=Et,xt;case Ia:return pj(vt,Tt,Et,yt);default:if(typeof xt=="object"&&xt!==null)switch(xt.$$typeof){case Ba:wt=10;break e;case Ca:wt=9;break e;case Da:wt=11;break e;case Ga:wt=14;break e;case Ha:wt=16,bt=null;break e}throw Error(p$1(130,xt==null?xt:typeof xt,""))}return yt=Bg(wt,vt,yt,Tt),yt.elementType=xt,yt.type=bt,yt.lanes=Et,yt}function Tg(xt,yt,vt,bt){return xt=Bg(7,xt,bt,yt),xt.lanes=vt,xt}function pj(xt,yt,vt,bt){return xt=Bg(22,xt,bt,yt),xt.elementType=Ia,xt.lanes=vt,xt.stateNode={isHidden:!1},xt}function Qg(xt,yt,vt){return xt=Bg(6,xt,null,yt),xt.lanes=vt,xt}function Sg(xt,yt,vt){return yt=Bg(4,xt.children!==null?xt.children:[],xt.key,yt),yt.lanes=vt,yt.stateNode={containerInfo:xt.containerInfo,pendingChildren:null,implementation:xt.implementation},yt}function al(xt,yt,vt,bt,Tt){this.tag=yt,this.containerInfo=xt,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=bt,this.onRecoverableError=Tt,this.mutableSourceEagerHydrationData=null}function bl(xt,yt,vt,bt,Tt,Et,wt,St,At){return xt=new al(xt,yt,vt,St,At),yt===1?(yt=1,Et===!0&&(yt|=8)):yt=0,Et=Bg(3,null,null,yt),xt.current=Et,Et.stateNode=xt,Et.memoizedState={element:bt,isDehydrated:vt,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(Et),xt}function cl(xt,yt,vt){var bt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:bt==null?null:""+bt,children:xt,containerInfo:yt,implementation:vt}}function dl(xt){if(!xt)return Vf;xt=xt._reactInternals;e:{if(Vb(xt)!==xt||xt.tag!==1)throw Error(p$1(170));var yt=xt;do{switch(yt.tag){case 3:yt=yt.stateNode.context;break e;case 1:if(Zf(yt.type)){yt=yt.stateNode.__reactInternalMemoizedMergedChildContext;break e}}yt=yt.return}while(yt!==null);throw Error(p$1(171))}if(xt.tag===1){var vt=xt.type;if(Zf(vt))return bg(xt,vt,yt)}return yt}function el(xt,yt,vt,bt,Tt,Et,wt,St,At){return xt=bl(vt,bt,!0,xt,Tt,Et,wt,St,At),xt.context=dl(null),vt=xt.current,bt=R$1(),Tt=yi(vt),Et=mh(bt,Tt),Et.callback=yt??null,nh(vt,Et,Tt),xt.current.lanes=Tt,Ac(xt,Tt,bt),Dk(xt,bt),xt}function fl(xt,yt,vt,bt){var Tt=yt.current,Et=R$1(),wt=yi(Tt);return vt=dl(vt),yt.context===null?yt.context=vt:yt.pendingContext=vt,yt=mh(Et,wt),yt.payload={element:xt},bt=bt===void 0?null:bt,bt!==null&&(yt.callback=bt),xt=nh(Tt,yt,wt),xt!==null&&(gi(xt,Tt,wt,Et),oh(xt,Tt,wt)),wt}function gl(xt){if(xt=xt.current,!xt.child)return null;switch(xt.child.tag){case 5:return xt.child.stateNode;default:return xt.child.stateNode}}function hl(xt,yt){if(xt=xt.memoizedState,xt!==null&&xt.dehydrated!==null){var vt=xt.retryLane;xt.retryLane=vt!==0&&vt<yt?vt:yt}}function il(xt,yt){hl(xt,yt),(xt=xt.alternate)&&hl(xt,yt)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(xt){console.error(xt)};function ll(xt){this._internalRoot=xt}ml.prototype.render=ll.prototype.render=function(xt){var yt=this._internalRoot;if(yt===null)throw Error(p$1(409));fl(xt,yt,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var xt=this._internalRoot;if(xt!==null){this._internalRoot=null;var yt=xt.containerInfo;Rk(function(){fl(null,xt,null,null)}),yt[uf]=null}};function ml(xt){this._internalRoot=xt}ml.prototype.unstable_scheduleHydration=function(xt){if(xt){var yt=Hc();xt={blockedOn:null,target:xt,priority:yt};for(var vt=0;vt<Qc.length&&yt!==0&&yt<Qc[vt].priority;vt++);Qc.splice(vt,0,xt),vt===0&&Vc(xt)}};function nl(xt){return!(!xt||xt.nodeType!==1&&xt.nodeType!==9&&xt.nodeType!==11)}function ol(xt){return!(!xt||xt.nodeType!==1&&xt.nodeType!==9&&xt.nodeType!==11&&(xt.nodeType!==8||xt.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(xt,yt,vt,bt,Tt){if(Tt){if(typeof bt=="function"){var Et=bt;bt=function(){var Rt=gl(wt);Et.call(Rt)}}var wt=el(yt,bt,xt,0,null,!1,!1,"",pl);return xt._reactRootContainer=wt,xt[uf]=wt.current,sf(xt.nodeType===8?xt.parentNode:xt),Rk(),wt}for(;Tt=xt.lastChild;)xt.removeChild(Tt);if(typeof bt=="function"){var St=bt;bt=function(){var Rt=gl(At);St.call(Rt)}}var At=bl(xt,0,!1,null,null,!1,!1,"",pl);return xt._reactRootContainer=At,xt[uf]=At.current,sf(xt.nodeType===8?xt.parentNode:xt),Rk(function(){fl(yt,At,vt,bt)}),At}function rl(xt,yt,vt,bt,Tt){var Et=vt._reactRootContainer;if(Et){var wt=Et;if(typeof Tt=="function"){var St=Tt;Tt=function(){var At=gl(wt);St.call(At)}}fl(yt,wt,xt,Tt)}else wt=ql(vt,yt,xt,Tt,bt);return gl(wt)}Ec=function(xt){switch(xt.tag){case 3:var yt=xt.stateNode;if(yt.current.memoizedState.isDehydrated){var vt=tc(yt.pendingLanes);vt!==0&&(Cc(yt,vt|1),Dk(yt,B$1()),!(K$1&6)&&(Gj=B$1()+500,jg()))}break;case 13:Rk(function(){var bt=ih(xt,1);if(bt!==null){var Tt=R$1();gi(bt,xt,1,Tt)}}),il(xt,1)}};Fc=function(xt){if(xt.tag===13){var yt=ih(xt,134217728);if(yt!==null){var vt=R$1();gi(yt,xt,134217728,vt)}il(xt,134217728)}};Gc=function(xt){if(xt.tag===13){var yt=yi(xt),vt=ih(xt,yt);if(vt!==null){var bt=R$1();gi(vt,xt,yt,bt)}il(xt,yt)}};Hc=function(){return C$1};Ic=function(xt,yt){var vt=C$1;try{return C$1=xt,yt()}finally{C$1=vt}};yb=function(xt,yt,vt){switch(yt){case"input":if(bb(xt,vt),yt=vt.name,vt.type==="radio"&&yt!=null){for(vt=xt;vt.parentNode;)vt=vt.parentNode;for(vt=vt.querySelectorAll("input[name="+JSON.stringify(""+yt)+'][type="radio"]'),yt=0;yt<vt.length;yt++){var bt=vt[yt];if(bt!==xt&&bt.form===xt.form){var Tt=Db(bt);if(!Tt)throw Error(p$1(90));Wa(bt),bb(bt,Tt)}}}break;case"textarea":ib(xt,vt);break;case"select":yt=vt.value,yt!=null&&fb(xt,!!vt.multiple,yt,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue$1,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(xt){return xt=Zb(xt),xt===null?null:xt.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(xt,yt){var vt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(yt))throw Error(p$1(200));return cl(xt,yt,null,vt)};reactDom_production_min.createRoot=function(xt,yt){if(!nl(xt))throw Error(p$1(299));var vt=!1,bt="",Tt=kl;return yt!=null&&(yt.unstable_strictMode===!0&&(vt=!0),yt.identifierPrefix!==void 0&&(bt=yt.identifierPrefix),yt.onRecoverableError!==void 0&&(Tt=yt.onRecoverableError)),yt=bl(xt,1,!1,null,null,vt,!1,bt,Tt),xt[uf]=yt.current,sf(xt.nodeType===8?xt.parentNode:xt),new ll(yt)};reactDom_production_min.findDOMNode=function(xt){if(xt==null)return null;if(xt.nodeType===1)return xt;var yt=xt._reactInternals;if(yt===void 0)throw typeof xt.render=="function"?Error(p$1(188)):(xt=Object.keys(xt).join(","),Error(p$1(268,xt)));return xt=Zb(yt),xt=xt===null?null:xt.stateNode,xt};reactDom_production_min.flushSync=function(xt){return Rk(xt)};reactDom_production_min.hydrate=function(xt,yt,vt){if(!ol(yt))throw Error(p$1(200));return rl(null,xt,yt,!0,vt)};reactDom_production_min.hydrateRoot=function(xt,yt,vt){if(!nl(xt))throw Error(p$1(405));var bt=vt!=null&&vt.hydratedSources||null,Tt=!1,Et="",wt=kl;if(vt!=null&&(vt.unstable_strictMode===!0&&(Tt=!0),vt.identifierPrefix!==void 0&&(Et=vt.identifierPrefix),vt.onRecoverableError!==void 0&&(wt=vt.onRecoverableError)),yt=el(yt,null,xt,1,vt??null,Tt,!1,Et,wt),xt[uf]=yt.current,sf(xt),bt)for(xt=0;xt<bt.length;xt++)vt=bt[xt],Tt=vt._getVersion,Tt=Tt(vt._source),yt.mutableSourceEagerHydrationData==null?yt.mutableSourceEagerHydrationData=[vt,Tt]:yt.mutableSourceEagerHydrationData.push(vt,Tt);return new ml(yt)};reactDom_production_min.render=function(xt,yt,vt){if(!ol(yt))throw Error(p$1(200));return rl(null,xt,yt,!1,vt)};reactDom_production_min.unmountComponentAtNode=function(xt){if(!ol(xt))throw Error(p$1(40));return xt._reactRootContainer?(Rk(function(){rl(null,null,xt,!1,function(){xt._reactRootContainer=null,xt[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(xt,yt,vt,bt){if(!ol(vt))throw Error(p$1(200));if(xt==null||xt._reactInternals===void 0)throw Error(p$1(38));return rl(xt,yt,vt,!1,bt)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(xt){console.error(xt)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,m$1=reactDomExports;client.createRoot=m$1.createRoot,client.hydrateRoot=m$1.hydrateRoot;const initialState$1={isInitialized:!1,isRunning:!1,isLoading:!0,error:null,agents:[],trafficData:null,cityModel:null,simulationData:null,currentTime:8,day:0,speed:1,selectedTool:null,stats:{totalAgents:0,activeAgents:0,averageSpeed:0,congestionLevel:0},performance:null};function simulationReducer(xt,yt){switch(yt.type){case"SET_LOADING":return{...xt,isLoading:yt.payload};case"SET_ERROR":return{...xt,error:yt.payload,isLoading:!1};case"SET_INITIALIZED":return{...xt,isInitialized:yt.payload};case"SET_RUNNING":return{...xt,isRunning:yt.payload};case"SET_AGENTS":return{...xt,agents:yt.payload};case"SET_TRAFFIC_DATA":return{...xt,trafficData:yt.payload};case"SET_CITY_MODEL":return{...xt,cityModel:yt.payload};case"SET_SIMULATION_DATA":return{...xt,simulationData:yt.payload};case"SET_TIME":return{...xt,currentTime:yt.payload.time,day:yt.payload.day};case"SET_SPEED":return{...xt,speed:yt.payload};case"SET_TOOL":return{...xt,selectedTool:yt.payload};case"UPDATE_STATS":return{...xt,stats:{...xt.stats,...yt.payload}};case"SET_PERFORMANCE_STATE":return{...xt,performance:yt.payload};case"UPDATE_PERFORMANCE_PROFILE":return{...xt,performance:xt.performance?{...xt.performance,current_profile:yt.payload}:null};default:return xt}}const SimulationContext=reactExports.createContext(void 0);function SimulationProvider({children:xt}){const[yt,vt]=reactExports.useReducer(simulationReducer,initialState$1);return jsxRuntimeExports.jsx(SimulationContext.Provider,{value:{state:yt,dispatch:vt},children:xt})}function useSimulationContext(){const xt=reactExports.useContext(SimulationContext);if(xt===void 0)throw new Error("useSimulationContext must be used within a SimulationProvider");return xt}const initialState={isEnabled:!0,scale:10,seed:12345,timeOfDay:12,showAtmosphere:!1,terrainProfile:"manhattan",customParameters:{mountainHeight:200,waterLevel:0,hilliness:.7,riverProbability:.3,coastalDistance:5e3},activeLayer:"basic",autoRegenerateCity:!1};function terrainReducer(xt,yt){let vt;switch(yt.type){case"TOGGLE_TERRAIN":vt={...xt,isEnabled:yt.payload};break;case"SET_SCALE":vt={...xt,scale:yt.payload,activeLayer:yt.payload>50?"planetary":"basic",showAtmosphere:yt.payload>100?!0:xt.showAtmosphere};break;case"SET_SEED":vt={...xt,seed:yt.payload};break;case"SET_TIME_OF_DAY":vt={...xt,timeOfDay:yt.payload};break;case"TOGGLE_ATMOSPHERE":vt={...xt,showAtmosphere:yt.payload};break;case"SET_TERRAIN_PROFILE":vt={...xt,terrainProfile:yt.payload};break;case"UPDATE_CUSTOM_PARAMETERS":vt={...xt,customParameters:{...xt.customParameters,...yt.payload}};break;case"SET_ACTIVE_LAYER":vt={...xt,activeLayer:yt.payload};break;case"TOGGLE_AUTO_REGENERATE":vt={...xt,autoRegenerateCity:yt.payload};break;case"RESET_TO_DEFAULTS":vt={...initialState};break;case"LOAD_SAVED_STATE":vt={...xt,...yt.payload};break;default:return xt}try{localStorage.setItem("urbansynth-terrain-state",JSON.stringify(vt))}catch(bt){console.warn("Failed to save terrain state to localStorage:",bt)}return vt}const TerrainContext=reactExports.createContext(void 0);function TerrainProvider({children:xt}){const yt=()=>{try{const Tt=localStorage.getItem("urbansynth-terrain-state");if(Tt){const Et=JSON.parse(Tt);return{...initialState,...Et}}}catch(Tt){console.warn("Failed to load saved terrain state:",Tt)}return initialState},[vt,bt]=reactExports.useReducer(terrainReducer,yt());return React.useEffect(()=>{const Tt=yt();Tt!==initialState&&bt({type:"LOAD_SAVED_STATE",payload:Tt})},[]),jsxRuntimeExports.jsx(TerrainContext.Provider,{value:{state:vt,dispatch:bt},children:xt})}function useTerrainContext(){const xt=reactExports.useContext(TerrainContext);if(xt===void 0)throw new Error("useTerrainContext must be used within a TerrainProvider");return xt}class ErrorBoundary extends reactExports.Component{constructor(){super(...arguments);Bt(this,"state",{hasError:!1})}static getDerivedStateFromError(vt){return{hasError:!0,error:vt}}componentDidCatch(vt,bt){console.error("ErrorBoundary caught an error:",vt,bt)}render(){return this.state.hasError?jsxRuntimeExports.jsxs("div",{className:"error-boundary",children:[jsxRuntimeExports.jsx("h2",{children:"Something went wrong"}),jsxRuntimeExports.jsx("p",{children:"The application encountered an unexpected error."}),jsxRuntimeExports.jsx("button",{className:"button button-primary",onClick:()=>window.location.reload(),children:"Reload Application"}),this.state.error&&jsxRuntimeExports.jsx("pre",{children:this.state.error.toString()})]}):this.props.children}}function LoadingScreen({isVisible:xt,progress:yt=0,message:vt="Loading..."}){const[bt,Tt]=reactExports.useState("");return reactExports.useEffect(()=>{const Et=setInterval(()=>{Tt(wt=>wt.length>=3?"":wt+".")},500);return()=>clearInterval(Et)},[]),xt?jsxRuntimeExports.jsx("div",{className:"loading-screen",children:jsxRuntimeExports.jsxs("div",{className:"loading-content",children:[jsxRuntimeExports.jsx("div",{className:"loading-spinner"}),jsxRuntimeExports.jsx("h2",{className:"loading-title",children:"UrbanSynth"}),jsxRuntimeExports.jsxs("p",{className:"loading-subtitle",children:[vt,bt]}),jsxRuntimeExports.jsx("div",{className:"loading-progress",children:jsxRuntimeExports.jsx("div",{className:"loading-progress-bar",style:{width:`${Math.min(yt,100)}%`}})}),jsxRuntimeExports.jsx("p",{style:{fontSize:"0.875rem",color:"var(--text-secondary)"},children:yt>0?`${Math.round(yt)}%`:"Initializing simulation..."})]})}):null}const Z_INDEX={PANEL_BASE:1e3,TERRAIN_PANEL:1e3,CAMERA_PANEL:1001,TIME_PANEL:1002,PERFORMANCE_PANEL:1003,ACTIVE_PANEL:1100,STATUS_BAR:9998};function getPanelZIndex(xt,yt=!1){if(yt)return Z_INDEX.ACTIVE_PANEL;switch(xt){case"terrain":return Z_INDEX.TERRAIN_PANEL;case"camera":return Z_INDEX.CAMERA_PANEL;case"time":return Z_INDEX.TIME_PANEL;case"performance":return Z_INDEX.PERFORMANCE_PANEL;default:return Z_INDEX.PANEL_BASE}}class PanelZIndexManager{constructor(){Bt(this,"activePanelId",null);Bt(this,"listeners",[])}setActivePanel(yt){this.activePanelId=yt,this.notifyListeners()}getActivePanel(){return this.activePanelId}subscribe(yt){return this.listeners.push(yt),()=>{this.listeners=this.listeners.filter(vt=>vt!==yt)}}notifyListeners(){this.listeners.forEach(yt=>yt(this.activePanelId))}}const panelZIndexManager=new PanelZIndexManager;function StatusBar(){const{state:xt}=useSimulationContext(),yt=Tt=>{const Et=Math.floor(Tt).toString().padStart(2,"0"),wt=Math.floor((Tt-Math.floor(Tt))*60).toString().padStart(2,"0");return`${Et}:${wt}`},vt=Tt=>Tt>=6&&Tt<12?"Morning":Tt>=12&&Tt<18?"Afternoon":Tt>=18&&Tt<22?"Evening":"Night",bt=()=>xt.isRunning?60:0;return jsxRuntimeExports.jsxs("div",{style:containerStyle,children:[jsxRuntimeExports.jsxs("div",{style:sectionStyle,children:[jsxRuntimeExports.jsxs("div",{style:statusStyle,children:[jsxRuntimeExports.jsx("span",{style:labelStyle$1,children:"Status:"}),jsxRuntimeExports.jsx("span",{style:getStatusValueStyle(xt.isInitialized,xt.isRunning),children:xt.isInitialized?xt.isRunning?" Running":" Paused":" Loading"})]}),jsxRuntimeExports.jsxs("div",{style:statusStyle,children:[jsxRuntimeExports.jsx("span",{style:labelStyle$1,children:"Speed:"}),jsxRuntimeExports.jsxs("span",{style:valueStyle$1,children:[xt.speed.toFixed(1),"x"]})]})]}),jsxRuntimeExports.jsxs("div",{style:{...sectionStyle,flex:1,justifyContent:"center"},children:[jsxRuntimeExports.jsxs("div",{style:{...statusStyle,marginRight:"1rem"},children:[jsxRuntimeExports.jsx("span",{style:labelStyle$1,children:"Time:"}),jsxRuntimeExports.jsxs("span",{style:valueStyle$1,children:[yt(xt.currentTime)," (",vt(xt.currentTime),")"]})]}),jsxRuntimeExports.jsxs("div",{style:statusStyle,children:[jsxRuntimeExports.jsx("span",{style:labelStyle$1,children:"Day:"}),jsxRuntimeExports.jsx("span",{style:valueStyle$1,children:xt.day+1})]})]}),jsxRuntimeExports.jsxs("div",{style:sectionStyle,children:[jsxRuntimeExports.jsxs("div",{style:statusStyle,children:[jsxRuntimeExports.jsx("span",{style:labelStyle$1,children:"Agents:"}),jsxRuntimeExports.jsxs("span",{style:valueStyle$1,children:[xt.stats.activeAgents,"/",xt.stats.totalAgents]})]}),jsxRuntimeExports.jsxs("div",{style:statusStyle,children:[jsxRuntimeExports.jsx("span",{style:labelStyle$1,children:"FPS:"}),jsxRuntimeExports.jsx("span",{style:getValueStyle$1(bt(),55,30),children:bt()})]}),jsxRuntimeExports.jsxs("div",{style:statusStyle,children:[jsxRuntimeExports.jsx("span",{style:labelStyle$1,children:"Avg Speed:"}),jsxRuntimeExports.jsxs("span",{style:valueStyle$1,children:[xt.stats.averageSpeed.toFixed(1)," km/h"]})]}),jsxRuntimeExports.jsxs("div",{style:statusStyle,children:[jsxRuntimeExports.jsx("span",{style:labelStyle$1,children:"Congestion:"}),jsxRuntimeExports.jsxs("span",{style:getCongestionStyle(xt.stats.congestionLevel),children:[(xt.stats.congestionLevel*100).toFixed(0),"%"]})]})]}),xt.error&&jsxRuntimeExports.jsx("div",{style:errorStyle,children:jsxRuntimeExports.jsxs("span",{children:[" ",xt.error]})})]})}function getStatusValueStyle(xt,yt){const vt={...valueStyle$1};return xt?yt?vt.color="#4ade80":vt.color="#6b7280":vt.color="#fbbf24",vt}function getValueStyle$1(xt,yt,vt){const bt={...valueStyle$1};return xt>=yt?bt.color="#4ade80":xt>=vt?bt.color="#fbbf24":bt.color="#f87171",bt}function getCongestionStyle(xt){const yt={...valueStyle$1};return xt<.3?yt.color="#4ade80":xt<.7?yt.color="#fbbf24":yt.color="#f87171",yt}const containerStyle={position:"fixed",top:0,left:0,right:0,height:"60px",background:"linear-gradient(135deg, rgba(0, 0, 0, 0.95) 0%, rgba(30, 30, 50, 0.95) 100%)",backdropFilter:"blur(10px)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",display:"flex",alignItems:"center",padding:"0 1rem",zIndex:Z_INDEX.STATUS_BAR,fontFamily:'Monaco, "Lucida Console", monospace',fontSize:"12px",color:"white",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.3)"},sectionStyle={display:"flex",alignItems:"center",gap:"1rem"},statusStyle={display:"flex",alignItems:"center",gap:"0.25rem"},labelStyle$1={color:"rgba(255, 255, 255, 0.7)",fontSize:"11px",fontWeight:"normal"},valueStyle$1={color:"rgba(255, 255, 255, 0.95)",fontSize:"11px",fontWeight:"bold"},errorStyle={position:"absolute",right:"1rem",background:"rgba(239, 68, 68, 0.9)",color:"white",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"10px",maxWidth:"300px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},scriptRel="modulepreload",assetsURL=function(xt){return"/citysim/"+xt},seen={},__vitePreload=function(yt,vt,bt){let Tt=Promise.resolve();if(vt&&vt.length>0){document.getElementsByTagName("link");const wt=document.querySelector("meta[property=csp-nonce]"),St=(wt==null?void 0:wt.nonce)||(wt==null?void 0:wt.getAttribute("nonce"));Tt=Promise.allSettled(vt.map(At=>{if(At=assetsURL(At),At in seen)return;seen[At]=!0;const Rt=At.endsWith(".css"),Pt=Rt?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${At}"]${Pt}`))return;const Ct=document.createElement("link");if(Ct.rel=Rt?"stylesheet":scriptRel,Rt||(Ct.as="script"),Ct.crossOrigin="",Ct.href=At,St&&Ct.setAttribute("nonce",St),document.head.appendChild(Ct),Rt)return new Promise((It,Mt)=>{Ct.addEventListener("load",It),Ct.addEventListener("error",()=>Mt(new Error(`Unable to preload CSS for ${At}`)))})}))}function Et(wt){const St=new Event("vite:preloadError",{cancelable:!0});if(St.payload=wt,window.dispatchEvent(St),!St.defaultPrevented)throw wt}return Tt.then(wt=>{for(const St of wt||[])St.status==="rejected"&&Et(St.reason);return yt().catch(Et)})};var indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(xt,yt){for(var vt=new Array(arguments.length-1),bt=0,Tt=2,Et=!0;Tt<arguments.length;)vt[bt++]=arguments[Tt++];return new Promise(function(St,At){vt[bt]=function(Pt){if(Et)if(Et=!1,Pt)At(Pt);else{for(var Ct=new Array(arguments.length-1),It=0;It<Ct.length;)Ct[It++]=arguments[It];St.apply(null,Ct)}};try{xt.apply(yt||null,vt)}catch(Rt){Et&&(Et=!1,At(Rt))}})}var base64$1={};(function(xt){var yt=xt;yt.length=function(St){var At=St.length;if(!At)return 0;for(var Rt=0;--At%4>1&&St.charAt(At)==="=";)++Rt;return Math.ceil(St.length*3)/4-Rt};for(var vt=new Array(64),bt=new Array(123),Tt=0;Tt<64;)bt[vt[Tt]=Tt<26?Tt+65:Tt<52?Tt+71:Tt<62?Tt-4:Tt-59|43]=Tt++;yt.encode=function(St,At,Rt){for(var Pt=null,Ct=[],It=0,Mt=0,Ot;At<Rt;){var kt=St[At++];switch(Mt){case 0:Ct[It++]=vt[kt>>2],Ot=(kt&3)<<4,Mt=1;break;case 1:Ct[It++]=vt[Ot|kt>>4],Ot=(kt&15)<<2,Mt=2;break;case 2:Ct[It++]=vt[Ot|kt>>6],Ct[It++]=vt[kt&63],Mt=0;break}It>8191&&((Pt||(Pt=[])).push(String.fromCharCode.apply(String,Ct)),It=0)}return Mt&&(Ct[It++]=vt[Ot],Ct[It++]=61,Mt===1&&(Ct[It++]=61)),Pt?(It&&Pt.push(String.fromCharCode.apply(String,Ct.slice(0,It))),Pt.join("")):String.fromCharCode.apply(String,Ct.slice(0,It))};var Et="invalid encoding";yt.decode=function(St,At,Rt){for(var Pt=Rt,Ct=0,It,Mt=0;Mt<St.length;){var Ot=St.charCodeAt(Mt++);if(Ot===61&&Ct>1)break;if((Ot=bt[Ot])===void 0)throw Error(Et);switch(Ct){case 0:It=Ot,Ct=1;break;case 1:At[Rt++]=It<<2|(Ot&48)>>4,It=Ot,Ct=2;break;case 2:At[Rt++]=(It&15)<<4|(Ot&60)>>2,It=Ot,Ct=3;break;case 3:At[Rt++]=(It&3)<<6|Ot,Ct=0;break}}if(Ct===1)throw Error(Et);return Rt-Pt},yt.test=function(St){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(St)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(yt,vt,bt){return(this._listeners[yt]||(this._listeners[yt]=[])).push({fn:vt,ctx:bt||this}),this};EventEmitter.prototype.off=function(yt,vt){if(yt===void 0)this._listeners={};else if(vt===void 0)this._listeners[yt]=[];else for(var bt=this._listeners[yt],Tt=0;Tt<bt.length;)bt[Tt].fn===vt?bt.splice(Tt,1):++Tt;return this};EventEmitter.prototype.emit=function(yt){var vt=this._listeners[yt];if(vt){for(var bt=[],Tt=1;Tt<arguments.length;)bt.push(arguments[Tt++]);for(Tt=0;Tt<vt.length;)vt[Tt].fn.apply(vt[Tt++].ctx,bt)}return this};var float=factory(factory);function factory(xt){return typeof Float32Array<"u"?function(){var yt=new Float32Array([-0]),vt=new Uint8Array(yt.buffer),bt=vt[3]===128;function Tt(At,Rt,Pt){yt[0]=At,Rt[Pt]=vt[0],Rt[Pt+1]=vt[1],Rt[Pt+2]=vt[2],Rt[Pt+3]=vt[3]}function Et(At,Rt,Pt){yt[0]=At,Rt[Pt]=vt[3],Rt[Pt+1]=vt[2],Rt[Pt+2]=vt[1],Rt[Pt+3]=vt[0]}xt.writeFloatLE=bt?Tt:Et,xt.writeFloatBE=bt?Et:Tt;function wt(At,Rt){return vt[0]=At[Rt],vt[1]=At[Rt+1],vt[2]=At[Rt+2],vt[3]=At[Rt+3],yt[0]}function St(At,Rt){return vt[3]=At[Rt],vt[2]=At[Rt+1],vt[1]=At[Rt+2],vt[0]=At[Rt+3],yt[0]}xt.readFloatLE=bt?wt:St,xt.readFloatBE=bt?St:wt}():function(){function yt(bt,Tt,Et,wt){var St=Tt<0?1:0;if(St&&(Tt=-Tt),Tt===0)bt(1/Tt>0?0:2147483648,Et,wt);else if(isNaN(Tt))bt(2143289344,Et,wt);else if(Tt>34028234663852886e22)bt((St<<31|2139095040)>>>0,Et,wt);else if(Tt<11754943508222875e-54)bt((St<<31|Math.round(Tt/1401298464324817e-60))>>>0,Et,wt);else{var At=Math.floor(Math.log(Tt)/Math.LN2),Rt=Math.round(Tt*Math.pow(2,-At)*8388608)&8388607;bt((St<<31|At+127<<23|Rt)>>>0,Et,wt)}}xt.writeFloatLE=yt.bind(null,writeUintLE),xt.writeFloatBE=yt.bind(null,writeUintBE);function vt(bt,Tt,Et){var wt=bt(Tt,Et),St=(wt>>31)*2+1,At=wt>>>23&255,Rt=wt&8388607;return At===255?Rt?NaN:St*(1/0):At===0?St*1401298464324817e-60*Rt:St*Math.pow(2,At-150)*(Rt+8388608)}xt.readFloatLE=vt.bind(null,readUintLE),xt.readFloatBE=vt.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var yt=new Float64Array([-0]),vt=new Uint8Array(yt.buffer),bt=vt[7]===128;function Tt(At,Rt,Pt){yt[0]=At,Rt[Pt]=vt[0],Rt[Pt+1]=vt[1],Rt[Pt+2]=vt[2],Rt[Pt+3]=vt[3],Rt[Pt+4]=vt[4],Rt[Pt+5]=vt[5],Rt[Pt+6]=vt[6],Rt[Pt+7]=vt[7]}function Et(At,Rt,Pt){yt[0]=At,Rt[Pt]=vt[7],Rt[Pt+1]=vt[6],Rt[Pt+2]=vt[5],Rt[Pt+3]=vt[4],Rt[Pt+4]=vt[3],Rt[Pt+5]=vt[2],Rt[Pt+6]=vt[1],Rt[Pt+7]=vt[0]}xt.writeDoubleLE=bt?Tt:Et,xt.writeDoubleBE=bt?Et:Tt;function wt(At,Rt){return vt[0]=At[Rt],vt[1]=At[Rt+1],vt[2]=At[Rt+2],vt[3]=At[Rt+3],vt[4]=At[Rt+4],vt[5]=At[Rt+5],vt[6]=At[Rt+6],vt[7]=At[Rt+7],yt[0]}function St(At,Rt){return vt[7]=At[Rt],vt[6]=At[Rt+1],vt[5]=At[Rt+2],vt[4]=At[Rt+3],vt[3]=At[Rt+4],vt[2]=At[Rt+5],vt[1]=At[Rt+6],vt[0]=At[Rt+7],yt[0]}xt.readDoubleLE=bt?wt:St,xt.readDoubleBE=bt?St:wt}():function(){function yt(bt,Tt,Et,wt,St,At){var Rt=wt<0?1:0;if(Rt&&(wt=-wt),wt===0)bt(0,St,At+Tt),bt(1/wt>0?0:2147483648,St,At+Et);else if(isNaN(wt))bt(0,St,At+Tt),bt(2146959360,St,At+Et);else if(wt>17976931348623157e292)bt(0,St,At+Tt),bt((Rt<<31|2146435072)>>>0,St,At+Et);else{var Pt;if(wt<22250738585072014e-324)Pt=wt/5e-324,bt(Pt>>>0,St,At+Tt),bt((Rt<<31|Pt/4294967296)>>>0,St,At+Et);else{var Ct=Math.floor(Math.log(wt)/Math.LN2);Ct===1024&&(Ct=1023),Pt=wt*Math.pow(2,-Ct),bt(Pt*4503599627370496>>>0,St,At+Tt),bt((Rt<<31|Ct+1023<<20|Pt*1048576&1048575)>>>0,St,At+Et)}}}xt.writeDoubleLE=yt.bind(null,writeUintLE,0,4),xt.writeDoubleBE=yt.bind(null,writeUintBE,4,0);function vt(bt,Tt,Et,wt,St){var At=bt(wt,St+Tt),Rt=bt(wt,St+Et),Pt=(Rt>>31)*2+1,Ct=Rt>>>20&2047,It=4294967296*(Rt&1048575)+At;return Ct===2047?It?NaN:Pt*(1/0):Ct===0?Pt*5e-324*It:Pt*Math.pow(2,Ct-1075)*(It+4503599627370496)}xt.readDoubleLE=vt.bind(null,readUintLE,0,4),xt.readDoubleBE=vt.bind(null,readUintBE,4,0)}(),xt}function writeUintLE(xt,yt,vt){yt[vt]=xt&255,yt[vt+1]=xt>>>8&255,yt[vt+2]=xt>>>16&255,yt[vt+3]=xt>>>24}function writeUintBE(xt,yt,vt){yt[vt]=xt>>>24,yt[vt+1]=xt>>>16&255,yt[vt+2]=xt>>>8&255,yt[vt+3]=xt&255}function readUintLE(xt,yt){return(xt[yt]|xt[yt+1]<<8|xt[yt+2]<<16|xt[yt+3]<<24)>>>0}function readUintBE(xt,yt){return(xt[yt]<<24|xt[yt+1]<<16|xt[yt+2]<<8|xt[yt+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(xt){}return null}var utf8$2={};(function(xt){var yt=xt;yt.length=function(bt){for(var Tt=0,Et=0,wt=0;wt<bt.length;++wt)Et=bt.charCodeAt(wt),Et<128?Tt+=1:Et<2048?Tt+=2:(Et&64512)===55296&&(bt.charCodeAt(wt+1)&64512)===56320?(++wt,Tt+=4):Tt+=3;return Tt},yt.read=function(bt,Tt,Et){var wt=Et-Tt;if(wt<1)return"";for(var St=null,At=[],Rt=0,Pt;Tt<Et;)Pt=bt[Tt++],Pt<128?At[Rt++]=Pt:Pt>191&&Pt<224?At[Rt++]=(Pt&31)<<6|bt[Tt++]&63:Pt>239&&Pt<365?(Pt=((Pt&7)<<18|(bt[Tt++]&63)<<12|(bt[Tt++]&63)<<6|bt[Tt++]&63)-65536,At[Rt++]=55296+(Pt>>10),At[Rt++]=56320+(Pt&1023)):At[Rt++]=(Pt&15)<<12|(bt[Tt++]&63)<<6|bt[Tt++]&63,Rt>8191&&((St||(St=[])).push(String.fromCharCode.apply(String,At)),Rt=0);return St?(Rt&&St.push(String.fromCharCode.apply(String,At.slice(0,Rt))),St.join("")):String.fromCharCode.apply(String,At.slice(0,Rt))},yt.write=function(bt,Tt,Et){for(var wt=Et,St,At,Rt=0;Rt<bt.length;++Rt)St=bt.charCodeAt(Rt),St<128?Tt[Et++]=St:St<2048?(Tt[Et++]=St>>6|192,Tt[Et++]=St&63|128):(St&64512)===55296&&((At=bt.charCodeAt(Rt+1))&64512)===56320?(St=65536+((St&1023)<<10)+(At&1023),++Rt,Tt[Et++]=St>>18|240,Tt[Et++]=St>>12&63|128,Tt[Et++]=St>>6&63|128,Tt[Et++]=St&63|128):(Tt[Et++]=St>>12|224,Tt[Et++]=St>>6&63|128,Tt[Et++]=St&63|128);return Et-wt}})(utf8$2);var pool_1=pool;function pool(xt,yt,vt){var bt=vt||8192,Tt=bt>>>1,Et=null,wt=bt;return function(At){if(At<1||At>Tt)return xt(At);wt+At>bt&&(Et=xt(bt),wt=0);var Rt=yt.call(Et,wt,wt+=At);return wt&7&&(wt=(wt|7)+1),Rt}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=yt;var xt=requireMinimal();function yt(Et,wt){this.lo=Et>>>0,this.hi=wt>>>0}var vt=yt.zero=new yt(0,0);vt.toNumber=function(){return 0},vt.zzEncode=vt.zzDecode=function(){return this},vt.length=function(){return 1};var bt=yt.zeroHash="\0\0\0\0\0\0\0\0";yt.fromNumber=function(wt){if(wt===0)return vt;var St=wt<0;St&&(wt=-wt);var At=wt>>>0,Rt=(wt-At)/4294967296>>>0;return St&&(Rt=~Rt>>>0,At=~At>>>0,++At>4294967295&&(At=0,++Rt>4294967295&&(Rt=0))),new yt(At,Rt)},yt.from=function(wt){if(typeof wt=="number")return yt.fromNumber(wt);if(xt.isString(wt))if(xt.Long)wt=xt.Long.fromString(wt);else return yt.fromNumber(parseInt(wt,10));return wt.low||wt.high?new yt(wt.low>>>0,wt.high>>>0):vt},yt.prototype.toNumber=function(wt){if(!wt&&this.hi>>>31){var St=~this.lo+1>>>0,At=~this.hi>>>0;return St||(At=At+1>>>0),-(St+At*4294967296)}return this.lo+this.hi*4294967296},yt.prototype.toLong=function(wt){return xt.Long?new xt.Long(this.lo|0,this.hi|0,!!wt):{low:this.lo|0,high:this.hi|0,unsigned:!!wt}};var Tt=String.prototype.charCodeAt;return yt.fromHash=function(wt){return wt===bt?vt:new yt((Tt.call(wt,0)|Tt.call(wt,1)<<8|Tt.call(wt,2)<<16|Tt.call(wt,3)<<24)>>>0,(Tt.call(wt,4)|Tt.call(wt,5)<<8|Tt.call(wt,6)<<16|Tt.call(wt,7)<<24)>>>0)},yt.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},yt.prototype.zzEncode=function(){var wt=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^wt)>>>0,this.lo=(this.lo<<1^wt)>>>0,this},yt.prototype.zzDecode=function(){var wt=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^wt)>>>0,this.hi=(this.hi>>>1^wt)>>>0,this},yt.prototype.length=function(){var wt=this.lo,St=(this.lo>>>28|this.hi<<4)>>>0,At=this.hi>>>24;return At===0?St===0?wt<16384?wt<128?1:2:wt<2097152?3:4:St<16384?St<128?5:6:St<2097152?7:8:At<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(xt){var yt=xt;yt.asPromise=aspromise,yt.base64=base64$1,yt.EventEmitter=eventemitter,yt.float=float,yt.inquire=inquire_1,yt.utf8=utf8$2,yt.pool=pool_1,yt.LongBits=requireLongbits(),yt.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),yt.global=yt.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,yt.emptyArray=Object.freeze?Object.freeze([]):[],yt.emptyObject=Object.freeze?Object.freeze({}):{},yt.isInteger=Number.isInteger||function(Et){return typeof Et=="number"&&isFinite(Et)&&Math.floor(Et)===Et},yt.isString=function(Et){return typeof Et=="string"||Et instanceof String},yt.isObject=function(Et){return Et&&typeof Et=="object"},yt.isset=yt.isSet=function(Et,wt){var St=Et[wt];return St!=null&&Et.hasOwnProperty(wt)?typeof St!="object"||(Array.isArray(St)?St.length:Object.keys(St).length)>0:!1},yt.Buffer=function(){try{var Tt=yt.inquire("buffer").Buffer;return Tt.prototype.utf8Write?Tt:null}catch{return null}}(),yt._Buffer_from=null,yt._Buffer_allocUnsafe=null,yt.newBuffer=function(Et){return typeof Et=="number"?yt.Buffer?yt._Buffer_allocUnsafe(Et):new yt.Array(Et):yt.Buffer?yt._Buffer_from(Et):typeof Uint8Array>"u"?Et:new Uint8Array(Et)},yt.Array=typeof Uint8Array<"u"?Uint8Array:Array,yt.Long=yt.global.dcodeIO&&yt.global.dcodeIO.Long||yt.global.Long||yt.inquire("long"),yt.key2Re=/^true|false|0|1$/,yt.key32Re=/^-?(?:0|[1-9][0-9]*)$/,yt.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,yt.longToHash=function(Et){return Et?yt.LongBits.from(Et).toHash():yt.LongBits.zeroHash},yt.longFromHash=function(Et,wt){var St=yt.LongBits.fromHash(Et);return yt.Long?yt.Long.fromBits(St.lo,St.hi,wt):St.toNumber(!!wt)};function vt(Tt,Et,wt){for(var St=Object.keys(Et),At=0;At<St.length;++At)(Tt[St[At]]===void 0||!wt)&&(Tt[St[At]]=Et[St[At]]);return Tt}yt.merge=vt,yt.lcFirst=function(Et){return Et.charAt(0).toLowerCase()+Et.substring(1)};function bt(Tt){function Et(wt,St){if(!(this instanceof Et))return new Et(wt,St);Object.defineProperty(this,"message",{get:function(){return wt}}),Error.captureStackTrace?Error.captureStackTrace(this,Et):Object.defineProperty(this,"stack",{value:new Error().stack||""}),St&&vt(this,St)}return Et.prototype=Object.create(Error.prototype,{constructor:{value:Et,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return Tt},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),Et}yt.newError=bt,yt.ProtocolError=bt("ProtocolError"),yt.oneOfGetter=function(Et){for(var wt={},St=0;St<Et.length;++St)wt[Et[St]]=1;return function(){for(var At=Object.keys(this),Rt=At.length-1;Rt>-1;--Rt)if(wt[At[Rt]]===1&&this[At[Rt]]!==void 0&&this[At[Rt]]!==null)return At[Rt]}},yt.oneOfSetter=function(Et){return function(wt){for(var St=0;St<Et.length;++St)Et[St]!==wt&&delete this[Et[St]]}},yt.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},yt._configure=function(){var Tt=yt.Buffer;if(!Tt){yt._Buffer_from=yt._Buffer_allocUnsafe=null;return}yt._Buffer_from=Tt.from!==Uint8Array.from&&Tt.from||function(wt,St){return new Tt(wt,St)},yt._Buffer_allocUnsafe=Tt.allocUnsafe||function(wt){return new Tt(wt)}}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(xt,yt,vt){this.fn=xt,this.len=yt,this.next=void 0,this.val=vt}function noop$4(){}function State(xt){this.head=xt.head,this.tail=xt.tail,this.len=xt.len,this.next=xt.states}function Writer$1(){this.len=0,this.head=new Op(noop$4,0,0),this.tail=this.head,this.states=null}var create$4=function xt(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$4();Writer$1.alloc=function xt(yt){return new util$4.Array(yt)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function xt(yt,vt,bt){return this.tail=this.tail.next=new Op(yt,vt,bt),this.len+=vt,this};function writeByte(xt,yt,vt){yt[vt]=xt&255}function writeVarint32(xt,yt,vt){for(;xt>127;)yt[vt++]=xt&127|128,xt>>>=7;yt[vt]=xt}function VarintOp(xt,yt){this.len=xt,this.next=void 0,this.val=yt}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function xt(yt){return this.len+=(this.tail=this.tail.next=new VarintOp((yt=yt>>>0)<128?1:yt<16384?2:yt<2097152?3:yt<268435456?4:5,yt)).len,this};Writer$1.prototype.int32=function xt(yt){return yt<0?this._push(writeVarint64,10,LongBits$1.fromNumber(yt)):this.uint32(yt)};Writer$1.prototype.sint32=function xt(yt){return this.uint32((yt<<1^yt>>31)>>>0)};function writeVarint64(xt,yt,vt){for(;xt.hi;)yt[vt++]=xt.lo&127|128,xt.lo=(xt.lo>>>7|xt.hi<<25)>>>0,xt.hi>>>=7;for(;xt.lo>127;)yt[vt++]=xt.lo&127|128,xt.lo=xt.lo>>>7;yt[vt++]=xt.lo}Writer$1.prototype.uint64=function xt(yt){var vt=LongBits$1.from(yt);return this._push(writeVarint64,vt.length(),vt)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function xt(yt){var vt=LongBits$1.from(yt).zzEncode();return this._push(writeVarint64,vt.length(),vt)};Writer$1.prototype.bool=function xt(yt){return this._push(writeByte,1,yt?1:0)};function writeFixed32(xt,yt,vt){yt[vt]=xt&255,yt[vt+1]=xt>>>8&255,yt[vt+2]=xt>>>16&255,yt[vt+3]=xt>>>24}Writer$1.prototype.fixed32=function xt(yt){return this._push(writeFixed32,4,yt>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function xt(yt){var vt=LongBits$1.from(yt);return this._push(writeFixed32,4,vt.lo)._push(writeFixed32,4,vt.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function xt(yt){return this._push(util$4.float.writeFloatLE,4,yt)};Writer$1.prototype.double=function xt(yt){return this._push(util$4.float.writeDoubleLE,8,yt)};var writeBytes=util$4.Array.prototype.set?function xt(yt,vt,bt){vt.set(yt,bt)}:function xt(yt,vt,bt){for(var Tt=0;Tt<yt.length;++Tt)vt[bt+Tt]=yt[Tt]};Writer$1.prototype.bytes=function xt(yt){var vt=yt.length>>>0;if(!vt)return this._push(writeByte,1,0);if(util$4.isString(yt)){var bt=Writer$1.alloc(vt=base64.length(yt));base64.decode(yt,bt,0),yt=bt}return this.uint32(vt)._push(writeBytes,vt,yt)};Writer$1.prototype.string=function xt(yt){var vt=utf8$1.length(yt);return vt?this.uint32(vt)._push(utf8$1.write,vt,yt):this._push(writeByte,1,0)};Writer$1.prototype.fork=function xt(){return this.states=new State(this),this.head=this.tail=new Op(noop$4,0,0),this.len=0,this};Writer$1.prototype.reset=function xt(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop$4,0,0),this.len=0),this};Writer$1.prototype.ldelim=function xt(){var yt=this.head,vt=this.tail,bt=this.len;return this.reset().uint32(bt),bt&&(this.tail.next=yt.next,this.tail=vt,this.len+=bt),this};Writer$1.prototype.finish=function xt(){for(var yt=this.head.next,vt=this.constructor.alloc(this.len),bt=0;yt;)yt.fn(yt.val,vt,bt),bt+=yt.len,yt=yt.next;return vt};Writer$1._configure=function(xt){BufferWriter$1=xt,Writer$1.create=create$4(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(yt,vt,bt){vt.set(yt,bt)}:function(yt,vt,bt){if(yt.copy)yt.copy(vt,bt,0,yt.length);else for(var Tt=0;Tt<yt.length;)vt[bt++]=yt[Tt++]}};BufferWriter.prototype.bytes=function xt(yt){util$3.isString(yt)&&(yt=util$3._Buffer_from(yt,"base64"));var vt=yt.length>>>0;return this.uint32(vt),vt&&this._push(BufferWriter.writeBytesBuffer,vt,yt),this};function writeStringBuffer(xt,yt,vt){xt.length<40?util$3.utf8.write(xt,yt,vt):yt.utf8Write?yt.utf8Write(xt,vt):yt.write(xt,vt)}BufferWriter.prototype.string=function xt(yt){var vt=util$3.Buffer.byteLength(yt);return this.uint32(vt),vt&&this._push(writeStringBuffer,vt,yt),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(xt,yt){return RangeError("index out of range: "+xt.pos+" + "+(yt||1)+" > "+xt.len)}function Reader$1(xt){this.buf=xt,this.pos=0,this.len=xt.length}var create_array=typeof Uint8Array<"u"?function xt(yt){if(yt instanceof Uint8Array||Array.isArray(yt))return new Reader$1(yt);throw Error("illegal buffer")}:function xt(yt){if(Array.isArray(yt))return new Reader$1(yt);throw Error("illegal buffer")},create$3=function xt(){return util$2.Buffer?function(vt){return(Reader$1.create=function(Tt){return util$2.Buffer.isBuffer(Tt)?new BufferReader$1(Tt):create_array(Tt)})(vt)}:create_array};Reader$1.create=create$3();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function xt(){var yt=4294967295;return function(){if(yt=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(yt=(yt|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(yt=(yt|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(yt=(yt|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(yt=(yt|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return yt;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return yt}}();Reader$1.prototype.int32=function xt(){return this.uint32()|0};Reader$1.prototype.sint32=function xt(){var yt=this.uint32();return yt>>>1^-(yt&1)|0};function readLongVarint(){var xt=new LongBits(0,0),yt=0;if(this.len-this.pos>4){for(;yt<4;++yt)if(xt.lo=(xt.lo|(this.buf[this.pos]&127)<<yt*7)>>>0,this.buf[this.pos++]<128)return xt;if(xt.lo=(xt.lo|(this.buf[this.pos]&127)<<28)>>>0,xt.hi=(xt.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return xt;yt=0}else{for(;yt<3;++yt){if(this.pos>=this.len)throw indexOutOfRange(this);if(xt.lo=(xt.lo|(this.buf[this.pos]&127)<<yt*7)>>>0,this.buf[this.pos++]<128)return xt}return xt.lo=(xt.lo|(this.buf[this.pos++]&127)<<yt*7)>>>0,xt}if(this.len-this.pos>4){for(;yt<5;++yt)if(xt.hi=(xt.hi|(this.buf[this.pos]&127)<<yt*7+3)>>>0,this.buf[this.pos++]<128)return xt}else for(;yt<5;++yt){if(this.pos>=this.len)throw indexOutOfRange(this);if(xt.hi=(xt.hi|(this.buf[this.pos]&127)<<yt*7+3)>>>0,this.buf[this.pos++]<128)return xt}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function xt(){return this.uint32()!==0};function readFixed32_end(xt,yt){return(xt[yt-4]|xt[yt-3]<<8|xt[yt-2]<<16|xt[yt-1]<<24)>>>0}Reader$1.prototype.fixed32=function xt(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function xt(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function xt(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var yt=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,yt};Reader$1.prototype.double=function xt(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var yt=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,yt};Reader$1.prototype.bytes=function xt(){var yt=this.uint32(),vt=this.pos,bt=this.pos+yt;if(bt>this.len)throw indexOutOfRange(this,yt);if(this.pos+=yt,Array.isArray(this.buf))return this.buf.slice(vt,bt);if(vt===bt){var Tt=util$2.Buffer;return Tt?Tt.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,vt,bt)};Reader$1.prototype.string=function xt(){var yt=this.bytes();return utf8.read(yt,0,yt.length)};Reader$1.prototype.skip=function xt(yt){if(typeof yt=="number"){if(this.pos+yt>this.len)throw indexOutOfRange(this,yt);this.pos+=yt}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(xt){switch(xt){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(xt=this.uint32()&7)!==4;)this.skipType(xt);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+xt+" at offset "+this.pos)}return this};Reader$1._configure=function(xt){BufferReader$1=xt,Reader$1.create=create$3(),BufferReader$1._configure();var yt=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[yt](!1)},uint64:function(){return readLongVarint.call(this)[yt](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[yt](!1)},fixed64:function(){return readFixed64.call(this)[yt](!0)},sfixed64:function(){return readFixed64.call(this)[yt](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(xt){Reader.call(this,xt)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function xt(){var yt=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+yt,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+yt,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(xt,yt,vt){if(typeof xt!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=xt,this.requestDelimited=!!yt,this.responseDelimited=!!vt}Service.prototype.rpcCall=function xt(yt,vt,bt,Tt,Et){if(!Tt)throw TypeError("request must be specified");var wt=this;if(!Et)return util.asPromise(xt,wt,yt,vt,bt,Tt);if(!wt.rpcImpl){setTimeout(function(){Et(Error("already ended"))},0);return}try{return wt.rpcImpl(yt,vt[wt.requestDelimited?"encodeDelimited":"encode"](Tt).finish(),function(At,Rt){if(At)return wt.emit("error",At,yt),Et(At);if(Rt===null){wt.end(!0);return}if(!(Rt instanceof bt))try{Rt=bt[wt.responseDelimited?"decodeDelimited":"decode"](Rt)}catch(Pt){return wt.emit("error",Pt,yt),Et(Pt)}return wt.emit("data",Rt,yt),Et(null,Rt)})}catch(St){wt.emit("error",St,yt),setTimeout(function(){Et(St)},0);return}};Service.prototype.end=function xt(yt){return this.rpcImpl&&(yt||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(xt){var yt=xt;yt.Service=service})(rpc);var roots={};(function(xt){var yt=xt;yt.build="minimal",yt.Writer=writer,yt.BufferWriter=writer_buffer,yt.Reader=reader,yt.BufferReader=reader_buffer,yt.util=requireMinimal(),yt.rpc=rpc,yt.roots=roots,yt.configure=vt;function vt(){yt.util._configure(),yt.Writer._configure(yt.BufferWriter),yt.Reader._configure(yt.BufferReader)}vt()})(indexMinimal);var minimal=indexMinimal;const $Reader=minimal.Reader,$Writer=minimal.Writer,$util=minimal.util,$root=minimal.roots.default||(minimal.roots.default={}),urbansynth=$root.urbansynth=(()=>{const xt={};return xt.City=function(){function yt(vt){if(this.zones=[],this.roads=[],this.pois=[],this.buildings=[],vt)for(let bt=Object.keys(vt),Tt=0;Tt<bt.length;++Tt)vt[bt[Tt]]!=null&&(this[bt[Tt]]=vt[bt[Tt]])}return yt.prototype.name="",yt.prototype.bounds=null,yt.prototype.zones=$util.emptyArray,yt.prototype.roads=$util.emptyArray,yt.prototype.pois=$util.emptyArray,yt.prototype.buildings=$util.emptyArray,yt.prototype.metadata=null,yt.create=function(bt){return new yt(bt)},yt.encode=function(bt,Tt){if(Tt||(Tt=$Writer.create()),bt.name!=null&&Object.hasOwnProperty.call(bt,"name")&&Tt.uint32(10).string(bt.name),bt.bounds!=null&&Object.hasOwnProperty.call(bt,"bounds")&&$root.urbansynth.BoundingBox.encode(bt.bounds,Tt.uint32(18).fork()).ldelim(),bt.zones!=null&&bt.zones.length)for(let Et=0;Et<bt.zones.length;++Et)$root.urbansynth.Zone.encode(bt.zones[Et],Tt.uint32(26).fork()).ldelim();if(bt.roads!=null&&bt.roads.length)for(let Et=0;Et<bt.roads.length;++Et)$root.urbansynth.Road.encode(bt.roads[Et],Tt.uint32(34).fork()).ldelim();if(bt.pois!=null&&bt.pois.length)for(let Et=0;Et<bt.pois.length;++Et)$root.urbansynth.POI.encode(bt.pois[Et],Tt.uint32(42).fork()).ldelim();if(bt.buildings!=null&&bt.buildings.length)for(let Et=0;Et<bt.buildings.length;++Et)$root.urbansynth.Building.encode(bt.buildings[Et],Tt.uint32(50).fork()).ldelim();return bt.metadata!=null&&Object.hasOwnProperty.call(bt,"metadata")&&$root.urbansynth.CityMetadata.encode(bt.metadata,Tt.uint32(58).fork()).ldelim(),Tt},yt.encodeDelimited=function(bt,Tt){return this.encode(bt,Tt).ldelim()},yt.decode=function(bt,Tt,Et){bt instanceof $Reader||(bt=$Reader.create(bt));let wt=Tt===void 0?bt.len:bt.pos+Tt,St=new $root.urbansynth.City;for(;bt.pos<wt;){let At=bt.uint32();if(At===Et)break;switch(At>>>3){case 1:{St.name=bt.string();break}case 2:{St.bounds=$root.urbansynth.BoundingBox.decode(bt,bt.uint32());break}case 3:{St.zones&&St.zones.length||(St.zones=[]),St.zones.push($root.urbansynth.Zone.decode(bt,bt.uint32()));break}case 4:{St.roads&&St.roads.length||(St.roads=[]),St.roads.push($root.urbansynth.Road.decode(bt,bt.uint32()));break}case 5:{St.pois&&St.pois.length||(St.pois=[]),St.pois.push($root.urbansynth.POI.decode(bt,bt.uint32()));break}case 6:{St.buildings&&St.buildings.length||(St.buildings=[]),St.buildings.push($root.urbansynth.Building.decode(bt,bt.uint32()));break}case 7:{St.metadata=$root.urbansynth.CityMetadata.decode(bt,bt.uint32());break}default:bt.skipType(At&7);break}}return St},yt.decodeDelimited=function(bt){return bt instanceof $Reader||(bt=new $Reader(bt)),this.decode(bt,bt.uint32())},yt.verify=function(bt){if(typeof bt!="object"||bt===null)return"object expected";if(bt.name!=null&&bt.hasOwnProperty("name")&&!$util.isString(bt.name))return"name: string expected";if(bt.bounds!=null&&bt.hasOwnProperty("bounds")){let Tt=$root.urbansynth.BoundingBox.verify(bt.bounds);if(Tt)return"bounds."+Tt}if(bt.zones!=null&&bt.hasOwnProperty("zones")){if(!Array.isArray(bt.zones))return"zones: array expected";for(let Tt=0;Tt<bt.zones.length;++Tt){let Et=$root.urbansynth.Zone.verify(bt.zones[Tt]);if(Et)return"zones."+Et}}if(bt.roads!=null&&bt.hasOwnProperty("roads")){if(!Array.isArray(bt.roads))return"roads: array expected";for(let Tt=0;Tt<bt.roads.length;++Tt){let Et=$root.urbansynth.Road.verify(bt.roads[Tt]);if(Et)return"roads."+Et}}if(bt.pois!=null&&bt.hasOwnProperty("pois")){if(!Array.isArray(bt.pois))return"pois: array expected";for(let Tt=0;Tt<bt.pois.length;++Tt){let Et=$root.urbansynth.POI.verify(bt.pois[Tt]);if(Et)return"pois."+Et}}if(bt.buildings!=null&&bt.hasOwnProperty("buildings")){if(!Array.isArray(bt.buildings))return"buildings: array expected";for(let Tt=0;Tt<bt.buildings.length;++Tt){let Et=$root.urbansynth.Building.verify(bt.buildings[Tt]);if(Et)return"buildings."+Et}}if(bt.metadata!=null&&bt.hasOwnProperty("metadata")){let Tt=$root.urbansynth.CityMetadata.verify(bt.metadata);if(Tt)return"metadata."+Tt}return null},yt.fromObject=function(bt){if(bt instanceof $root.urbansynth.City)return bt;let Tt=new $root.urbansynth.City;if(bt.name!=null&&(Tt.name=String(bt.name)),bt.bounds!=null){if(typeof bt.bounds!="object")throw TypeError(".urbansynth.City.bounds: object expected");Tt.bounds=$root.urbansynth.BoundingBox.fromObject(bt.bounds)}if(bt.zones){if(!Array.isArray(bt.zones))throw TypeError(".urbansynth.City.zones: array expected");Tt.zones=[];for(let Et=0;Et<bt.zones.length;++Et){if(typeof bt.zones[Et]!="object")throw TypeError(".urbansynth.City.zones: object expected");Tt.zones[Et]=$root.urbansynth.Zone.fromObject(bt.zones[Et])}}if(bt.roads){if(!Array.isArray(bt.roads))throw TypeError(".urbansynth.City.roads: array expected");Tt.roads=[];for(let Et=0;Et<bt.roads.length;++Et){if(typeof bt.roads[Et]!="object")throw TypeError(".urbansynth.City.roads: object expected");Tt.roads[Et]=$root.urbansynth.Road.fromObject(bt.roads[Et])}}if(bt.pois){if(!Array.isArray(bt.pois))throw TypeError(".urbansynth.City.pois: array expected");Tt.pois=[];for(let Et=0;Et<bt.pois.length;++Et){if(typeof bt.pois[Et]!="object")throw TypeError(".urbansynth.City.pois: object expected");Tt.pois[Et]=$root.urbansynth.POI.fromObject(bt.pois[Et])}}if(bt.buildings){if(!Array.isArray(bt.buildings))throw TypeError(".urbansynth.City.buildings: array expected");Tt.buildings=[];for(let Et=0;Et<bt.buildings.length;++Et){if(typeof bt.buildings[Et]!="object")throw TypeError(".urbansynth.City.buildings: object expected");Tt.buildings[Et]=$root.urbansynth.Building.fromObject(bt.buildings[Et])}}if(bt.metadata!=null){if(typeof bt.metadata!="object")throw TypeError(".urbansynth.City.metadata: object expected");Tt.metadata=$root.urbansynth.CityMetadata.fromObject(bt.metadata)}return Tt},yt.toObject=function(bt,Tt){Tt||(Tt={});let Et={};if((Tt.arrays||Tt.defaults)&&(Et.zones=[],Et.roads=[],Et.pois=[],Et.buildings=[]),Tt.defaults&&(Et.name="",Et.bounds=null,Et.metadata=null),bt.name!=null&&bt.hasOwnProperty("name")&&(Et.name=bt.name),bt.bounds!=null&&bt.hasOwnProperty("bounds")&&(Et.bounds=$root.urbansynth.BoundingBox.toObject(bt.bounds,Tt)),bt.zones&&bt.zones.length){Et.zones=[];for(let wt=0;wt<bt.zones.length;++wt)Et.zones[wt]=$root.urbansynth.Zone.toObject(bt.zones[wt],Tt)}if(bt.roads&&bt.roads.length){Et.roads=[];for(let wt=0;wt<bt.roads.length;++wt)Et.roads[wt]=$root.urbansynth.Road.toObject(bt.roads[wt],Tt)}if(bt.pois&&bt.pois.length){Et.pois=[];for(let wt=0;wt<bt.pois.length;++wt)Et.pois[wt]=$root.urbansynth.POI.toObject(bt.pois[wt],Tt)}if(bt.buildings&&bt.buildings.length){Et.buildings=[];for(let wt=0;wt<bt.buildings.length;++wt)Et.buildings[wt]=$root.urbansynth.Building.toObject(bt.buildings[wt],Tt)}return bt.metadata!=null&&bt.hasOwnProperty("metadata")&&(Et.metadata=$root.urbansynth.CityMetadata.toObject(bt.metadata,Tt)),Et},yt.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},yt.getTypeUrl=function(bt){return bt===void 0&&(bt="type.googleapis.com"),bt+"/urbansynth.City"},yt}(),xt.BoundingBox=function(){function yt(vt){if(vt)for(let bt=Object.keys(vt),Tt=0;Tt<bt.length;++Tt)vt[bt[Tt]]!=null&&(this[bt[Tt]]=vt[bt[Tt]])}return yt.prototype.minX=0,yt.prototype.minY=0,yt.prototype.maxX=0,yt.prototype.maxY=0,yt.create=function(bt){return new yt(bt)},yt.encode=function(bt,Tt){return Tt||(Tt=$Writer.create()),bt.minX!=null&&Object.hasOwnProperty.call(bt,"minX")&&Tt.uint32(13).float(bt.minX),bt.minY!=null&&Object.hasOwnProperty.call(bt,"minY")&&Tt.uint32(21).float(bt.minY),bt.maxX!=null&&Object.hasOwnProperty.call(bt,"maxX")&&Tt.uint32(29).float(bt.maxX),bt.maxY!=null&&Object.hasOwnProperty.call(bt,"maxY")&&Tt.uint32(37).float(bt.maxY),Tt},yt.encodeDelimited=function(bt,Tt){return this.encode(bt,Tt).ldelim()},yt.decode=function(bt,Tt,Et){bt instanceof $Reader||(bt=$Reader.create(bt));let wt=Tt===void 0?bt.len:bt.pos+Tt,St=new $root.urbansynth.BoundingBox;for(;bt.pos<wt;){let At=bt.uint32();if(At===Et)break;switch(At>>>3){case 1:{St.minX=bt.float();break}case 2:{St.minY=bt.float();break}case 3:{St.maxX=bt.float();break}case 4:{St.maxY=bt.float();break}default:bt.skipType(At&7);break}}return St},yt.decodeDelimited=function(bt){return bt instanceof $Reader||(bt=new $Reader(bt)),this.decode(bt,bt.uint32())},yt.verify=function(bt){return typeof bt!="object"||bt===null?"object expected":bt.minX!=null&&bt.hasOwnProperty("minX")&&typeof bt.minX!="number"?"minX: number expected":bt.minY!=null&&bt.hasOwnProperty("minY")&&typeof bt.minY!="number"?"minY: number expected":bt.maxX!=null&&bt.hasOwnProperty("maxX")&&typeof bt.maxX!="number"?"maxX: number expected":bt.maxY!=null&&bt.hasOwnProperty("maxY")&&typeof bt.maxY!="number"?"maxY: number expected":null},yt.fromObject=function(bt){if(bt instanceof $root.urbansynth.BoundingBox)return bt;let Tt=new $root.urbansynth.BoundingBox;return bt.minX!=null&&(Tt.minX=Number(bt.minX)),bt.minY!=null&&(Tt.minY=Number(bt.minY)),bt.maxX!=null&&(Tt.maxX=Number(bt.maxX)),bt.maxY!=null&&(Tt.maxY=Number(bt.maxY)),Tt},yt.toObject=function(bt,Tt){Tt||(Tt={});let Et={};return Tt.defaults&&(Et.minX=0,Et.minY=0,Et.maxX=0,Et.maxY=0),bt.minX!=null&&bt.hasOwnProperty("minX")&&(Et.minX=Tt.json&&!isFinite(bt.minX)?String(bt.minX):bt.minX),bt.minY!=null&&bt.hasOwnProperty("minY")&&(Et.minY=Tt.json&&!isFinite(bt.minY)?String(bt.minY):bt.minY),bt.maxX!=null&&bt.hasOwnProperty("maxX")&&(Et.maxX=Tt.json&&!isFinite(bt.maxX)?String(bt.maxX):bt.maxX),bt.maxY!=null&&bt.hasOwnProperty("maxY")&&(Et.maxY=Tt.json&&!isFinite(bt.maxY)?String(bt.maxY):bt.maxY),Et},yt.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},yt.getTypeUrl=function(bt){return bt===void 0&&(bt="type.googleapis.com"),bt+"/urbansynth.BoundingBox"},yt}(),xt.Zone=function(){function yt(vt){if(this.boundary=[],vt)for(let bt=Object.keys(vt),Tt=0;Tt<bt.length;++Tt)vt[bt[Tt]]!=null&&(this[bt[Tt]]=vt[bt[Tt]])}return yt.prototype.id="",yt.prototype.type=0,yt.prototype.boundary=$util.emptyArray,yt.prototype.density=0,yt.prototype.properties=null,yt.create=function(bt){return new yt(bt)},yt.encode=function(bt,Tt){if(Tt||(Tt=$Writer.create()),bt.id!=null&&Object.hasOwnProperty.call(bt,"id")&&Tt.uint32(10).string(bt.id),bt.type!=null&&Object.hasOwnProperty.call(bt,"type")&&Tt.uint32(16).int32(bt.type),bt.boundary!=null&&bt.boundary.length)for(let Et=0;Et<bt.boundary.length;++Et)$root.urbansynth.Point2D.encode(bt.boundary[Et],Tt.uint32(26).fork()).ldelim();return bt.density!=null&&Object.hasOwnProperty.call(bt,"density")&&Tt.uint32(37).float(bt.density),bt.properties!=null&&Object.hasOwnProperty.call(bt,"properties")&&$root.urbansynth.ZoneProperties.encode(bt.properties,Tt.uint32(42).fork()).ldelim(),Tt},yt.encodeDelimited=function(bt,Tt){return this.encode(bt,Tt).ldelim()},yt.decode=function(bt,Tt,Et){bt instanceof $Reader||(bt=$Reader.create(bt));let wt=Tt===void 0?bt.len:bt.pos+Tt,St=new $root.urbansynth.Zone;for(;bt.pos<wt;){let At=bt.uint32();if(At===Et)break;switch(At>>>3){case 1:{St.id=bt.string();break}case 2:{St.type=bt.int32();break}case 3:{St.boundary&&St.boundary.length||(St.boundary=[]),St.boundary.push($root.urbansynth.Point2D.decode(bt,bt.uint32()));break}case 4:{St.density=bt.float();break}case 5:{St.properties=$root.urbansynth.ZoneProperties.decode(bt,bt.uint32());break}default:bt.skipType(At&7);break}}return St},yt.decodeDelimited=function(bt){return bt instanceof $Reader||(bt=new $Reader(bt)),this.decode(bt,bt.uint32())},yt.verify=function(bt){if(typeof bt!="object"||bt===null)return"object expected";if(bt.id!=null&&bt.hasOwnProperty("id")&&!$util.isString(bt.id))return"id: string expected";if(bt.type!=null&&bt.hasOwnProperty("type"))switch(bt.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:break}if(bt.boundary!=null&&bt.hasOwnProperty("boundary")){if(!Array.isArray(bt.boundary))return"boundary: array expected";for(let Tt=0;Tt<bt.boundary.length;++Tt){let Et=$root.urbansynth.Point2D.verify(bt.boundary[Tt]);if(Et)return"boundary."+Et}}if(bt.density!=null&&bt.hasOwnProperty("density")&&typeof bt.density!="number")return"density: number expected";if(bt.properties!=null&&bt.hasOwnProperty("properties")){let Tt=$root.urbansynth.ZoneProperties.verify(bt.properties);if(Tt)return"properties."+Tt}return null},yt.fromObject=function(bt){if(bt instanceof $root.urbansynth.Zone)return bt;let Tt=new $root.urbansynth.Zone;switch(bt.id!=null&&(Tt.id=String(bt.id)),bt.type){default:if(typeof bt.type=="number"){Tt.type=bt.type;break}break;case"RESIDENTIAL":case 0:Tt.type=0;break;case"COMMERCIAL":case 1:Tt.type=1;break;case"INDUSTRIAL":case 2:Tt.type=2;break;case"DOWNTOWN":case 3:Tt.type=3;break;case"PARK":case 4:Tt.type=4;break;case"WATER":case 5:Tt.type=5;break}if(bt.boundary){if(!Array.isArray(bt.boundary))throw TypeError(".urbansynth.Zone.boundary: array expected");Tt.boundary=[];for(let Et=0;Et<bt.boundary.length;++Et){if(typeof bt.boundary[Et]!="object")throw TypeError(".urbansynth.Zone.boundary: object expected");Tt.boundary[Et]=$root.urbansynth.Point2D.fromObject(bt.boundary[Et])}}if(bt.density!=null&&(Tt.density=Number(bt.density)),bt.properties!=null){if(typeof bt.properties!="object")throw TypeError(".urbansynth.Zone.properties: object expected");Tt.properties=$root.urbansynth.ZoneProperties.fromObject(bt.properties)}return Tt},yt.toObject=function(bt,Tt){Tt||(Tt={});let Et={};if((Tt.arrays||Tt.defaults)&&(Et.boundary=[]),Tt.defaults&&(Et.id="",Et.type=Tt.enums===String?"RESIDENTIAL":0,Et.density=0,Et.properties=null),bt.id!=null&&bt.hasOwnProperty("id")&&(Et.id=bt.id),bt.type!=null&&bt.hasOwnProperty("type")&&(Et.type=Tt.enums===String?$root.urbansynth.ZoneType[bt.type]===void 0?bt.type:$root.urbansynth.ZoneType[bt.type]:bt.type),bt.boundary&&bt.boundary.length){Et.boundary=[];for(let wt=0;wt<bt.boundary.length;++wt)Et.boundary[wt]=$root.urbansynth.Point2D.toObject(bt.boundary[wt],Tt)}return bt.density!=null&&bt.hasOwnProperty("density")&&(Et.density=Tt.json&&!isFinite(bt.density)?String(bt.density):bt.density),bt.properties!=null&&bt.hasOwnProperty("properties")&&(Et.properties=$root.urbansynth.ZoneProperties.toObject(bt.properties,Tt)),Et},yt.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},yt.getTypeUrl=function(bt){return bt===void 0&&(bt="type.googleapis.com"),bt+"/urbansynth.Zone"},yt}(),xt.Road=function(){function yt(vt){if(this.path=[],vt)for(let bt=Object.keys(vt),Tt=0;Tt<bt.length;++Tt)vt[bt[Tt]]!=null&&(this[bt[Tt]]=vt[bt[Tt]])}return yt.prototype.id="",yt.prototype.type=0,yt.prototype.path=$util.emptyArray,yt.prototype.width=0,yt.prototype.lanes=0,yt.prototype.speedLimit=0,yt.create=function(bt){return new yt(bt)},yt.encode=function(bt,Tt){if(Tt||(Tt=$Writer.create()),bt.id!=null&&Object.hasOwnProperty.call(bt,"id")&&Tt.uint32(10).string(bt.id),bt.type!=null&&Object.hasOwnProperty.call(bt,"type")&&Tt.uint32(16).int32(bt.type),bt.path!=null&&bt.path.length)for(let Et=0;Et<bt.path.length;++Et)$root.urbansynth.Point2D.encode(bt.path[Et],Tt.uint32(26).fork()).ldelim();return bt.width!=null&&Object.hasOwnProperty.call(bt,"width")&&Tt.uint32(37).float(bt.width),bt.lanes!=null&&Object.hasOwnProperty.call(bt,"lanes")&&Tt.uint32(40).int32(bt.lanes),bt.speedLimit!=null&&Object.hasOwnProperty.call(bt,"speedLimit")&&Tt.uint32(53).float(bt.speedLimit),Tt},yt.encodeDelimited=function(bt,Tt){return this.encode(bt,Tt).ldelim()},yt.decode=function(bt,Tt,Et){bt instanceof $Reader||(bt=$Reader.create(bt));let wt=Tt===void 0?bt.len:bt.pos+Tt,St=new $root.urbansynth.Road;for(;bt.pos<wt;){let At=bt.uint32();if(At===Et)break;switch(At>>>3){case 1:{St.id=bt.string();break}case 2:{St.type=bt.int32();break}case 3:{St.path&&St.path.length||(St.path=[]),St.path.push($root.urbansynth.Point2D.decode(bt,bt.uint32()));break}case 4:{St.width=bt.float();break}case 5:{St.lanes=bt.int32();break}case 6:{St.speedLimit=bt.float();break}default:bt.skipType(At&7);break}}return St},yt.decodeDelimited=function(bt){return bt instanceof $Reader||(bt=new $Reader(bt)),this.decode(bt,bt.uint32())},yt.verify=function(bt){if(typeof bt!="object"||bt===null)return"object expected";if(bt.id!=null&&bt.hasOwnProperty("id")&&!$util.isString(bt.id))return"id: string expected";if(bt.type!=null&&bt.hasOwnProperty("type"))switch(bt.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:break}if(bt.path!=null&&bt.hasOwnProperty("path")){if(!Array.isArray(bt.path))return"path: array expected";for(let Tt=0;Tt<bt.path.length;++Tt){let Et=$root.urbansynth.Point2D.verify(bt.path[Tt]);if(Et)return"path."+Et}}return bt.width!=null&&bt.hasOwnProperty("width")&&typeof bt.width!="number"?"width: number expected":bt.lanes!=null&&bt.hasOwnProperty("lanes")&&!$util.isInteger(bt.lanes)?"lanes: integer expected":bt.speedLimit!=null&&bt.hasOwnProperty("speedLimit")&&typeof bt.speedLimit!="number"?"speedLimit: number expected":null},yt.fromObject=function(bt){if(bt instanceof $root.urbansynth.Road)return bt;let Tt=new $root.urbansynth.Road;switch(bt.id!=null&&(Tt.id=String(bt.id)),bt.type){default:if(typeof bt.type=="number"){Tt.type=bt.type;break}break;case"HIGHWAY":case 0:Tt.type=0;break;case"ARTERIAL":case 1:Tt.type=1;break;case"COLLECTOR":case 2:Tt.type=2;break;case"LOCAL":case 3:Tt.type=3;break}if(bt.path){if(!Array.isArray(bt.path))throw TypeError(".urbansynth.Road.path: array expected");Tt.path=[];for(let Et=0;Et<bt.path.length;++Et){if(typeof bt.path[Et]!="object")throw TypeError(".urbansynth.Road.path: object expected");Tt.path[Et]=$root.urbansynth.Point2D.fromObject(bt.path[Et])}}return bt.width!=null&&(Tt.width=Number(bt.width)),bt.lanes!=null&&(Tt.lanes=bt.lanes|0),bt.speedLimit!=null&&(Tt.speedLimit=Number(bt.speedLimit)),Tt},yt.toObject=function(bt,Tt){Tt||(Tt={});let Et={};if((Tt.arrays||Tt.defaults)&&(Et.path=[]),Tt.defaults&&(Et.id="",Et.type=Tt.enums===String?"HIGHWAY":0,Et.width=0,Et.lanes=0,Et.speedLimit=0),bt.id!=null&&bt.hasOwnProperty("id")&&(Et.id=bt.id),bt.type!=null&&bt.hasOwnProperty("type")&&(Et.type=Tt.enums===String?$root.urbansynth.RoadType[bt.type]===void 0?bt.type:$root.urbansynth.RoadType[bt.type]:bt.type),bt.path&&bt.path.length){Et.path=[];for(let wt=0;wt<bt.path.length;++wt)Et.path[wt]=$root.urbansynth.Point2D.toObject(bt.path[wt],Tt)}return bt.width!=null&&bt.hasOwnProperty("width")&&(Et.width=Tt.json&&!isFinite(bt.width)?String(bt.width):bt.width),bt.lanes!=null&&bt.hasOwnProperty("lanes")&&(Et.lanes=bt.lanes),bt.speedLimit!=null&&bt.hasOwnProperty("speedLimit")&&(Et.speedLimit=Tt.json&&!isFinite(bt.speedLimit)?String(bt.speedLimit):bt.speedLimit),Et},yt.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},yt.getTypeUrl=function(bt){return bt===void 0&&(bt="type.googleapis.com"),bt+"/urbansynth.Road"},yt}(),xt.POI=function(){function yt(vt){if(vt)for(let bt=Object.keys(vt),Tt=0;Tt<bt.length;++Tt)vt[bt[Tt]]!=null&&(this[bt[Tt]]=vt[bt[Tt]])}return yt.prototype.id="",yt.prototype.type=0,yt.prototype.position=null,yt.prototype.zoneId="",yt.prototype.capacity=0,yt.prototype.properties=null,yt.create=function(bt){return new yt(bt)},yt.encode=function(bt,Tt){return Tt||(Tt=$Writer.create()),bt.id!=null&&Object.hasOwnProperty.call(bt,"id")&&Tt.uint32(10).string(bt.id),bt.type!=null&&Object.hasOwnProperty.call(bt,"type")&&Tt.uint32(16).int32(bt.type),bt.position!=null&&Object.hasOwnProperty.call(bt,"position")&&$root.urbansynth.Point2D.encode(bt.position,Tt.uint32(26).fork()).ldelim(),bt.zoneId!=null&&Object.hasOwnProperty.call(bt,"zoneId")&&Tt.uint32(34).string(bt.zoneId),bt.capacity!=null&&Object.hasOwnProperty.call(bt,"capacity")&&Tt.uint32(40).int32(bt.capacity),bt.properties!=null&&Object.hasOwnProperty.call(bt,"properties")&&$root.urbansynth.POIProperties.encode(bt.properties,Tt.uint32(50).fork()).ldelim(),Tt},yt.encodeDelimited=function(bt,Tt){return this.encode(bt,Tt).ldelim()},yt.decode=function(bt,Tt,Et){bt instanceof $Reader||(bt=$Reader.create(bt));let wt=Tt===void 0?bt.len:bt.pos+Tt,St=new $root.urbansynth.POI;for(;bt.pos<wt;){let At=bt.uint32();if(At===Et)break;switch(At>>>3){case 1:{St.id=bt.string();break}case 2:{St.type=bt.int32();break}case 3:{St.position=$root.urbansynth.Point2D.decode(bt,bt.uint32());break}case 4:{St.zoneId=bt.string();break}case 5:{St.capacity=bt.int32();break}case 6:{St.properties=$root.urbansynth.POIProperties.decode(bt,bt.uint32());break}default:bt.skipType(At&7);break}}return St},yt.decodeDelimited=function(bt){return bt instanceof $Reader||(bt=new $Reader(bt)),this.decode(bt,bt.uint32())},yt.verify=function(bt){if(typeof bt!="object"||bt===null)return"object expected";if(bt.id!=null&&bt.hasOwnProperty("id")&&!$util.isString(bt.id))return"id: string expected";if(bt.type!=null&&bt.hasOwnProperty("type"))switch(bt.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break}if(bt.position!=null&&bt.hasOwnProperty("position")){let Tt=$root.urbansynth.Point2D.verify(bt.position);if(Tt)return"position."+Tt}if(bt.zoneId!=null&&bt.hasOwnProperty("zoneId")&&!$util.isString(bt.zoneId))return"zoneId: string expected";if(bt.capacity!=null&&bt.hasOwnProperty("capacity")&&!$util.isInteger(bt.capacity))return"capacity: integer expected";if(bt.properties!=null&&bt.hasOwnProperty("properties")){let Tt=$root.urbansynth.POIProperties.verify(bt.properties);if(Tt)return"properties."+Tt}return null},yt.fromObject=function(bt){if(bt instanceof $root.urbansynth.POI)return bt;let Tt=new $root.urbansynth.POI;switch(bt.id!=null&&(Tt.id=String(bt.id)),bt.type){default:if(typeof bt.type=="number"){Tt.type=bt.type;break}break;case"HOME":case 0:Tt.type=0;break;case"OFFICE":case 1:Tt.type=1;break;case"SHOP":case 2:Tt.type=2;break;case"RESTAURANT":case 3:Tt.type=3;break;case"SCHOOL":case 4:Tt.type=4;break;case"HOSPITAL":case 5:Tt.type=5;break;case"PARK_POI":case 6:Tt.type=6;break;case"FACTORY":case 7:Tt.type=7;break}if(bt.position!=null){if(typeof bt.position!="object")throw TypeError(".urbansynth.POI.position: object expected");Tt.position=$root.urbansynth.Point2D.fromObject(bt.position)}if(bt.zoneId!=null&&(Tt.zoneId=String(bt.zoneId)),bt.capacity!=null&&(Tt.capacity=bt.capacity|0),bt.properties!=null){if(typeof bt.properties!="object")throw TypeError(".urbansynth.POI.properties: object expected");Tt.properties=$root.urbansynth.POIProperties.fromObject(bt.properties)}return Tt},yt.toObject=function(bt,Tt){Tt||(Tt={});let Et={};return Tt.defaults&&(Et.id="",Et.type=Tt.enums===String?"HOME":0,Et.position=null,Et.zoneId="",Et.capacity=0,Et.properties=null),bt.id!=null&&bt.hasOwnProperty("id")&&(Et.id=bt.id),bt.type!=null&&bt.hasOwnProperty("type")&&(Et.type=Tt.enums===String?$root.urbansynth.POIType[bt.type]===void 0?bt.type:$root.urbansynth.POIType[bt.type]:bt.type),bt.position!=null&&bt.hasOwnProperty("position")&&(Et.position=$root.urbansynth.Point2D.toObject(bt.position,Tt)),bt.zoneId!=null&&bt.hasOwnProperty("zoneId")&&(Et.zoneId=bt.zoneId),bt.capacity!=null&&bt.hasOwnProperty("capacity")&&(Et.capacity=bt.capacity),bt.properties!=null&&bt.hasOwnProperty("properties")&&(Et.properties=$root.urbansynth.POIProperties.toObject(bt.properties,Tt)),Et},yt.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},yt.getTypeUrl=function(bt){return bt===void 0&&(bt="type.googleapis.com"),bt+"/urbansynth.POI"},yt}(),xt.Building=function(){function yt(vt){if(this.footprint=[],vt)for(let bt=Object.keys(vt),Tt=0;Tt<bt.length;++Tt)vt[bt[Tt]]!=null&&(this[bt[Tt]]=vt[bt[Tt]])}return yt.prototype.id="",yt.prototype.footprint=$util.emptyArray,yt.prototype.height=0,yt.prototype.zoneId="",yt.prototype.type=0,yt.create=function(bt){return new yt(bt)},yt.encode=function(bt,Tt){if(Tt||(Tt=$Writer.create()),bt.id!=null&&Object.hasOwnProperty.call(bt,"id")&&Tt.uint32(10).string(bt.id),bt.footprint!=null&&bt.footprint.length)for(let Et=0;Et<bt.footprint.length;++Et)$root.urbansynth.Point2D.encode(bt.footprint[Et],Tt.uint32(18).fork()).ldelim();return bt.height!=null&&Object.hasOwnProperty.call(bt,"height")&&Tt.uint32(29).float(bt.height),bt.zoneId!=null&&Object.hasOwnProperty.call(bt,"zoneId")&&Tt.uint32(34).string(bt.zoneId),bt.type!=null&&Object.hasOwnProperty.call(bt,"type")&&Tt.uint32(40).int32(bt.type),Tt},yt.encodeDelimited=function(bt,Tt){return this.encode(bt,Tt).ldelim()},yt.decode=function(bt,Tt,Et){bt instanceof $Reader||(bt=$Reader.create(bt));let wt=Tt===void 0?bt.len:bt.pos+Tt,St=new $root.urbansynth.Building;for(;bt.pos<wt;){let At=bt.uint32();if(At===Et)break;switch(At>>>3){case 1:{St.id=bt.string();break}case 2:{St.footprint&&St.footprint.length||(St.footprint=[]),St.footprint.push($root.urbansynth.Point2D.decode(bt,bt.uint32()));break}case 3:{St.height=bt.float();break}case 4:{St.zoneId=bt.string();break}case 5:{St.type=bt.int32();break}default:bt.skipType(At&7);break}}return St},yt.decodeDelimited=function(bt){return bt instanceof $Reader||(bt=new $Reader(bt)),this.decode(bt,bt.uint32())},yt.verify=function(bt){if(typeof bt!="object"||bt===null)return"object expected";if(bt.id!=null&&bt.hasOwnProperty("id")&&!$util.isString(bt.id))return"id: string expected";if(bt.footprint!=null&&bt.hasOwnProperty("footprint")){if(!Array.isArray(bt.footprint))return"footprint: array expected";for(let Tt=0;Tt<bt.footprint.length;++Tt){let Et=$root.urbansynth.Point2D.verify(bt.footprint[Tt]);if(Et)return"footprint."+Et}}if(bt.height!=null&&bt.hasOwnProperty("height")&&typeof bt.height!="number")return"height: number expected";if(bt.zoneId!=null&&bt.hasOwnProperty("zoneId")&&!$util.isString(bt.zoneId))return"zoneId: string expected";if(bt.type!=null&&bt.hasOwnProperty("type"))switch(bt.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:case 4:break}return null},yt.fromObject=function(bt){if(bt instanceof $root.urbansynth.Building)return bt;let Tt=new $root.urbansynth.Building;if(bt.id!=null&&(Tt.id=String(bt.id)),bt.footprint){if(!Array.isArray(bt.footprint))throw TypeError(".urbansynth.Building.footprint: array expected");Tt.footprint=[];for(let Et=0;Et<bt.footprint.length;++Et){if(typeof bt.footprint[Et]!="object")throw TypeError(".urbansynth.Building.footprint: object expected");Tt.footprint[Et]=$root.urbansynth.Point2D.fromObject(bt.footprint[Et])}}switch(bt.height!=null&&(Tt.height=Number(bt.height)),bt.zoneId!=null&&(Tt.zoneId=String(bt.zoneId)),bt.type){default:if(typeof bt.type=="number"){Tt.type=bt.type;break}break;case"HOUSE":case 0:Tt.type=0;break;case"APARTMENT":case 1:Tt.type=1;break;case"OFFICE_BUILDING":case 2:Tt.type=2;break;case"STORE":case 3:Tt.type=3;break;case"WAREHOUSE":case 4:Tt.type=4;break}return Tt},yt.toObject=function(bt,Tt){Tt||(Tt={});let Et={};if((Tt.arrays||Tt.defaults)&&(Et.footprint=[]),Tt.defaults&&(Et.id="",Et.height=0,Et.zoneId="",Et.type=Tt.enums===String?"HOUSE":0),bt.id!=null&&bt.hasOwnProperty("id")&&(Et.id=bt.id),bt.footprint&&bt.footprint.length){Et.footprint=[];for(let wt=0;wt<bt.footprint.length;++wt)Et.footprint[wt]=$root.urbansynth.Point2D.toObject(bt.footprint[wt],Tt)}return bt.height!=null&&bt.hasOwnProperty("height")&&(Et.height=Tt.json&&!isFinite(bt.height)?String(bt.height):bt.height),bt.zoneId!=null&&bt.hasOwnProperty("zoneId")&&(Et.zoneId=bt.zoneId),bt.type!=null&&bt.hasOwnProperty("type")&&(Et.type=Tt.enums===String?$root.urbansynth.BuildingType[bt.type]===void 0?bt.type:$root.urbansynth.BuildingType[bt.type]:bt.type),Et},yt.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},yt.getTypeUrl=function(bt){return bt===void 0&&(bt="type.googleapis.com"),bt+"/urbansynth.Building"},yt}(),xt.Point2D=function(){function yt(vt){if(vt)for(let bt=Object.keys(vt),Tt=0;Tt<bt.length;++Tt)vt[bt[Tt]]!=null&&(this[bt[Tt]]=vt[bt[Tt]])}return yt.prototype.x=0,yt.prototype.y=0,yt.create=function(bt){return new yt(bt)},yt.encode=function(bt,Tt){return Tt||(Tt=$Writer.create()),bt.x!=null&&Object.hasOwnProperty.call(bt,"x")&&Tt.uint32(13).float(bt.x),bt.y!=null&&Object.hasOwnProperty.call(bt,"y")&&Tt.uint32(21).float(bt.y),Tt},yt.encodeDelimited=function(bt,Tt){return this.encode(bt,Tt).ldelim()},yt.decode=function(bt,Tt,Et){bt instanceof $Reader||(bt=$Reader.create(bt));let wt=Tt===void 0?bt.len:bt.pos+Tt,St=new $root.urbansynth.Point2D;for(;bt.pos<wt;){let At=bt.uint32();if(At===Et)break;switch(At>>>3){case 1:{St.x=bt.float();break}case 2:{St.y=bt.float();break}default:bt.skipType(At&7);break}}return St},yt.decodeDelimited=function(bt){return bt instanceof $Reader||(bt=new $Reader(bt)),this.decode(bt,bt.uint32())},yt.verify=function(bt){return typeof bt!="object"||bt===null?"object expected":bt.x!=null&&bt.hasOwnProperty("x")&&typeof bt.x!="number"?"x: number expected":bt.y!=null&&bt.hasOwnProperty("y")&&typeof bt.y!="number"?"y: number expected":null},yt.fromObject=function(bt){if(bt instanceof $root.urbansynth.Point2D)return bt;let Tt=new $root.urbansynth.Point2D;return bt.x!=null&&(Tt.x=Number(bt.x)),bt.y!=null&&(Tt.y=Number(bt.y)),Tt},yt.toObject=function(bt,Tt){Tt||(Tt={});let Et={};return Tt.defaults&&(Et.x=0,Et.y=0),bt.x!=null&&bt.hasOwnProperty("x")&&(Et.x=Tt.json&&!isFinite(bt.x)?String(bt.x):bt.x),bt.y!=null&&bt.hasOwnProperty("y")&&(Et.y=Tt.json&&!isFinite(bt.y)?String(bt.y):bt.y),Et},yt.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},yt.getTypeUrl=function(bt){return bt===void 0&&(bt="type.googleapis.com"),bt+"/urbansynth.Point2D"},yt}(),xt.ZoneProperties=function(){function yt(vt){if(vt)for(let bt=Object.keys(vt),Tt=0;Tt<bt.length;++Tt)vt[bt[Tt]]!=null&&(this[bt[Tt]]=vt[bt[Tt]])}return yt.prototype.residentialDensity=0,yt.prototype.commercialDensity=0,yt.prototype.officeDensity=0,yt.create=function(bt){return new yt(bt)},yt.encode=function(bt,Tt){return Tt||(Tt=$Writer.create()),bt.residentialDensity!=null&&Object.hasOwnProperty.call(bt,"residentialDensity")&&Tt.uint32(13).float(bt.residentialDensity),bt.commercialDensity!=null&&Object.hasOwnProperty.call(bt,"commercialDensity")&&Tt.uint32(21).float(bt.commercialDensity),bt.officeDensity!=null&&Object.hasOwnProperty.call(bt,"officeDensity")&&Tt.uint32(29).float(bt.officeDensity),Tt},yt.encodeDelimited=function(bt,Tt){return this.encode(bt,Tt).ldelim()},yt.decode=function(bt,Tt,Et){bt instanceof $Reader||(bt=$Reader.create(bt));let wt=Tt===void 0?bt.len:bt.pos+Tt,St=new $root.urbansynth.ZoneProperties;for(;bt.pos<wt;){let At=bt.uint32();if(At===Et)break;switch(At>>>3){case 1:{St.residentialDensity=bt.float();break}case 2:{St.commercialDensity=bt.float();break}case 3:{St.officeDensity=bt.float();break}default:bt.skipType(At&7);break}}return St},yt.decodeDelimited=function(bt){return bt instanceof $Reader||(bt=new $Reader(bt)),this.decode(bt,bt.uint32())},yt.verify=function(bt){return typeof bt!="object"||bt===null?"object expected":bt.residentialDensity!=null&&bt.hasOwnProperty("residentialDensity")&&typeof bt.residentialDensity!="number"?"residentialDensity: number expected":bt.commercialDensity!=null&&bt.hasOwnProperty("commercialDensity")&&typeof bt.commercialDensity!="number"?"commercialDensity: number expected":bt.officeDensity!=null&&bt.hasOwnProperty("officeDensity")&&typeof bt.officeDensity!="number"?"officeDensity: number expected":null},yt.fromObject=function(bt){if(bt instanceof $root.urbansynth.ZoneProperties)return bt;let Tt=new $root.urbansynth.ZoneProperties;return bt.residentialDensity!=null&&(Tt.residentialDensity=Number(bt.residentialDensity)),bt.commercialDensity!=null&&(Tt.commercialDensity=Number(bt.commercialDensity)),bt.officeDensity!=null&&(Tt.officeDensity=Number(bt.officeDensity)),Tt},yt.toObject=function(bt,Tt){Tt||(Tt={});let Et={};return Tt.defaults&&(Et.residentialDensity=0,Et.commercialDensity=0,Et.officeDensity=0),bt.residentialDensity!=null&&bt.hasOwnProperty("residentialDensity")&&(Et.residentialDensity=Tt.json&&!isFinite(bt.residentialDensity)?String(bt.residentialDensity):bt.residentialDensity),bt.commercialDensity!=null&&bt.hasOwnProperty("commercialDensity")&&(Et.commercialDensity=Tt.json&&!isFinite(bt.commercialDensity)?String(bt.commercialDensity):bt.commercialDensity),bt.officeDensity!=null&&bt.hasOwnProperty("officeDensity")&&(Et.officeDensity=Tt.json&&!isFinite(bt.officeDensity)?String(bt.officeDensity):bt.officeDensity),Et},yt.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},yt.getTypeUrl=function(bt){return bt===void 0&&(bt="type.googleapis.com"),bt+"/urbansynth.ZoneProperties"},yt}(),xt.POIProperties=function(){function yt(vt){if(this.tags=[],vt)for(let bt=Object.keys(vt),Tt=0;Tt<bt.length;++Tt)vt[bt[Tt]]!=null&&(this[bt[Tt]]=vt[bt[Tt]])}return yt.prototype.name="",yt.prototype.tags=$util.emptyArray,yt.create=function(bt){return new yt(bt)},yt.encode=function(bt,Tt){if(Tt||(Tt=$Writer.create()),bt.name!=null&&Object.hasOwnProperty.call(bt,"name")&&Tt.uint32(10).string(bt.name),bt.tags!=null&&bt.tags.length)for(let Et=0;Et<bt.tags.length;++Et)Tt.uint32(18).string(bt.tags[Et]);return Tt},yt.encodeDelimited=function(bt,Tt){return this.encode(bt,Tt).ldelim()},yt.decode=function(bt,Tt,Et){bt instanceof $Reader||(bt=$Reader.create(bt));let wt=Tt===void 0?bt.len:bt.pos+Tt,St=new $root.urbansynth.POIProperties;for(;bt.pos<wt;){let At=bt.uint32();if(At===Et)break;switch(At>>>3){case 1:{St.name=bt.string();break}case 2:{St.tags&&St.tags.length||(St.tags=[]),St.tags.push(bt.string());break}default:bt.skipType(At&7);break}}return St},yt.decodeDelimited=function(bt){return bt instanceof $Reader||(bt=new $Reader(bt)),this.decode(bt,bt.uint32())},yt.verify=function(bt){if(typeof bt!="object"||bt===null)return"object expected";if(bt.name!=null&&bt.hasOwnProperty("name")&&!$util.isString(bt.name))return"name: string expected";if(bt.tags!=null&&bt.hasOwnProperty("tags")){if(!Array.isArray(bt.tags))return"tags: array expected";for(let Tt=0;Tt<bt.tags.length;++Tt)if(!$util.isString(bt.tags[Tt]))return"tags: string[] expected"}return null},yt.fromObject=function(bt){if(bt instanceof $root.urbansynth.POIProperties)return bt;let Tt=new $root.urbansynth.POIProperties;if(bt.name!=null&&(Tt.name=String(bt.name)),bt.tags){if(!Array.isArray(bt.tags))throw TypeError(".urbansynth.POIProperties.tags: array expected");Tt.tags=[];for(let Et=0;Et<bt.tags.length;++Et)Tt.tags[Et]=String(bt.tags[Et])}return Tt},yt.toObject=function(bt,Tt){Tt||(Tt={});let Et={};if((Tt.arrays||Tt.defaults)&&(Et.tags=[]),Tt.defaults&&(Et.name=""),bt.name!=null&&bt.hasOwnProperty("name")&&(Et.name=bt.name),bt.tags&&bt.tags.length){Et.tags=[];for(let wt=0;wt<bt.tags.length;++wt)Et.tags[wt]=bt.tags[wt]}return Et},yt.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},yt.getTypeUrl=function(bt){return bt===void 0&&(bt="type.googleapis.com"),bt+"/urbansynth.POIProperties"},yt}(),xt.CityMetadata=function(){function yt(vt){if(vt)for(let bt=Object.keys(vt),Tt=0;Tt<bt.length;++Tt)vt[bt[Tt]]!=null&&(this[bt[Tt]]=vt[bt[Tt]])}return yt.prototype.generationTimestamp=$util.Long?$util.Long.fromBits(0,0,!1):0,yt.prototype.generationSeed="",yt.prototype.totalPopulation=0,yt.prototype.totalArea=0,yt.create=function(bt){return new yt(bt)},yt.encode=function(bt,Tt){return Tt||(Tt=$Writer.create()),bt.generationTimestamp!=null&&Object.hasOwnProperty.call(bt,"generationTimestamp")&&Tt.uint32(8).int64(bt.generationTimestamp),bt.generationSeed!=null&&Object.hasOwnProperty.call(bt,"generationSeed")&&Tt.uint32(18).string(bt.generationSeed),bt.totalPopulation!=null&&Object.hasOwnProperty.call(bt,"totalPopulation")&&Tt.uint32(24).int32(bt.totalPopulation),bt.totalArea!=null&&Object.hasOwnProperty.call(bt,"totalArea")&&Tt.uint32(37).float(bt.totalArea),Tt},yt.encodeDelimited=function(bt,Tt){return this.encode(bt,Tt).ldelim()},yt.decode=function(bt,Tt,Et){bt instanceof $Reader||(bt=$Reader.create(bt));let wt=Tt===void 0?bt.len:bt.pos+Tt,St=new $root.urbansynth.CityMetadata;for(;bt.pos<wt;){let At=bt.uint32();if(At===Et)break;switch(At>>>3){case 1:{St.generationTimestamp=bt.int64();break}case 2:{St.generationSeed=bt.string();break}case 3:{St.totalPopulation=bt.int32();break}case 4:{St.totalArea=bt.float();break}default:bt.skipType(At&7);break}}return St},yt.decodeDelimited=function(bt){return bt instanceof $Reader||(bt=new $Reader(bt)),this.decode(bt,bt.uint32())},yt.verify=function(bt){return typeof bt!="object"||bt===null?"object expected":bt.generationTimestamp!=null&&bt.hasOwnProperty("generationTimestamp")&&!$util.isInteger(bt.generationTimestamp)&&!(bt.generationTimestamp&&$util.isInteger(bt.generationTimestamp.low)&&$util.isInteger(bt.generationTimestamp.high))?"generationTimestamp: integer|Long expected":bt.generationSeed!=null&&bt.hasOwnProperty("generationSeed")&&!$util.isString(bt.generationSeed)?"generationSeed: string expected":bt.totalPopulation!=null&&bt.hasOwnProperty("totalPopulation")&&!$util.isInteger(bt.totalPopulation)?"totalPopulation: integer expected":bt.totalArea!=null&&bt.hasOwnProperty("totalArea")&&typeof bt.totalArea!="number"?"totalArea: number expected":null},yt.fromObject=function(bt){if(bt instanceof $root.urbansynth.CityMetadata)return bt;let Tt=new $root.urbansynth.CityMetadata;return bt.generationTimestamp!=null&&($util.Long?(Tt.generationTimestamp=$util.Long.fromValue(bt.generationTimestamp)).unsigned=!1:typeof bt.generationTimestamp=="string"?Tt.generationTimestamp=parseInt(bt.generationTimestamp,10):typeof bt.generationTimestamp=="number"?Tt.generationTimestamp=bt.generationTimestamp:typeof bt.generationTimestamp=="object"&&(Tt.generationTimestamp=new $util.LongBits(bt.generationTimestamp.low>>>0,bt.generationTimestamp.high>>>0).toNumber())),bt.generationSeed!=null&&(Tt.generationSeed=String(bt.generationSeed)),bt.totalPopulation!=null&&(Tt.totalPopulation=bt.totalPopulation|0),bt.totalArea!=null&&(Tt.totalArea=Number(bt.totalArea)),Tt},yt.toObject=function(bt,Tt){Tt||(Tt={});let Et={};if(Tt.defaults){if($util.Long){let wt=new $util.Long(0,0,!1);Et.generationTimestamp=Tt.longs===String?wt.toString():Tt.longs===Number?wt.toNumber():wt}else Et.generationTimestamp=Tt.longs===String?"0":0;Et.generationSeed="",Et.totalPopulation=0,Et.totalArea=0}return bt.generationTimestamp!=null&&bt.hasOwnProperty("generationTimestamp")&&(typeof bt.generationTimestamp=="number"?Et.generationTimestamp=Tt.longs===String?String(bt.generationTimestamp):bt.generationTimestamp:Et.generationTimestamp=Tt.longs===String?$util.Long.prototype.toString.call(bt.generationTimestamp):Tt.longs===Number?new $util.LongBits(bt.generationTimestamp.low>>>0,bt.generationTimestamp.high>>>0).toNumber():bt.generationTimestamp),bt.generationSeed!=null&&bt.hasOwnProperty("generationSeed")&&(Et.generationSeed=bt.generationSeed),bt.totalPopulation!=null&&bt.hasOwnProperty("totalPopulation")&&(Et.totalPopulation=bt.totalPopulation),bt.totalArea!=null&&bt.hasOwnProperty("totalArea")&&(Et.totalArea=Tt.json&&!isFinite(bt.totalArea)?String(bt.totalArea):bt.totalArea),Et},yt.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},yt.getTypeUrl=function(bt){return bt===void 0&&(bt="type.googleapis.com"),bt+"/urbansynth.CityMetadata"},yt}(),xt.ZoneType=function(){const yt={},vt=Object.create(yt);return vt[yt[0]="RESIDENTIAL"]=0,vt[yt[1]="COMMERCIAL"]=1,vt[yt[2]="INDUSTRIAL"]=2,vt[yt[3]="DOWNTOWN"]=3,vt[yt[4]="PARK"]=4,vt[yt[5]="WATER"]=5,vt}(),xt.RoadType=function(){const yt={},vt=Object.create(yt);return vt[yt[0]="HIGHWAY"]=0,vt[yt[1]="ARTERIAL"]=1,vt[yt[2]="COLLECTOR"]=2,vt[yt[3]="LOCAL"]=3,vt}(),xt.POIType=function(){const yt={},vt=Object.create(yt);return vt[yt[0]="HOME"]=0,vt[yt[1]="OFFICE"]=1,vt[yt[2]="SHOP"]=2,vt[yt[3]="RESTAURANT"]=3,vt[yt[4]="SCHOOL"]=4,vt[yt[5]="HOSPITAL"]=5,vt[yt[6]="PARK_POI"]=6,vt[yt[7]="FACTORY"]=7,vt}(),xt.BuildingType=function(){const yt={},vt=Object.create(yt);return vt[yt[0]="HOUSE"]=0,vt[yt[1]="APARTMENT"]=1,vt[yt[2]="OFFICE_BUILDING"]=2,vt[yt[3]="STORE"]=3,vt[yt[4]="WAREHOUSE"]=4,vt}(),xt})();let wasmModule=null;function generateRoadName(xt,yt){const vt=["Street","Road","Highway","Boulevard","Avenue"],bt=["Main","Oak","First","Park","Washington","Second","Maple","Church","Third","Elm","Cedar","Pine","Lincoln","Spring","Fourth","River","Mill","Lake","Hill","State"],Tt=vt[xt]||"Street";return`${bt[yt%bt.length]} ${Tt}`}function generatePOIsFromCityData(xt){const yt=xt.pois||[],vt=xt.zones||[],bt=xt.buildings||[],Tt=[...yt];return console.log("Generating POIs from zones and buildings..."),vt.forEach((Et,wt)=>{if(Et.type===0||Et.zone_type===0){const St=Et.boundary||[];if(St.length>=3){const At=St.reduce((Pt,Ct)=>Pt+Ct.x,0)/St.length,Rt=St.reduce((Pt,Ct)=>Pt+Ct.y,0)/St.length;for(let Pt=0;Pt<3;Pt++){const Ct=(wt*7+Pt*3)%1e3,It=Ct%400-200,Mt=Ct*3%400-200;Tt.push({id:`home_${wt}_${Pt}`,type:0,position:{x:At+It,y:Rt+Mt},capacity:50+Ct%100,zone_id:Et.id||`zone_${wt}`})}}}}),vt.length===0&&bt.length>0&&bt.forEach((Et,wt)=>{if(Et.building_type===0||Et.type===0){const St=Et.footprint||[];if(St.length>=3){const At=St.reduce((Ct,It)=>Ct+It.x,0)/St.length,Rt=St.reduce((Ct,It)=>Ct+It.y,0)/St.length,Pt=wt%100;Tt.push({id:`building_home_${wt}`,type:0,position:{x:At,y:Rt},capacity:30+Pt%70,zone_id:Et.zone_id||"default"})}}}),console.log(`Generated ${Tt.length-yt.length} additional POIs`),Tt}async function loadWasmModule(){if(wasmModule)return wasmModule;try{const xt=await __vitePreload(()=>import("./urbansynth_sim-BJDcseqM.js"),[]);return await xt.default(),wasmModule=xt,xt}catch(xt){throw console.error("Failed to load WASM module:",xt),new Error(`WASM module loading failed: ${xt instanceof Error?xt.message:"Unknown error"}`)}}async function initializeSimulation(xt){const yt=await loadWasmModule();try{const vt=(xt.zones||[]).map(St=>({...St,zone_type:St.type||St.zone_type||0})),bt=(xt.roads||[]).map((St,At)=>({...St,road_type:St.type||St.road_type||0,speed_limit:St.speed_limit||St.speedLimit||50,width:St.width||6,lanes:St.lanes||2,name:St.name||St.road_name||generateRoadName(St.road_type||St.type||0,At)})),Tt=(xt.pois||[]).map(St=>({...St,poi_type:St.type||St.poi_type||0,zone_id:St.zone_id||St.zoneId||"default"})),Et=(xt.buildings||[]).map(St=>({...St,building_type:St.type||St.building_type||0,zone_id:St.zone_id||St.zoneId||"default",height:St.height||St.stories*3.5||Math.random()*30+10})),wt={zones:vt,roads:bt,pois:Tt,buildings:Et};console.log("Initializing WASM with config:",{zonesCount:wt.zones.length,roadsCount:wt.roads.length,poisCount:wt.pois.length,buildingsCount:wt.buildings.length}),yt.init(wt)}catch(vt){throw console.error("Failed to initialize simulation:",vt),new Error(`Simulation initialization failed: ${vt instanceof Error?vt.message:"Unknown error"}`)}}async function loadCityModel(){var xt,yt,vt,bt;try{console.log("Loading city model from /model.pbf...");const Tt=await fetch("/model.pbf");if(!Tt.ok)throw new Error(`Failed to fetch city model: ${Tt.statusText}`);const Et=await Tt.arrayBuffer(),wt=new Uint8Array(Et);console.log(`Loaded protobuf data: ${wt.length} bytes`);const St=urbansynth.City.decode(wt);console.log("Decoded city model:",{name:St.name,zonesCount:((xt=St.zones)==null?void 0:xt.length)||0,roadsCount:((yt=St.roads)==null?void 0:yt.length)||0,poisCount:((vt=St.pois)==null?void 0:vt.length)||0,buildingsCount:((bt=St.buildings)==null?void 0:bt.length)||0});let At=St.pois||[];At.filter(Pt=>Pt.type===0).length<5&&(console.log("Generating residential POIs for agent spawning..."),At=generatePOIsFromCityData(St));const Rt={name:St.name||"Generated City",bounds:St.bounds?{min_x:St.bounds.minX||0,min_y:St.bounds.minY||0,max_x:St.bounds.maxX||15e3,max_y:St.bounds.maxY||15e3}:{min_x:0,min_y:0,max_x:15e3,max_y:15e3},zones:St.zones||[],roads:St.roads||[],pois:At,buildings:St.buildings||[],metadata:St.metadata||null};return console.log("Final city model with bounds:",{name:Rt.name,bounds:Rt.bounds,zonesCount:Rt.zones.length,roadsCount:Rt.roads.length,poisCount:Rt.pois.length,buildingsCount:Rt.buildings.length}),Rt}catch(Tt){return console.error("Failed to load city model:",Tt),console.log("Using fallback empty city model"),{name:"Default City",bounds:{min_x:0,min_y:0,max_x:15e3,max_y:15e3},zones:[],roads:[],pois:[],buildings:[],metadata:null}}}function useSimulation(){const{state:xt,dispatch:yt}=useSimulationContext(),vt=reactExports.useRef(),bt=reactExports.useRef(null),Tt=reactExports.useCallback(async()=>{try{yt({type:"SET_LOADING",payload:!0}),yt({type:"SET_ERROR",payload:null}),console.log("Loading city model...");const Mt=await loadCityModel();yt({type:"SET_CITY_MODEL",payload:Mt}),console.log(" Starting fallback agent generation (always runs)..."),Et(Mt);try{console.log("Attempting to load WASM module...");const Ot=await loadWasmModule();await initializeSimulation(Mt),bt.current=Ot,console.log("WASM module loaded successfully - will replace fallback agents")}catch(Ot){console.warn("WASM module failed to load, continuing with fallback mode:",Ot)}yt({type:"SET_INITIALIZED",payload:!0}),yt({type:"SET_LOADING",payload:!1})}catch(Mt){console.error("Critical initialization error:",Mt),yt({type:"SET_ERROR",payload:Mt instanceof Error?Mt.message:"Unknown error"}),yt({type:"SET_LOADING",payload:!1})}},[yt]);reactExports.useCallback(()=>{const Mt=[];for(let Ot=0;Ot<8;Ot++)for(let kt=0;kt<8;kt++){const Ft=(Ot-4)*200,Nt=(kt-4)*200,Lt=50+(Ot*8+kt)*5;Mt.push({id:`building_${Ot}_${kt}`,footprint:[[Ft-30,Nt-30],[Ft+30,Nt-30],[Ft+30,Nt+30],[Ft-30,Nt+30]],height:Lt,stories:Math.ceil(Lt/3.5),building_type:Math.floor((Ot+kt)%5),type:Math.floor((Ot+kt)%5)})}return Mt},[]);const Et=reactExports.useCallback(Mt=>{var Lt,Dt,$t;console.log(" generateFallbackAgents called with cityModel:",{name:Mt==null?void 0:Mt.name,buildings:((Lt=Mt==null?void 0:Mt.buildings)==null?void 0:Lt.length)||0,pois:((Dt=Mt==null?void 0:Mt.pois)==null?void 0:Dt.length)||0,roads:(($t=Mt==null?void 0:Mt.roads)==null?void 0:$t.length)||0});const Ot=[],kt=(Mt==null?void 0:Mt.pois)||[],Ft=(Mt==null?void 0:Mt.buildings)||[];console.log(" Starting agent generation...",{pois:kt.length,buildings:Ft.length});let Nt=0;kt.forEach((zt,Ut)=>{if(zt.type===0&&Ot.length<20){const jt=Math.min(3,Math.floor((zt.capacity||50)/20));Nt+=jt;for(let Ht=0;Ht<jt;Ht++){const Vt=Ot.length,Wt=(Vt*17+Ut*5)%100,Yt=Wt%50-25,Kt=Wt*3%50-25,Zt={id:Vt,position:{x:zt.position.x+Yt,y:zt.position.y+Kt,z:5},agent_type:Vt%3===0?"Car":"Pedestrian",speed:5+Vt%15,state:"Traveling",destination:`poi_${Vt%kt.length}`,path:[],path_progress:0,initialPosition:{x:zt.position.x+Yt,y:zt.position.y+Kt,z:5}};Ot.push(Zt)}}}),console.log(" Created agents from POIs:",Nt),Ot.length<5&&Ft.length>0&&(console.log(" Generating agents from buildings since POI agents are insufficient..."),Ft.slice(0,15).forEach((zt,Ut)=>{if(zt.footprint&&zt.footprint.length>0&&Ot.length<20){const jt=zt.footprint.reduce((Yt,Kt)=>Yt+(Kt.x||Kt[0]),0)/zt.footprint.length,Ht=zt.footprint.reduce((Yt,Kt)=>Yt+(Kt.y||Kt[1]),0)/zt.footprint.length,Vt=Ot.length,Wt={id:Vt,position:{x:jt,y:Ht,z:5},agent_type:Vt%3===0?"Car":"Pedestrian",speed:5+Vt%15,state:"Traveling",destination:`building_${Vt%Ft.length}`,path:[],path_progress:0,initialPosition:{x:jt,y:Ht,z:5}};Ot.push(Wt)}}),console.log(" Created additional agents from buildings:",Ot.length-Nt)),console.log(`Generated ${Ot.length} fallback agents`),yt({type:"SET_AGENTS",payload:Ot}),Ot.length>0&&St()},[yt]),wt=reactExports.useRef([]),St=reactExports.useCallback(()=>{wt.current=xt.agents.map(Mt=>({...Mt,initialPosition:Mt.initialPosition||Mt.position,animationStartTime:Date.now(),targetPosition:null,movementPath:[]})),console.log(`${wt.current.length} agents created with movement animation`)},[xt.agents]),At=reactExports.useCallback(()=>{xt.isInitialized&&(bt.current&&bt.current.start(),yt({type:"SET_RUNNING",payload:!0}),console.log("Simulation started"))},[xt.isInitialized,yt]),Rt=reactExports.useCallback(()=>{vt.current&&(cancelAnimationFrame(vt.current),vt.current=void 0),bt.current&&bt.current.pause(),yt({type:"SET_RUNNING",payload:!1}),console.log("Simulation paused")},[yt]),Pt=reactExports.useCallback(Mt=>{yt({type:"SET_SPEED",payload:Mt}),bt.current&&bt.current.setSpeed(Mt),console.log(`Simulation speed set to ${Mt}x`)},[yt]),Ct=reactExports.useCallback(()=>{if(xt.isRunning)try{if(bt.current){bt.current.tick();const Mt=bt.current.getAgentStates();yt({type:"SET_AGENTS",payload:Mt});const Ot=bt.current.getSimulationTime(),kt=Math.floor(Ot/24),Ft=Ot%24;if(yt({type:"SET_TIME",payload:{time:Ft,day:kt}}),Math.random()<.1){const Nt=bt.current.getTrafficData();yt({type:"SET_TRAFFIC_DATA",payload:Nt})}yt({type:"UPDATE_STATS",payload:{totalAgents:Mt.length,activeAgents:Mt.filter(Nt=>Nt.state==="Traveling").length,averageSpeed:Mt.reduce((Nt,Lt)=>Nt+(Lt.speed||0),0)/Math.max(Mt.length,1)}})}else{const Mt=Date.now(),Ot=(xt.currentTime+.05*xt.speed)%24,kt=xt.day+(Ot<xt.currentTime?1:0);if(yt({type:"SET_TIME",payload:{time:Ot,day:kt}}),wt.current.length>0){const Ft=wt.current.map((Dt,$t)=>{const zt=(Mt-Dt.animationStartTime)/1e3,Ut=$t*17+3,jt=50+Ut%100,Ht=.3+Ut%20/100,Vt=Ut%360*(Math.PI/180),Wt=(zt*Ht+Vt)%(Math.PI*2),Yt=Math.cos(Wt)*jt,Kt=Math.sin(Wt)*jt,Zt={x:Dt.initialPosition.x+Yt,y:Dt.initialPosition.y+Kt,z:Dt.initialPosition.z+Math.sin(Wt*2)*2},Xt=Math.sqrt(Yt*Yt+Kt*Kt)*Ht;return{...Dt,position:Zt,speed:Xt,state:"Traveling"}});yt({type:"SET_AGENTS",payload:Ft});const Lt=Ft.reduce((Dt,$t)=>Dt+$t.speed,0)/Math.max(Ft.length,1);yt({type:"UPDATE_STATS",payload:{totalAgents:Ft.length,activeAgents:Ft.length,averageSpeed:Lt}})}}}catch(Mt){console.error("Simulation update error:",Mt),yt({type:"SET_ERROR",payload:Mt instanceof Error?Mt.message:"Unknown error"})}},[xt.isRunning,xt.currentTime,xt.day,xt.speed,xt.agents.length,yt]),It=reactExports.useCallback(Mt=>{if(bt.current)try{bt.current.updateWorld(Mt)}catch(Ot){console.error("World update error:",Ot),yt({type:"SET_ERROR",payload:Ot instanceof Error?Ot.message:"Unknown error"})}},[yt]);return reactExports.useEffect(()=>{function Mt(){Ct(),vt.current=requestAnimationFrame(Mt)}return xt.isRunning&&(vt.current=requestAnimationFrame(Mt)),()=>{vt.current&&cancelAnimationFrame(vt.current)}},[xt.isRunning,Ct]),reactExports.useEffect(()=>()=>{if(bt.current)try{bt.current.destroy()}catch(Mt){console.error("WASM cleanup error:",Mt)}},[]),{initialize:Tt,start:At,pause:Rt,setSpeed:Pt,updateWorld:It,isInitialized:xt.isInitialized,isLoading:xt.isLoading,error:xt.error}}function DraggablePanel({title:xt,children:yt,defaultPosition:vt={x:20,y:20},defaultSize:bt={width:320,height:400},isCollapsible:Tt=!0,initiallyCollapsed:Et=!1,zIndex:wt,storageKey:St,panelType:At}){const Pt=(()=>{if(!St)return{position:vt,size:bt,collapsed:Et};try{const Gt=localStorage.getItem(`draggable-panel-${St}`);if(Gt)return JSON.parse(Gt)}catch(Gt){console.warn("Failed to load saved panel state:",Gt)}return{position:vt,size:bt,collapsed:Et}})(),[Ct,It]=reactExports.useState(Pt.position),[Mt,Ot]=reactExports.useState(Pt.size),[kt,Ft]=reactExports.useState(Pt.collapsed),[Nt,Lt]=reactExports.useState(!1),[Dt,$t]=reactExports.useState(!1),[zt,Ut]=reactExports.useState({x:0,y:0}),[jt,Ht]=reactExports.useState({x:0,y:0,width:0,height:0}),[Vt,Wt]=reactExports.useState(!1),Yt=reactExports.useRef(null),Kt=St||`panel-${xt.replace(/\s+/g,"-").toLowerCase()}`,Zt=wt||(At?getPanelZIndex(At,Vt):1e3);reactExports.useEffect(()=>panelZIndexManager.subscribe(Qt=>{Wt(Qt===Kt)}),[Kt]);const Xt=()=>{panelZIndexManager.setActivePanel(Kt)},en=(Gt,Qt,Jt)=>{if(St)try{const tn={position:Gt||Ct,size:Qt||Mt,collapsed:Jt!==void 0?Jt:kt};localStorage.setItem(`draggable-panel-${St}`,JSON.stringify(tn))}catch(tn){console.warn("Failed to save panel state:",tn)}},nn=Gt=>{Xt();const Qt=Gt.target;(Qt.classList.contains("panel-header")||Qt.classList.contains("panel-title"))&&(Gt.preventDefault(),Lt(!0),Ut({x:Gt.clientX-Ct.x,y:Gt.clientY-Ct.y}))},rn=Gt=>{Gt.preventDefault(),Gt.stopPropagation(),$t(!0),Ht({x:Gt.clientX,y:Gt.clientY,width:Mt.width,height:Mt.height})},qt=()=>{const Gt=!kt;Ft(Gt),en(void 0,void 0,Gt)};return reactExports.useEffect(()=>{const Gt=Jt=>{if(Nt){const tn={x:Math.max(0,Math.min(window.innerWidth-Mt.width,Jt.clientX-zt.x)),y:Math.max(0,Math.min(window.innerHeight-50,Jt.clientY-zt.y))};It(tn)}else if(Dt){const tn={width:Math.max(250,jt.width+(Jt.clientX-jt.x)),height:Math.max(200,jt.height+(Jt.clientY-jt.y))};Ot(tn)}},Qt=()=>{Nt&&(Lt(!1),en(Ct,void 0,void 0)),Dt&&($t(!1),en(void 0,Mt,void 0))};return(Nt||Dt)&&(document.addEventListener("mousemove",Gt),document.addEventListener("mouseup",Qt),document.body.style.userSelect="none"),()=>{document.removeEventListener("mousemove",Gt),document.removeEventListener("mouseup",Qt),document.body.style.userSelect=""}},[Nt,Dt,zt,jt,Ct,Mt]),jsxRuntimeExports.jsxs("div",{ref:Yt,className:"floating-panel",onClick:Xt,style:{position:"fixed",left:Ct.x,top:Ct.y,width:Mt.width,height:kt?"auto":Mt.height,zIndex:Zt,background:"var(--surface-color)",border:Vt?"2px solid var(--primary-color)":"1px solid var(--border-color)",borderRadius:"var(--border-radius)",boxShadow:Vt?"var(--shadow-xl)":"var(--shadow-lg)",userSelect:"none",fontFamily:"inherit",transition:"border-color 0.2s ease, box-shadow 0.2s ease"},children:[jsxRuntimeExports.jsxs("div",{className:"panel-header",style:{padding:"0.75rem 1rem",borderBottom:kt?"none":"1px solid var(--border-color)",background:"var(--background-color)",borderRadius:"var(--border-radius) var(--border-radius) 0 0",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.875rem",fontWeight:600,cursor:Nt?"grabbing":"grab",color:"var(--text-primary)"},onMouseDown:nn,children:[jsxRuntimeExports.jsx("span",{className:"panel-title",style:{pointerEvents:"none"},children:xt}),jsxRuntimeExports.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:Tt&&jsxRuntimeExports.jsx("button",{onClick:qt,style:{background:"none",border:"none",cursor:"pointer",fontSize:"0.75rem",padding:"0.25rem",color:"var(--text-secondary)",borderRadius:"2px"},onMouseDown:Gt=>Gt.stopPropagation(),children:kt?"":""})})]}),!kt&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"panel-content",style:{padding:"1rem",overflow:"auto",height:Mt.height-60,cursor:"default"},onMouseDown:Gt=>Gt.stopPropagation(),children:yt}),jsxRuntimeExports.jsx("div",{className:"resize-handle",style:{position:"absolute",bottom:0,right:0,width:16,height:16,cursor:"se-resize",background:`
                linear-gradient(-45deg,
                  transparent 0%,
                  transparent 30%,
                  var(--border-color) 30%,
                  var(--border-color) 35%,
                  transparent 35%,
                  transparent 45%,
                  var(--border-color) 45%,
                  var(--border-color) 50%,
                  transparent 50%,
                  transparent 60%,
                  var(--border-color) 60%,
                  var(--border-color) 65%,
                  transparent 65%,
                  transparent 100%
                )
              `,opacity:.5},onMouseDown:rn})]})]})}function ControlPanel(){const{state:xt}=useSimulationContext(),{start:yt,pause:vt,setSpeed:bt}=useSimulation(),Tt=Et=>{const wt=Math.floor(Et),St=Math.floor((Et-wt)*60);return`${wt.toString().padStart(2,"0")}:${St.toString().padStart(2,"0")}`};return console.log("ControlPanel render:",{isInitialized:xt.isInitialized,isRunning:xt.isRunning,isLoading:xt.isLoading,currentTime:xt.currentTime,speed:xt.speed}),jsxRuntimeExports.jsxs(DraggablePanel,{title:" Time Controls",defaultPosition:{x:20,y:120},defaultSize:{width:280,height:200},isCollapsible:!0,initiallyCollapsed:!1,storageKey:"time-controls",panelType:"controls",children:[jsxRuntimeExports.jsxs("div",{className:"control-group",children:[jsxRuntimeExports.jsxs("label",{className:"control-label",children:["Simulation Status: ",xt.isInitialized?" Ready":" Loading"]}),jsxRuntimeExports.jsx("div",{className:"control-buttons",children:jsxRuntimeExports.jsx("button",{className:"button button-primary",onClick:xt.isRunning?vt:yt,style:{minWidth:"100px"},children:xt.isRunning?" Pause":" Play"})})]}),jsxRuntimeExports.jsxs("div",{className:"control-group",children:[jsxRuntimeExports.jsxs("label",{className:"control-label",children:["Speed: ",xt.speed.toFixed(1),"x"]}),jsxRuntimeExports.jsx("input",{type:"range",min:"0.1",max:"5",step:"0.1",value:xt.speed,onChange:Et=>bt(parseFloat(Et.target.value)),className:"speed-slider",style:{width:"100%"}})]}),jsxRuntimeExports.jsxs("div",{className:"control-group",children:[jsxRuntimeExports.jsx("label",{className:"control-label",children:"Time"}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[jsxRuntimeExports.jsx("span",{children:Tt(xt.currentTime)}),jsxRuntimeExports.jsxs("span",{style:{fontSize:"0.875rem",color:"var(--text-secondary)"},children:["Day ",xt.day+1]})]})]})]})}const CITY_CENTER_LAT=40.7128,CITY_CENTER_LNG=-74.006,METERS_PER_DEGREE_LAT=111e3,METERS_PER_DEGREE_LNG=85e3;function localToLatLng(xt,yt){const vt=CITY_CENTER_LAT+yt/METERS_PER_DEGREE_LAT,bt=CITY_CENTER_LNG+xt/METERS_PER_DEGREE_LNG;return isNaN(bt)||isNaN(vt)||!isFinite(bt)||!isFinite(vt)?(console.error(" Generated invalid coordinates for point:",{input:{x:xt,y:yt},output:{lng:bt,lat:vt},constants:{CITY_CENTER_LAT,CITY_CENTER_LNG,METERS_PER_DEGREE_LAT,METERS_PER_DEGREE_LNG}}),[-74.006,40.7128]):(Math.random()<.01&&console.log(" Coordinate conversion sample:",{local:{x:xt,y:yt},latLng:{lat:vt,lng:bt},distance_from_center:Math.sqrt(xt*xt+yt*yt)}),[bt,vt])}function convertPointsToLatLng(xt){return xt.map(yt=>localToLatLng(yt.x,yt.y))}function convertAllCoordinates(xt){if(xt==null)return xt;if(Array.isArray(xt))return xt.map(yt=>convertAllCoordinates(yt));if(typeof xt=="object"){const yt={};for(const[vt,bt]of Object.entries(xt))if(vt==="position"&&bt&&typeof bt=="object"&&"x"in bt&&"y"in bt){const[Tt,Et]=localToLatLng(bt.x,bt.y);yt[vt]={lng:Tt,lat:Et,z:bt.z||0}}else if((vt==="path"||vt==="coordinates"||vt==="footprint"||vt==="boundary")&&Array.isArray(bt))bt.length>0?typeof bt[0]=="object"&&"x"in bt[0]&&"y"in bt[0]?yt[vt]=convertPointsToLatLng(bt):Array.isArray(bt[0])&&bt[0].length>=2&&typeof bt[0][0]=="number"&&typeof bt[0][1]=="number"?yt[vt]=bt.map(Tt=>{const[Et,wt]=localToLatLng(Tt[0],Tt[1]);return Tt.length===3?[Et,wt,Tt[2]]:[Et,wt]}):yt[vt]=convertAllCoordinates(bt):yt[vt]=bt;else if(vt==="x"&&typeof bt=="number"&&xt.y!==void 0){const[Tt,Et]=localToLatLng(bt,xt.y);yt.lng=Tt,yt.lat=Et}else{if(vt==="y"&&typeof bt=="number"&&xt.x!==void 0)continue;yt[vt]=convertAllCoordinates(bt)}return yt}return xt}function distance2D(xt,yt,vt,bt){return Math.sqrt(Math.pow(vt-xt,2)+Math.pow(bt-yt,2))}function cubicEaseOut(xt){return 1-Math.pow(1-xt,3)}function exponentialDecayHeight(xt,yt,vt,bt,Tt,Et,wt=2){const At=distance2D(xt,yt,vt,bt)/Et;return Math.max(0,Tt*Math.exp(-Math.pow(At,wt)))}function getBoundsFromCityModel(xt){console.log("Raw city model bounds:",xt.bounds);let yt,vt,bt,Tt;if(xt.bounds)({min_x:yt,min_y:vt,max_x:bt,max_y:Tt}=xt.bounds);else{console.log("No bounds found in city model, calculating from zones/buildings...");const Mt=[];if(xt.zones&&xt.zones.forEach(kt=>{kt.boundary&&Mt.push(...kt.boundary)}),xt.buildings&&xt.buildings.forEach(kt=>{kt.footprint&&Mt.push(...kt.footprint)}),Mt.length===0)return console.log("No coordinate data found, using default view"),{longitude:CITY_CENTER_LNG,latitude:CITY_CENTER_LAT,zoom:12,pitch:45,bearing:0};const Ot={min_x:Math.min(...Mt.map(kt=>kt.x)),min_y:Math.min(...Mt.map(kt=>kt.y)),max_x:Math.max(...Mt.map(kt=>kt.x)),max_y:Math.max(...Mt.map(kt=>kt.y))};console.log("Calculated bounds from geometry:",Ot),{min_x:yt,min_y:vt,max_x:bt,max_y:Tt}=Ot}const Et=(yt+bt)/2,wt=(vt+Tt)/2,[St,At]=localToLatLng(Et,wt),Rt=bt-yt,Pt=Tt-vt,Ct=Math.max(Rt,Pt);console.log(`City bounds: ${Rt}x${Pt}, max dimension: ${Ct}`);let It=17;return Ct>1e4?It=11:Ct>5e3?It=13:Ct>2e3?It=15:Ct>1e3&&(It=16),console.log(`Setting view to: lng=${St}, lat=${At}, zoom=${It}`),{longitude:St,latitude:At,zoom:It,pitch:45,bearing:0}}function useCamera(xt){const yt={longitude:xt.longitude??-74.006,latitude:xt.latitude??40.7128,zoom:xt.zoom??12,pitch:xt.pitch??45,bearing:xt.bearing??0},[vt,bt]=reactExports.useState(yt),[Tt,Et]=reactExports.useState({enableGyroscope:!1,enableVR:!1,followTarget:null,smoothTransitions:!0}),[wt,St]=reactExports.useState({alpha:null,beta:null,gamma:null,supported:!1,permissionGranted:!1}),[At,Rt]=reactExports.useState(new Map),Pt=reactExports.useRef(),Ct=reactExports.useRef(xt);reactExports.useEffect(()=>{const Ut="DeviceMotionEvent"in window;St(jt=>({...jt,supported:Ut})),Ut&&/Mobile|Android|iOS/.test(navigator.userAgent)&&It()},[]);const It=reactExports.useCallback(async()=>{if(!wt.supported)return!1;try{if(typeof DeviceMotionEvent.requestPermission=="function"){const jt=await DeviceMotionEvent.requestPermission()==="granted";return St(Ht=>({...Ht,permissionGranted:jt})),jt&&Et(Ht=>({...Ht,enableGyroscope:!0})),jt}else return St(Ut=>({...Ut,permissionGranted:!0})),Et(Ut=>({...Ut,enableGyroscope:!0})),!0}catch(Ut){return console.warn("Gyroscope permission denied:",Ut),!1}},[wt.supported]),Mt=reactExports.useCallback(async()=>{if(!("xr"in navigator))return console.warn("WebXR not supported"),!1;try{if(!await navigator.xr.isSessionSupported("immersive-vr"))return console.warn("VR not supported"),!1;const jt=await navigator.xr.requestSession("immersive-vr");return Et(Ht=>({...Ht,enableVR:!0})),jt.addEventListener("end",()=>{Et(Ht=>({...Ht,enableVR:!1}))}),!0}catch(Ut){return console.warn("VR session request failed:",Ut),!1}},[]);reactExports.useEffect(()=>{if(!Tt.enableGyroscope||!wt.permissionGranted)return;const Ut=jt=>{jt.rotationRate&&(St(Ht=>({...Ht,alpha:jt.rotationRate.alpha,beta:jt.rotationRate.beta,gamma:jt.rotationRate.gamma})),jt.rotationRate.alpha!==null&&jt.rotationRate.beta!==null&&bt(Ht=>({...Ht,bearing:Ht.bearing+(jt.rotationRate.alpha||0)*.1,pitch:Math.max(0,Math.min(60,Ht.pitch+(jt.rotationRate.beta||0)*.1))})))};return window.addEventListener("devicemotion",Ut),()=>window.removeEventListener("devicemotion",Ut)},[Tt.enableGyroscope,wt.permissionGranted]),reactExports.useEffect(()=>{if(!Tt.followTarget){Pt.current&&cancelAnimationFrame(Pt.current);return}const Ut=At.get(Tt.followTarget);if(!Ut)return;const jt=()=>{const[Ht,Vt,Wt]=Ut.position,Yt=Ht/111320,Kt=Vt/110540;bt(Zt=>({...Zt,longitude:Zt.longitude+(Yt-Zt.longitude)*.05,latitude:Zt.latitude+(Kt-Zt.latitude)*.05,zoom:Ut.type==="aircraft"?12:Ut.type==="vehicle"?16:18,pitch:Wt>50?60:45})),Pt.current=requestAnimationFrame(jt)};return jt(),()=>{Pt.current&&cancelAnimationFrame(Pt.current)}},[Tt.followTarget,At]);const Ot=reactExports.useCallback((Ut,jt,Ht)=>{Rt(Vt=>new Map(Vt.set(Ut,{id:Ut,position:jt,type:Ht})))},[]),kt=reactExports.useCallback(Ut=>{Et(jt=>({...jt,followTarget:Ut})),Ct.current=vt},[vt]),Ft=reactExports.useCallback(()=>{Et(Ut=>({...Ut,followTarget:null}))},[]),Nt=reactExports.useCallback(async()=>{if(Tt.enableGyroscope)Et(Ut=>({...Ut,enableGyroscope:!1}));else if(!await It())return!1;return!0},[Tt.enableGyroscope,It]),Lt=reactExports.useCallback(async()=>Tt.enableVR?(Et(Ut=>({...Ut,enableVR:!1})),!0):await Mt(),[Tt.enableVR,Mt]),Dt=reactExports.useCallback((Ut,jt=1e3)=>Tt.smoothTransitions?new Promise(Ht=>{const Vt=Date.now(),Wt=vt,Yt=()=>{const Kt=Date.now()-Vt,Zt=Math.min(Kt/jt,1),Xt=cubicEaseOut(Zt);bt(en=>{const nn={...en};return Object.entries(Ut).forEach(([rn,qt])=>{if(qt!==void 0&&rn in Wt){const Gt=Wt[rn],Qt=qt-Gt;nn[rn]=Gt+Qt*Xt}}),nn}),Zt<1?requestAnimationFrame(Yt):Ht()};Yt()}):(bt(Ht=>({...Ht,...Ut})),Promise.resolve()),[vt,Tt.smoothTransitions]),$t={overview:()=>Dt({...vt,zoom:12,pitch:45,bearing:0}),street:()=>Dt({...vt,zoom:18,pitch:0,bearing:0}),aerial:()=>Dt({...vt,zoom:10,pitch:75,bearing:0}),underground:()=>Dt({...vt,zoom:16,pitch:60,bearing:0}),isometric:()=>Dt({...vt,zoom:14,pitch:45,bearing:45})};return{viewState:{longitude:vt.longitude??-74.006,latitude:vt.latitude??40.7128,zoom:vt.zoom??12,pitch:vt.pitch??45,bearing:vt.bearing??0},setViewState:bt,controls:Tt,setControls:Et,deviceMotion:wt,followTargets:At,updateFollowTarget:Ot,startFollowing:kt,stopFollowing:Ft,toggleGyroscope:Nt,toggleVR:Lt,smoothTransitionTo:Dt,presets:$t,capabilities:{hasGyroscope:wt.supported,hasVR:"xr"in navigator,gyroscopeEnabled:Tt.enableGyroscope&&wt.permissionGranted,vrEnabled:Tt.enableVR}}}function assert$6(xt,yt){if(!xt)throw new Error(yt||"loader assertion failed.")}const isBrowser$2=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),matches$1=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);matches$1&&parseFloat(matches$1[1]);const window_=globalThis,process_=globalThis.process||{},navigator_=globalThis.navigator||{};function isElectron(xt){var bt,Tt;if(typeof window<"u"&&((bt=window.process)==null?void 0:bt.type)==="renderer"||typeof process<"u"&&((Tt=process.versions)!=null&&Tt.electron))return!0;const vt=typeof navigator<"u"&&navigator.userAgent;return!!(vt&&vt.indexOf("Electron")>=0)}function isBrowser$1(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||isElectron()}function getBrowser(xt){return isBrowser$1()?isElectron()?"Electron":(navigator_.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const VERSION$4="4.1.0";function getStorage(xt){try{const yt=window[xt],vt="__storage_test__";return yt.setItem(vt,vt),yt.removeItem(vt),yt}catch{return null}}class LocalStorage{constructor(yt,vt,bt="sessionStorage"){this.storage=getStorage(bt),this.id=yt,this.config=vt,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(yt){if(Object.assign(this.config,yt),this.storage){const vt=JSON.stringify(this.config);this.storage.setItem(this.id,vt)}}_loadConfiguration(){let yt={};if(this.storage){const vt=this.storage.getItem(this.id);yt=vt?JSON.parse(vt):{}}return Object.assign(this.config,yt),this}}function formatTime(xt){let yt;return xt<10?yt=`${xt.toFixed(2)}ms`:xt<100?yt=`${xt.toFixed(1)}ms`:xt<1e3?yt=`${xt.toFixed(0)}ms`:yt=`${(xt/1e3).toFixed(2)}s`,yt}function leftPad(xt,yt=8){const vt=Math.max(yt-xt.length,0);return`${" ".repeat(vt)}${xt}`}var COLOR;(function(xt){xt[xt.BLACK=30]="BLACK",xt[xt.RED=31]="RED",xt[xt.GREEN=32]="GREEN",xt[xt.YELLOW=33]="YELLOW",xt[xt.BLUE=34]="BLUE",xt[xt.MAGENTA=35]="MAGENTA",xt[xt.CYAN=36]="CYAN",xt[xt.WHITE=37]="WHITE",xt[xt.BRIGHT_BLACK=90]="BRIGHT_BLACK",xt[xt.BRIGHT_RED=91]="BRIGHT_RED",xt[xt.BRIGHT_GREEN=92]="BRIGHT_GREEN",xt[xt.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",xt[xt.BRIGHT_BLUE=94]="BRIGHT_BLUE",xt[xt.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",xt[xt.BRIGHT_CYAN=96]="BRIGHT_CYAN",xt[xt.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(COLOR||(COLOR={}));const BACKGROUND_INCREMENT=10;function getColor(xt){return typeof xt!="string"?xt:(xt=xt.toUpperCase(),COLOR[xt]||COLOR.WHITE)}function addColor(xt,yt,vt){return!isBrowser$1&&typeof xt=="string"&&(yt&&(xt=`\x1B[${getColor(yt)}m${xt}\x1B[39m`),vt&&(xt=`\x1B[${getColor(vt)+BACKGROUND_INCREMENT}m${xt}\x1B[49m`)),xt}function autobind(xt,yt=["constructor"]){const vt=Object.getPrototypeOf(xt),bt=Object.getOwnPropertyNames(vt),Tt=xt;for(const Et of bt){const wt=Tt[Et];typeof wt=="function"&&(yt.find(St=>Et===St)||(Tt[Et]=wt.bind(xt)))}}function assert$5(xt,yt){if(!xt)throw new Error("Assertion failed")}function getHiResTimestamp$1(){var yt,vt,bt;let xt;if(isBrowser$1()&&window_.performance)xt=(vt=(yt=window_==null?void 0:window_.performance)==null?void 0:yt.now)==null?void 0:vt.call(yt);else if("hrtime"in process_){const Tt=(bt=process_==null?void 0:process_.hrtime)==null?void 0:bt.call(process_);xt=Tt[0]*1e3+Tt[1]/1e6}else xt=Date.now();return xt}const originalConsole={debug:isBrowser$1()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},DEFAULT_LOG_CONFIGURATION={enabled:!0,level:0};function noop$3(){}const cache$1={},ONCE={once:!0};class Log{constructor({id:yt}={id:""}){this.VERSION=VERSION$4,this._startTs=getHiResTimestamp$1(),this._deltaTs=getHiResTimestamp$1(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=yt,this.userData={},this._storage=new LocalStorage(`__probe-${this.id}__`,DEFAULT_LOG_CONFIGURATION),this.timeStamp(`${this.id} started`),autobind(this),Object.seal(this)}set level(yt){this.setLevel(yt)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((getHiResTimestamp$1()-this._startTs).toPrecision(10))}getDelta(){return Number((getHiResTimestamp$1()-this._deltaTs).toPrecision(10))}set priority(yt){this.level=yt}get priority(){return this.level}getPriority(){return this.level}enable(yt=!0){return this._storage.setConfiguration({enabled:yt}),this}setLevel(yt){return this._storage.setConfiguration({level:yt}),this}get(yt){return this._storage.config[yt]}set(yt,vt){this._storage.setConfiguration({[yt]:vt})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(yt,vt){if(!yt)throw new Error(vt||"Assertion failed")}warn(yt){return this._getLogFunction(0,yt,originalConsole.warn,arguments,ONCE)}error(yt){return this._getLogFunction(0,yt,originalConsole.error,arguments)}deprecated(yt,vt){return this.warn(`\`${yt}\` is deprecated and will be removed in a later version. Use \`${vt}\` instead`)}removed(yt,vt){return this.error(`\`${yt}\` has been removed. Use \`${vt}\` instead`)}probe(yt,vt){return this._getLogFunction(yt,vt,originalConsole.log,arguments,{time:!0,once:!0})}log(yt,vt){return this._getLogFunction(yt,vt,originalConsole.debug,arguments)}info(yt,vt){return this._getLogFunction(yt,vt,console.info,arguments)}once(yt,vt){return this._getLogFunction(yt,vt,originalConsole.debug||originalConsole.info,arguments,ONCE)}table(yt,vt,bt){return vt?this._getLogFunction(yt,vt,console.table||noop$3,bt&&[bt],{tag:getTableHeader(vt)}):noop$3}time(yt,vt){return this._getLogFunction(yt,vt,console.time?console.time:console.info)}timeEnd(yt,vt){return this._getLogFunction(yt,vt,console.timeEnd?console.timeEnd:console.info)}timeStamp(yt,vt){return this._getLogFunction(yt,vt,console.timeStamp||noop$3)}group(yt,vt,bt={collapsed:!1}){const Tt=normalizeArguments({logLevel:yt,message:vt,opts:bt}),{collapsed:Et}=bt;return Tt.method=(Et?console.groupCollapsed:console.group)||console.info,this._getLogFunction(Tt)}groupCollapsed(yt,vt,bt={}){return this.group(yt,vt,Object.assign({},bt,{collapsed:!0}))}groupEnd(yt){return this._getLogFunction(yt,"",console.groupEnd||noop$3)}withGroup(yt,vt,bt){this.group(yt,vt)();try{bt()}finally{this.groupEnd(yt)()}}trace(){console.trace&&console.trace()}_shouldLog(yt){return this.isEnabled()&&this.getLevel()>=normalizeLogLevel(yt)}_getLogFunction(yt,vt,bt,Tt,Et){if(this._shouldLog(yt)){Et=normalizeArguments({logLevel:yt,message:vt,args:Tt,opts:Et}),bt=bt||Et.method,assert$5(bt),Et.total=this.getTotal(),Et.delta=this.getDelta(),this._deltaTs=getHiResTimestamp$1();const wt=Et.tag||Et.message;if(Et.once&&wt)if(!cache$1[wt])cache$1[wt]=getHiResTimestamp$1();else return noop$3;return vt=decorateMessage(this.id,Et.message,Et),bt.bind(console,vt,...Et.args)}return noop$3}}Log.VERSION=VERSION$4;function normalizeLogLevel(xt){if(!xt)return 0;let yt;switch(typeof xt){case"number":yt=xt;break;case"object":yt=xt.logLevel||xt.priority||0;break;default:return 0}return assert$5(Number.isFinite(yt)&&yt>=0),yt}function normalizeArguments(xt){const{logLevel:yt,message:vt}=xt;xt.logLevel=normalizeLogLevel(yt);const bt=xt.args?Array.from(xt.args):[];for(;bt.length&&bt.shift()!==vt;);switch(typeof yt){case"string":case"function":vt!==void 0&&bt.unshift(vt),xt.message=yt;break;case"object":Object.assign(xt,yt);break}typeof xt.message=="function"&&(xt.message=xt.message());const Tt=typeof xt.message;return assert$5(Tt==="string"||Tt==="object"),Object.assign(xt,{args:bt},xt.opts)}function decorateMessage(xt,yt,vt){if(typeof yt=="string"){const bt=vt.time?leftPad(formatTime(vt.total)):"";yt=vt.time?`${xt}: ${bt}  ${yt}`:`${xt}: ${yt}`,yt=addColor(yt,vt.color,vt.background)}return yt}function getTableHeader(xt){for(const yt in xt)for(const vt in xt[yt])return vt||"untitled";return"empty"}const VERSION$3="4.3.3",version=VERSION$3[0]>="0"&&VERSION$3[0]<="9"?`v${VERSION$3}`:"";function createLog(){const xt=new Log({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=xt,globalThis.loaders.version=version,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=xt,xt}const log$1=createLog();function mergeLoaderOptions(xt,yt){return mergeOptionsRecursively(xt||{},yt)}function mergeOptionsRecursively(xt,yt,vt=0){if(vt>3)return yt;const bt={...xt};for(const[Tt,Et]of Object.entries(yt))Et&&typeof Et=="object"&&!Array.isArray(Et)?bt[Tt]=mergeOptionsRecursively(bt[Tt]||{},yt[Tt],vt+1):bt[Tt]=yt[Tt];return bt}const NPM_TAG="latest";function getVersion(){var xt;return(xt=globalThis._loadersgl_)!=null&&xt.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const VERSION$2=getVersion();function assert$4(xt,yt){if(!xt)throw new Error(yt||"loaders.gl assertion failed.")}const isBrowser=typeof process!="object"||String(process)!=="[object process]"||process.browser,isMobile=typeof window<"u"&&typeof window.orientation<"u",matches=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);matches&&parseFloat(matches[1]);class WorkerJob{constructor(yt,vt){Bt(this,"name");Bt(this,"workerThread");Bt(this,"isRunning",!0);Bt(this,"result");Bt(this,"_resolve",()=>{});Bt(this,"_reject",()=>{});this.name=yt,this.workerThread=vt,this.result=new Promise((bt,Tt)=>{this._resolve=bt,this._reject=Tt})}postMessage(yt,vt){this.workerThread.postMessage({source:"loaders.gl",type:yt,payload:vt})}done(yt){assert$4(this.isRunning),this.isRunning=!1,this._resolve(yt)}error(yt){assert$4(this.isRunning),this.isRunning=!1,this._reject(yt)}}class NodeWorker{terminate(){}}const workerURLCache=new Map;function getLoadableWorkerURL(xt){assert$4(xt.source&&!xt.url||!xt.source&&xt.url);let yt=workerURLCache.get(xt.source||xt.url);return yt||(xt.url&&(yt=getLoadableWorkerURLFromURL(xt.url),workerURLCache.set(xt.url,yt)),xt.source&&(yt=getLoadableWorkerURLFromSource(xt.source),workerURLCache.set(xt.source,yt))),assert$4(yt),yt}function getLoadableWorkerURLFromURL(xt){if(!xt.startsWith("http"))return xt;const yt=buildScriptSource(xt);return getLoadableWorkerURLFromSource(yt)}function getLoadableWorkerURLFromSource(xt){const yt=new Blob([xt],{type:"application/javascript"});return URL.createObjectURL(yt)}function buildScriptSource(xt){return`try {
  importScripts('${xt}');
} catch (error) {
  console.error(error);
  throw error;
}`}function getTransferList(xt,yt=!0,vt){const bt=vt||new Set;if(xt){if(isTransferable(xt))bt.add(xt);else if(isTransferable(xt.buffer))bt.add(xt.buffer);else if(!ArrayBuffer.isView(xt)){if(yt&&typeof xt=="object")for(const Tt in xt)getTransferList(xt[Tt],yt,bt)}}return vt===void 0?Array.from(bt):[]}function isTransferable(xt){return xt?xt instanceof ArrayBuffer||typeof MessagePort<"u"&&xt instanceof MessagePort||typeof ImageBitmap<"u"&&xt instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&xt instanceof OffscreenCanvas:!1}const NOOP=()=>{};class WorkerThread{constructor(yt){Bt(this,"name");Bt(this,"source");Bt(this,"url");Bt(this,"terminated",!1);Bt(this,"worker");Bt(this,"onMessage");Bt(this,"onError");Bt(this,"_loadableURL","");const{name:vt,source:bt,url:Tt}=yt;assert$4(bt||Tt),this.name=vt,this.source=bt,this.url=Tt,this.onMessage=NOOP,this.onError=Et=>console.log(Et),this.worker=isBrowser?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&isBrowser||typeof NodeWorker<"u"&&!isBrowser}destroy(){this.onMessage=NOOP,this.onError=NOOP,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(yt,vt){vt=vt||getTransferList(yt),this.worker.postMessage(yt,vt)}_getErrorFromErrorEvent(yt){let vt="Failed to load ";return vt+=`worker ${this.name} from ${this.url}. `,yt.message&&(vt+=`${yt.message} in `),yt.lineno&&(vt+=`:${yt.lineno}:${yt.colno}`),new Error(vt)}_createBrowserWorker(){this._loadableURL=getLoadableWorkerURL({source:this.source,url:this.url});const yt=new Worker(this._loadableURL,{name:this.name});return yt.onmessage=vt=>{vt.data?this.onMessage(vt.data):this.onError(new Error("No data received"))},yt.onerror=vt=>{this.onError(this._getErrorFromErrorEvent(vt)),this.terminated=!0},yt.onmessageerror=vt=>console.error(vt),yt}_createNodeWorker(){let yt;if(this.url){const bt=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;yt=new NodeWorker(bt,{eval:!1})}else if(this.source)yt=new NodeWorker(this.source,{eval:!0});else throw new Error("no worker");return yt.on("message",vt=>{this.onMessage(vt)}),yt.on("error",vt=>{this.onError(vt)}),yt.on("exit",vt=>{}),yt}}class WorkerPool{constructor(yt){Bt(this,"name","unnamed");Bt(this,"source");Bt(this,"url");Bt(this,"maxConcurrency",1);Bt(this,"maxMobileConcurrency",1);Bt(this,"onDebug",()=>{});Bt(this,"reuseWorkers",!0);Bt(this,"props",{});Bt(this,"jobQueue",[]);Bt(this,"idleQueue",[]);Bt(this,"count",0);Bt(this,"isDestroyed",!1);this.source=yt.source,this.url=yt.url,this.setProps(yt)}static isSupported(){return WorkerThread.isSupported()}destroy(){this.idleQueue.forEach(yt=>yt.destroy()),this.isDestroyed=!0}setProps(yt){this.props={...this.props,...yt},yt.name!==void 0&&(this.name=yt.name),yt.maxConcurrency!==void 0&&(this.maxConcurrency=yt.maxConcurrency),yt.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=yt.maxMobileConcurrency),yt.reuseWorkers!==void 0&&(this.reuseWorkers=yt.reuseWorkers),yt.onDebug!==void 0&&(this.onDebug=yt.onDebug)}async startJob(yt,vt=(Tt,Et,wt)=>Tt.done(wt),bt=(Tt,Et)=>Tt.error(Et)){const Tt=new Promise(Et=>(this.jobQueue.push({name:yt,onMessage:vt,onError:bt,onStart:Et}),this));return this._startQueuedJob(),await Tt}async _startQueuedJob(){if(!this.jobQueue.length)return;const yt=this._getAvailableWorker();if(!yt)return;const vt=this.jobQueue.shift();if(vt){this.onDebug({message:"Starting job",name:vt.name,workerThread:yt,backlog:this.jobQueue.length});const bt=new WorkerJob(vt.name,yt);yt.onMessage=Tt=>vt.onMessage(bt,Tt.type,Tt.payload),yt.onError=Tt=>vt.onError(bt,Tt),vt.onStart(bt);try{await bt.result}catch(Tt){console.error(`Worker exception: ${Tt}`)}finally{this.returnWorkerToQueue(yt)}}}returnWorkerToQueue(yt){!isBrowser||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(yt.destroy(),this.count--):this.idleQueue.push(yt),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const yt=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new WorkerThread({name:yt,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return isMobile?this.maxMobileConcurrency:this.maxConcurrency}}const DEFAULT_PROPS$1={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},cn=class cn{constructor(yt){Bt(this,"props");Bt(this,"workerPools",new Map);this.props={...DEFAULT_PROPS$1},this.setProps(yt),this.workerPools=new Map}static isSupported(){return WorkerThread.isSupported()}static getWorkerFarm(yt={}){return cn._workerFarm=cn._workerFarm||new cn({}),cn._workerFarm.setProps(yt),cn._workerFarm}destroy(){for(const yt of this.workerPools.values())yt.destroy();this.workerPools=new Map}setProps(yt){this.props={...this.props,...yt};for(const vt of this.workerPools.values())vt.setProps(this._getWorkerPoolProps())}getWorkerPool(yt){const{name:vt,source:bt,url:Tt}=yt;let Et=this.workerPools.get(vt);return Et||(Et=new WorkerPool({name:vt,source:bt,url:Tt}),Et.setProps(this._getWorkerPoolProps()),this.workerPools.set(vt,Et)),Et}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};Bt(cn,"_workerFarm");let WorkerFarm=cn;function getWorkerURL(xt,yt={}){const vt=yt[xt.id]||{},bt=isBrowser?`${xt.id}-worker.js`:`${xt.id}-worker-node.js`;let Tt=vt.workerUrl;if(!Tt&&xt.id==="compression"&&(Tt=yt.workerUrl),yt._workerType==="test"&&(isBrowser?Tt=`modules/${xt.module}/dist/${bt}`:Tt=`modules/${xt.module}/src/workers/${xt.id}-worker-node.ts`),!Tt){let Et=xt.version;Et==="latest"&&(Et=NPM_TAG);const wt=Et?`@${Et}`:"";Tt=`https://unpkg.com/@loaders.gl/${xt.module}${wt}/dist/${bt}`}return assert$4(Tt),Tt}function validateWorkerVersion(xt,yt=VERSION$2){assert$4(xt,"no worker provided");const vt=xt.version;return!(!yt||!vt)}function canParseWithWorker(xt,yt){return!WorkerFarm.isSupported()||!isBrowser&&!(yt!=null&&yt._nodeWorkers)?!1:xt.worker&&(yt==null?void 0:yt.worker)}async function parseWithWorker(xt,yt,vt,bt,Tt){const Et=xt.id,wt=getWorkerURL(xt,vt),At=WorkerFarm.getWorkerFarm(vt).getWorkerPool({name:Et,url:wt});vt=JSON.parse(JSON.stringify(vt)),bt=JSON.parse(JSON.stringify(bt||{}));const Rt=await At.startJob("process-on-worker",onMessage.bind(null,Tt));return Rt.postMessage("process",{input:yt,options:vt,context:bt}),await(await Rt.result).result}async function onMessage(xt,yt,vt,bt){switch(vt){case"done":yt.done(bt);break;case"error":yt.error(new Error(bt.error));break;case"process":const{id:Tt,input:Et,options:wt}=bt;try{const St=await xt(Et,wt);yt.postMessage("done",{id:Tt,result:St})}catch(St){const At=St instanceof Error?St.message:"unknown error";yt.postMessage("error",{id:Tt,error:At})}break;default:console.warn(`parse-with-worker unknown message ${vt}`)}}function compareArrayBuffers(xt,yt,vt){if(vt=vt||xt.byteLength,xt.byteLength<vt||yt.byteLength<vt)return!1;const bt=new Uint8Array(xt),Tt=new Uint8Array(yt);for(let Et=0;Et<bt.length;++Et)if(bt[Et]!==Tt[Et])return!1;return!0}function concatenateArrayBuffers(...xt){return concatenateArrayBuffersFromArray(xt)}function concatenateArrayBuffersFromArray(xt){const yt=xt.map(Et=>Et instanceof ArrayBuffer?new Uint8Array(Et):Et),vt=yt.reduce((Et,wt)=>Et+wt.byteLength,0),bt=new Uint8Array(vt);let Tt=0;for(const Et of yt)bt.set(Et,Tt),Tt+=Et.byteLength;return bt.buffer}async function concatenateArrayBuffersAsync(xt){const yt=[];for await(const vt of xt)yt.push(vt);return concatenateArrayBuffers(...yt)}function getHiResTimestamp(){let xt;if(typeof window<"u"&&window.performance)xt=window.performance.now();else if(typeof process<"u"&&process.hrtime){const yt=process.hrtime();xt=yt[0]*1e3+yt[1]/1e6}else xt=Date.now();return xt}class Stat{constructor(yt,vt){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=yt,this.type=vt,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(yt){return this.sampleSize=yt,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(yt){return this._count+=yt,this._samples++,this._checkSampling(),this}subtractCount(yt){return this._count-=yt,this._samples++,this._checkSampling(),this}addTime(yt){return this._time+=yt,this.lastTiming=yt,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=getHiResTimestamp(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(getHiResTimestamp()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Stats{constructor(yt){this.stats={},this.id=yt.id,this.stats={},this._initializeStats(yt.stats),Object.seal(this)}get(yt,vt="count"){return this._getOrCreate({name:yt,type:vt})}get size(){return Object.keys(this.stats).length}reset(){for(const yt of Object.values(this.stats))yt.reset();return this}forEach(yt){for(const vt of Object.values(this.stats))yt(vt)}getTable(){const yt={};return this.forEach(vt=>{yt[vt.name]={time:vt.time||0,count:vt.count||0,average:vt.getAverageTime()||0,hz:vt.getHz()||0}}),yt}_initializeStats(yt=[]){yt.forEach(vt=>this._getOrCreate(vt))}_getOrCreate(yt){const{name:vt,type:bt}=yt;let Tt=this.stats[vt];return Tt||(yt instanceof Stat?Tt=yt:Tt=new Stat(vt,bt),this.stats[vt]=Tt),Tt}}let pathPrefix$1="";const fileAliases={};function resolvePath(xt){for(const yt in fileAliases)if(xt.startsWith(yt)){const vt=fileAliases[yt];xt=xt.replace(yt,vt)}return!xt.startsWith("http://")&&!xt.startsWith("https://")&&(xt=`${pathPrefix$1}${xt}`),xt}function toArrayBuffer$1(xt){return xt}function isBuffer$1(xt){return xt&&typeof xt=="object"&&xt.isBuffer}function toArrayBuffer(xt){if(isBuffer$1(xt))return xt;if(xt instanceof ArrayBuffer)return xt;if(ArrayBuffer.isView(xt))return xt.byteOffset===0&&xt.byteLength===xt.buffer.byteLength?xt.buffer:xt.buffer.slice(xt.byteOffset,xt.byteOffset+xt.byteLength);if(typeof xt=="string"){const yt=xt;return new TextEncoder().encode(yt).buffer}if(xt&&typeof xt=="object"&&xt._toArrayBuffer)return xt._toArrayBuffer();throw new Error("toArrayBuffer")}function filename(xt){const yt=xt?xt.lastIndexOf("/"):-1;return yt>=0?xt.substr(yt+1):""}function dirname(xt){const yt=xt?xt.lastIndexOf("/"):-1;return yt>=0?xt.substr(0,yt):""}const isBoolean=xt=>typeof xt=="boolean",isFunction=xt=>typeof xt=="function",isObject$1=xt=>xt!==null&&typeof xt=="object",isPureObject=xt=>isObject$1(xt)&&xt.constructor==={}.constructor,isIterable=xt=>!!xt&&typeof xt[Symbol.iterator]=="function",isAsyncIterable$1=xt=>xt&&typeof xt[Symbol.asyncIterator]=="function",isResponse=xt=>typeof Response<"u"&&xt instanceof Response||xt&&xt.arrayBuffer&&xt.text&&xt.json,isBlob=xt=>typeof Blob<"u"&&xt instanceof Blob,isBuffer=xt=>xt&&typeof xt=="object"&&xt.isBuffer,isReadableDOMStream=xt=>typeof ReadableStream<"u"&&xt instanceof ReadableStream||isObject$1(xt)&&isFunction(xt.tee)&&isFunction(xt.cancel)&&isFunction(xt.getReader),isReadableNodeStream=xt=>isObject$1(xt)&&isFunction(xt.read)&&isFunction(xt.pipe)&&isBoolean(xt.readable),isReadableStream=xt=>isReadableDOMStream(xt)||isReadableNodeStream(xt);class FetchError extends Error{constructor(vt,bt){super(vt);Bt(this,"reason");Bt(this,"url");Bt(this,"response");this.reason=bt.reason,this.url=bt.url,this.response=bt.response}}const DATA_URL_PATTERN=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,MIME_TYPE_PATTERN=/^([-\w.]+\/[-\w.+]+)/;function compareMIMETypes(xt,yt){return xt.toLowerCase()===yt.toLowerCase()}function parseMIMEType(xt){const yt=MIME_TYPE_PATTERN.exec(xt);return yt?yt[1]:xt}function parseMIMETypeFromURL(xt){const yt=DATA_URL_PATTERN.exec(xt);return yt?yt[1]:""}const QUERY_STRING_PATTERN=/\?.*/;function extractQueryString(xt){const yt=xt.match(QUERY_STRING_PATTERN);return yt&&yt[0]}function stripQueryString(xt){return xt.replace(QUERY_STRING_PATTERN,"")}function shortenUrlForDisplay(xt){if(xt.length<50)return xt;const yt=xt.slice(xt.length-15);return`${xt.substr(0,32)}...${yt}`}function getResourceUrl(xt){return isResponse(xt)?xt.url:isBlob(xt)?xt.name||"":typeof xt=="string"?xt:""}function getResourceMIMEType(xt){if(isResponse(xt)){const yt=xt,vt=yt.headers.get("content-type")||"",bt=stripQueryString(yt.url);return parseMIMEType(vt)||parseMIMETypeFromURL(bt)}return isBlob(xt)?xt.type||"":typeof xt=="string"?parseMIMETypeFromURL(xt):""}function getResourceContentLength(xt){return isResponse(xt)?xt.headers["content-length"]||-1:isBlob(xt)?xt.size:typeof xt=="string"?xt.length:xt instanceof ArrayBuffer||ArrayBuffer.isView(xt)?xt.byteLength:-1}async function makeResponse(xt){if(isResponse(xt))return xt;const yt={},vt=getResourceContentLength(xt);vt>=0&&(yt["content-length"]=String(vt));const bt=getResourceUrl(xt),Tt=getResourceMIMEType(xt);Tt&&(yt["content-type"]=Tt);const Et=await getInitialDataUrl(xt);Et&&(yt["x-first-bytes"]=Et),typeof xt=="string"&&(xt=new TextEncoder().encode(xt));const wt=new Response(xt,{headers:yt});return Object.defineProperty(wt,"url",{value:bt}),wt}async function checkResponse(xt){if(!xt.ok)throw await getResponseError(xt)}async function getResponseError(xt){const yt=shortenUrlForDisplay(xt.url);let vt=`Failed to fetch resource (${xt.status}) ${xt.statusText}: ${yt}`;vt=vt.length>100?`${vt.slice(0,100)}...`:vt;const bt={reason:xt.statusText,url:xt.url,response:xt};try{const Tt=xt.headers.get("Content-Type");bt.reason=!xt.bodyUsed&&(Tt!=null&&Tt.includes("application/json"))?await xt.json():await xt.text()}catch{}return new FetchError(vt,bt)}async function getInitialDataUrl(xt){if(typeof xt=="string")return`data:,${xt.slice(0,5)}`;if(xt instanceof Blob){const vt=xt.slice(0,5);return await new Promise(bt=>{const Tt=new FileReader;Tt.onload=Et=>{var wt;return bt((wt=Et==null?void 0:Et.target)==null?void 0:wt.result)},Tt.readAsDataURL(vt)})}if(xt instanceof ArrayBuffer){const vt=xt.slice(0,5);return`data:base64,${arrayBufferToBase64(vt)}`}return null}function arrayBufferToBase64(xt){let yt="";const vt=new Uint8Array(xt);for(let bt=0;bt<vt.byteLength;bt++)yt+=String.fromCharCode(vt[bt]);return btoa(yt)}function isNodePath(xt){return!isRequestURL(xt)&&!isDataURL(xt)}function isRequestURL(xt){return xt.startsWith("http:")||xt.startsWith("https:")}function isDataURL(xt){return xt.startsWith("data:")}async function fetchFile(xt,yt){var vt,bt;if(typeof xt=="string"){const Tt=resolvePath(xt);return isNodePath(Tt)&&(vt=globalThis.loaders)!=null&&vt.fetchNode?(bt=globalThis.loaders)==null?void 0:bt.fetchNode(Tt,yt):await fetch(Tt,yt)}return await makeResponse(xt)}const probeLog=new Log({id:"loaders.gl"});class NullLog{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class ConsoleLog{constructor(){Bt(this,"console");this.console=console}log(...yt){return this.console.log.bind(this.console,...yt)}info(...yt){return this.console.info.bind(this.console,...yt)}warn(...yt){return this.console.warn.bind(this.console,...yt)}error(...yt){return this.console.error.bind(this.console,...yt)}}const DEFAULT_LOADER_OPTIONS={fetch:null,mimeType:void 0,nothrow:!1,log:new ConsoleLog,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:isBrowser$2,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},REMOVED_LOADER_OPTIONS={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function getGlobalLoaderState(){globalThis.loaders=globalThis.loaders||{};const{loaders:xt}=globalThis;return xt._state||(xt._state={}),xt._state}function getGlobalLoaderOptions(){const xt=getGlobalLoaderState();return xt.globalOptions=xt.globalOptions||{...DEFAULT_LOADER_OPTIONS},xt.globalOptions}function normalizeOptions(xt,yt,vt,bt){return vt=vt||[],vt=Array.isArray(vt)?vt:[vt],validateOptions(xt,vt),normalizeOptionsInternal(yt,xt,bt)}function validateOptions(xt,yt){validateOptionsObject(xt,null,DEFAULT_LOADER_OPTIONS,REMOVED_LOADER_OPTIONS,yt);for(const vt of yt){const bt=xt&&xt[vt.id]||{},Tt=vt.options&&vt.options[vt.id]||{},Et=vt.deprecatedOptions&&vt.deprecatedOptions[vt.id]||{};validateOptionsObject(bt,vt.id,Tt,Et,yt)}}function validateOptionsObject(xt,yt,vt,bt,Tt){const Et=yt||"Top level",wt=yt?`${yt}.`:"";for(const St in xt){const At=!yt&&isObject$1(xt[St]),Rt=St==="baseUri"&&!yt,Pt=St==="workerUrl"&&yt;if(!(St in vt)&&!Rt&&!Pt){if(St in bt)probeLog.warn(`${Et} loader option '${wt}${St}' no longer supported, use '${bt[St]}'`)();else if(!At){const Ct=findSimilarOption(St,Tt);probeLog.warn(`${Et} loader option '${wt}${St}' not recognized. ${Ct}`)()}}}}function findSimilarOption(xt,yt){const vt=xt.toLowerCase();let bt="";for(const Tt of yt)for(const Et in Tt.options){if(xt===Et)return`Did you mean '${Tt.id}.${Et}'?`;const wt=Et.toLowerCase();(vt.startsWith(wt)||wt.startsWith(vt))&&(bt=bt||`Did you mean '${Tt.id}.${Et}'?`)}return bt}function normalizeOptionsInternal(xt,yt,vt){const Tt={...xt.options||{}};return addUrlOptions(Tt,vt),Tt.log===null&&(Tt.log=new NullLog),mergeNestedFields(Tt,getGlobalLoaderOptions()),mergeNestedFields(Tt,yt),Tt}function mergeNestedFields(xt,yt){for(const vt in yt)if(vt in yt){const bt=yt[vt];isPureObject(bt)&&isPureObject(xt[vt])?xt[vt]={...xt[vt],...yt[vt]}:xt[vt]=yt[vt]}}function addUrlOptions(xt,yt){yt&&!("baseUri"in xt)&&(xt.baseUri=yt)}function isLoaderObject(xt){return xt?(Array.isArray(xt)&&(xt=xt[0]),Array.isArray(xt==null?void 0:xt.extensions)):!1}function normalizeLoader(xt){assert$6(xt,"null loader"),assert$6(isLoaderObject(xt),"invalid loader");let yt;return Array.isArray(xt)&&(yt=xt[1],xt=xt[0],xt={...xt,options:{...xt.options,...yt}}),(xt!=null&&xt.parseTextSync||xt!=null&&xt.parseText)&&(xt.text=!0),xt.text||(xt.binary=!0),xt}const getGlobalLoaderRegistry=()=>{const xt=getGlobalLoaderState();return xt.loaderRegistry=xt.loaderRegistry||[],xt.loaderRegistry};function registerLoaders(xt){const yt=getGlobalLoaderRegistry();xt=Array.isArray(xt)?xt:[xt];for(const vt of xt){const bt=normalizeLoader(vt);yt.find(Tt=>bt===Tt)||yt.unshift(bt)}}function getRegisteredLoaders(){return getGlobalLoaderRegistry()}const EXT_PATTERN=/\.([^.]+)$/;async function selectLoader(xt,yt=[],vt,bt){if(!validHTTPResponse(xt))return null;let Tt=selectLoaderSync(xt,yt,{...vt,nothrow:!0},bt);if(Tt)return Tt;if(isBlob(xt)&&(xt=await xt.slice(0,10).arrayBuffer(),Tt=selectLoaderSync(xt,yt,vt,bt)),!Tt&&!(vt!=null&&vt.nothrow))throw new Error(getNoValidLoaderMessage(xt));return Tt}function selectLoaderSync(xt,yt=[],vt,bt){if(!validHTTPResponse(xt))return null;if(yt&&!Array.isArray(yt))return normalizeLoader(yt);let Tt=[];yt&&(Tt=Tt.concat(yt)),vt!=null&&vt.ignoreRegisteredLoaders||Tt.push(...getRegisteredLoaders()),normalizeLoaders(Tt);const Et=selectLoaderInternal(xt,Tt,vt,bt);if(!Et&&!(vt!=null&&vt.nothrow))throw new Error(getNoValidLoaderMessage(xt));return Et}function selectLoaderInternal(xt,yt,vt,bt){const Tt=getResourceUrl(xt),Et=getResourceMIMEType(xt),wt=stripQueryString(Tt)||(bt==null?void 0:bt.url);let St=null,At="";return vt!=null&&vt.mimeType&&(St=findLoaderByMIMEType(yt,vt==null?void 0:vt.mimeType),At=`match forced by supplied MIME type ${vt==null?void 0:vt.mimeType}`),St=St||findLoaderByUrl(yt,wt),At=At||(St?`matched url ${wt}`:""),St=St||findLoaderByMIMEType(yt,Et),At=At||(St?`matched MIME type ${Et}`:""),St=St||findLoaderByInitialBytes(yt,xt),At=At||(St?`matched initial data ${getFirstCharacters(xt)}`:""),vt!=null&&vt.fallbackMimeType&&(St=St||findLoaderByMIMEType(yt,vt==null?void 0:vt.fallbackMimeType),At=At||(St?`matched fallback MIME type ${Et}`:"")),At&&log$1.log(1,`selectLoader selected ${St==null?void 0:St.name}: ${At}.`),St}function validHTTPResponse(xt){return!(xt instanceof Response&&xt.status===204)}function getNoValidLoaderMessage(xt){const yt=getResourceUrl(xt),vt=getResourceMIMEType(xt);let bt="No valid loader found (";bt+=yt?`${filename(yt)}, `:"no url provided, ",bt+=`MIME type: ${vt?`"${vt}"`:"not provided"}, `;const Tt=xt?getFirstCharacters(xt):"";return bt+=Tt?` first bytes: "${Tt}"`:"first bytes: not available",bt+=")",bt}function normalizeLoaders(xt){for(const yt of xt)normalizeLoader(yt)}function findLoaderByUrl(xt,yt){const vt=yt&&EXT_PATTERN.exec(yt),bt=vt&&vt[1];return bt?findLoaderByExtension(xt,bt):null}function findLoaderByExtension(xt,yt){yt=yt.toLowerCase();for(const vt of xt)for(const bt of vt.extensions)if(bt.toLowerCase()===yt)return vt;return null}function findLoaderByMIMEType(xt,yt){var vt;for(const bt of xt)if((vt=bt.mimeTypes)!=null&&vt.some(Tt=>compareMIMETypes(yt,Tt))||compareMIMETypes(yt,`application/x.${bt.id}`))return bt;return null}function findLoaderByInitialBytes(xt,yt){if(!yt)return null;for(const vt of xt)if(typeof yt=="string"){if(testDataAgainstText(yt,vt))return vt}else if(ArrayBuffer.isView(yt)){if(testDataAgainstBinary(yt.buffer,yt.byteOffset,vt))return vt}else if(yt instanceof ArrayBuffer&&testDataAgainstBinary(yt,0,vt))return vt;return null}function testDataAgainstText(xt,yt){return yt.testText?yt.testText(xt):(Array.isArray(yt.tests)?yt.tests:[yt.tests]).some(bt=>xt.startsWith(bt))}function testDataAgainstBinary(xt,yt,vt){return(Array.isArray(vt.tests)?vt.tests:[vt.tests]).some(Tt=>testBinary(xt,yt,vt,Tt))}function testBinary(xt,yt,vt,bt){if(bt instanceof ArrayBuffer)return compareArrayBuffers(bt,xt,bt.byteLength);switch(typeof bt){case"function":return bt(xt);case"string":const Tt=getMagicString(xt,yt,bt.length);return bt===Tt;default:return!1}}function getFirstCharacters(xt,yt=5){return typeof xt=="string"?xt.slice(0,yt):ArrayBuffer.isView(xt)?getMagicString(xt.buffer,xt.byteOffset,yt):xt instanceof ArrayBuffer?getMagicString(xt,0,yt):""}function getMagicString(xt,yt,vt){if(xt.byteLength<yt+vt)return"";const bt=new DataView(xt);let Tt="";for(let Et=0;Et<vt;Et++)Tt+=String.fromCharCode(bt.getUint8(yt+Et));return Tt}const DEFAULT_CHUNK_SIZE$2=256*1024;function*makeStringIterator(xt,yt){const vt=(yt==null?void 0:yt.chunkSize)||DEFAULT_CHUNK_SIZE$2;let bt=0;const Tt=new TextEncoder;for(;bt<xt.length;){const Et=Math.min(xt.length-bt,vt),wt=xt.slice(bt,bt+Et);bt+=Et,yield Tt.encode(wt)}}const DEFAULT_CHUNK_SIZE$1=256*1024;function*makeArrayBufferIterator(xt,yt={}){const{chunkSize:vt=DEFAULT_CHUNK_SIZE$1}=yt;let bt=0;for(;bt<xt.byteLength;){const Tt=Math.min(xt.byteLength-bt,vt),Et=new ArrayBuffer(Tt),wt=new Uint8Array(xt,bt,Tt);new Uint8Array(Et).set(wt),bt+=Tt,yield Et}}const DEFAULT_CHUNK_SIZE=1024*1024;async function*makeBlobIterator(xt,yt){const vt=(yt==null?void 0:yt.chunkSize)||DEFAULT_CHUNK_SIZE;let bt=0;for(;bt<xt.size;){const Tt=bt+vt,Et=await xt.slice(bt,Tt).arrayBuffer();bt=Tt,yield Et}}function makeStreamIterator(xt,yt){return isBrowser$2?makeBrowserStreamIterator(xt,yt):makeNodeStreamIterator(xt)}async function*makeBrowserStreamIterator(xt,yt){const vt=xt.getReader();let bt;try{for(;;){const Tt=bt||vt.read();yt!=null&&yt._streamReadAhead&&(bt=vt.read());const{done:Et,value:wt}=await Tt;if(Et)return;yield toArrayBuffer(wt)}}catch{vt.releaseLock()}}async function*makeNodeStreamIterator(xt,yt){for await(const vt of xt)yield toArrayBuffer(vt)}function makeIterator(xt,yt){if(typeof xt=="string")return makeStringIterator(xt,yt);if(xt instanceof ArrayBuffer)return makeArrayBufferIterator(xt,yt);if(isBlob(xt))return makeBlobIterator(xt,yt);if(isReadableStream(xt))return makeStreamIterator(xt,yt);if(isResponse(xt))return makeStreamIterator(xt.body,yt);throw new Error("makeIterator")}const ERR_DATA="Cannot convert supplied data type";function getArrayBufferOrStringFromDataSync(xt,yt,vt){if(yt.text&&typeof xt=="string")return xt;if(isBuffer(xt)&&(xt=xt.buffer),xt instanceof ArrayBuffer){const bt=xt;return yt.text&&!yt.binary?new TextDecoder("utf8").decode(bt):bt}if(ArrayBuffer.isView(xt)){if(yt.text&&!yt.binary)return new TextDecoder("utf8").decode(xt);let bt=xt.buffer;const Tt=xt.byteLength||xt.length;return(xt.byteOffset!==0||Tt!==bt.byteLength)&&(bt=bt.slice(xt.byteOffset,xt.byteOffset+Tt)),bt}throw new Error(ERR_DATA)}async function getArrayBufferOrStringFromData(xt,yt,vt){const bt=xt instanceof ArrayBuffer||ArrayBuffer.isView(xt);if(typeof xt=="string"||bt)return getArrayBufferOrStringFromDataSync(xt,yt);if(isBlob(xt)&&(xt=await makeResponse(xt)),isResponse(xt)){const Tt=xt;return await checkResponse(Tt),yt.binary?await Tt.arrayBuffer():await Tt.text()}if(isReadableStream(xt)&&(xt=makeIterator(xt,vt)),isIterable(xt)||isAsyncIterable$1(xt))return concatenateArrayBuffersAsync(xt);throw new Error(ERR_DATA)}function getFetchFunction(xt,yt){const vt=getGlobalLoaderOptions(),bt=xt||vt;return typeof bt.fetch=="function"?bt.fetch:isObject$1(bt.fetch)?Tt=>fetchFile(Tt,bt.fetch):yt!=null&&yt.fetch?yt==null?void 0:yt.fetch:fetchFile}function getLoaderContext(xt,yt,vt){if(vt)return vt;const bt={fetch:getFetchFunction(yt,xt),...xt};if(bt.url){const Tt=stripQueryString(bt.url);bt.baseUrl=Tt,bt.queryString=extractQueryString(bt.url),bt.filename=filename(Tt),bt.baseUrl=dirname(Tt)}return Array.isArray(bt.loaders)||(bt.loaders=null),bt}function getLoadersFromContext(xt,yt){if(xt&&!Array.isArray(xt))return xt;let vt;if(xt&&(vt=Array.isArray(xt)?xt:[xt]),yt&&yt.loaders){const bt=Array.isArray(yt.loaders)?yt.loaders:[yt.loaders];vt=vt?[...vt,...bt]:bt}return vt&&vt.length?vt:void 0}async function parse(xt,yt,vt,bt){yt&&!Array.isArray(yt)&&!isLoaderObject(yt)&&(bt=void 0,vt=yt,yt=void 0),xt=await xt,vt=vt||{};const Tt=getResourceUrl(xt),wt=getLoadersFromContext(yt,bt),St=await selectLoader(xt,wt,vt);return St?(vt=normalizeOptions(vt,St,wt,Tt),bt=getLoaderContext({url:Tt,_parse:parse,loaders:wt},vt,bt||null),await parseWithLoader(St,xt,vt,bt)):null}async function parseWithLoader(xt,yt,vt,bt){if(validateWorkerVersion(xt),vt=mergeLoaderOptions(xt.options,vt),isResponse(yt)){const Et=yt,{ok:wt,redirected:St,status:At,statusText:Rt,type:Pt,url:Ct}=Et,It=Object.fromEntries(Et.headers.entries());bt.response={headers:It,ok:wt,redirected:St,status:At,statusText:Rt,type:Pt,url:Ct}}yt=await getArrayBufferOrStringFromData(yt,xt,vt);const Tt=xt;if(Tt.parseTextSync&&typeof yt=="string")return Tt.parseTextSync(yt,vt,bt);if(canParseWithWorker(xt,vt))return await parseWithWorker(xt,yt,vt,bt,parse);if(Tt.parseText&&typeof yt=="string")return await Tt.parseText(yt,vt,bt);if(Tt.parse)return await Tt.parse(yt,vt,bt);throw assert$4(!Tt.parseSync),new Error(`${xt.id} loader - no parser found and worker is disabled`)}async function load(xt,yt,vt,bt){let Tt,Et;!Array.isArray(yt)&&!isLoaderObject(yt)?(Tt=[],Et=yt):(Tt=yt,Et=vt);const wt=getFetchFunction(Et);let St=xt;return typeof xt=="string"&&(St=await wt(xt)),isBlob(xt)&&(St=await wt(xt)),Array.isArray(Tt)?await parse(St,Tt,Et):await parse(St,Tt,Et)}const VERSION$1="4.3.3";var Fn;const parseImageNode=(Fn=globalThis.loaders)==null?void 0:Fn.parseImageNode,IMAGE_SUPPORTED=typeof Image<"u",IMAGE_BITMAP_SUPPORTED=typeof ImageBitmap<"u",NODE_IMAGE_SUPPORTED=!!parseImageNode,DATA_SUPPORTED=isBrowser$2?!0:NODE_IMAGE_SUPPORTED;function isImageTypeSupported(xt){switch(xt){case"auto":return IMAGE_BITMAP_SUPPORTED||IMAGE_SUPPORTED||DATA_SUPPORTED;case"imagebitmap":return IMAGE_BITMAP_SUPPORTED;case"image":return IMAGE_SUPPORTED;case"data":return DATA_SUPPORTED;default:throw new Error(`@loaders.gl/images: image ${xt} not supported in this environment`)}}function getDefaultImageType(){if(IMAGE_BITMAP_SUPPORTED)return"imagebitmap";if(IMAGE_SUPPORTED)return"image";if(DATA_SUPPORTED)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function getImageType(xt){const yt=getImageTypeOrNull(xt);if(!yt)throw new Error("Not an image");return yt}function getImageData(xt){switch(getImageType(xt)){case"data":return xt;case"image":case"imagebitmap":const yt=document.createElement("canvas"),vt=yt.getContext("2d");if(!vt)throw new Error("getImageData");return yt.width=xt.width,yt.height=xt.height,vt.drawImage(xt,0,0),vt.getImageData(0,0,xt.width,xt.height);default:throw new Error("getImageData")}}function getImageTypeOrNull(xt){return typeof ImageBitmap<"u"&&xt instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&xt instanceof Image?"image":xt&&typeof xt=="object"&&xt.data&&xt.width&&xt.height?"data":null}const SVG_DATA_URL_PATTERN=/^data:image\/svg\+xml/,SVG_URL_PATTERN=/\.svg((\?|#).*)?$/;function isSVG(xt){return xt&&(SVG_DATA_URL_PATTERN.test(xt)||SVG_URL_PATTERN.test(xt))}function getBlobOrSVGDataUrl(xt,yt){if(isSVG(yt)){let bt=new TextDecoder().decode(xt);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(bt=unescape(encodeURIComponent(bt)))}catch(Et){throw new Error(Et.message)}return`data:image/svg+xml;base64,${btoa(bt)}`}return getBlob(xt,yt)}function getBlob(xt,yt){if(isSVG(yt))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(xt)])}async function parseToImage(xt,yt,vt){const bt=getBlobOrSVGDataUrl(xt,vt),Tt=self.URL||self.webkitURL,Et=typeof bt!="string"&&Tt.createObjectURL(bt);try{return await loadToImage(Et||bt,yt)}finally{Et&&Tt.revokeObjectURL(Et)}}async function loadToImage(xt,yt){const vt=new Image;return vt.src=xt,yt.image&&yt.image.decode&&vt.decode?(await vt.decode(),vt):await new Promise((bt,Tt)=>{try{vt.onload=()=>bt(vt),vt.onerror=Et=>{const wt=Et instanceof Error?Et.message:"error";Tt(new Error(wt))}}catch(Et){Tt(Et)}})}const EMPTY_OBJECT={};let imagebitmapOptionsSupported=!0;async function parseToImageBitmap(xt,yt,vt){let bt;isSVG(vt)?bt=await parseToImage(xt,yt,vt):bt=getBlob(xt,vt);const Tt=yt&&yt.imagebitmap;return await safeCreateImageBitmap(bt,Tt)}async function safeCreateImageBitmap(xt,yt=null){if((isEmptyObject(yt)||!imagebitmapOptionsSupported)&&(yt=null),yt)try{return await createImageBitmap(xt,yt)}catch(vt){console.warn(vt),imagebitmapOptionsSupported=!1}return await createImageBitmap(xt)}function isEmptyObject(xt){for(const yt in xt||EMPTY_OBJECT)return!1;return!0}function getISOBMFFMediaType(xt){return!checkString(xt,"ftyp",4)||!(xt[8]&96)?null:decodeMajorBrand(xt)}function decodeMajorBrand(xt){switch(getUTF8String(xt,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function getUTF8String(xt,yt,vt){return String.fromCharCode(...xt.slice(yt,vt))}function stringToBytes(xt){return[...xt].map(yt=>yt.charCodeAt(0))}function checkString(xt,yt,vt=0){const bt=stringToBytes(yt);for(let Tt=0;Tt<bt.length;++Tt)if(bt[Tt]!==xt[Tt+vt])return!1;return!0}const BIG_ENDIAN=!1,LITTLE_ENDIAN=!0;function getBinaryImageMetadata(xt){const yt=toDataView(xt);return getPngMetadata(yt)||getJpegMetadata(yt)||getGifMetadata(yt)||getBmpMetadata(yt)||getISOBMFFMetadata(yt)}function getISOBMFFMetadata(xt){const yt=new Uint8Array(xt instanceof DataView?xt.buffer:xt),vt=getISOBMFFMediaType(yt);return vt?{mimeType:vt.mimeType,width:0,height:0}:null}function getPngMetadata(xt){const yt=toDataView(xt);return yt.byteLength>=24&&yt.getUint32(0,BIG_ENDIAN)===2303741511?{mimeType:"image/png",width:yt.getUint32(16,BIG_ENDIAN),height:yt.getUint32(20,BIG_ENDIAN)}:null}function getGifMetadata(xt){const yt=toDataView(xt);return yt.byteLength>=10&&yt.getUint32(0,BIG_ENDIAN)===1195984440?{mimeType:"image/gif",width:yt.getUint16(6,LITTLE_ENDIAN),height:yt.getUint16(8,LITTLE_ENDIAN)}:null}function getBmpMetadata(xt){const yt=toDataView(xt);return yt.byteLength>=14&&yt.getUint16(0,BIG_ENDIAN)===16973&&yt.getUint32(2,LITTLE_ENDIAN)===yt.byteLength?{mimeType:"image/bmp",width:yt.getUint32(18,LITTLE_ENDIAN),height:yt.getUint32(22,LITTLE_ENDIAN)}:null}function getJpegMetadata(xt){const yt=toDataView(xt);if(!(yt.byteLength>=3&&yt.getUint16(0,BIG_ENDIAN)===65496&&yt.getUint8(2)===255))return null;const{tableMarkers:bt,sofMarkers:Tt}=getJpegMarkers();let Et=2;for(;Et+9<yt.byteLength;){const wt=yt.getUint16(Et,BIG_ENDIAN);if(Tt.has(wt))return{mimeType:"image/jpeg",height:yt.getUint16(Et+5,BIG_ENDIAN),width:yt.getUint16(Et+7,BIG_ENDIAN)};if(!bt.has(wt))return null;Et+=2,Et+=yt.getUint16(Et,BIG_ENDIAN)}return null}function getJpegMarkers(){const xt=new Set([65499,65476,65484,65501,65534]);for(let vt=65504;vt<65520;++vt)xt.add(vt);return{tableMarkers:xt,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function toDataView(xt){if(xt instanceof DataView)return xt;if(ArrayBuffer.isView(xt))return new DataView(xt.buffer);if(xt instanceof ArrayBuffer)return new DataView(xt);throw new Error("toDataView")}async function parseToNodeImage(xt,yt){var Tt;const{mimeType:vt}=getBinaryImageMetadata(xt)||{},bt=(Tt=globalThis.loaders)==null?void 0:Tt.parseImageNode;return assert$6(bt),await bt(xt,vt)}async function parseImage(xt,yt,vt){yt=yt||{};const Tt=(yt.image||{}).type||"auto",{url:Et}=vt||{},wt=getLoadableImageType(Tt);let St;switch(wt){case"imagebitmap":St=await parseToImageBitmap(xt,yt,Et);break;case"image":St=await parseToImage(xt,yt,Et);break;case"data":St=await parseToNodeImage(xt);break;default:assert$6(!1)}return Tt==="data"&&(St=getImageData(St)),St}function getLoadableImageType(xt){switch(xt){case"auto":case"data":return getDefaultImageType();default:return isImageTypeSupported(xt),xt}}const EXTENSIONS=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],MIME_TYPES=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],DEFAULT_IMAGE_LOADER_OPTIONS={image:{type:"auto",decode:!0}},ImageLoader={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:VERSION$1,mimeTypes:MIME_TYPES,extensions:EXTENSIONS,parse:parseImage,tests:[xt=>!!getBinaryImageMetadata(new DataView(xt))],options:DEFAULT_IMAGE_LOADER_OPTIONS},defaultLogger=new Log({id:"deck"});let loggers={};function register(xt){loggers=xt}function debug(xt,yt,vt,bt){defaultLogger.level>0&&loggers[xt]&&loggers[xt].call(null,yt,vt,bt)}function isJSON(xt){const yt=xt[0],vt=xt[xt.length-1];return yt==="{"&&vt==="}"||yt==="["&&vt==="]"}const jsonLoader={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:isJSON,parseTextSync:JSON.parse};function checkVersion(){const xt="9.1.14",yt=globalThis.deck&&globalThis.deck.VERSION;if(yt&&yt!==xt)throw new Error(`deck.gl - multiple versions detected: ${yt} vs ${xt}`);return yt||(defaultLogger.log(1,`deck.gl ${xt}`)(),globalThis.deck={...globalThis.deck,VERSION:xt,version:xt,log:defaultLogger,_registerLoggers:register},registerLoaders([jsonLoader,[ImageLoader,{imagebitmap:{premultiplyAlpha:"none"}}]])),xt}const VERSION=checkVersion();function assert$3(xt,yt){if(!xt)throw new Error(yt||"shadertools: assertion failed.")}const DEFAULT_PROP_VALIDATORS={number:{type:"number",validate(xt,yt){return Number.isFinite(xt)&&typeof yt=="object"&&(yt.max===void 0||xt<=yt.max)&&(yt.min===void 0||xt>=yt.min)}},array:{type:"array",validate(xt,yt){return Array.isArray(xt)||ArrayBuffer.isView(xt)}}};function makePropValidators(xt){const yt={};for(const[vt,bt]of Object.entries(xt))yt[vt]=makePropValidator(bt);return yt}function makePropValidator(xt){let yt=getTypeOf$1(xt);if(yt!=="object")return{value:xt,...DEFAULT_PROP_VALIDATORS[yt],type:yt};if(typeof xt=="object")return xt?xt.type!==void 0?{...xt,...DEFAULT_PROP_VALIDATORS[xt.type],type:xt.type}:xt.value===void 0?{type:"object",value:xt}:(yt=getTypeOf$1(xt.value),{...xt,...DEFAULT_PROP_VALIDATORS[yt],type:yt}):{type:"object",value:null};throw new Error("props")}function getTypeOf$1(xt){return Array.isArray(xt)||ArrayBuffer.isView(xt)?"array":typeof xt}const MODULE_INJECTORS_VS=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,MODULE_INJECTORS_FS=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,MODULE_INJECTORS={vertex:MODULE_INJECTORS_VS,fragment:MODULE_INJECTORS_FS},REGEX_START_OF_MAIN=/void\s+main\s*\([^)]*\)\s*\{\n?/,REGEX_END_OF_MAIN=/}\n?[^{}]*$/,fragments=[],DECLARATION_INJECT_MARKER="__LUMA_INJECT_DECLARATIONS__";function normalizeInjections(xt){const yt={vertex:{},fragment:{}};for(const vt in xt){let bt=xt[vt];const Tt=getHookStage(vt);typeof bt=="string"&&(bt={order:0,injection:bt}),yt[Tt][vt]=bt}return yt}function getHookStage(xt){const yt=xt.slice(0,2);switch(yt){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(yt)}}function injectShader(xt,yt,vt,bt=!1){const Tt=yt==="vertex";for(const Et in vt){const wt=vt[Et];wt.sort((At,Rt)=>At.order-Rt.order),fragments.length=wt.length;for(let At=0,Rt=wt.length;At<Rt;++At)fragments[At]=wt[At].injection;const St=`${fragments.join(`
`)}
`;switch(Et){case"vs:#decl":Tt&&(xt=xt.replace(DECLARATION_INJECT_MARKER,St));break;case"vs:#main-start":Tt&&(xt=xt.replace(REGEX_START_OF_MAIN,At=>At+St));break;case"vs:#main-end":Tt&&(xt=xt.replace(REGEX_END_OF_MAIN,At=>St+At));break;case"fs:#decl":Tt||(xt=xt.replace(DECLARATION_INJECT_MARKER,St));break;case"fs:#main-start":Tt||(xt=xt.replace(REGEX_START_OF_MAIN,At=>At+St));break;case"fs:#main-end":Tt||(xt=xt.replace(REGEX_END_OF_MAIN,At=>St+At));break;default:xt=xt.replace(Et,At=>At+St)}}return xt=xt.replace(DECLARATION_INJECT_MARKER,""),bt&&(xt=xt.replace(/\}\s*$/,Et=>Et+MODULE_INJECTORS[yt])),xt}function initializeShaderModules(xt){xt.map(yt=>initializeShaderModule(yt))}function initializeShaderModule(xt){if(xt.instance)return;initializeShaderModules(xt.dependencies||[]);const{propTypes:yt={},deprecations:vt=[],inject:bt={}}=xt,Tt={normalizedInjections:normalizeInjections(bt),parsedDeprecations:parseDeprecationDefinitions(vt)};yt&&(Tt.propValidators=makePropValidators(yt)),xt.instance=Tt;let Et={};yt&&(Et=Object.entries(yt).reduce((wt,[St,At])=>{const Rt=At==null?void 0:At.value;return Rt&&(wt[St]=Rt),wt},{})),xt.defaultUniforms={...xt.defaultUniforms,...Et}}function checkShaderModuleDeprecations(xt,yt,vt){var bt;(bt=xt.deprecations)==null||bt.forEach(Tt=>{var Et;(Et=Tt.regex)!=null&&Et.test(yt)&&(Tt.deprecated?vt.deprecated(Tt.old,Tt.new)():vt.removed(Tt.old,Tt.new)())})}function parseDeprecationDefinitions(xt){return xt.forEach(yt=>{switch(yt.type){case"function":yt.regex=new RegExp(`\\b${yt.old}\\(`);break;default:yt.regex=new RegExp(`${yt.type} ${yt.old};`)}}),xt}function getShaderModuleDependencies(xt){initializeShaderModules(xt);const yt={},vt={};getDependencyGraph({modules:xt,level:0,moduleMap:yt,moduleDepth:vt});const bt=Object.keys(vt).sort((Tt,Et)=>vt[Et]-vt[Tt]).map(Tt=>yt[Tt]);return initializeShaderModules(bt),bt}function getDependencyGraph(xt){const{modules:yt,level:vt,moduleMap:bt,moduleDepth:Tt}=xt;if(vt>=5)throw new Error("Possible loop in shader dependency graph");for(const Et of yt)bt[Et.name]=Et,(Tt[Et.name]===void 0||Tt[Et.name]<vt)&&(Tt[Et.name]=vt);for(const Et of yt)Et.dependencies&&getDependencyGraph({modules:Et.dependencies,level:vt+1,moduleMap:bt,moduleDepth:Tt})}function getPlatformShaderDefines(xt){switch(xt==null?void 0:xt.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function transpileGLSLShader(xt,yt){var bt;if(Number(((bt=xt.match(/^#version[ \t]+(\d+)/m))==null?void 0:bt[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(yt){case"vertex":return xt=convertShader(xt,ES300_VERTEX_REPLACEMENTS),xt;case"fragment":return xt=convertShader(xt,ES300_FRAGMENT_REPLACEMENTS),xt;default:throw new Error(yt)}}const ES300_REPLACEMENTS=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],ES300_VERTEX_REPLACEMENTS=[...ES300_REPLACEMENTS,[makeVariableTextRegExp("attribute"),"in $1"],[makeVariableTextRegExp("varying"),"out $1"]],ES300_FRAGMENT_REPLACEMENTS=[...ES300_REPLACEMENTS,[makeVariableTextRegExp("varying"),"in $1"]];function convertShader(xt,yt){for(const[vt,bt]of yt)xt=xt.replace(vt,bt);return xt}function makeVariableTextRegExp(xt){return new RegExp(`\\b${xt}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function getShaderHooks(xt,yt){let vt="";for(const bt in xt){const Tt=xt[bt];if(vt+=`void ${Tt.signature} {
`,Tt.header&&(vt+=`  ${Tt.header}`),yt[bt]){const Et=yt[bt];Et.sort((wt,St)=>wt.order-St.order);for(const wt of Et)vt+=`  ${wt.injection}
`}Tt.footer&&(vt+=`  ${Tt.footer}`),vt+=`}
`}return vt}function normalizeShaderHooks(xt){const yt={vertex:{},fragment:{}};for(const vt of xt){let bt,Tt;typeof vt!="string"?(bt=vt,Tt=bt.hook):(bt={},Tt=vt),Tt=Tt.trim();const[Et,wt]=Tt.split(":"),St=Tt.replace(/\(.+/,""),At=Object.assign(bt,{signature:wt});switch(Et){case"vs":yt.vertex[St]=At;break;case"fs":yt.fragment[St]=At;break;default:throw new Error(Et)}}return yt}function getShaderInfo(xt,yt){return{name:getShaderName$1(xt,yt),language:"glsl",version:getShaderVersion(xt)}}function getShaderName$1(xt,yt="unnamed"){const bt=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(xt);return bt?bt[1]:yt}function getShaderVersion(xt){let yt=100;const vt=xt.match(/[^\s]+/g);if(vt&&vt.length>=2&&vt[0]==="#version"){const bt=parseInt(vt[1],10);Number.isFinite(bt)&&(yt=bt)}if(yt!==100&&yt!==300)throw new Error(`Invalid GLSL version ${yt}`);return yt}const INJECT_SHADER_DECLARATIONS=`

${DECLARATION_INJECT_MARKER}
`,FRAGMENT_SHADER_PROLOGUE=`precision highp float;
`;function assembleWGSLShader(xt){const yt=getShaderModuleDependencies(xt.modules||[]);return{source:assembleShaderWGSL(xt.platformInfo,{...xt,source:xt.source,stage:"vertex",modules:yt}),getUniforms:assembleGetUniforms(yt)}}function assembleGLSLShaderPair(xt){const{vs:yt,fs:vt}=xt,bt=getShaderModuleDependencies(xt.modules||[]);return{vs:assembleShaderGLSL(xt.platformInfo,{...xt,source:yt,stage:"vertex",modules:bt}),fs:assembleShaderGLSL(xt.platformInfo,{...xt,source:vt,stage:"fragment",modules:bt}),getUniforms:assembleGetUniforms(bt)}}function assembleShaderWGSL(xt,yt){var kt;const{source:vt,stage:bt,modules:Tt,hookFunctions:Et=[],inject:wt={},log:St}=yt;assert$3(typeof vt=="string","shader source must be a string");const At=vt;let Rt="";const Pt=normalizeShaderHooks(Et),Ct={},It={},Mt={};for(const Ft in wt){const Nt=typeof wt[Ft]=="string"?{injection:wt[Ft],order:0}:wt[Ft],Lt=/^(v|f)s:(#)?([\w-]+)$/.exec(Ft);if(Lt){const Dt=Lt[2],$t=Lt[3];Dt?$t==="decl"?It[Ft]=[Nt]:Mt[Ft]=[Nt]:Ct[Ft]=[Nt]}else Mt[Ft]=[Nt]}const Ot=Tt;for(const Ft of Ot){St&&checkShaderModuleDeprecations(Ft,At,St);const Nt=getShaderModuleSource(Ft,"wgsl");Rt+=Nt;const Lt=((kt=Ft.injections)==null?void 0:kt[bt])||{};for(const Dt in Lt){const $t=/^(v|f)s:#([\w-]+)$/.exec(Dt);if($t){const Ut=$t[2]==="decl"?It:Mt;Ut[Dt]=Ut[Dt]||[],Ut[Dt].push(Lt[Dt])}else Ct[Dt]=Ct[Dt]||[],Ct[Dt].push(Lt[Dt])}}return Rt+=INJECT_SHADER_DECLARATIONS,Rt=injectShader(Rt,bt,It),Rt+=getShaderHooks(Pt[bt],Ct),Rt+=At,Rt=injectShader(Rt,bt,Mt),Rt}function assembleShaderGLSL(xt,yt){var jt;const{id:vt,source:bt,stage:Tt,language:Et="glsl",modules:wt,defines:St={},hookFunctions:At=[],inject:Rt={},prologue:Pt=!0,log:Ct}=yt;assert$3(typeof bt=="string","shader source must be a string");const It=Et==="glsl"?getShaderInfo(bt).version:-1,Mt=xt.shaderLanguageVersion,Ot=It===100?"#version 100":"#version 300 es",Ft=bt.split(`
`).slice(1).join(`
`),Nt={};wt.forEach(Ht=>{Object.assign(Nt,Ht.defines)}),Object.assign(Nt,St);let Lt="";switch(Et){case"wgsl":break;case"glsl":Lt=Pt?`${Ot}

// ----- PROLOGUE -------------------------
${getShaderNameDefine({id:vt,source:bt,stage:Tt})}
${`#define SHADER_TYPE_${Tt.toUpperCase()}`}

${getPlatformShaderDefines(xt)}
${Tt==="fragment"?FRAGMENT_SHADER_PROLOGUE:""}

// ----- APPLICATION DEFINES -------------------------

${getApplicationDefines(Nt)}

`:`${Ot}
`;break}const Dt=normalizeShaderHooks(At),$t={},zt={},Ut={};for(const Ht in Rt){const Vt=typeof Rt[Ht]=="string"?{injection:Rt[Ht],order:0}:Rt[Ht],Wt=/^(v|f)s:(#)?([\w-]+)$/.exec(Ht);if(Wt){const Yt=Wt[2],Kt=Wt[3];Yt?Kt==="decl"?zt[Ht]=[Vt]:Ut[Ht]=[Vt]:$t[Ht]=[Vt]}else Ut[Ht]=[Vt]}for(const Ht of wt){Ct&&checkShaderModuleDeprecations(Ht,Ft,Ct);const Vt=getShaderModuleSource(Ht,Tt);Lt+=Vt;const Wt=((jt=Ht.instance)==null?void 0:jt.normalizedInjections[Tt])||{};for(const Yt in Wt){const Kt=/^(v|f)s:#([\w-]+)$/.exec(Yt);if(Kt){const Xt=Kt[2]==="decl"?zt:Ut;Xt[Yt]=Xt[Yt]||[],Xt[Yt].push(Wt[Yt])}else $t[Yt]=$t[Yt]||[],$t[Yt].push(Wt[Yt])}}return Lt+="// ----- MAIN SHADER SOURCE -------------------------",Lt+=INJECT_SHADER_DECLARATIONS,Lt=injectShader(Lt,Tt,zt),Lt+=getShaderHooks(Dt[Tt],$t),Lt+=Ft,Lt=injectShader(Lt,Tt,Ut),Et==="glsl"&&It!==Mt&&(Lt=transpileGLSLShader(Lt,Tt)),Lt.trim()}function assembleGetUniforms(xt){return function(vt){var Tt;const bt={};for(const Et of xt){const wt=(Tt=Et.getUniforms)==null?void 0:Tt.call(Et,vt,bt);Object.assign(bt,wt)}return bt}}function getShaderNameDefine(xt){const{id:yt,source:vt,stage:bt}=xt;return yt&&vt.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${yt}_${bt}`:""}function getApplicationDefines(xt={}){let yt="";for(const vt in xt){const bt=xt[vt];(bt||Number.isFinite(bt))&&(yt+=`#define ${vt.toUpperCase()} ${xt[vt]}
`)}return yt}function getShaderModuleSource(xt,yt){let vt;switch(yt){case"vertex":vt=xt.vs||"";break;case"fragment":vt=xt.fs||"";break;case"wgsl":vt=xt.source||"";break;default:assert$3(!1)}if(!xt.name)throw new Error("Shader module must have a name");const bt=xt.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let Tt=`// ----- MODULE ${xt.name} ---------------

`;return yt!=="wgsl"&&(Tt+=`#define MODULE_${bt}
`),Tt+=`${vt}
`,Tt}const IFDEF_REGEXP=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,ENDIF_REGEXP=/^\s*\#\s*endif\s*$/;function preprocess(xt,yt){var wt;const vt=xt.split(`
`),bt=[];let Tt=!0,Et=null;for(const St of vt){const At=St.match(IFDEF_REGEXP),Rt=St.match(ENDIF_REGEXP);At?(Et=At[1],Tt=!!((wt=yt==null?void 0:yt.defines)!=null&&wt[Et])):Rt?Tt=!0:Tt&&bt.push(St)}return bt.join(`
`)}const dn=class dn{constructor(){Bt(this,"_hookFunctions",[]);Bt(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return dn.defaultShaderAssembler=dn.defaultShaderAssembler||new dn,dn.defaultShaderAssembler}addDefaultModule(yt){this._defaultModules.find(vt=>vt.name===(typeof yt=="string"?yt:yt.name))||this._defaultModules.push(yt)}removeDefaultModule(yt){const vt=typeof yt=="string"?yt:yt.name;this._defaultModules=this._defaultModules.filter(bt=>bt.name!==vt)}addShaderHook(yt,vt){vt&&(yt=Object.assign(vt,{hook:yt})),this._hookFunctions.push(yt)}assembleWGSLShader(yt){const vt=this._getModuleList(yt.modules),bt=this._hookFunctions,{source:Tt,getUniforms:Et}=assembleWGSLShader({...yt,source:yt.source,modules:vt,hookFunctions:bt});return{source:yt.platformInfo.shaderLanguage==="wgsl"?preprocess(Tt):Tt,getUniforms:Et,modules:vt}}assembleGLSLShaderPair(yt){const vt=this._getModuleList(yt.modules),bt=this._hookFunctions;return{...assembleGLSLShaderPair({...yt,vs:yt.vs,fs:yt.fs,modules:vt,hookFunctions:bt}),modules:vt}}_getModuleList(yt=[]){const vt=new Array(this._defaultModules.length+yt.length),bt={};let Tt=0;for(let Et=0,wt=this._defaultModules.length;Et<wt;++Et){const St=this._defaultModules[Et],At=St.name;vt[Tt++]=St,bt[At]=!0}for(let Et=0,wt=yt.length;Et<wt;++Et){const St=yt[Et],At=St.name;bt[At]||(vt[Tt++]=St,bt[At]=!0)}return vt.length=Tt,initializeShaderModules(vt),vt}};Bt(dn,"defaultShaderAssembler");let ShaderAssembler=dn;const FS_GLES=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,FS300=`#version 300 es
${FS_GLES}`;function getPassthroughFS(xt){const{input:yt,inputChannels:vt,output:bt}={};if(!yt)return FS300;if(!vt)throw new Error("inputChannels");const Tt=channelCountToType(vt),Et=convertToVec4(yt,vt);return`#version 300 es
in ${Tt} ${yt};
out vec4 ${bt};
void main() {
  ${bt} = ${Et};
}`}function channelCountToType(xt){switch(xt){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${xt}`)}}function convertToVec4(xt,yt){switch(yt){case 1:return`vec4(${xt}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${xt}, 0.0, 1.0)`;case 3:return`vec4(${xt}, 1.0)`;case 4:return xt;default:throw new Error(`invalid channels: ${yt}`)}}class StatsManager{constructor(){Bt(this,"stats",new Map)}getStats(yt){return this.get(yt)}get(yt){return this.stats.has(yt)||this.stats.set(yt,new Stats({id:yt})),this.stats.get(yt)}}const lumaStats=new StatsManager,log=new Log({id:"luma.gl"}),uidCounters$2={};function uid$2(xt="id"){uidCounters$2[xt]=uidCounters$2[xt]||1;const yt=uidCounters$2[xt]++;return`${xt}-${yt}`}var Dn;let Resource$1=(Dn=class{constructor(yt,vt,bt){Bt(this,"id");Bt(this,"props");Bt(this,"userData",{});Bt(this,"_device");Bt(this,"destroyed",!1);Bt(this,"allocatedBytes",0);Bt(this,"_attachedResources",new Set);if(!yt)throw new Error("no device");this._device=yt,this.props=selectivelyMerge(vt,bt);const Tt=this.props.id!=="undefined"?this.props.id:uid$2(this[Symbol.toStringTag]);this.props.id=Tt,this.id=Tt,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(yt){this._attachedResources.add(yt)}detachResource(yt){this._attachedResources.delete(yt)}destroyAttachedResource(yt){this._attachedResources.delete(yt)&&yt.destroy()}destroyAttachedResources(){for(const yt of Object.values(this._attachedResources))yt.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const yt=this._device.statsManager.getStats("Resource Counts"),vt=this[Symbol.toStringTag];yt.get(`${vt}s Active`).decrementCount()}trackAllocatedMemory(yt,vt=this[Symbol.toStringTag]){const bt=this._device.statsManager.getStats("Resource Counts");bt.get("GPU Memory").addCount(yt),bt.get(`${vt} Memory`).addCount(yt),this.allocatedBytes=yt}trackDeallocatedMemory(yt=this[Symbol.toStringTag]){const vt=this._device.statsManager.getStats("Resource Counts");vt.get("GPU Memory").subtractCount(this.allocatedBytes),vt.get(`${yt} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const yt=this._device.statsManager.getStats("Resource Counts"),vt=this[Symbol.toStringTag];yt.get("Resources Created").incrementCount(),yt.get(`${vt}s Created`).incrementCount(),yt.get(`${vt}s Active`).incrementCount()}},Bt(Dn,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Dn);function selectivelyMerge(xt,yt){const vt={...yt};for(const bt in xt)xt[bt]!==void 0&&(vt[bt]=xt[bt]);return vt}const on=class on extends Resource$1{constructor(vt,bt){const Tt={...bt};(bt.usage||0)&on.INDEX&&!bt.indexType&&(bt.data instanceof Uint32Array?Tt.indexType="uint32":bt.data instanceof Uint16Array&&(Tt.indexType="uint16")),delete Tt.data;super(vt,Tt,on.defaultProps);Bt(this,"usage");Bt(this,"indexType");Bt(this,"updateTimestamp");Bt(this,"debugData",new ArrayBuffer(0));this.usage=Tt.usage||0,this.indexType=Tt.indexType,this.updateTimestamp=vt.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(vt){return this.device.createBuffer({...this.props,...vt})}readSyncWebGL(vt,bt){throw new Error("not implemented")}_setDebugData(vt,bt,Tt){const Et=ArrayBuffer.isView(vt)?vt.buffer:vt,wt=Math.min(vt?vt.byteLength:Tt,on.DEBUG_DATA_MAX_LENGTH);Et===null?this.debugData=new ArrayBuffer(wt):bt===0&&Tt===Et.byteLength?this.debugData=Et.slice(0,wt):this.debugData=Et.slice(bt,bt+wt)}};Bt(on,"defaultProps",{...Resource$1.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),Bt(on,"MAP_READ",1),Bt(on,"MAP_WRITE",2),Bt(on,"COPY_SRC",4),Bt(on,"COPY_DST",8),Bt(on,"INDEX",16),Bt(on,"VERTEX",32),Bt(on,"UNIFORM",64),Bt(on,"STORAGE",128),Bt(on,"INDIRECT",256),Bt(on,"QUERY_RESOLVE",512),Bt(on,"DEBUG_DATA_MAX_LENGTH",32);let Buffer=on;function decodeVertexType(xt){const yt=TYPE_MAP[xt],vt=getDataTypeBytes(yt),bt=xt.includes("norm"),Tt=!bt&&!xt.startsWith("float"),Et=xt.startsWith("s");return{dataType:TYPE_MAP[xt],byteLength:vt,integer:Tt,signed:Et,normalized:bt}}function getDataTypeBytes(xt){return TYPE_SIZES$1[xt]}const TYPE_MAP={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},TYPE_SIZES$1={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},texture_compression_bc="texture-compression-bc",texture_compression_astc="texture-compression-astc",texture_compression_etc2="texture-compression-etc2",texture_compression_etc1_webgl="texture-compression-etc1-webgl",texture_compression_pvrtc_webgl="texture-compression-pvrtc-webgl",texture_compression_atc_webgl="texture-compression-atc-webgl",float32_renderable="float32-renderable-webgl",float16_renderable="float16-renderable-webgl",rgb9e5ufloat_renderable="rgb9e5ufloat-renderable-webgl",snorm8_renderable="snorm8-renderable-webgl",norm16_renderable="norm16-renderable-webgl",snorm16_renderable="snorm16-renderable-webgl",float32_filterable="float32-filterable",float16_filterable="float16-filterable-webgl";function getTextureFormatDefinition(xt){const yt=TEXTURE_FORMAT_TABLE[xt];if(!yt)throw new Error(`Unsupported texture format ${xt}`);return yt}const TEXTURE_FORMAT_TABLE={r8unorm:{},r8snorm:{render:snorm8_renderable},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:snorm8_renderable},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:float16_renderable,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:norm16_renderable},"r16snorm-webgl":{f:snorm16_renderable},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:snorm8_renderable},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:float16_renderable,filter:float16_filterable},"rg16unorm-webgl":{render:norm16_renderable},"rg16snorm-webgl":{render:snorm16_renderable},r32uint:{},r32sint:{},r32float:{render:float32_renderable,filter:float32_filterable},rgb9e5ufloat:{channels:"rgb",packed:!0,render:rgb9e5ufloat_renderable},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:float32_renderable},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:norm16_renderable},"rgb16snorm-webgl":{f:norm16_renderable},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:float32_filterable},rgba16uint:{},rgba16sint:{},rgba16float:{render:float16_renderable,filter:float16_filterable},"rgba16unorm-webgl":{render:norm16_renderable},"rgba16snorm-webgl":{render:snorm16_renderable},"rgb32float-webgl":{render:float32_renderable,filter:float32_filterable},rgba32uint:{},rgba32sint:{},rgba32float:{render:float32_renderable,filter:float32_filterable},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:texture_compression_bc},"bc1-rgb-unorm-srgb-webgl":{f:texture_compression_bc},"bc1-rgba-unorm":{f:texture_compression_bc},"bc1-rgba-unorm-srgb":{f:texture_compression_bc},"bc2-rgba-unorm":{f:texture_compression_bc},"bc2-rgba-unorm-srgb":{f:texture_compression_bc},"bc3-rgba-unorm":{f:texture_compression_bc},"bc3-rgba-unorm-srgb":{f:texture_compression_bc},"bc4-r-unorm":{f:texture_compression_bc},"bc4-r-snorm":{f:texture_compression_bc},"bc5-rg-unorm":{f:texture_compression_bc},"bc5-rg-snorm":{f:texture_compression_bc},"bc6h-rgb-ufloat":{f:texture_compression_bc},"bc6h-rgb-float":{f:texture_compression_bc},"bc7-rgba-unorm":{f:texture_compression_bc},"bc7-rgba-unorm-srgb":{f:texture_compression_bc},"etc2-rgb8unorm":{f:texture_compression_etc2},"etc2-rgb8unorm-srgb":{f:texture_compression_etc2},"etc2-rgb8a1unorm":{f:texture_compression_etc2},"etc2-rgb8a1unorm-srgb":{f:texture_compression_etc2},"etc2-rgba8unorm":{f:texture_compression_etc2},"etc2-rgba8unorm-srgb":{f:texture_compression_etc2},"eac-r11unorm":{f:texture_compression_etc2},"eac-r11snorm":{f:texture_compression_etc2},"eac-rg11unorm":{f:texture_compression_etc2},"eac-rg11snorm":{f:texture_compression_etc2},"astc-4x4-unorm":{f:texture_compression_astc},"astc-4x4-unorm-srgb":{f:texture_compression_astc},"astc-5x4-unorm":{f:texture_compression_astc},"astc-5x4-unorm-srgb":{f:texture_compression_astc},"astc-5x5-unorm":{f:texture_compression_astc},"astc-5x5-unorm-srgb":{f:texture_compression_astc},"astc-6x5-unorm":{f:texture_compression_astc},"astc-6x5-unorm-srgb":{f:texture_compression_astc},"astc-6x6-unorm":{f:texture_compression_astc},"astc-6x6-unorm-srgb":{f:texture_compression_astc},"astc-8x5-unorm":{f:texture_compression_astc},"astc-8x5-unorm-srgb":{f:texture_compression_astc},"astc-8x6-unorm":{f:texture_compression_astc},"astc-8x6-unorm-srgb":{f:texture_compression_astc},"astc-8x8-unorm":{f:texture_compression_astc},"astc-8x8-unorm-srgb":{f:texture_compression_astc},"astc-10x5-unorm":{f:texture_compression_astc},"astc-10x5-unorm-srgb":{f:texture_compression_astc},"astc-10x6-unorm":{f:texture_compression_astc},"astc-10x6-unorm-srgb":{f:texture_compression_astc},"astc-10x8-unorm":{f:texture_compression_astc},"astc-10x8-unorm-srgb":{f:texture_compression_astc},"astc-10x10-unorm":{f:texture_compression_astc},"astc-10x10-unorm-srgb":{f:texture_compression_astc},"astc-12x10-unorm":{f:texture_compression_astc},"astc-12x10-unorm-srgb":{f:texture_compression_astc},"astc-12x12-unorm":{f:texture_compression_astc},"astc-12x12-unorm-srgb":{f:texture_compression_astc},"pvrtc-rgb4unorm-webgl":{f:texture_compression_pvrtc_webgl},"pvrtc-rgba4unorm-webgl":{f:texture_compression_pvrtc_webgl},"pvrtc-rbg2unorm-webgl":{f:texture_compression_pvrtc_webgl},"pvrtc-rgba2unorm-webgl":{f:texture_compression_pvrtc_webgl},"etc1-rbg-unorm-webgl":{f:texture_compression_etc1_webgl},"atc-rgb-unorm-webgl":{f:texture_compression_atc_webgl},"atc-rgba-unorm-webgl":{f:texture_compression_atc_webgl},"atc-rgbai-unorm-webgl":{f:texture_compression_atc_webgl}},COMPRESSED_TEXTURE_FORMAT_PREFIXES=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],RGB_FORMAT_REGEX=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function isTextureFormatCompressed(xt){return COMPRESSED_TEXTURE_FORMAT_PREFIXES.some(yt=>xt.startsWith(yt))}function decodeTextureFormat(xt){let yt=decodeTextureFormatUsingTable(xt);if(isTextureFormatCompressed(xt)){yt.channels="rgb",yt.components=3,yt.bytesPerPixel=1,yt.srgb=!1,yt.compressed=!0;const bt=getCompressedTextureBlockSize(xt);bt&&(yt.blockWidth=bt.blockWidth,yt.blockHeight=bt.blockHeight)}const vt=RGB_FORMAT_REGEX.exec(xt);if(vt){const[,bt,Tt,Et,wt,St]=vt,At=`${Et}${Tt}`,Rt=decodeVertexType(At),Pt=Rt.byteLength*8,Ct=bt.length,It=[Pt,Ct>=2?Pt:0,Ct>=3?Pt:0,Ct>=4?Pt:0];yt={format:xt,attachment:yt.attachment,dataType:Rt.dataType,components:Ct,channels:bt,integer:Rt.integer,signed:Rt.signed,normalized:Rt.normalized,bitsPerChannel:It,bytesPerPixel:Rt.byteLength*bt.length,packed:yt.packed,srgb:yt.srgb},St==="-webgl"&&(yt.webgl=!0),wt==="-srgb"&&(yt.srgb=!0)}return xt.endsWith("-webgl")&&(yt.webgl=!0),xt.endsWith("-srgb")&&(yt.srgb=!0),yt}function decodeTextureFormatUsingTable(xt){var Et;const yt=getTextureFormatDefinition(xt),vt=yt.bytesPerPixel||1,bt=yt.bitsPerChannel||[8,8,8,8];return delete yt.bitsPerChannel,delete yt.bytesPerPixel,delete yt.f,delete yt.render,delete yt.filter,delete yt.blend,delete yt.store,{...yt,format:xt,attachment:yt.attachment||"color",channels:yt.channels||"r",components:yt.components||((Et=yt.channels)==null?void 0:Et.length)||1,bytesPerPixel:vt,bitsPerChannel:bt,dataType:yt.dataType||"uint8",srgb:yt.srgb??!1,packed:yt.packed??!1,webgl:yt.webgl??!1,integer:yt.integer??!1,signed:yt.signed??!1,normalized:yt.normalized??!1,compressed:yt.compressed??!1}}function getCompressedTextureBlockSize(xt){const vt=/.*-(\d+)x(\d+)-.*/.exec(xt);if(vt){const[,bt,Tt]=vt;return{blockWidth:Number(bt),blockHeight:Number(Tt)}}return null}function getTextureFormatCapabilities(xt){const yt=getTextureFormatDefinition(xt),vt={format:xt,create:yt.f??!0,render:yt.render??!0,filter:yt.filter??!0,blend:yt.blend??!0,store:yt.store??!0},bt=decodeTextureFormat(xt),Tt=xt.startsWith("depth")||xt.startsWith("stencil"),Et=bt==null?void 0:bt.signed,wt=bt==null?void 0:bt.integer,St=bt==null?void 0:bt.webgl;return vt.render&&(vt.render=!Et),vt.filter&&(vt.filter=!Tt&&!Et&&!wt&&!St),vt}class DeviceLimits{}class DeviceFeatures{constructor(yt=[],vt){Bt(this,"features");Bt(this,"disabledFeatures");this.features=new Set(yt),this.disabledFeatures=vt||{}}*[Symbol.iterator](){yield*this.features}has(yt){var vt;return!((vt=this.disabledFeatures)!=null&&vt[yt])&&this.features.has(yt)}}const xn=class xn{constructor(yt){Bt(this,"id");Bt(this,"props");Bt(this,"userData",{});Bt(this,"statsManager",lumaStats);Bt(this,"timestamp",0);Bt(this,"_reused",!1);Bt(this,"_lumaData",{});this.props={...xn.defaultProps,...yt},this.id=this.props.id||uid$2(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(yt){const vt=getTextureFormatCapabilities(yt),bt=wt=>(typeof wt=="string"?this.features.has(wt):wt)??!0,Tt=bt(vt.create),Et={format:yt,create:Tt,render:Tt&&bt(vt.render),filter:Tt&&bt(vt.filter),blend:Tt&&bt(vt.blend),store:Tt&&bt(vt.store)};return this._getDeviceSpecificTextureFormatCapabilities(Et)}isTextureFormatSupported(yt,vt){return this.getTextureFormatCapabilities(yt).create}isTextureFormatFilterable(yt){return this.getTextureFormatCapabilities(yt).filter}isTextureFormatRenderable(yt){return this.getTextureFormatCapabilities(yt).render}isTextureFormatCompressed(yt){return isTextureFormatCompressed(yt)}loseDevice(){return!1}reportError(yt){this.props.onError(yt)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(yt={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(yt){this.props.onError(yt)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(yt,vt){throw new Error("not implemented")}readPixelsToBufferWebGL(yt,vt){throw new Error("not implemented")}setParametersWebGL(yt){throw new Error("not implemented")}getParametersWebGL(yt){throw new Error("not implemented")}withParametersWebGL(yt,vt){throw new Error("not implemented")}clearWebGL(yt){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(yt){return yt.createCanvasContext===!0?{}:yt.createCanvasContext}_normalizeBufferProps(yt){(yt instanceof ArrayBuffer||ArrayBuffer.isView(yt))&&(yt={data:yt});const vt={...yt};return(yt.usage||0)&Buffer.INDEX&&!yt.indexType&&(yt.data instanceof Uint32Array?vt.indexType="uint32":yt.data instanceof Uint16Array?vt.indexType="uint16":log.warn("indices buffer content must be of integer type")()),vt}};Bt(xn,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:yt=>log.error(yt.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:log.get("debug")||void 0,debugShaders:log.get("debug-shaders")||void 0,debugFramebuffers:!!log.get("debug-framebuffers"),debugWebGL:!!log.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let Device=xn;const isPage=isBrowser$1()&&typeof document<"u",isPageLoaded=()=>isPage&&document.readyState==="complete",STARTUP_MESSAGE="set luma.log.level=1 (or higher) to trace rendering",ERROR_MESSAGE="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",un=class un{constructor(){Bt(this,"stats",lumaStats);Bt(this,"log",log);Bt(this,"VERSION","9.1.9");Bt(this,"spector");Bt(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw log.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),log.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");log.error("This version of luma.gl has already been initialized")()}log.log(1,`${this.VERSION} - ${STARTUP_MESSAGE}`)(),globalThis.luma=this}registerAdapters(yt){for(const vt of yt)this.preregisteredAdapters.set(vt.type,vt)}getSupportedAdapters(yt=[]){const vt=this.getAdapterMap(yt);return Array.from(vt).map(([,bt])=>bt).filter(bt=>{var Tt;return(Tt=bt.isSupported)==null?void 0:Tt.call(bt)}).map(bt=>bt.type)}getBestAvailableAdapter(yt=[]){var bt,Tt,Et,wt;const vt=this.getAdapterMap(yt);return(Tt=(bt=vt.get("webgpu"))==null?void 0:bt.isSupported)!=null&&Tt.call(bt)?"webgpu":(wt=(Et=vt.get("webgl"))==null?void 0:Et.isSupported)!=null&&wt.call(Et)?"webgl":null}setDefaultDeviceProps(yt){Object.assign(un.defaultProps,yt)}async createDevice(yt={}){var St;yt={...un.defaultProps,...yt},yt.waitForPageLoad&&await un.pageLoaded;const vt=this.getAdapterMap(yt.adapters);let bt=yt.type||"";bt==="best-available"&&(bt=this.getBestAvailableAdapter(yt.adapters)||bt);const Et=(this.getAdapterMap(yt.adapters)||vt).get(bt),wt=await((St=Et==null?void 0:Et.create)==null?void 0:St.call(Et,yt));if(wt)return wt;throw new Error(ERROR_MESSAGE)}async attachDevice(yt){var wt;const vt=this.getAdapterMap(yt.adapters);let bt="";yt.handle instanceof WebGL2RenderingContext&&(bt="webgl"),yt.createCanvasContext&&await un.pageLoaded,yt.handle===null&&(bt="unknown");const Tt=vt.get(bt),Et=await((wt=Tt==null?void 0:Tt.attach)==null?void 0:wt.call(Tt,null));if(Et)return Et;throw new Error(ERROR_MESSAGE)}enforceWebGL2(yt=!0,vt=[]){var Et;const Tt=this.getAdapterMap(vt).get("webgl");Tt||log.warn("enforceWebGL2: webgl adapter not found")(),(Et=Tt==null?void 0:Tt.enforceWebGL2)==null||Et.call(Tt,yt)}getAdapterMap(yt=[]){const vt=new Map(this.preregisteredAdapters);for(const bt of yt)vt.set(bt.type,bt);return vt}registerDevices(yt){log.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const vt of yt){const bt=vt.adapter;bt&&this.preregisteredAdapters.set(bt.type,bt)}}};Bt(un,"defaultProps",{...Device.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),Bt(un,"pageLoaded",getPageLoadPromise().then(()=>{log.probe(2,"DOM is loaded")()}));let Luma=un;const luma=new Luma;function getPageLoadPromise(){return isPageLoaded()||typeof window>"u"?Promise.resolve():new Promise(xt=>{window.addEventListener("load",()=>xt())})}class Adapter{}const bn=class bn{constructor(yt){Bt(this,"id");Bt(this,"props");Bt(this,"canvas");Bt(this,"htmlCanvas");Bt(this,"offscreenCanvas");Bt(this,"type");Bt(this,"width",1);Bt(this,"height",1);Bt(this,"resizeObserver");Bt(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...bn.defaultProps,...yt},yt=this.props,!isBrowser$1()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(yt.canvas)typeof yt.canvas=="string"?this.canvas=getCanvasFromDOM(yt.canvas):this.canvas=yt.canvas;else{const vt=createCanvas(yt),bt=getContainer((yt==null?void 0:yt.container)||null);bt.insertBefore(vt,bt.firstChild),this.canvas=vt,yt!=null&&yt.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&yt.autoResize&&(this.resizeObserver=new ResizeObserver(vt=>{for(const bt of vt)bt.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(yt){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(yt=yt===void 0?this.props.useDevicePixels:yt,!yt||yt<=0)?1:yt===!0?typeof window<"u"&&window.devicePixelRatio||1:yt}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const yt=this.getDevicePixelRatio(),vt=this.canvas;return vt.parentElement?[vt.clientWidth*yt,vt.clientHeight*yt]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[yt,vt]=this.getPixelSize();return yt/vt}cssToDeviceRatio(){var yt;try{const[vt]=this.getDrawingBufferSize(),bt=this._canvasSizeInfo.clientWidth||((yt=this.htmlCanvas)==null?void 0:yt.clientWidth);return bt?vt/bt:1}catch{return 1}}cssToDevicePixels(yt,vt=!0){const bt=this.cssToDeviceRatio(),[Tt,Et]=this.getDrawingBufferSize();return scalePixels(yt,bt,Tt,Et,vt)}setDevicePixelRatio(yt,vt={}){if(!this.htmlCanvas)return;let bt="width"in vt?vt.width:this.htmlCanvas.clientWidth,Tt="height"in vt?vt.height:this.htmlCanvas.clientHeight;(!bt||!Tt)&&(log.log(1,"Canvas clientWidth/clientHeight is 0")(),yt=1,bt=this.htmlCanvas.width||1,Tt=this.htmlCanvas.height||1);const Et=this._canvasSizeInfo;if(Et.clientWidth!==bt||Et.clientHeight!==Tt||Et.devicePixelRatio!==yt){let wt=yt;const St=Math.floor(bt*wt),At=Math.floor(Tt*wt);if(this.htmlCanvas.width=St,this.htmlCanvas.height=At,this.device.gl){const[Pt,Ct]=this.getDrawingBufferSize();(Pt!==St||Ct!==At)&&(wt=Math.min(Pt/bt,Ct/Tt),this.htmlCanvas.width=Math.floor(bt*wt),this.htmlCanvas.height=Math.floor(Tt*wt),log.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=bt,this._canvasSizeInfo.clientHeight=Tt,this._canvasSizeInfo.devicePixelRatio=yt}}}getDrawingBufferSize(){const yt=this.device.gl;return yt?[yt.drawingBufferWidth,yt.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(yt){var vt;((vt=this.htmlCanvas)==null?void 0:vt.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=yt)}};Bt(bn,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let CanvasContext=bn;function getContainer(xt){if(typeof xt=="string"){const yt=document.getElementById(xt);if(!yt)throw new Error(`${xt} is not an HTML element`);return yt}else if(xt)return xt;return document.body}function getCanvasFromDOM(xt){const yt=document.getElementById(xt);if(!(yt instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return yt}function createCanvas(xt){const{width:yt,height:vt}=xt,bt=document.createElement("canvas");return bt.id=uid$2("lumagl-auto-created-canvas"),bt.width=yt||1,bt.height=vt||1,bt.style.width=Number.isFinite(yt)?`${yt}px`:"100%",bt.style.height=Number.isFinite(vt)?`${vt}px`:"100%",bt}function scalePixels(xt,yt,vt,bt,Tt){const Et=xt,wt=scaleX(Et[0],yt,vt);let St=scaleY(Et[1],yt,bt,Tt),At=scaleX(Et[0]+1,yt,vt);const Rt=At===vt-1?At:At-1;At=scaleY(Et[1]+1,yt,bt,Tt);let Pt;return Tt?(At=At===0?At:At+1,Pt=St,St=At):Pt=At===bt-1?At:At-1,{x:wt,y:St,width:Math.max(Rt-wt+1,1),height:Math.max(Pt-St+1,1)}}function scaleX(xt,yt,vt){return Math.min(Math.round(xt*yt),vt-1)}function scaleY(xt,yt,vt,bt){return bt?Math.max(0,vt-1-Math.round(xt*yt)):Math.min(Math.round(xt*yt),vt-1)}const an=class an extends Resource$1{constructor(vt,bt){bt=an.normalizeProps(vt,bt);super(vt,bt,an.defaultProps);Bt(this,"dimension");Bt(this,"format");Bt(this,"width");Bt(this,"height");Bt(this,"depth");Bt(this,"mipLevels");Bt(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const Tt=an.getTextureDataSize(this.props.data);this.width=(Tt==null?void 0:Tt.width)||1,this.height=(Tt==null?void 0:Tt.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?an.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=vt.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(vt){return this.device.createTexture({...this.props,...vt})}static isExternalImage(vt){return typeof ImageData<"u"&&vt instanceof ImageData||typeof ImageBitmap<"u"&&vt instanceof ImageBitmap||typeof HTMLImageElement<"u"&&vt instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&vt instanceof HTMLVideoElement||typeof VideoFrame<"u"&&vt instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&vt instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&vt instanceof OffscreenCanvas}static getExternalImageSize(vt){if(typeof ImageData<"u"&&vt instanceof ImageData||typeof ImageBitmap<"u"&&vt instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&vt instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&vt instanceof OffscreenCanvas)return{width:vt.width,height:vt.height};if(typeof HTMLImageElement<"u"&&vt instanceof HTMLImageElement)return{width:vt.naturalWidth,height:vt.naturalHeight};if(typeof HTMLVideoElement<"u"&&vt instanceof HTMLVideoElement)return{width:vt.videoWidth,height:vt.videoHeight};if(typeof VideoFrame<"u"&&vt instanceof VideoFrame)return{width:vt.displayWidth,height:vt.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(vt){const bt=vt==null?void 0:vt.data;return ArrayBuffer.isView(bt)}static getTextureDataSize(vt){if(!vt||ArrayBuffer.isView(vt))return null;if(Array.isArray(vt))return an.getTextureDataSize(vt[0]);if(an.isExternalImage(vt))return an.getExternalImageSize(vt);if(vt&&typeof vt=="object"&&vt.constructor===Object){const Tt=Object.values(vt)[0];return{width:Tt.width,height:Tt.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(vt,bt){let Tt;return ArrayBuffer.isView(vt)?Tt=[{data:vt,width:bt.width,height:bt.height}]:Array.isArray(vt)?Tt=vt:Tt=[vt],Tt}static getMipLevelCount(vt,bt){return Math.floor(Math.log2(Math.max(vt,bt)))+1}static getCubeFaceDepth(vt){switch(vt){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(vt)}}static normalizeProps(vt,bt){var At,Rt;const Tt={...bt},Et=((Rt=(At=vt==null?void 0:vt.props)==null?void 0:At._resourceDefaults)==null?void 0:Rt.texture)||{};Object.assign(Tt,Et);const{width:wt,height:St}=Tt;return typeof wt=="number"&&(Tt.width=Math.max(1,Math.ceil(wt))),typeof St=="number"&&(Tt.height=Math.max(1,Math.ceil(St))),Tt}};Bt(an,"COPY_SRC",1),Bt(an,"COPY_DST",2),Bt(an,"TEXTURE",4),Bt(an,"STORAGE",8),Bt(an,"RENDER_ATTACHMENT",16),Bt(an,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),Bt(an,"defaultProps",{...Resource$1.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),Bt(an,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let Texture=an;const Tn=class Tn extends Resource$1{get[Symbol.toStringTag](){return"TextureView"}constructor(yt,vt){super(yt,vt,Tn.defaultProps)}};Bt(Tn,"defaultProps",{...Resource$1.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let TextureView=Tn;function formatCompilerLog(xt,yt,vt){let bt="";const Tt=yt.split(/\r?\n/),Et=xt.slice().sort((wt,St)=>wt.lineNum-St.lineNum);switch((vt==null?void 0:vt.showSourceCode)||"no"){case"all":let wt=0;for(let St=1;St<=Tt.length;St++)for(bt+=getNumberedLine(Tt[St-1],St,vt);Et.length>wt&&Et[wt].lineNum===St;){const At=Et[wt++];bt+=formatCompilerMessage(At,Tt,At.lineNum,{...vt,inlineSource:!1})}return bt;case"issues":case"no":for(const St of xt)bt+=formatCompilerMessage(St,Tt,St.lineNum,{inlineSource:(vt==null?void 0:vt.showSourceCode)!=="no"});return bt}}function formatCompilerMessage(xt,yt,vt,bt){if(bt!=null&&bt.inlineSource){const Et=getNumberedLines(yt,vt),wt=xt.linePos>0?`${" ".repeat(xt.linePos+5)}^^^
`:"";return`
${Et}${wt}${xt.type.toUpperCase()}: ${xt.message}

`}const Tt=xt.type==="error"?"red":"#8B4000";return bt!=null&&bt.html?`<div class='luma-compiler-log-error' style="color:${Tt};"><b> ${xt.type.toUpperCase()}: ${xt.message}</b></div>`:`${xt.type.toUpperCase()}: ${xt.message}`}function getNumberedLines(xt,yt,vt){let bt="";for(let Tt=yt-2;Tt<=yt;Tt++){const Et=xt[Tt-1];Et!==void 0&&(bt+=getNumberedLine(Et,yt,vt))}return bt}function getNumberedLine(xt,yt,vt){const bt=vt!=null&&vt.html?escapeHTML(xt):xt;return`${padLeft(String(yt),4)}: ${bt}${vt!=null&&vt.html?"<br/>":`
`}`}function padLeft(xt,yt){let vt="";for(let bt=xt.length;bt<yt;++bt)vt+=" ";return vt+xt}function escapeHTML(xt){return xt.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const En=class En extends Resource$1{constructor(vt,bt){bt={...bt,debugShaders:bt.debugShaders||vt.props.debugShaders||"errors"};super(vt,{id:getShaderIdFromProps(bt),...bt},En.defaultProps);Bt(this,"stage");Bt(this,"source");Bt(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const vt=this.props.debugShaders;switch(vt){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const bt=await this.getCompilationInfo();vt==="warnings"&&(bt==null?void 0:bt.length)===0||this._displayShaderLog(bt)}_displayShaderLog(vt){var Rt;if(typeof document>"u"||!(document!=null&&document.createElement))return;const bt=getShaderName(this.source),Tt=`${this.stage} ${bt}`;let Et=formatCompilerLog(vt,this.source,{showSourceCode:"all",html:!0});const wt=this.getTranslatedSource();wt&&(Et+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${wt}</pre></code>`);const St=document.createElement("Button");St.innerHTML=`
<h1>Shader Compilation Error in ${Tt}</h1><br /><br />
<code style="user-select:text;"><pre>
${Et}
</pre></code>`,St.style.top="10px",St.style.left="10px",St.style.position="absolute",St.style.zIndex="9999",St.style.width="100%",St.style.textAlign="left",document.body.appendChild(St),(Rt=document.getElementsByClassName("luma-compiler-log-error")[0])==null||Rt.scrollIntoView(),St.onclick=()=>{const Pt=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(Pt)}}};Bt(En,"defaultProps",{...Resource$1.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Shader=En;function getShaderIdFromProps(xt){return getShaderName(xt.source)||xt.id||uid$2(`unnamed ${xt.stage}-shader`)}function getShaderName(xt,yt="unnamed"){const bt=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(xt);return bt?bt[1]:yt}const mn=class mn extends Resource$1{get[Symbol.toStringTag](){return"Sampler"}constructor(yt,vt){vt=mn.normalizeProps(yt,vt),super(yt,vt,mn.defaultProps)}static normalizeProps(yt,vt){var Et,wt;const bt=((wt=(Et=yt==null?void 0:yt.props)==null?void 0:Et._resourceDefaults)==null?void 0:wt.sampler)||{};return{...vt,...bt}}};Bt(mn,"defaultProps",{...Resource$1.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Sampler=mn;const wn=class wn extends Resource$1{constructor(vt,bt={}){super(vt,bt,wn.defaultProps);Bt(this,"width");Bt(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(vt){const bt=this.colorAttachments.map(Et=>Et.texture.clone(vt)),Tt=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(vt);return this.device.createFramebuffer({...this.props,colorAttachments:bt,depthStencilAttachment:Tt})}resize(vt){let bt=!vt;if(vt){const[Tt,Et]=Array.isArray(vt)?vt:[vt.width,vt.height];bt=bt||Et!==this.height||Tt!==this.width,this.width=Tt,this.height=Et}bt&&(log.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((bt,Tt)=>{if(typeof bt=="string"){const Et=this.createColorTexture(bt,Tt);return this.attachResource(Et),Et.view}return bt instanceof Texture?bt.view:bt});const vt=this.props.depthStencilAttachment;if(vt)if(typeof vt=="string"){const bt=this.createDepthStencilTexture(vt);this.attachResource(bt),this.depthStencilAttachment=bt.view}else vt instanceof Texture?this.depthStencilAttachment=vt.view:this.depthStencilAttachment=vt}createColorTexture(vt,bt){return this.device.createTexture({id:`${this.id}-color-attachment-${bt}`,usage:Texture.RENDER_ATTACHMENT,format:vt,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(vt){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Texture.RENDER_ATTACHMENT,format:vt,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(vt,bt){for(let Tt=0;Tt<this.colorAttachments.length;++Tt)if(this.colorAttachments[Tt]){const Et=this.colorAttachments[Tt].texture.clone({width:vt,height:bt});this.destroyAttachedResource(this.colorAttachments[Tt]),this.colorAttachments[Tt]=Et.view,this.attachResource(Et.view)}if(this.depthStencilAttachment){const Tt=this.depthStencilAttachment.texture.clone({width:vt,height:bt});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=Tt.view,this.attachResource(Tt)}this.updateAttachments()}};Bt(wn,"defaultProps",{...Resource$1.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Framebuffer=wn;const Sn=class Sn extends Resource$1{constructor(vt,bt){super(vt,bt,Sn.defaultProps);Bt(this,"shaderLayout");Bt(this,"bufferLayout");Bt(this,"linkStatus","pending");Bt(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(vt){throw new Error("Use uniform blocks")}};Bt(Sn,"defaultProps",{...Resource$1.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let RenderPipeline=Sn;const ln=class ln extends Resource$1{get[Symbol.toStringTag](){return"RenderPass"}constructor(yt,vt){vt=ln.normalizeProps(yt,vt),super(yt,vt,ln.defaultProps)}static normalizeProps(yt,vt){var Et;return{...(Et=yt.props._resourceDefaults)==null?void 0:Et.renderPass,...vt}}};Bt(ln,"defaultClearColor",[0,0,0,1]),Bt(ln,"defaultClearDepth",1),Bt(ln,"defaultClearStencil",0),Bt(ln,"defaultProps",{...Resource$1.defaultProps,framebuffer:null,parameters:void 0,clearColor:ln.defaultClearColor,clearColors:void 0,clearDepth:ln.defaultClearDepth,clearStencil:ln.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let RenderPass=ln;const An=class An extends Resource$1{constructor(vt,bt){super(vt,bt,An.defaultProps);Bt(this,"hash","");Bt(this,"shaderLayout");this.shaderLayout=bt.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};Bt(An,"defaultProps",{...Resource$1.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let ComputePipeline=An;const Rn=class Rn extends Resource$1{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(yt,vt){super(yt,vt,Rn.defaultProps)}};Bt(Rn,"defaultProps",{...Resource$1.defaultProps,measureExecutionTime:void 0});let CommandEncoder=Rn;const Pn=class Pn extends Resource$1{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(yt,vt){super(yt,vt,Pn.defaultProps)}};Bt(Pn,"defaultProps",{...Resource$1.defaultProps});let CommandBuffer=Pn;function decodeShaderAttributeType(xt){const[yt,vt]=TYPE_INFO[xt],bt=yt==="i32"||yt==="u32",Tt=yt!=="u32",Et=TYPE_SIZES[yt]*vt,wt=getCompatibleVertexFormat(yt,vt);return{dataType:yt,components:vt,defaultVertexFormat:wt,byteLength:Et,integer:bt,signed:Tt}}function getCompatibleVertexFormat(xt,yt){let vt;switch(xt){case"f32":vt="float32";break;case"i32":vt="sint32";break;case"u32":vt="uint32";break;case"f16":return yt<=2?"float16x2":"float16x4"}return yt===1?vt:`${vt}x${yt}`}const TYPE_INFO={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},TYPE_SIZES={f32:4,f16:2,i32:4,u32:4};function decodeVertexFormat(xt){let yt;xt.endsWith("-webgl")&&(xt.replace("-webgl",""),yt=!0);const[vt,bt]=xt.split("x"),Tt=vt,Et=bt?parseInt(bt):1,wt=decodeVertexType(Tt),St={type:Tt,components:Et,byteLength:wt.byteLength*Et,integer:wt.integer,signed:wt.signed,normalized:wt.normalized};return yt&&(St.webglOnly=!0),St}function getAttributeInfosFromLayouts(xt,yt){const vt={};for(const bt of xt.attributes){const Tt=getAttributeInfoFromLayouts(xt,yt,bt.name);Tt&&(vt[bt.name]=Tt)}return vt}function getAttributeInfosByLocation(xt,yt,vt=16){const bt=getAttributeInfosFromLayouts(xt,yt),Tt=new Array(vt).fill(null);for(const Et of Object.values(bt))Tt[Et.location]=Et;return Tt}function getAttributeInfoFromLayouts(xt,yt,vt){const bt=getAttributeFromShaderLayout(xt,vt),Tt=getAttributeFromBufferLayout(yt,vt);if(!bt)return null;const Et=decodeShaderAttributeType(bt.type),wt=(Tt==null?void 0:Tt.vertexFormat)||Et.defaultVertexFormat,St=decodeVertexFormat(wt);return{attributeName:(Tt==null?void 0:Tt.attributeName)||bt.name,bufferName:(Tt==null?void 0:Tt.bufferName)||bt.name,location:bt.location,shaderType:bt.type,shaderDataType:Et.dataType,shaderComponents:Et.components,vertexFormat:wt,bufferDataType:St.type,bufferComponents:St.components,normalized:St.normalized,integer:Et.integer,stepMode:(Tt==null?void 0:Tt.stepMode)||bt.stepMode||"vertex",byteOffset:(Tt==null?void 0:Tt.byteOffset)||0,byteStride:(Tt==null?void 0:Tt.byteStride)||0}}function getAttributeFromShaderLayout(xt,yt){const vt=xt.attributes.find(bt=>bt.name===yt);return vt||log.warn(`shader layout attribute "${yt}" not present in shader`),vt||null}function getAttributeFromBufferLayout(xt,yt){checkBufferLayouts(xt);let vt=getAttributeFromShortHand(xt,yt);return vt||(vt=getAttributeFromAttributesList(xt,yt),vt)?vt:(log.warn(`layout for attribute "${yt}" not present in buffer layout`),null)}function checkBufferLayouts(xt){for(const yt of xt)(yt.attributes&&yt.format||!yt.attributes&&!yt.format)&&log.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function getAttributeFromShortHand(xt,yt){for(const vt of xt)if(vt.format&&vt.name===yt)return{attributeName:vt.name,bufferName:yt,stepMode:vt.stepMode,vertexFormat:vt.format,byteOffset:0,byteStride:vt.byteStride||0};return null}function getAttributeFromAttributesList(xt,yt){var vt;for(const bt of xt){let Tt=bt.byteStride;if(typeof bt.byteStride!="number")for(const wt of bt.attributes||[]){const St=decodeVertexFormat(wt.format);Tt+=St.byteLength}const Et=(vt=bt.attributes)==null?void 0:vt.find(wt=>wt.attribute===yt);if(Et)return{attributeName:Et.attribute,bufferName:bt.name,stepMode:bt.stepMode,vertexFormat:Et.format,byteOffset:Et.byteOffset,byteStride:Tt}}return null}const Cn=class Cn extends Resource$1{constructor(vt,bt){super(vt,bt,Cn.defaultProps);Bt(this,"maxVertexAttributes");Bt(this,"attributeInfos");Bt(this,"indexBuffer",null);Bt(this,"attributes");this.maxVertexAttributes=vt.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:Tt,bufferLayout:Et}=bt.renderPipeline||{};if(!Tt||!Et)throw new Error("VertexArray");this.attributeInfos=getAttributeInfosByLocation(Tt,Et,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(vt,bt){this.device.reportError(new Error("constant attributes not supported"))}};Bt(Cn,"defaultProps",{...Resource$1.defaultProps,renderPipeline:null});let VertexArray=Cn;const In=class In extends Resource$1{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(yt,vt){super(yt,vt,In.defaultProps)}};Bt(In,"defaultProps",{...Resource$1.defaultProps,layout:void 0,buffers:{}});let TransformFeedback=In;const Mn=class Mn extends Resource$1{get[Symbol.toStringTag](){return"QuerySet"}constructor(yt,vt){super(yt,vt,Mn.defaultProps)}};Bt(Mn,"defaultProps",{...Resource$1.defaultProps,type:void 0,count:void 0});let QuerySet=Mn;const UNIFORM_FORMATS={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function decodeShaderUniformType(xt){return UNIFORM_FORMATS[xt]}function alignTo(xt,yt){switch(yt){case 1:return xt;case 2:return xt+xt%2;default:return xt+(4-xt%4)%4}}let arrayBuffer;function getScratchArrayBuffer(xt){return(!arrayBuffer||arrayBuffer.byteLength<xt)&&(arrayBuffer=new ArrayBuffer(xt)),arrayBuffer}function getScratchArray(xt,yt){const vt=getScratchArrayBuffer(xt.BYTES_PER_ELEMENT*yt);return new xt(vt,0,yt)}function isTypedArray$1(xt){return ArrayBuffer.isView(xt)&&!(xt instanceof DataView)}function isNumberArray$1(xt){return Array.isArray(xt)?xt.length===0||typeof xt[0]=="number":isTypedArray$1(xt)}const minBufferSize=1024;class UniformBufferLayout{constructor(yt){Bt(this,"layout",{});Bt(this,"byteLength");let vt=0;for(const[Tt,Et]of Object.entries(yt)){const wt=decodeShaderUniformType(Et),{type:St,components:At}=wt;vt=alignTo(vt,At);const Rt=vt;vt+=At,this.layout[Tt]={type:St,size:At,offset:Rt}}vt+=(4-vt%4)%4;const bt=vt*4;this.byteLength=Math.max(bt,minBufferSize)}getData(yt){const vt=Math.max(this.byteLength,minBufferSize),bt=getScratchArrayBuffer(vt),Tt={i32:new Int32Array(bt),u32:new Uint32Array(bt),f32:new Float32Array(bt),f16:new Uint16Array(bt)};for(const[Et,wt]of Object.entries(yt)){const St=this.layout[Et];if(!St){log.warn(`Supplied uniform value ${Et} not present in uniform block layout`)();continue}const{type:At,size:Rt,offset:Pt}=St,Ct=Tt[At];if(Rt===1){if(typeof wt!="number"&&typeof wt!="boolean"){log.warn(`Supplied value for single component uniform ${Et} is not a number: ${wt}`)();continue}Ct[Pt]=Number(wt)}else{if(!isNumberArray$1(wt)){log.warn(`Supplied value for multi component / array uniform ${Et} is not a numeric array: ${wt}`)();continue}Ct.set(wt,Pt)}}return new Uint8Array(bt)}has(yt){return!!this.layout[yt]}get(yt){return this.layout[yt]}}function arrayEqual(xt,yt,vt=16){if(xt!==yt)return!1;const bt=xt,Tt=yt;if(!isNumberArray$1(bt))return!1;if(isNumberArray$1(Tt)&&bt.length===Tt.length){for(let Et=0;Et<bt.length;++Et)if(Tt[Et]!==bt[Et])return!1}return!0}function arrayCopy(xt){return isNumberArray$1(xt)?xt.slice():xt}class UniformBlock{constructor(yt){Bt(this,"name");Bt(this,"uniforms",{});Bt(this,"modifiedUniforms",{});Bt(this,"modified",!0);Bt(this,"bindingLayout",{});Bt(this,"needsRedraw","initialized");var vt;if(this.name=(yt==null?void 0:yt.name)||"unnamed",yt!=null&&yt.name&&(yt!=null&&yt.shaderLayout)){const bt=(vt=yt==null?void 0:yt.shaderLayout.bindings)==null?void 0:vt.find(Et=>Et.type==="uniform"&&Et.name===(yt==null?void 0:yt.name));if(!bt)throw new Error(yt==null?void 0:yt.name);const Tt=bt;for(const Et of Tt.uniforms||[])this.bindingLayout[Et.name]=Et}}setUniforms(yt){for(const[vt,bt]of Object.entries(yt))this._setUniform(vt,bt),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${vt}=${bt}`)}setNeedsRedraw(yt){this.needsRedraw=this.needsRedraw||yt}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(yt,vt){arrayEqual(this.uniforms[yt],vt)||(this.uniforms[yt]=arrayCopy(vt),this.modifiedUniforms[yt]=!0,this.modified=!0)}}class UniformStore{constructor(yt){Bt(this,"uniformBlocks",new Map);Bt(this,"uniformBufferLayouts",new Map);Bt(this,"uniformBuffers",new Map);for(const[vt,bt]of Object.entries(yt)){const Tt=vt,Et=new UniformBufferLayout(bt.uniformTypes||{});this.uniformBufferLayouts.set(Tt,Et);const wt=new UniformBlock({name:vt});wt.setUniforms(bt.defaultUniforms||{}),this.uniformBlocks.set(Tt,wt)}}destroy(){for(const yt of this.uniformBuffers.values())yt.destroy()}setUniforms(yt){var vt;for(const[bt,Tt]of Object.entries(yt))(vt=this.uniformBlocks.get(bt))==null||vt.setUniforms(Tt);this.updateUniformBuffers()}getUniformBufferByteLength(yt){var vt;return((vt=this.uniformBufferLayouts.get(yt))==null?void 0:vt.byteLength)||0}getUniformBufferData(yt){var bt,Tt;const vt=((bt=this.uniformBlocks.get(yt))==null?void 0:bt.getAllUniforms())||{};return(Tt=this.uniformBufferLayouts.get(yt))==null?void 0:Tt.getData(vt)}createUniformBuffer(yt,vt,bt){bt&&this.setUniforms(bt);const Tt=this.getUniformBufferByteLength(vt),Et=yt.createBuffer({usage:Buffer.UNIFORM|Buffer.COPY_DST,byteLength:Tt}),wt=this.getUniformBufferData(vt);return Et.write(wt),Et}getManagedUniformBuffer(yt,vt){if(!this.uniformBuffers.get(vt)){const bt=this.getUniformBufferByteLength(vt),Tt=yt.createBuffer({usage:Buffer.UNIFORM|Buffer.COPY_DST,byteLength:bt});this.uniformBuffers.set(vt,Tt)}return this.uniformBuffers.get(vt)}updateUniformBuffers(){let yt=!1;for(const vt of this.uniformBlocks.keys()){const bt=this.updateUniformBuffer(vt);yt||(yt=bt)}return yt&&log.log(3,`UniformStore.updateUniformBuffers(): ${yt}`)(),yt}updateUniformBuffer(yt){var Et;const vt=this.uniformBlocks.get(yt);let bt=this.uniformBuffers.get(yt),Tt=!1;if(bt&&(vt!=null&&vt.needsRedraw)){Tt||(Tt=vt.needsRedraw);const wt=this.getUniformBufferData(yt);bt=this.uniformBuffers.get(yt),bt==null||bt.write(wt);const St=(Et=this.uniformBlocks.get(yt))==null?void 0:Et.getAllUniforms();log.log(4,`Writing to uniform buffer ${String(yt)}`,wt,St)()}return Tt}}function getDataTypeFromTypedArray(xt){const yt=ArrayBuffer.isView(xt)?xt.constructor:xt;switch(yt){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(yt.constructor.name)}}function getTypedArrayFromDataType(xt){switch(xt){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(xt)}}function getVertexFormatFromAttribute(xt,yt,vt){if(!yt||yt>4)throw new Error(`size ${yt}`);const bt=yt;let Tt=getDataTypeFromTypedArray(xt);if(Tt==="uint8"&&vt&&bt===1)return"unorm8-webgl";if(Tt==="uint8"&&vt&&bt===3)return"unorm8x3-webgl";if(Tt==="uint8"||Tt==="sint8"){if(bt===1||bt===3)throw new Error(`size: ${yt}`);return vt&&(Tt=Tt.replace("int","norm")),`${Tt}x${bt}`}if(Tt==="uint16"||Tt==="sint16"){if(bt===1||bt===3)throw new Error(`size: ${yt}`);return vt&&(Tt=Tt.replace("int","norm")),`${Tt}x${bt}`}return bt===1?Tt:`${Tt}x${bt}`}class BufferLayoutHelper{constructor(yt){Bt(this,"bufferLayouts");this.bufferLayouts=yt}getBufferLayout(yt){return this.bufferLayouts.find(vt=>vt.name===yt)||null}getAttributeNamesForBuffer(yt){var vt;return yt.attributes?(vt=yt.attributes)==null?void 0:vt.map(bt=>bt.attribute):[yt.name]}mergeBufferLayouts(yt,vt){const bt=[...yt];for(const Tt of vt){const Et=bt.findIndex(wt=>wt.name===Tt.name);Et<0?bt.push(Tt):bt[Et]=Tt}return bt}getBufferIndex(yt){const vt=this.bufferLayouts.findIndex(bt=>bt.name===yt);return vt===-1&&log.warn(`BufferLayout: Missing buffer for "${yt}".`)(),vt}}function sortedBufferLayoutByShaderSourceLocations(xt,yt){const vt=Object.fromEntries(xt.attributes.map(Tt=>[Tt.name,Tt.location])),bt=yt.slice();return bt.sort((Tt,Et)=>{const wt=Tt.attributes?Tt.attributes.map(Pt=>Pt.attribute):[Tt.name],St=Et.attributes?Et.attributes.map(Pt=>Pt.attribute):[Et.name],At=Math.min(...wt.map(Pt=>vt[Pt])),Rt=Math.min(...St.map(Pt=>vt[Pt]));return At-Rt}),bt}class e{constructor(yt,vt){this.name=yt,this.attributes=vt,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class t{constructor(yt,vt,bt){this.name=yt,this.type=vt,this.attributes=bt,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class n extends e{constructor(yt,vt){super(yt,vt),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class s extends e{constructor(yt,vt){super(yt,vt),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class r extends e{constructor(yt,vt,bt){super(yt,bt),this.format=vt}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class a extends e{constructor(yt,vt,bt,Tt){super(yt,bt),this.format=vt,this.access=Tt}get isTemplate(){return!0}getTypeName(){let yt=this.name;if(this.format!==null){if(yt==="vec2"||yt==="vec3"||yt==="vec4"||yt==="mat2x2"||yt==="mat2x3"||yt==="mat2x4"||yt==="mat3x2"||yt==="mat3x3"||yt==="mat3x4"||yt==="mat4x2"||yt==="mat4x3"||yt==="mat4x4"){if(this.format.name==="f32")return yt+="f",yt;if(this.format.name==="i32")return yt+="i",yt;if(this.format.name==="u32")return yt+="u",yt;if(this.format.name==="bool")return yt+="b",yt;if(this.format.name==="f16")return yt+="h",yt}yt+=`<${this.format.name}>`}else if(yt==="vec2"||yt==="vec3"||yt==="vec4")return yt;return yt}}var i;(xt=>{xt[xt.Uniform=0]="Uniform",xt[xt.Storage=1]="Storage",xt[xt.Texture=2]="Texture",xt[xt.Sampler=3]="Sampler",xt[xt.StorageTexture=4]="StorageTexture"})(i||(i={}));class o{constructor(yt,vt,bt,Tt,Et,wt,St){this.name=yt,this.type=vt,this.group=bt,this.binding=Tt,this.attributes=Et,this.resourceType=wt,this.access=St}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class c{constructor(yt,vt){this.name=yt,this.type=vt}}class l{constructor(yt,vt,bt,Tt){this.name=yt,this.type=vt,this.locationType=bt,this.location=Tt,this.interpolation=null}}class u{constructor(yt,vt,bt,Tt){this.name=yt,this.type=vt,this.locationType=bt,this.location=Tt}}class h{constructor(yt,vt,bt,Tt){this.name=yt,this.type=vt,this.attributes=bt,this.id=Tt}}class f{constructor(yt,vt,bt){this.name=yt,this.type=vt,this.attributes=bt}}class p{constructor(yt,vt=null,bt){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=yt,this.stage=vt,this.attributes=bt}}class d{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function m(xt){var yt=(32768&xt)>>15,vt=(31744&xt)>>10,bt=1023&xt;return vt==0?(yt?-1:1)*Math.pow(2,-14)*(bt/Math.pow(2,10)):vt==31?bt?NaN:1/0*(yt?-1:1):(yt?-1:1)*Math.pow(2,vt-15)*(1+bt/Math.pow(2,10))}const g=new Float32Array(1),_=new Int32Array(g.buffer),x=new Uint16Array(1);function y(xt){g[0]=xt;const yt=_[0],vt=yt>>31&1;let bt=yt>>23&255,Tt=8388607&yt;if(bt===255)return x[0]=vt<<15|31744|(Tt!==0?512:0),x[0];if(bt===0){if(Tt===0)return x[0]=vt<<15,x[0];Tt|=8388608;let Et=113;for(;!(8388608&Tt);)Tt<<=1,Et--;return bt=127-Et,Tt&=8388607,bt>0?(Tt=(Tt>>126-bt)+(Tt>>127-bt&1),x[0]=vt<<15|bt<<10|Tt>>13,x[0]):(x[0]=vt<<15,x[0])}return bt=bt-127+15,bt>=31?(x[0]=vt<<15|31744,x[0]):bt<=0?bt<-10?(x[0]=vt<<15,x[0]):(Tt=(8388608|Tt)>>1-bt,x[0]=vt<<15|Tt>>13,x[0]):(Tt>>=13,x[0]=vt<<15|bt<<10|Tt,x[0])}const b=new Uint32Array(1),v=new Float32Array(b.buffer,0,1);function w(xt){const yt=112+(xt>>6&31)<<23|(63&xt)<<17;return b[0]=yt,v[0]}function k(xt,yt,vt,bt,Tt,Et,wt,St,At){const Rt=bt*(wt>>=Tt)*(Et>>=Tt)+vt*wt+yt*St;switch(At){case"r8unorm":return[I(xt,Rt,"8unorm",1)[0]];case"r8snorm":return[I(xt,Rt,"8snorm",1)[0]];case"r8uint":return[I(xt,Rt,"8uint",1)[0]];case"r8sint":return[I(xt,Rt,"8sint",1)[0]];case"rg8unorm":{const Pt=I(xt,Rt,"8unorm",2);return[Pt[0],Pt[1]]}case"rg8snorm":{const Pt=I(xt,Rt,"8snorm",2);return[Pt[0],Pt[1]]}case"rg8uint":{const Pt=I(xt,Rt,"8uint",2);return[Pt[0],Pt[1]]}case"rg8sint":{const Pt=I(xt,Rt,"8sint",2);return[Pt[0],Pt[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const Pt=I(xt,Rt,"8unorm",4);return[Pt[0],Pt[1],Pt[2],Pt[3]]}case"rgba8snorm":{const Pt=I(xt,Rt,"8snorm",4);return[Pt[0],Pt[1],Pt[2],Pt[3]]}case"rgba8uint":{const Pt=I(xt,Rt,"8uint",4);return[Pt[0],Pt[1],Pt[2],Pt[3]]}case"rgba8sint":{const Pt=I(xt,Rt,"8sint",4);return[Pt[0],Pt[1],Pt[2],Pt[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const Pt=I(xt,Rt,"8unorm",4);return[Pt[2],Pt[1],Pt[0],Pt[3]]}case"r16uint":return[I(xt,Rt,"16uint",1)[0]];case"r16sint":return[I(xt,Rt,"16sint",1)[0]];case"r16float":return[I(xt,Rt,"16float",1)[0]];case"rg16uint":{const Pt=I(xt,Rt,"16uint",2);return[Pt[0],Pt[1]]}case"rg16sint":{const Pt=I(xt,Rt,"16sint",2);return[Pt[0],Pt[1]]}case"rg16float":{const Pt=I(xt,Rt,"16float",2);return[Pt[0],Pt[1]]}case"rgba16uint":{const Pt=I(xt,Rt,"16uint",4);return[Pt[0],Pt[1],Pt[2],Pt[3]]}case"rgba16sint":{const Pt=I(xt,Rt,"16sint",4);return[Pt[0],Pt[1],Pt[2],Pt[3]]}case"rgba16float":{const Pt=I(xt,Rt,"16float",4);return[Pt[0],Pt[1],Pt[2],Pt[3]]}case"r32uint":return[I(xt,Rt,"32uint",1)[0]];case"r32sint":return[I(xt,Rt,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[I(xt,Rt,"32float",1)[0]];case"rg32uint":{const Pt=I(xt,Rt,"32uint",2);return[Pt[0],Pt[1]]}case"rg32sint":{const Pt=I(xt,Rt,"32sint",2);return[Pt[0],Pt[1]]}case"rg32float":{const Pt=I(xt,Rt,"32float",2);return[Pt[0],Pt[1]]}case"rgba32uint":{const Pt=I(xt,Rt,"32uint",4);return[Pt[0],Pt[1],Pt[2],Pt[3]]}case"rgba32sint":{const Pt=I(xt,Rt,"32sint",4);return[Pt[0],Pt[1],Pt[2],Pt[3]]}case"rgba32float":{const Pt=I(xt,Rt,"32float",4);return[Pt[0],Pt[1],Pt[2],Pt[3]]}case"rg11b10ufloat":{const Pt=new Uint32Array(xt.buffer,Rt,1)[0],Ct=(4192256&Pt)>>11,It=(4290772992&Pt)>>22;return[w(2047&Pt),w(Ct),function(Mt){const Ot=112+(Mt>>5&31)<<23|(31&Mt)<<18;return b[0]=Ot,v[0]}(It),1]}}return null}function I(xt,yt,vt,bt){const Tt=[0,0,0,0];for(let Et=0;Et<bt;++Et)switch(vt){case"8unorm":Tt[Et]=xt[yt]/255,yt++;break;case"8snorm":Tt[Et]=xt[yt]/255*2-1,yt++;break;case"8uint":Tt[Et]=xt[yt],yt++;break;case"8sint":Tt[Et]=xt[yt]-127,yt++;break;case"16uint":Tt[Et]=xt[yt]|xt[yt+1]<<8,yt+=2;break;case"16sint":Tt[Et]=(xt[yt]|xt[yt+1]<<8)-32768,yt+=2;break;case"16float":Tt[Et]=m(xt[yt]|xt[yt+1]<<8),yt+=2;break;case"32uint":case"32sint":Tt[Et]=xt[yt]|xt[yt+1]<<8|xt[yt+2]<<16|xt[yt+3]<<24,yt+=4;break;case"32float":Tt[Et]=new Float32Array(xt.buffer,yt,1)[0],yt+=4}return Tt}function T(xt,yt,vt,bt,Tt){for(let Et=0;Et<bt;++Et)switch(vt){case"8unorm":xt[yt]=255*Tt[Et],yt++;break;case"8snorm":xt[yt]=.5*(Tt[Et]+1)*255,yt++;break;case"8uint":xt[yt]=Tt[Et],yt++;break;case"8sint":xt[yt]=Tt[Et]+127,yt++;break;case"16uint":new Uint16Array(xt.buffer,yt,1)[0]=Tt[Et],yt+=2;break;case"16sint":new Int16Array(xt.buffer,yt,1)[0]=Tt[Et],yt+=2;break;case"16float":{const wt=y(Tt[Et]);new Uint16Array(xt.buffer,yt,1)[0]=wt,yt+=2;break}case"32uint":new Uint32Array(xt.buffer,yt,1)[0]=Tt[Et],yt+=4;break;case"32sint":new Int32Array(xt.buffer,yt,1)[0]=Tt[Et],yt+=4;break;case"32float":new Float32Array(xt.buffer,yt,1)[0]=Tt[Et],yt+=4}return Tt}const S={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class A{constructor(){this.id=A._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(yt){yt(this)}searchBlock(yt,vt){if(yt){vt(E.instance);for(const bt of yt)bt instanceof Array?this.searchBlock(bt,vt):bt.search(vt);vt($.instance)}}constEvaluate(yt,vt){throw new Error("Cannot evaluate node")}constEvaluateString(yt){return this.constEvaluate(yt).toString()}}A._id=0;class E extends A{}E.instance=new E;class $ extends A{}$.instance=new $;const L=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class C extends A{constructor(){super()}}class D extends C{constructor(yt,vt,bt,Tt,Et,wt){super(),this.calls=new Set,this.name=yt,this.args=vt,this.returnType=bt,this.body=Tt,this.startLine=Et,this.endLine=wt}get astNodeType(){return"function"}search(yt){if(this.attributes)for(const vt of this.attributes)yt(vt);yt(this);for(const vt of this.args)yt(vt);this.searchBlock(this.body,yt)}}class N extends C{constructor(yt){super(),this.expression=yt}get astNodeType(){return"staticAssert"}search(yt){this.expression.search(yt)}}class V extends C{constructor(yt,vt){super(),this.condition=yt,this.body=vt}get astNodeType(){return"while"}search(yt){this.condition.search(yt),this.searchBlock(this.body,yt)}}class O extends C{constructor(yt,vt){super(),this.body=yt,this.loopId=vt}get astNodeType(){return"continuing"}search(yt){this.searchBlock(this.body,yt)}}class B extends C{constructor(yt,vt,bt,Tt){super(),this.init=yt,this.condition=vt,this.increment=bt,this.body=Tt}get astNodeType(){return"for"}search(yt){var vt,bt,Tt;(vt=this.init)===null||vt===void 0||vt.search(yt),(bt=this.condition)===null||bt===void 0||bt.search(yt),(Tt=this.increment)===null||Tt===void 0||Tt.search(yt),this.searchBlock(this.body,yt)}}class F extends C{constructor(yt,vt,bt,Tt,Et){super(),this.attributes=null,this.name=yt,this.type=vt,this.storage=bt,this.access=Tt,this.value=Et}get astNodeType(){return"var"}search(yt){var vt;yt(this),(vt=this.value)===null||vt===void 0||vt.search(yt)}}class M extends C{constructor(yt,vt,bt){super(),this.attributes=null,this.name=yt,this.type=vt,this.value=bt}get astNodeType(){return"override"}search(yt){var vt;(vt=this.value)===null||vt===void 0||vt.search(yt)}}class U extends C{constructor(yt,vt,bt,Tt,Et){super(),this.attributes=null,this.name=yt,this.type=vt,this.storage=bt,this.access=Tt,this.value=Et}get astNodeType(){return"let"}search(yt){var vt;yt(this),(vt=this.value)===null||vt===void 0||vt.search(yt)}}class P extends C{constructor(yt,vt,bt,Tt,Et){super(),this.attributes=null,this.name=yt,this.type=vt,this.storage=bt,this.access=Tt,this.value=Et}get astNodeType(){return"const"}constEvaluate(yt,vt){return this.value.constEvaluate(yt,vt)}search(yt){var vt;yt(this),(vt=this.value)===null||vt===void 0||vt.search(yt)}}var W,q,H,z;(xt=>{xt.increment="++",xt.decrement="--"})(W||(W={})),(xt=>{xt.parse=function(yt){const vt=yt;if(vt=="parse")throw new Error("Invalid value for IncrementOperator");return xt[vt]}})(W||(W={}));class R extends C{constructor(yt,vt){super(),this.operator=yt,this.variable=vt}get astNodeType(){return"increment"}search(yt){this.variable.search(yt)}}(xt=>{xt.assign="=",xt.addAssign="+=",xt.subtractAssin="-=",xt.multiplyAssign="*=",xt.divideAssign="/=",xt.moduloAssign="%=",xt.andAssign="&=",xt.orAssign="|=",xt.xorAssign="^=",xt.shiftLeftAssign="<<=",xt.shiftRightAssign=">>="})(q||(q={})),(xt=>{xt.parse=function(yt){const vt=yt;if(vt=="parse")throw new Error("Invalid value for AssignOperator");return vt}})(q||(q={}));class G extends C{constructor(yt,vt,bt){super(),this.operator=yt,this.variable=vt,this.value=bt}get astNodeType(){return"assign"}search(yt){this.variable.search(yt),this.value.search(yt)}}class X extends C{constructor(yt,vt){super(),this.name=yt,this.args=vt}get astNodeType(){return"call"}isBuiltin(){return L.has(this.name)}search(yt){for(const vt of this.args)vt.search(yt);yt(this)}}class j extends C{constructor(yt,vt){super(),this.body=yt,this.continuing=vt}get astNodeType(){return"loop"}search(yt){var vt;this.searchBlock(this.body,yt),(vt=this.continuing)===null||vt===void 0||vt.search(yt)}}class Z extends C{constructor(yt,vt){super(),this.condition=yt,this.cases=vt}get astNodeType(){return"switch"}search(yt){yt(this);for(const vt of this.cases)vt.search(yt)}}class Q extends C{constructor(yt,vt,bt,Tt){super(),this.condition=yt,this.body=vt,this.elseif=bt,this.else=Tt}get astNodeType(){return"if"}search(yt){this.condition.search(yt),this.searchBlock(this.body,yt),this.searchBlock(this.elseif,yt),this.searchBlock(this.else,yt)}}class Y extends C{constructor(yt){super(),this.value=yt}get astNodeType(){return"return"}search(yt){var vt;(vt=this.value)===null||vt===void 0||vt.search(yt)}}class K extends C{constructor(yt){super(),this.name=yt}get astNodeType(){return"enable"}}class J extends C{constructor(yt){super(),this.extensions=yt}get astNodeType(){return"requires"}}class ee extends C{constructor(yt,vt){super(),this.severity=yt,this.rule=vt}get astNodeType(){return"diagnostic"}}class te extends C{constructor(yt,vt){super(),this.name=yt,this.type=vt}get astNodeType(){return"alias"}}class ne extends C{constructor(){super()}get astNodeType(){return"discard"}}class se extends C{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class re extends C{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class ae extends C{constructor(yt){super(),this.attributes=null,this.name=yt}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(yt){let vt=yt[0];if(vt.name==="f32")return vt;for(let bt=1;bt<yt.length;++bt){const Tt=ae._priority.get(vt.name);ae._priority.get(yt[bt].name)<Tt&&(vt=yt[bt])}return vt.name==="x32"?ae.i32:vt}getTypeName(){return this.name}}ae.x32=new ae("x32"),ae.f32=new ae("f32"),ae.i32=new ae("i32"),ae.u32=new ae("u32"),ae.f16=new ae("f16"),ae.bool=new ae("bool"),ae.void=new ae("void"),ae._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class ie extends ae{constructor(yt){super(yt)}}class oe extends ae{constructor(yt,vt,bt,Tt){super(yt),this.members=vt,this.startLine=bt,this.endLine=Tt}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(yt){for(let vt=0;vt<this.members.length;vt++)if(this.members[vt].name==yt)return vt;return-1}search(yt){for(const vt of this.members)yt(vt)}}class ce extends ae{constructor(yt,vt,bt){super(yt),this.format=vt,this.access=bt}get astNodeType(){return"template"}getTypeName(){let yt=this.name;if(this.format!==null){if(yt==="vec2"||yt==="vec3"||yt==="vec4"||yt==="mat2x2"||yt==="mat2x3"||yt==="mat2x4"||yt==="mat3x2"||yt==="mat3x3"||yt==="mat3x4"||yt==="mat4x2"||yt==="mat4x3"||yt==="mat4x4"){if(this.format.name==="f32")return yt+="f",yt;if(this.format.name==="i32")return yt+="i",yt;if(this.format.name==="u32")return yt+="u",yt;if(this.format.name==="bool")return yt+="b",yt;if(this.format.name==="f16")return yt+="h",yt}yt+=`<${this.format.name}>`}else if(yt==="vec2"||yt==="vec3"||yt==="vec4")return yt;return yt}}ce.vec2f=new ce("vec2",ae.f32,null),ce.vec3f=new ce("vec3",ae.f32,null),ce.vec4f=new ce("vec4",ae.f32,null),ce.vec2i=new ce("vec2",ae.i32,null),ce.vec3i=new ce("vec3",ae.i32,null),ce.vec4i=new ce("vec4",ae.i32,null),ce.vec2u=new ce("vec2",ae.u32,null),ce.vec3u=new ce("vec3",ae.u32,null),ce.vec4u=new ce("vec4",ae.u32,null),ce.vec2h=new ce("vec2",ae.f16,null),ce.vec3h=new ce("vec3",ae.f16,null),ce.vec4h=new ce("vec4",ae.f16,null),ce.vec2b=new ce("vec2",ae.bool,null),ce.vec3b=new ce("vec3",ae.bool,null),ce.vec4b=new ce("vec4",ae.bool,null),ce.mat2x2f=new ce("mat2x2",ae.f32,null),ce.mat2x3f=new ce("mat2x3",ae.f32,null),ce.mat2x4f=new ce("mat2x4",ae.f32,null),ce.mat3x2f=new ce("mat3x2",ae.f32,null),ce.mat3x3f=new ce("mat3x3",ae.f32,null),ce.mat3x4f=new ce("mat3x4",ae.f32,null),ce.mat4x2f=new ce("mat4x2",ae.f32,null),ce.mat4x3f=new ce("mat4x3",ae.f32,null),ce.mat4x4f=new ce("mat4x4",ae.f32,null),ce.mat2x2h=new ce("mat2x2",ae.f16,null),ce.mat2x3h=new ce("mat2x3",ae.f16,null),ce.mat2x4h=new ce("mat2x4",ae.f16,null),ce.mat3x2h=new ce("mat3x2",ae.f16,null),ce.mat3x3h=new ce("mat3x3",ae.f16,null),ce.mat3x4h=new ce("mat3x4",ae.f16,null),ce.mat4x2h=new ce("mat4x2",ae.f16,null),ce.mat4x3h=new ce("mat4x3",ae.f16,null),ce.mat4x4h=new ce("mat4x4",ae.f16,null),ce.mat2x2i=new ce("mat2x2",ae.i32,null),ce.mat2x3i=new ce("mat2x3",ae.i32,null),ce.mat2x4i=new ce("mat2x4",ae.i32,null),ce.mat3x2i=new ce("mat3x2",ae.i32,null),ce.mat3x3i=new ce("mat3x3",ae.i32,null),ce.mat3x4i=new ce("mat3x4",ae.i32,null),ce.mat4x2i=new ce("mat4x2",ae.i32,null),ce.mat4x3i=new ce("mat4x3",ae.i32,null),ce.mat4x4i=new ce("mat4x4",ae.i32,null),ce.mat2x2u=new ce("mat2x2",ae.u32,null),ce.mat2x3u=new ce("mat2x3",ae.u32,null),ce.mat2x4u=new ce("mat2x4",ae.u32,null),ce.mat3x2u=new ce("mat3x2",ae.u32,null),ce.mat3x3u=new ce("mat3x3",ae.u32,null),ce.mat3x4u=new ce("mat3x4",ae.u32,null),ce.mat4x2u=new ce("mat4x2",ae.u32,null),ce.mat4x3u=new ce("mat4x3",ae.u32,null),ce.mat4x4u=new ce("mat4x4",ae.u32,null);class le extends ae{constructor(yt,vt,bt,Tt){super(yt),this.storage=vt,this.type=bt,this.access=Tt}get astNodeType(){return"pointer"}}class ue extends ae{constructor(yt,vt,bt,Tt){super(yt),this.attributes=vt,this.format=bt,this.count=Tt}get astNodeType(){return"array"}get isArray(){return!0}}class he extends ae{constructor(yt,vt,bt){super(yt),this.format=vt,this.access=bt}get astNodeType(){return"sampler"}}class fe extends A{constructor(){super(),this.postfix=null}}class pe extends fe{constructor(yt){super(),this.value=yt}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class de extends fe{constructor(yt,vt){super(),this.type=yt,this.args=vt}get astNodeType(){return"createExpr"}search(yt){if(yt(this),this.args)for(const vt of this.args)vt.search(yt)}constEvaluate(yt,vt){return vt&&(vt[0]=this.type),yt.evalExpression(this,yt.context)}}class me extends fe{constructor(yt,vt){super(),this.cachedReturnValue=null,this.name=yt,this.args=vt}get astNodeType(){return"callExpr"}setCachedReturnValue(yt){this.cachedReturnValue=yt}get isBuiltin(){return L.has(this.name)}constEvaluate(yt,vt){return yt.evalExpression(this,yt.context)}search(yt){for(const vt of this.args)vt.search(yt);yt(this)}}class ge extends fe{constructor(yt){super(),this.name=yt}get astNodeType(){return"varExpr"}search(yt){yt(this),this.postfix&&this.postfix.search(yt)}constEvaluate(yt,vt){return yt.evalExpression(this,yt.context)}}class _e extends fe{constructor(yt,vt){super(),this.name=yt,this.initializer=vt}get astNodeType(){return"constExpr"}constEvaluate(yt,vt){if(this.initializer){const bt=yt.evalExpression(this.initializer,yt.context);return bt!==null&&this.postfix?bt.getSubData(yt,this.postfix,yt.context):bt}return null}search(yt){this.initializer.search(yt)}}class xe extends fe{constructor(yt,vt){super(),this.value=yt,this.type=vt}get astNodeType(){return"literalExpr"}constEvaluate(yt,vt){return vt!==void 0&&(vt[0]=this.type),this.value}get isScalar(){return this.value instanceof Be}get isVector(){return this.value instanceof Me||this.value instanceof Ue}get scalarValue(){return this.value instanceof Be?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Me||this.value instanceof Ue?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class ye extends fe{constructor(yt,vt){super(),this.type=yt,this.value=vt}get astNodeType(){return"bitcastExpr"}search(yt){this.value.search(yt)}}class ve extends fe{constructor(yt){super(),this.index=yt}search(yt){this.index.search(yt)}}class we extends fe{constructor(){super()}}class ke extends we{constructor(yt,vt){super(),this.operator=yt,this.right=vt}get astNodeType(){return"unaryOp"}constEvaluate(yt,vt){return yt.evalExpression(this,yt.context)}search(yt){this.right.search(yt)}}class Ie extends we{constructor(yt,vt,bt){super(),this.operator=yt,this.left=vt,this.right=bt}get astNodeType(){return"binaryOp"}_getPromotedType(yt,vt){return yt.name===vt.name?yt:yt.name==="f32"||vt.name==="f32"?ae.f32:yt.name==="u32"||vt.name==="u32"?ae.u32:ae.i32}constEvaluate(yt,vt){return yt.evalExpression(this,yt.context)}search(yt){this.left.search(yt),this.right.search(yt)}}class Te extends A{constructor(yt){super(),this.body=yt}search(yt){yt(this),this.searchBlock(this.body,yt)}}class Se extends fe{constructor(){super()}get astNodeType(){return"default"}}class Ae extends Te{constructor(yt,vt){super(vt),this.selectors=yt}get astNodeType(){return"case"}search(yt){this.searchBlock(this.body,yt)}}class Ee extends Te{constructor(yt){super(yt)}get astNodeType(){return"default"}search(yt){this.searchBlock(this.body,yt)}}class $e extends A{constructor(yt,vt,bt){super(),this.name=yt,this.type=vt,this.attributes=bt}get astNodeType(){return"argument"}}class Le extends A{constructor(yt,vt){super(),this.condition=yt,this.body=vt}get astNodeType(){return"elseif"}search(yt){this.condition.search(yt),this.searchBlock(this.body,yt)}}class Ce extends A{constructor(yt,vt,bt){super(),this.name=yt,this.type=vt,this.attributes=bt}get astNodeType(){return"member"}}class De extends A{constructor(yt,vt){super(),this.name=yt,this.value=vt}get astNodeType(){return"attribute"}}class Ne{constructor(yt,vt){this.parent=null,this.typeInfo=yt,this.parent=vt,this.id=Ne._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(yt,vt,bt,Tt){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(yt,vt,bt){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Ne._id=0;class Ve extends Ne{constructor(){super(new e("void",null),null)}toString(){return"void"}}Ve.void=new Ve;class Oe extends Ne{constructor(yt){super(new r("pointer",yt.typeInfo,null),null),this.reference=yt}clone(){return this}setDataValue(yt,vt,bt,Tt){this.reference.setDataValue(yt,vt,bt,Tt)}getSubData(yt,vt,bt){return vt?this.reference.getSubData(yt,vt,bt):this}toString(){return`&${this.reference.toString()}`}}class Be extends Ne{constructor(yt,vt,bt=null){super(vt,bt),yt instanceof Int32Array||yt instanceof Uint32Array||yt instanceof Float32Array?this.data=yt:this.typeInfo.name==="x32"?yt-Math.floor(yt)!==0?this.data=new Float32Array([yt]):this.data=yt>=0?new Uint32Array([yt]):new Int32Array([yt]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([yt]):this.typeInfo.name==="u32"?this.data=new Uint32Array([yt]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([yt]):console.error("ScalarData2: Invalid type",vt)}clone(){if(this.data instanceof Float32Array)return new Be(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Be(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Be(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(yt){this.data[0]=yt}setDataValue(yt,vt,bt,Tt){if(bt)return void console.error("SetDataValue: Scalar data does not support postfix",bt);if(!(vt instanceof Be))return void console.error("SetDataValue: Invalid value",vt);let Et=vt.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?Et=Math.floor(Et):this.typeInfo.name==="bool"&&(Et=Et?1:0),this.data[0]=Et}getSubData(yt,vt,bt){return vt?(console.error("getSubData: Scalar data does not support postfix",vt),null):this}toString(){return`${this.value}`}}function Fe(xt,yt,vt){const bt=yt.length;return bt===2?vt==="f32"?new Me(new Float32Array(yt),xt.getTypeInfo("vec2f")):vt==="i32"||vt==="bool"?new Me(new Int32Array(yt),xt.getTypeInfo("vec2i")):vt==="u32"?new Me(new Uint32Array(yt),xt.getTypeInfo("vec2u")):vt==="f16"?new Me(new Float32Array(yt),xt.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${vt}`),null):bt===3?vt==="f32"?new Me(new Float32Array(yt),xt.getTypeInfo("vec3f")):vt==="i32"||vt==="bool"?new Me(new Int32Array(yt),xt.getTypeInfo("vec3i")):vt==="u32"?new Me(new Uint32Array(yt),xt.getTypeInfo("vec3u")):vt==="f16"?new Me(new Float32Array(yt),xt.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${vt}`),null):bt===4?vt==="f32"?new Me(new Float32Array(yt),xt.getTypeInfo("vec4f")):vt==="i32"||vt==="bool"?new Me(new Int32Array(yt),xt.getTypeInfo("vec4i")):vt==="u32"?new Me(new Uint32Array(yt),xt.getTypeInfo("vec4u")):vt==="f16"?new Me(new Float32Array(yt),xt.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${vt}`),null):(console.error(`getSubData: Invalid vector size ${yt.length}`),null)}class Me extends Ne{constructor(yt,vt,bt=null){if(super(vt,bt),yt instanceof Float32Array||yt instanceof Uint32Array||yt instanceof Int32Array)this.data=yt;else{const Tt=this.typeInfo.name;Tt==="vec2f"||Tt==="vec3f"||Tt==="vec4f"?this.data=new Float32Array(yt):Tt==="vec2i"||Tt==="vec3i"||Tt==="vec4i"?this.data=new Int32Array(yt):Tt==="vec2u"||Tt==="vec3u"||Tt==="vec4u"?this.data=new Uint32Array(yt):Tt==="vec2h"||Tt==="vec3h"||Tt==="vec4h"?this.data=new Float32Array(yt):Tt==="vec2b"||Tt==="vec3b"||Tt==="vec4b"?this.data=new Int32Array(yt):Tt==="vec2"||Tt==="vec3"||Tt==="vec4"?this.data=new Float32Array(yt):console.error(`VectorData: Invalid type ${Tt}`)}}clone(){if(this.data instanceof Float32Array)return new Me(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Me(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Me(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(yt,vt,bt,Tt){bt instanceof pe?console.error("TODO: Set vector postfix"):vt instanceof Me?this.data=vt.data:console.error("SetDataValue: Invalid value",vt)}getSubData(yt,vt,bt){if(vt===null)return this;let Tt=yt.getTypeInfo("f32");if(this.typeInfo instanceof a)Tt=this.typeInfo.format||Tt;else{const wt=this.typeInfo.name;wt==="vec2f"||wt==="vec3f"||wt==="vec4f"?Tt=yt.getTypeInfo("f32"):wt==="vec2i"||wt==="vec3i"||wt==="vec4i"?Tt=yt.getTypeInfo("i32"):wt==="vec2b"||wt==="vec3b"||wt==="vec4b"?Tt=yt.getTypeInfo("bool"):wt==="vec2u"||wt==="vec3u"||wt==="vec4u"?Tt=yt.getTypeInfo("u32"):wt==="vec2h"||wt==="vec3h"||wt==="vec4h"?Tt=yt.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${wt}`)}let Et=this;for(;vt!==null&&Et!==null;){if(vt instanceof ve){const wt=vt.index;let St=-1;if(wt instanceof xe){if(!(wt.value instanceof Be))return console.error(`GetSubData: Invalid array index ${wt.value}`),null;St=wt.value.value}else{const At=yt.evalExpression(wt,bt);if(!(At instanceof Be))return console.error("GetSubData: Unknown index type",wt),null;St=At.value}if(St<0||St>=Et.data.length)return console.error("GetSubData: Index out of range",St),null;if(Et.data instanceof Float32Array){const At=new Float32Array(Et.data.buffer,Et.data.byteOffset+4*St,1);return new Be(At,Tt)}if(Et.data instanceof Int32Array){const At=new Int32Array(Et.data.buffer,Et.data.byteOffset+4*St,1);return new Be(At,Tt)}if(Et.data instanceof Uint32Array){const At=new Uint32Array(Et.data.buffer,Et.data.byteOffset+4*St,1);return new Be(At,Tt)}throw"GetSubData: Invalid data type"}if(!(vt instanceof pe))return console.error("GetSubData: Unknown postfix",vt),null;{const wt=vt.value.toLowerCase();if(wt.length===1){let At=0;if(wt==="x"||wt==="r")At=0;else if(wt==="y"||wt==="g")At=1;else if(wt==="z"||wt==="b")At=2;else{if(wt!=="w"&&wt!=="a")return console.error(`GetSubData: Unknown member ${wt}`),null;At=3}if(this.data instanceof Float32Array){let Rt=new Float32Array(this.data.buffer,this.data.byteOffset+4*At,1);return new Be(Rt,Tt,this)}if(this.data instanceof Int32Array){let Rt=new Int32Array(this.data.buffer,this.data.byteOffset+4*At,1);return new Be(Rt,Tt,this)}if(this.data instanceof Uint32Array){let Rt=new Uint32Array(this.data.buffer,this.data.byteOffset+4*At,1);return new Be(Rt,Tt,this)}}const St=[];for(const At of wt)At==="x"||At==="r"?St.push(this.data[0]):At==="y"||At==="g"?St.push(this.data[1]):At==="z"||At==="b"?St.push(this.data[2]):At==="w"||At==="a"?St.push(this.data[3]):console.error(`GetDataValue: Unknown member ${At}`);Et=Fe(yt,St,Tt.name)}vt=vt.postfix}return Et}toString(){let yt=`${this.data[0]}`;for(let vt=1;vt<this.data.length;++vt)yt+=`, ${this.data[vt]}`;return yt}}class Ue extends Ne{constructor(yt,vt,bt=null){super(vt,bt),yt instanceof Float32Array?this.data=yt:this.data=new Float32Array(yt)}clone(){return new Ue(new Float32Array(this.data),this.typeInfo,null)}setDataValue(yt,vt,bt,Tt){bt instanceof pe?console.error("TODO: Set matrix postfix"):vt instanceof Ue?this.data=vt.data:console.error("SetDataValue: Invalid value",vt)}getSubData(yt,vt,bt){if(vt===null)return this;const Tt=this.typeInfo.name;if(yt.getTypeInfo("f32"),this.typeInfo instanceof a)this.typeInfo.format;else if(Tt.endsWith("f"))yt.getTypeInfo("f32");else if(Tt.endsWith("i"))yt.getTypeInfo("i32");else if(Tt.endsWith("u"))yt.getTypeInfo("u32");else{if(!Tt.endsWith("h"))return console.error(`GetDataValue: Unknown type ${Tt}`),null;yt.getTypeInfo("f16")}if(vt instanceof ve){const Et=vt.index;let wt=-1;if(Et instanceof xe){if(!(Et.value instanceof Be))return console.error(`GetDataValue: Invalid array index ${Et.value}`),null;wt=Et.value.value}else{const Rt=yt.evalExpression(Et,bt);if(!(Rt instanceof Be))return console.error("GetDataValue: Unknown index type",Et),null;wt=Rt.value}if(wt<0||wt>=this.data.length)return console.error("GetDataValue: Index out of range",wt),null;const St=Tt.endsWith("h")?"h":"f";let At;if(Tt==="mat2x2"||Tt==="mat2x2f"||Tt==="mat2x2h"||Tt==="mat3x2"||Tt==="mat3x2f"||Tt==="mat3x2h"||Tt==="mat4x2"||Tt==="mat4x2f"||Tt==="mat4x2h")At=new Me(new Float32Array(this.data.buffer,this.data.byteOffset+2*wt*4,2),yt.getTypeInfo(`vec2${St}`));else if(Tt==="mat2x3"||Tt==="mat2x3f"||Tt==="mat2x3h"||Tt==="mat3x3"||Tt==="mat3x3f"||Tt==="mat3x3h"||Tt==="mat4x3"||Tt==="mat4x3f"||Tt==="mat4x3h")At=new Me(new Float32Array(this.data.buffer,this.data.byteOffset+3*wt*4,3),yt.getTypeInfo(`vec3${St}`));else{if(Tt!=="mat2x4"&&Tt!=="mat2x4f"&&Tt!=="mat2x4h"&&Tt!=="mat3x4"&&Tt!=="mat3x4f"&&Tt!=="mat3x4h"&&Tt!=="mat4x4"&&Tt!=="mat4x4f"&&Tt!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${Tt}`),null;At=new Me(new Float32Array(this.data.buffer,this.data.byteOffset+4*wt*4,4),yt.getTypeInfo(`vec4${St}`))}return vt.postfix?At.getSubData(yt,vt.postfix,bt):At}return console.error("GetDataValue: Invalid postfix",vt),null}toString(){let yt=`${this.data[0]}`;for(let vt=1;vt<this.data.length;++vt)yt+=`, ${this.data[vt]}`;return yt}}class Pe extends Ne{constructor(yt,vt,bt=0,Tt=null){super(vt,Tt),this.buffer=yt instanceof ArrayBuffer?yt:yt.buffer,this.offset=bt}clone(){const yt=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Pe(yt.buffer,this.typeInfo,0,null)}setDataValue(yt,vt,bt,Tt){if(vt===null)return void console.log("setDataValue: NULL data.");let Et=this.offset,wt=this.typeInfo;for(;bt;){if(bt instanceof ve)if(wt instanceof s){const St=bt.index;if(St instanceof xe){if(!(St.value instanceof Be))return void console.error(`SetDataValue: Invalid index type ${St.value}`);Et+=St.value.value*wt.stride}else{const At=yt.evalExpression(St,Tt);if(!(At instanceof Be))return void console.error("SetDataValue: Unknown index type",St);Et+=At.value*wt.stride}wt=wt.format}else console.error(`SetDataValue: Type ${wt.getTypeName()} is not an array`);else{if(!(bt instanceof pe))return void console.error("SetDataValue: Unknown postfix type",bt);{const St=bt.value;if(wt instanceof n){let At=!1;for(const Rt of wt.members)if(Rt.name===St){Et+=Rt.offset,wt=Rt.type,At=!0;break}if(!At)return void console.error(`SetDataValue: Member ${St} not found`)}else if(wt instanceof e){const At=wt.getTypeName();let Rt=0;if(St==="x"||St==="r")Rt=0;else if(St==="y"||St==="g")Rt=1;else if(St==="z"||St==="b")Rt=2;else{if(St!=="w"&&St!=="a")return void console.error(`SetDataValue: Unknown member ${St}`);Rt=3}if(!(vt instanceof Be))return void console.error("SetDataValue: Invalid value",vt);const Pt=vt.value;return At==="vec2f"?void(new Float32Array(this.buffer,Et,2)[Rt]=Pt):At==="vec3f"?void(new Float32Array(this.buffer,Et,3)[Rt]=Pt):At==="vec4f"?void(new Float32Array(this.buffer,Et,4)[Rt]=Pt):At==="vec2i"?void(new Int32Array(this.buffer,Et,2)[Rt]=Pt):At==="vec3i"?void(new Int32Array(this.buffer,Et,3)[Rt]=Pt):At==="vec4i"?void(new Int32Array(this.buffer,Et,4)[Rt]=Pt):At==="vec2u"?void(new Uint32Array(this.buffer,Et,2)[Rt]=Pt):At==="vec3u"?void(new Uint32Array(this.buffer,Et,3)[Rt]=Pt):At==="vec4u"?void(new Uint32Array(this.buffer,Et,4)[Rt]=Pt):void console.error(`SetDataValue: Type ${At} is not a struct`)}}}bt=bt.postfix}this.setData(yt,vt,wt,Et,Tt)}setData(yt,vt,bt,Tt,Et){const wt=bt.getTypeName();if(wt!=="f32"&&wt!=="f16")if(wt!=="i32"&&wt!=="atomic<i32>"&&wt!=="x32")if(wt!=="u32"&&wt!=="atomic<u32>")if(wt!=="bool"){if(wt==="vec2f"||wt==="vec2h"){const St=new Float32Array(this.buffer,Tt,2);return void(vt instanceof Me?(St[0]=vt.data[0],St[1]=vt.data[1]):(St[0]=vt[0],St[1]=vt[1]))}if(wt==="vec3f"||wt==="vec3h"){const St=new Float32Array(this.buffer,Tt,3);return void(vt instanceof Me?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2]))}if(wt==="vec4f"||wt==="vec4h"){const St=new Float32Array(this.buffer,Tt,4);return void(vt instanceof Me?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2],St[3]=vt.data[3]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2],St[3]=vt[3]))}if(wt==="vec2i"){const St=new Int32Array(this.buffer,Tt,2);return void(vt instanceof Me?(St[0]=vt.data[0],St[1]=vt.data[1]):(St[0]=vt[0],St[1]=vt[1]))}if(wt==="vec3i"){const St=new Int32Array(this.buffer,Tt,3);return void(vt instanceof Me?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2]))}if(wt==="vec4i"){const St=new Int32Array(this.buffer,Tt,4);return void(vt instanceof Me?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2],St[3]=vt.data[3]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2],St[3]=vt[3]))}if(wt==="vec2u"){const St=new Uint32Array(this.buffer,Tt,2);return void(vt instanceof Me?(St[0]=vt.data[0],St[1]=vt.data[1]):(St[0]=vt[0],St[1]=vt[1]))}if(wt==="vec3u"){const St=new Uint32Array(this.buffer,Tt,3);return void(vt instanceof Me?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2]))}if(wt==="vec4u"){const St=new Uint32Array(this.buffer,Tt,4);return void(vt instanceof Me?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2],St[3]=vt.data[3]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2],St[3]=vt[3]))}if(wt==="vec2b"){const St=new Uint32Array(this.buffer,Tt,2);return void(vt instanceof Me?(St[0]=vt.data[0],St[1]=vt.data[1]):(St[0]=vt[0],St[1]=vt[1]))}if(wt==="vec3b"){const St=new Uint32Array(this.buffer,Tt,3);return void(vt instanceof Me?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2]))}if(wt==="vec4b"){const St=new Uint32Array(this.buffer,Tt,4);return void(vt instanceof Me?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2],St[3]=vt.data[3]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2],St[3]=vt[3]))}if(wt==="mat2x2f"||wt==="mat2x2h"){const St=new Float32Array(this.buffer,Tt,4);return void(vt instanceof Ue?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2],St[3]=vt.data[3]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2],St[3]=vt[3]))}if(wt==="mat2x3f"||wt==="mat2x3h"){const St=new Float32Array(this.buffer,Tt,6);return void(vt instanceof Ue?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2],St[3]=vt.data[3],St[4]=vt.data[4],St[5]=vt.data[5]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2],St[3]=vt[3],St[4]=vt[4],St[5]=vt[5]))}if(wt==="mat2x4f"||wt==="mat2x4h"){const St=new Float32Array(this.buffer,Tt,8);return void(vt instanceof Ue?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2],St[3]=vt.data[3],St[4]=vt.data[4],St[5]=vt.data[5],St[6]=vt.data[6],St[7]=vt.data[7]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2],St[3]=vt[3],St[4]=vt[4],St[5]=vt[5],St[6]=vt[6],St[7]=vt[7]))}if(wt==="mat3x2f"||wt==="mat3x2h"){const St=new Float32Array(this.buffer,Tt,6);return void(vt instanceof Ue?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2],St[3]=vt.data[3],St[4]=vt.data[4],St[5]=vt.data[5]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2],St[3]=vt[3],St[4]=vt[4],St[5]=vt[5]))}if(wt==="mat3x3f"||wt==="mat3x3h"){const St=new Float32Array(this.buffer,Tt,9);return void(vt instanceof Ue?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2],St[3]=vt.data[3],St[4]=vt.data[4],St[5]=vt.data[5],St[6]=vt.data[6],St[7]=vt.data[7],St[8]=vt.data[8]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2],St[3]=vt[3],St[4]=vt[4],St[5]=vt[5],St[6]=vt[6],St[7]=vt[7],St[8]=vt[8]))}if(wt==="mat3x4f"||wt==="mat3x4h"){const St=new Float32Array(this.buffer,Tt,12);return void(vt instanceof Ue?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2],St[3]=vt.data[3],St[4]=vt.data[4],St[5]=vt.data[5],St[6]=vt.data[6],St[7]=vt.data[7],St[8]=vt.data[8],St[9]=vt.data[9],St[10]=vt.data[10],St[11]=vt.data[11]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2],St[3]=vt[3],St[4]=vt[4],St[5]=vt[5],St[6]=vt[6],St[7]=vt[7],St[8]=vt[8],St[9]=vt[9],St[10]=vt[10],St[11]=vt[11]))}if(wt==="mat4x2f"||wt==="mat4x2h"){const St=new Float32Array(this.buffer,Tt,8);return void(vt instanceof Ue?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2],St[3]=vt.data[3],St[4]=vt.data[4],St[5]=vt.data[5],St[6]=vt.data[6],St[7]=vt.data[7]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2],St[3]=vt[3],St[4]=vt[4],St[5]=vt[5],St[6]=vt[6],St[7]=vt[7]))}if(wt==="mat4x3f"||wt==="mat4x3h"){const St=new Float32Array(this.buffer,Tt,12);return void(vt instanceof Ue?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2],St[3]=vt.data[3],St[4]=vt.data[4],St[5]=vt.data[5],St[6]=vt.data[6],St[7]=vt.data[7],St[8]=vt.data[8],St[9]=vt.data[9],St[10]=vt.data[10],St[11]=vt.data[11]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2],St[3]=vt[3],St[4]=vt[4],St[5]=vt[5],St[6]=vt[6],St[7]=vt[7],St[8]=vt[8],St[9]=vt[9],St[10]=vt[10],St[11]=vt[11]))}if(wt==="mat4x4f"||wt==="mat4x4h"){const St=new Float32Array(this.buffer,Tt,16);return void(vt instanceof Ue?(St[0]=vt.data[0],St[1]=vt.data[1],St[2]=vt.data[2],St[3]=vt.data[3],St[4]=vt.data[4],St[5]=vt.data[5],St[6]=vt.data[6],St[7]=vt.data[7],St[8]=vt.data[8],St[9]=vt.data[9],St[10]=vt.data[10],St[11]=vt.data[11],St[12]=vt.data[12],St[13]=vt.data[13],St[14]=vt.data[14],St[15]=vt.data[15]):(St[0]=vt[0],St[1]=vt[1],St[2]=vt[2],St[3]=vt[3],St[4]=vt[4],St[5]=vt[5],St[6]=vt[6],St[7]=vt[7],St[8]=vt[8],St[9]=vt[9],St[10]=vt[10],St[11]=vt[11],St[12]=vt[12],St[13]=vt[13],St[14]=vt[14],St[15]=vt[15]))}if(vt instanceof Pe){if(bt===vt.typeInfo)return void new Uint8Array(this.buffer,Tt,vt.buffer.byteLength).set(new Uint8Array(vt.buffer));console.error("SetDataValue: Type mismatch",wt,vt.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${wt}`)}else vt instanceof Be&&(new Int32Array(this.buffer,Tt,1)[0]=vt.value);else vt instanceof Be&&(new Uint32Array(this.buffer,Tt,1)[0]=vt.value);else vt instanceof Be&&(new Int32Array(this.buffer,Tt,1)[0]=vt.value);else vt instanceof Be&&(new Float32Array(this.buffer,Tt,1)[0]=vt.value)}getSubData(yt,vt,bt){var Tt,Et,wt;if(vt===null)return this;let St=this.offset,At=this.typeInfo;for(;vt;){if(vt instanceof ve){const Pt=vt.index,Ct=Pt instanceof fe?yt.evalExpression(Pt,bt):Pt;let It=0;if(Ct instanceof Be?It=Ct.value:typeof Ct=="number"?It=Ct:console.error("GetDataValue: Invalid index type",Pt),At instanceof s)St+=It*At.stride,At=At.format;else{const Mt=At.getTypeName();Mt==="mat4x4"||Mt==="mat4x4f"||Mt==="mat4x4h"?(St+=16*It,At=yt.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${At.getTypeName()} is not an array`)}}else{if(!(vt instanceof pe))return console.error("GetDataValue: Unknown postfix type",vt),null;{const Pt=vt.value;if(At instanceof n){let Ct=!1;for(const It of At.members)if(It.name===Pt){St+=It.offset,At=It.type,Ct=!0;break}if(!Ct)return console.error(`GetDataValue: Member ${Pt} not found`),null}else if(At instanceof e){const Ct=At.getTypeName();if(Ct==="vec2f"||Ct==="vec3f"||Ct==="vec4f"||Ct==="vec2i"||Ct==="vec3i"||Ct==="vec4i"||Ct==="vec2u"||Ct==="vec3u"||Ct==="vec4u"||Ct==="vec2b"||Ct==="vec3b"||Ct==="vec4b"||Ct==="vec2h"||Ct==="vec3h"||Ct==="vec4h"||Ct==="vec2"||Ct==="vec3"||Ct==="vec4"){if(Pt.length>0&&Pt.length<5){let It="f";const Mt=[];for(let Ot=0;Ot<Pt.length;++Ot){const kt=Pt[Ot].toLowerCase();let Ft=0;if(kt==="x"||kt==="r")Ft=0;else if(kt==="y"||kt==="g")Ft=1;else if(kt==="z"||kt==="b")Ft=2;else{if(kt!=="w"&&kt!=="a")return console.error(`Unknown member ${Pt}`),null;Ft=3}if(Pt.length===1){if(Ct.endsWith("f"))return this.buffer.byteLength<St+4*Ft+4?(console.log("Insufficient buffer data"),null):new Be(new Float32Array(this.buffer,St+4*Ft,1),yt.getTypeInfo("f32"),this);if(Ct.endsWith("h"))return new Be(new Float32Array(this.buffer,St+4*Ft,1),yt.getTypeInfo("f16"),this);if(Ct.endsWith("i"))return new Be(new Int32Array(this.buffer,St+4*Ft,1),yt.getTypeInfo("i32"),this);if(Ct.endsWith("b"))return new Be(new Int32Array(this.buffer,St+4*Ft,1),yt.getTypeInfo("bool"),this);if(Ct.endsWith("u"))return new Be(new Uint32Array(this.buffer,St+4*Ft,1),yt.getTypeInfo("i32"),this)}if(Ct==="vec2f")Mt.push(new Float32Array(this.buffer,St,2)[Ft]);else if(Ct==="vec3f"){if(St+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const Nt=new Float32Array(this.buffer,St,3);Mt.push(Nt[Ft])}else if(Ct==="vec4f")Mt.push(new Float32Array(this.buffer,St,4)[Ft]);else if(Ct==="vec2i")It="i",Mt.push(new Int32Array(this.buffer,St,2)[Ft]);else if(Ct==="vec3i")It="i",Mt.push(new Int32Array(this.buffer,St,3)[Ft]);else if(Ct==="vec4i")It="i",Mt.push(new Int32Array(this.buffer,St,4)[Ft]);else if(Ct==="vec2u"){It="u";const Nt=new Uint32Array(this.buffer,St,2);Mt.push(Nt[Ft])}else Ct==="vec3u"?(It="u",Mt.push(new Uint32Array(this.buffer,St,3)[Ft])):Ct==="vec4u"&&(It="u",Mt.push(new Uint32Array(this.buffer,St,4)[Ft]))}return Mt.length===2?At=yt.getTypeInfo(`vec2${It}`):Mt.length===3?At=yt.getTypeInfo(`vec3${It}`):Mt.length===4?At=yt.getTypeInfo(`vec4${It}`):console.error(`GetDataValue: Invalid vector length ${Mt.length}`),new Me(Mt,At,null)}return console.error(`GetDataValue: Unknown member ${Pt}`),null}return console.error(`GetDataValue: Type ${Ct} is not a struct`),null}}}vt=vt.postfix}const Rt=At.getTypeName();return Rt==="f32"?new Be(new Float32Array(this.buffer,St,1),At,this):Rt==="i32"?new Be(new Int32Array(this.buffer,St,1),At,this):Rt==="u32"?new Be(new Uint32Array(this.buffer,St,1),At,this):Rt==="vec2f"?new Me(new Float32Array(this.buffer,St,2),At,this):Rt==="vec3f"?new Me(new Float32Array(this.buffer,St,3),At,this):Rt==="vec4f"?new Me(new Float32Array(this.buffer,St,4),At,this):Rt==="vec2i"?new Me(new Int32Array(this.buffer,St,2),At,this):Rt==="vec3i"?new Me(new Int32Array(this.buffer,St,3),At,this):Rt==="vec4i"?new Me(new Int32Array(this.buffer,St,4),At,this):Rt==="vec2u"?new Me(new Uint32Array(this.buffer,St,2),At,this):Rt==="vec3u"?new Me(new Uint32Array(this.buffer,St,3),At,this):Rt==="vec4u"?new Me(new Uint32Array(this.buffer,St,4),At,this):At instanceof a&&At.name==="atomic"?((Tt=At.format)===null||Tt===void 0?void 0:Tt.name)==="u32"?new Be(new Uint32Array(this.buffer,St,1)[0],At.format,this):((Et=At.format)===null||Et===void 0?void 0:Et.name)==="i32"?new Be(new Int32Array(this.buffer,St,1)[0],At.format,this):(console.error(`GetDataValue: Invalid atomic format ${(wt=At.format)===null||wt===void 0?void 0:wt.name}`),null):new Pe(this.buffer,At,St,this)}toString(){let yt="";if(this.typeInfo instanceof s)if(this.typeInfo.format.name==="f32"){const vt=new Float32Array(this.buffer,this.offset);yt=`[${vt[0]}`;for(let bt=1;bt<vt.length;++bt)yt+=`, ${vt[bt]}`}else if(this.typeInfo.format.name==="i32"){const vt=new Int32Array(this.buffer,this.offset);yt=`[${vt[0]}`;for(let bt=1;bt<vt.length;++bt)yt+=`, ${vt[bt]}`}else if(this.typeInfo.format.name==="u32"){const vt=new Uint32Array(this.buffer,this.offset);yt=`[${vt[0]}`;for(let bt=1;bt<vt.length;++bt)yt+=`, ${vt[bt]}`}else if(this.typeInfo.format.name==="vec2f"){const vt=new Float32Array(this.buffer,this.offset);yt=`[${vt[0]}, ${vt[1]}]`;for(let bt=1;bt<vt.length/2;++bt)yt+=`, [${vt[2*bt]}, ${vt[2*bt+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const vt=new Float32Array(this.buffer,this.offset);yt=`[${vt[0]}, ${vt[1]}, ${vt[2]}]`;for(let bt=4;bt<vt.length;bt+=4)yt+=`, [${vt[bt]}, ${vt[bt+1]}, ${vt[bt+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const vt=new Float32Array(this.buffer,this.offset);yt=`[${vt[0]}, ${vt[1]}, ${vt[2]}, ${vt[3]}]`;for(let bt=4;bt<vt.length;bt+=4)yt+=`, [${vt[bt]}, ${vt[bt+1]}, ${vt[bt+2]}, ${vt[bt+3]}]`}else yt="[...]";else this.typeInfo instanceof n?yt+="{...}":yt="[...]";return yt}}class We extends Ne{constructor(yt,vt,bt,Tt){super(vt,null),this.data=yt,this.descriptor=bt,this.view=Tt}clone(){return new We(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var yt,vt;const bt=this.descriptor.size;return bt instanceof Array&&bt.length>0?(yt=bt[0])!==null&&yt!==void 0?yt:0:bt instanceof Object&&(vt=bt.width)!==null&&vt!==void 0?vt:0}get height(){var yt,vt;const bt=this.descriptor.size;return bt instanceof Array&&bt.length>1?(yt=bt[1])!==null&&yt!==void 0?yt:0:bt instanceof Object&&(vt=bt.height)!==null&&vt!==void 0?vt:0}get depthOrArrayLayers(){var yt,vt;const bt=this.descriptor.size;return bt instanceof Array&&bt.length>2?(yt=bt[2])!==null&&yt!==void 0?yt:0:bt instanceof Object&&(vt=bt.depthOrArrayLayers)!==null&&vt!==void 0?vt:0}get format(){var yt;return this.descriptor&&(yt=this.descriptor.format)!==null&&yt!==void 0?yt:"rgba8unorm"}get sampleCount(){var yt;return this.descriptor&&(yt=this.descriptor.sampleCount)!==null&&yt!==void 0?yt:1}get mipLevelCount(){var yt;return this.descriptor&&(yt=this.descriptor.mipLevelCount)!==null&&yt!==void 0?yt:1}get dimension(){var yt;return this.descriptor&&(yt=this.descriptor.dimension)!==null&&yt!==void 0?yt:"2d"}getMipLevelSize(yt){if(yt>=this.mipLevelCount)return[0,0,0];const vt=[this.width,this.height,this.depthOrArrayLayers];for(let bt=0;bt<vt.length;++bt)vt[bt]=Math.max(1,vt[bt]>>yt);return vt}get texelByteSize(){const yt=this.format,vt=S[yt];return vt?vt.isDepthStencil?4:vt.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const yt=this.format,vt=S[yt];return!!vt&&vt.isDepthStencil}getGpuSize(){const yt=this.format,vt=S[yt],bt=this.width;if(!yt||bt<=0||!vt)return-1;const Tt=this.height,Et=this.depthOrArrayLayers,wt=this.dimension;return bt/vt.blockWidth*(wt==="1d"?1:Tt/vt.blockHeight)*vt.bytesPerBlock*Et}getPixel(yt,vt,bt=0,Tt=0){const Et=this.texelByteSize,wt=this.bytesPerRow,St=this.height,At=this.data[Tt];return k(new Uint8Array(At),yt,vt,bt,Tt,St,wt,Et,this.format)}setPixel(yt,vt,bt,Tt,Et){const wt=this.texelByteSize,St=this.bytesPerRow,At=this.height,Rt=this.data[Tt];(function(Pt,Ct,It,Mt,Ot,kt,Ft,Nt,Lt,Dt){const $t=Mt*(Ft>>=Ot)*(kt>>=Ot)+It*Ft+Ct*Nt;switch(Lt){case"r8unorm":return void T(Pt,$t,"8unorm",1,Dt);case"r8snorm":return void T(Pt,$t,"8snorm",1,Dt);case"r8uint":return void T(Pt,$t,"8uint",1,Dt);case"r8sint":return void T(Pt,$t,"8sint",1,Dt);case"rg8unorm":return void T(Pt,$t,"8unorm",2,Dt);case"rg8snorm":return void T(Pt,$t,"8snorm",2,Dt);case"rg8uint":return void T(Pt,$t,"8uint",2,Dt);case"rg8sint":return void T(Pt,$t,"8sint",2,Dt);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void T(Pt,$t,"8unorm",4,Dt);case"rgba8snorm":return void T(Pt,$t,"8snorm",4,Dt);case"rgba8uint":return void T(Pt,$t,"8uint",4,Dt);case"rgba8sint":return void T(Pt,$t,"8sint",4,Dt);case"r16uint":return void T(Pt,$t,"16uint",1,Dt);case"r16sint":return void T(Pt,$t,"16sint",1,Dt);case"r16float":return void T(Pt,$t,"16float",1,Dt);case"rg16uint":return void T(Pt,$t,"16uint",2,Dt);case"rg16sint":return void T(Pt,$t,"16sint",2,Dt);case"rg16float":return void T(Pt,$t,"16float",2,Dt);case"rgba16uint":return void T(Pt,$t,"16uint",4,Dt);case"rgba16sint":return void T(Pt,$t,"16sint",4,Dt);case"rgba16float":return void T(Pt,$t,"16float",4,Dt);case"r32uint":return void T(Pt,$t,"32uint",1,Dt);case"r32sint":return void T(Pt,$t,"32sint",1,Dt);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void T(Pt,$t,"32float",1,Dt);case"rg32uint":return void T(Pt,$t,"32uint",2,Dt);case"rg32sint":return void T(Pt,$t,"32sint",2,Dt);case"rg32float":return void T(Pt,$t,"32float",2,Dt);case"rgba32uint":return void T(Pt,$t,"32uint",4,Dt);case"rgba32sint":return void T(Pt,$t,"32sint",4,Dt);case"rgba32float":return void T(Pt,$t,"32float",4,Dt);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(Rt),yt,vt,bt,Tt,At,St,wt,this.format,Et)}}(xt=>{xt[xt.token=0]="token",xt[xt.keyword=1]="keyword",xt[xt.reserved=2]="reserved"})(z||(z={}));class qe{constructor(yt,vt,bt){this.name=yt,this.type=vt,this.rule=bt}toString(){return this.name}}class He{}H=He,He.none=new qe("",z.reserved,""),He.eof=new qe("EOF",z.token,""),He.reserved={asm:new qe("asm",z.reserved,"asm"),bf16:new qe("bf16",z.reserved,"bf16"),do:new qe("do",z.reserved,"do"),enum:new qe("enum",z.reserved,"enum"),f16:new qe("f16",z.reserved,"f16"),f64:new qe("f64",z.reserved,"f64"),handle:new qe("handle",z.reserved,"handle"),i8:new qe("i8",z.reserved,"i8"),i16:new qe("i16",z.reserved,"i16"),i64:new qe("i64",z.reserved,"i64"),mat:new qe("mat",z.reserved,"mat"),premerge:new qe("premerge",z.reserved,"premerge"),regardless:new qe("regardless",z.reserved,"regardless"),typedef:new qe("typedef",z.reserved,"typedef"),u8:new qe("u8",z.reserved,"u8"),u16:new qe("u16",z.reserved,"u16"),u64:new qe("u64",z.reserved,"u64"),unless:new qe("unless",z.reserved,"unless"),using:new qe("using",z.reserved,"using"),vec:new qe("vec",z.reserved,"vec"),void:new qe("void",z.reserved,"void")},He.keywords={array:new qe("array",z.keyword,"array"),atomic:new qe("atomic",z.keyword,"atomic"),bool:new qe("bool",z.keyword,"bool"),f32:new qe("f32",z.keyword,"f32"),i32:new qe("i32",z.keyword,"i32"),mat2x2:new qe("mat2x2",z.keyword,"mat2x2"),mat2x3:new qe("mat2x3",z.keyword,"mat2x3"),mat2x4:new qe("mat2x4",z.keyword,"mat2x4"),mat3x2:new qe("mat3x2",z.keyword,"mat3x2"),mat3x3:new qe("mat3x3",z.keyword,"mat3x3"),mat3x4:new qe("mat3x4",z.keyword,"mat3x4"),mat4x2:new qe("mat4x2",z.keyword,"mat4x2"),mat4x3:new qe("mat4x3",z.keyword,"mat4x3"),mat4x4:new qe("mat4x4",z.keyword,"mat4x4"),ptr:new qe("ptr",z.keyword,"ptr"),sampler:new qe("sampler",z.keyword,"sampler"),sampler_comparison:new qe("sampler_comparison",z.keyword,"sampler_comparison"),struct:new qe("struct",z.keyword,"struct"),texture_1d:new qe("texture_1d",z.keyword,"texture_1d"),texture_2d:new qe("texture_2d",z.keyword,"texture_2d"),texture_2d_array:new qe("texture_2d_array",z.keyword,"texture_2d_array"),texture_3d:new qe("texture_3d",z.keyword,"texture_3d"),texture_cube:new qe("texture_cube",z.keyword,"texture_cube"),texture_cube_array:new qe("texture_cube_array",z.keyword,"texture_cube_array"),texture_multisampled_2d:new qe("texture_multisampled_2d",z.keyword,"texture_multisampled_2d"),texture_storage_1d:new qe("texture_storage_1d",z.keyword,"texture_storage_1d"),texture_storage_2d:new qe("texture_storage_2d",z.keyword,"texture_storage_2d"),texture_storage_2d_array:new qe("texture_storage_2d_array",z.keyword,"texture_storage_2d_array"),texture_storage_3d:new qe("texture_storage_3d",z.keyword,"texture_storage_3d"),texture_depth_2d:new qe("texture_depth_2d",z.keyword,"texture_depth_2d"),texture_depth_2d_array:new qe("texture_depth_2d_array",z.keyword,"texture_depth_2d_array"),texture_depth_cube:new qe("texture_depth_cube",z.keyword,"texture_depth_cube"),texture_depth_cube_array:new qe("texture_depth_cube_array",z.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new qe("texture_depth_multisampled_2d",z.keyword,"texture_depth_multisampled_2d"),texture_external:new qe("texture_external",z.keyword,"texture_external"),u32:new qe("u32",z.keyword,"u32"),vec2:new qe("vec2",z.keyword,"vec2"),vec3:new qe("vec3",z.keyword,"vec3"),vec4:new qe("vec4",z.keyword,"vec4"),bitcast:new qe("bitcast",z.keyword,"bitcast"),block:new qe("block",z.keyword,"block"),break:new qe("break",z.keyword,"break"),case:new qe("case",z.keyword,"case"),continue:new qe("continue",z.keyword,"continue"),continuing:new qe("continuing",z.keyword,"continuing"),default:new qe("default",z.keyword,"default"),diagnostic:new qe("diagnostic",z.keyword,"diagnostic"),discard:new qe("discard",z.keyword,"discard"),else:new qe("else",z.keyword,"else"),enable:new qe("enable",z.keyword,"enable"),fallthrough:new qe("fallthrough",z.keyword,"fallthrough"),false:new qe("false",z.keyword,"false"),fn:new qe("fn",z.keyword,"fn"),for:new qe("for",z.keyword,"for"),function:new qe("function",z.keyword,"function"),if:new qe("if",z.keyword,"if"),let:new qe("let",z.keyword,"let"),const:new qe("const",z.keyword,"const"),loop:new qe("loop",z.keyword,"loop"),while:new qe("while",z.keyword,"while"),private:new qe("private",z.keyword,"private"),read:new qe("read",z.keyword,"read"),read_write:new qe("read_write",z.keyword,"read_write"),return:new qe("return",z.keyword,"return"),requires:new qe("requires",z.keyword,"requires"),storage:new qe("storage",z.keyword,"storage"),switch:new qe("switch",z.keyword,"switch"),true:new qe("true",z.keyword,"true"),alias:new qe("alias",z.keyword,"alias"),type:new qe("type",z.keyword,"type"),uniform:new qe("uniform",z.keyword,"uniform"),var:new qe("var",z.keyword,"var"),override:new qe("override",z.keyword,"override"),workgroup:new qe("workgroup",z.keyword,"workgroup"),write:new qe("write",z.keyword,"write"),r8unorm:new qe("r8unorm",z.keyword,"r8unorm"),r8snorm:new qe("r8snorm",z.keyword,"r8snorm"),r8uint:new qe("r8uint",z.keyword,"r8uint"),r8sint:new qe("r8sint",z.keyword,"r8sint"),r16uint:new qe("r16uint",z.keyword,"r16uint"),r16sint:new qe("r16sint",z.keyword,"r16sint"),r16float:new qe("r16float",z.keyword,"r16float"),rg8unorm:new qe("rg8unorm",z.keyword,"rg8unorm"),rg8snorm:new qe("rg8snorm",z.keyword,"rg8snorm"),rg8uint:new qe("rg8uint",z.keyword,"rg8uint"),rg8sint:new qe("rg8sint",z.keyword,"rg8sint"),r32uint:new qe("r32uint",z.keyword,"r32uint"),r32sint:new qe("r32sint",z.keyword,"r32sint"),r32float:new qe("r32float",z.keyword,"r32float"),rg16uint:new qe("rg16uint",z.keyword,"rg16uint"),rg16sint:new qe("rg16sint",z.keyword,"rg16sint"),rg16float:new qe("rg16float",z.keyword,"rg16float"),rgba8unorm:new qe("rgba8unorm",z.keyword,"rgba8unorm"),rgba8unorm_srgb:new qe("rgba8unorm_srgb",z.keyword,"rgba8unorm_srgb"),rgba8snorm:new qe("rgba8snorm",z.keyword,"rgba8snorm"),rgba8uint:new qe("rgba8uint",z.keyword,"rgba8uint"),rgba8sint:new qe("rgba8sint",z.keyword,"rgba8sint"),bgra8unorm:new qe("bgra8unorm",z.keyword,"bgra8unorm"),bgra8unorm_srgb:new qe("bgra8unorm_srgb",z.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new qe("rgb10a2unorm",z.keyword,"rgb10a2unorm"),rg11b10float:new qe("rg11b10float",z.keyword,"rg11b10float"),rg32uint:new qe("rg32uint",z.keyword,"rg32uint"),rg32sint:new qe("rg32sint",z.keyword,"rg32sint"),rg32float:new qe("rg32float",z.keyword,"rg32float"),rgba16uint:new qe("rgba16uint",z.keyword,"rgba16uint"),rgba16sint:new qe("rgba16sint",z.keyword,"rgba16sint"),rgba16float:new qe("rgba16float",z.keyword,"rgba16float"),rgba32uint:new qe("rgba32uint",z.keyword,"rgba32uint"),rgba32sint:new qe("rgba32sint",z.keyword,"rgba32sint"),rgba32float:new qe("rgba32float",z.keyword,"rgba32float"),static_assert:new qe("static_assert",z.keyword,"static_assert")},He.tokens={decimal_float_literal:new qe("decimal_float_literal",z.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new qe("hex_float_literal",z.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new qe("int_literal",z.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new qe("uint_literal",z.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new qe("name",z.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new qe("ident",z.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new qe("and",z.token,"&"),and_and:new qe("and_and",z.token,"&&"),arrow:new qe("arrow ",z.token,"->"),attr:new qe("attr",z.token,"@"),forward_slash:new qe("forward_slash",z.token,"/"),bang:new qe("bang",z.token,"!"),bracket_left:new qe("bracket_left",z.token,"["),bracket_right:new qe("bracket_right",z.token,"]"),brace_left:new qe("brace_left",z.token,"{"),brace_right:new qe("brace_right",z.token,"}"),colon:new qe("colon",z.token,":"),comma:new qe("comma",z.token,","),equal:new qe("equal",z.token,"="),equal_equal:new qe("equal_equal",z.token,"=="),not_equal:new qe("not_equal",z.token,"!="),greater_than:new qe("greater_than",z.token,">"),greater_than_equal:new qe("greater_than_equal",z.token,">="),shift_right:new qe("shift_right",z.token,">>"),less_than:new qe("less_than",z.token,"<"),less_than_equal:new qe("less_than_equal",z.token,"<="),shift_left:new qe("shift_left",z.token,"<<"),modulo:new qe("modulo",z.token,"%"),minus:new qe("minus",z.token,"-"),minus_minus:new qe("minus_minus",z.token,"--"),period:new qe("period",z.token,"."),plus:new qe("plus",z.token,"+"),plus_plus:new qe("plus_plus",z.token,"++"),or:new qe("or",z.token,"|"),or_or:new qe("or_or",z.token,"||"),paren_left:new qe("paren_left",z.token,"("),paren_right:new qe("paren_right",z.token,")"),semicolon:new qe("semicolon",z.token,";"),star:new qe("star",z.token,"*"),tilde:new qe("tilde",z.token,"~"),underscore:new qe("underscore",z.token,"_"),xor:new qe("xor",z.token,"^"),plus_equal:new qe("plus_equal",z.token,"+="),minus_equal:new qe("minus_equal",z.token,"-="),times_equal:new qe("times_equal",z.token,"*="),division_equal:new qe("division_equal",z.token,"/="),modulo_equal:new qe("modulo_equal",z.token,"%="),and_equal:new qe("and_equal",z.token,"&="),or_equal:new qe("or_equal",z.token,"|="),xor_equal:new qe("xor_equal",z.token,"^="),shift_right_equal:new qe("shift_right_equal",z.token,">>="),shift_left_equal:new qe("shift_left_equal",z.token,"<<=")},He.simpleTokens={"@":H.tokens.attr,"{":H.tokens.brace_left,"}":H.tokens.brace_right,":":H.tokens.colon,",":H.tokens.comma,"(":H.tokens.paren_left,")":H.tokens.paren_right,";":H.tokens.semicolon},He.literalTokens={"&":H.tokens.and,"&&":H.tokens.and_and,"->":H.tokens.arrow,"/":H.tokens.forward_slash,"!":H.tokens.bang,"[":H.tokens.bracket_left,"]":H.tokens.bracket_right,"=":H.tokens.equal,"==":H.tokens.equal_equal,"!=":H.tokens.not_equal,">":H.tokens.greater_than,">=":H.tokens.greater_than_equal,">>":H.tokens.shift_right,"<":H.tokens.less_than,"<=":H.tokens.less_than_equal,"<<":H.tokens.shift_left,"%":H.tokens.modulo,"-":H.tokens.minus,"--":H.tokens.minus_minus,".":H.tokens.period,"+":H.tokens.plus,"++":H.tokens.plus_plus,"|":H.tokens.or,"||":H.tokens.or_or,"*":H.tokens.star,"~":H.tokens.tilde,_:H.tokens.underscore,"^":H.tokens.xor,"+=":H.tokens.plus_equal,"-=":H.tokens.minus_equal,"*=":H.tokens.times_equal,"/=":H.tokens.division_equal,"%=":H.tokens.modulo_equal,"&=":H.tokens.and_equal,"|=":H.tokens.or_equal,"^=":H.tokens.xor_equal,">>=":H.tokens.shift_right_equal,"<<=":H.tokens.shift_left_equal},He.regexTokens={decimal_float_literal:H.tokens.decimal_float_literal,hex_float_literal:H.tokens.hex_float_literal,int_literal:H.tokens.int_literal,uint_literal:H.tokens.uint_literal,ident:H.tokens.ident},He.storage_class=[H.keywords.function,H.keywords.private,H.keywords.workgroup,H.keywords.uniform,H.keywords.storage],He.access_mode=[H.keywords.read,H.keywords.write,H.keywords.read_write],He.sampler_type=[H.keywords.sampler,H.keywords.sampler_comparison],He.sampled_texture_type=[H.keywords.texture_1d,H.keywords.texture_2d,H.keywords.texture_2d_array,H.keywords.texture_3d,H.keywords.texture_cube,H.keywords.texture_cube_array],He.multisampled_texture_type=[H.keywords.texture_multisampled_2d],He.storage_texture_type=[H.keywords.texture_storage_1d,H.keywords.texture_storage_2d,H.keywords.texture_storage_2d_array,H.keywords.texture_storage_3d],He.depth_texture_type=[H.keywords.texture_depth_2d,H.keywords.texture_depth_2d_array,H.keywords.texture_depth_cube,H.keywords.texture_depth_cube_array,H.keywords.texture_depth_multisampled_2d],He.texture_external_type=[H.keywords.texture_external],He.any_texture_type=[...H.sampled_texture_type,...H.multisampled_texture_type,...H.storage_texture_type,...H.depth_texture_type,...H.texture_external_type],He.texel_format=[H.keywords.r8unorm,H.keywords.r8snorm,H.keywords.r8uint,H.keywords.r8sint,H.keywords.r16uint,H.keywords.r16sint,H.keywords.r16float,H.keywords.rg8unorm,H.keywords.rg8snorm,H.keywords.rg8uint,H.keywords.rg8sint,H.keywords.r32uint,H.keywords.r32sint,H.keywords.r32float,H.keywords.rg16uint,H.keywords.rg16sint,H.keywords.rg16float,H.keywords.rgba8unorm,H.keywords.rgba8unorm_srgb,H.keywords.rgba8snorm,H.keywords.rgba8uint,H.keywords.rgba8sint,H.keywords.bgra8unorm,H.keywords.bgra8unorm_srgb,H.keywords.rgb10a2unorm,H.keywords.rg11b10float,H.keywords.rg32uint,H.keywords.rg32sint,H.keywords.rg32float,H.keywords.rgba16uint,H.keywords.rgba16sint,H.keywords.rgba16float,H.keywords.rgba32uint,H.keywords.rgba32sint,H.keywords.rgba32float],He.const_literal=[H.tokens.int_literal,H.tokens.uint_literal,H.tokens.decimal_float_literal,H.tokens.hex_float_literal,H.keywords.true,H.keywords.false],He.literal_or_ident=[H.tokens.ident,H.tokens.int_literal,H.tokens.uint_literal,H.tokens.decimal_float_literal,H.tokens.hex_float_literal,H.tokens.name],He.element_count_expression=[H.tokens.int_literal,H.tokens.uint_literal,H.tokens.ident],He.template_types=[H.keywords.vec2,H.keywords.vec3,H.keywords.vec4,H.keywords.mat2x2,H.keywords.mat2x3,H.keywords.mat2x4,H.keywords.mat3x2,H.keywords.mat3x3,H.keywords.mat3x4,H.keywords.mat4x2,H.keywords.mat4x3,H.keywords.mat4x4,H.keywords.atomic,H.keywords.bitcast,...H.any_texture_type],He.attribute_name=[H.tokens.ident,H.keywords.block,H.keywords.diagnostic],He.assignment_operators=[H.tokens.equal,H.tokens.plus_equal,H.tokens.minus_equal,H.tokens.times_equal,H.tokens.division_equal,H.tokens.modulo_equal,H.tokens.and_equal,H.tokens.or_equal,H.tokens.xor_equal,H.tokens.shift_right_equal,H.tokens.shift_left_equal],He.increment_operators=[H.tokens.plus_plus,H.tokens.minus_minus];class ze{constructor(yt,vt,bt,Tt,Et){this.type=yt,this.lexeme=vt,this.line=bt,this.start=Tt,this.end=Et}toString(){return this.lexeme}isTemplateType(){return He.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==He.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Re{constructor(yt){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=yt??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new ze(He.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let yt=this._advance();if(yt==`
`)return this._line++,!0;if(this._isWhitespace(yt))return!0;if(yt=="/"){if(this._peekAhead()=="/"){for(;yt!=`
`;){if(this._isAtEnd())return!0;yt=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let wt=1;for(;wt>0;){if(this._isAtEnd())return!0;if(yt=this._advance(),yt==`
`)this._line++;else if(yt=="*"){if(this._peekAhead()=="/"&&(this._advance(),wt--,wt==0))return!0}else yt=="/"&&this._peekAhead()=="*"&&(this._advance(),wt++)}return!0}}const vt=He.simpleTokens[yt];if(vt)return this._addToken(vt),!0;let bt=He.none;const Tt=this._isAlpha(yt),Et=yt==="_";if(this._isAlphaNumeric(yt)){let wt=this._peekAhead();for(;this._isAlphaNumeric(wt);)yt+=this._advance(),wt=this._peekAhead()}if(Tt){const wt=He.keywords[yt];if(wt)return this._addToken(wt),!0}if(Tt||Et)return this._addToken(He.tokens.ident),!0;for(;;){let wt=this._findType(yt);const St=this._peekAhead();if(yt=="-"&&this._tokens.length>0){if(St=="=")return this._current++,yt+=St,this._addToken(He.tokens.minus_equal),!0;if(St=="-")return this._current++,yt+=St,this._addToken(He.tokens.minus_minus),!0;const At=this._tokens.length-1;if((He.literal_or_ident.indexOf(this._tokens[At].type)!=-1||this._tokens[At].type==He.tokens.paren_right)&&St!=">")return this._addToken(wt),!0}if(yt==">"&&(St==">"||St=="=")){let At=!1,Rt=this._tokens.length-1;for(let Pt=0;Pt<5&&Rt>=0&&He.assignment_operators.indexOf(this._tokens[Rt].type)===-1;++Pt,--Rt)if(this._tokens[Rt].type===He.tokens.less_than){Rt>0&&this._tokens[Rt-1].isArrayOrTemplateType()&&(At=!0);break}if(At)return this._addToken(wt),!0}if(wt===He.none){let At=yt,Rt=0;const Pt=2;for(let Ct=0;Ct<Pt;++Ct)if(At+=this._peekAhead(Ct),wt=this._findType(At),wt!==He.none){Rt=Ct;break}if(wt===He.none)return bt!==He.none&&(this._current--,this._addToken(bt),!0);yt=At,this._current+=Rt+1}if(bt=wt,this._isAtEnd())break;yt+=this._advance()}return bt!==He.none&&(this._addToken(bt),!0)}_findType(yt){for(const bt in He.regexTokens){const Tt=He.regexTokens[bt];if(this._match(yt,Tt.rule))return Tt}return He.literalTokens[yt]||He.none}_match(yt,vt){const bt=vt.exec(yt);return bt&&bt.index==0&&bt[0]==yt}_isAtEnd(){return this._current>=this._source.length}_isAlpha(yt){return!this._isNumeric(yt)&&!this._isWhitespace(yt)&&yt!=="_"&&yt!=="."&&yt!=="("&&yt!==")"&&yt!=="["&&yt!=="]"&&yt!=="{"&&yt!=="}"&&yt!==","&&yt!==";"&&yt!==":"&&yt!=="="&&yt!=="!"&&yt!=="<"&&yt!==">"&&yt!=="+"&&yt!=="-"&&yt!=="*"&&yt!=="/"&&yt!=="%"&&yt!=="&"&&yt!=="|"&&yt!=="^"&&yt!=="~"&&yt!=="@"&&yt!=="#"&&yt!=="?"&&yt!=="'"&&yt!=="`"&&yt!=='"'&&yt!=="\\"&&yt!==`
`&&yt!=="\r"&&yt!=="	"&&yt!=="\0"}_isNumeric(yt){return yt>="0"&&yt<="9"}_isAlphaNumeric(yt){return this._isAlpha(yt)||this._isNumeric(yt)||yt==="_"}_isWhitespace(yt){return yt==" "||yt=="	"||yt=="\r"}_advance(yt=0){let vt=this._source[this._current];return yt=yt||0,yt++,this._current+=yt,vt}_peekAhead(yt=0){return yt=yt||0,this._current+yt>=this._source.length?"\0":this._source[this._current+yt]}_addToken(yt){const vt=this._source.substring(this._start,this._current);this._tokens.push(new ze(yt,vt,this._line,this._start,this._current))}}function Ge(xt){return Array.isArray(xt)||(xt==null?void 0:xt.buffer)instanceof ArrayBuffer}const Xe=new Float32Array(1),je=new Uint32Array(Xe.buffer),Ze=new Uint32Array(Xe.buffer),Qe=new Int32Array(1),Ye=new Float32Array(Qe.buffer),Ke=new Uint32Array(Qe.buffer),Je=new Uint32Array(1),et=new Float32Array(Je.buffer),tt=new Int32Array(Je.buffer);function nt(xt,yt,vt){if(yt===vt)return xt;if(yt==="f32"){if(vt==="i32"||vt==="x32")return Xe[0]=xt,je[0];if(vt==="u32")return Xe[0]=xt,Ze[0]}else if(yt==="i32"||yt==="x32"){if(vt==="f32")return Qe[0]=xt,Ye[0];if(vt==="u32")return Qe[0]=xt,Ke[0]}else if(yt==="u32"){if(vt==="f32")return Je[0]=xt,et[0];if(vt==="i32"||vt==="x32")return Je[0]=xt,tt[0]}return console.error(`Unsupported cast from ${yt} to ${vt}`),xt}class st{constructor(yt){this.resources=null,this.inUse=!1,this.info=null,this.node=yt}}class rt{constructor(yt,vt){this.align=yt,this.size=vt}}class at{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new d,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(yt){return yt.name=="texture_storage_1d"||yt.name=="texture_storage_2d"||yt.name=="texture_storage_2d_array"||yt.name=="texture_storage_3d"}updateAST(yt){for(const vt of yt)vt instanceof D&&this._functions.set(vt.name,new st(vt));for(const vt of yt)if(vt instanceof oe){const bt=this.getTypeInfo(vt,null);bt instanceof n&&this.structs.push(bt)}for(const vt of yt)if(vt instanceof te)this.aliases.push(this._getAliasInfo(vt));else{if(vt instanceof M){const bt=vt,Tt=this._getAttributeNum(bt.attributes,"id",0),Et=bt.type!=null?this.getTypeInfo(bt.type,bt.attributes):null;this.overrides.push(new h(bt.name,Et,bt.attributes,Tt));continue}if(this._isUniformVar(vt)){const bt=vt,Tt=this._getAttributeNum(bt.attributes,"group",0),Et=this._getAttributeNum(bt.attributes,"binding",0),wt=this.getTypeInfo(bt.type,bt.attributes),St=new o(bt.name,wt,Tt,Et,bt.attributes,i.Uniform,bt.access);St.access||(St.access="read"),this.uniforms.push(St);continue}if(this._isStorageVar(vt)){const bt=vt,Tt=this._getAttributeNum(bt.attributes,"group",0),Et=this._getAttributeNum(bt.attributes,"binding",0),wt=this.getTypeInfo(bt.type,bt.attributes),St=this._isStorageTexture(wt),At=new o(bt.name,wt,Tt,Et,bt.attributes,St?i.StorageTexture:i.Storage,bt.access);At.access||(At.access="read"),this.storage.push(At);continue}if(this._isTextureVar(vt)){const bt=vt,Tt=this._getAttributeNum(bt.attributes,"group",0),Et=this._getAttributeNum(bt.attributes,"binding",0),wt=this.getTypeInfo(bt.type,bt.attributes),St=this._isStorageTexture(wt),At=new o(bt.name,wt,Tt,Et,bt.attributes,St?i.StorageTexture:i.Texture,bt.access);At.access||(At.access="read"),St?this.storage.push(At):this.textures.push(At);continue}if(this._isSamplerVar(vt)){const bt=vt,Tt=this._getAttributeNum(bt.attributes,"group",0),Et=this._getAttributeNum(bt.attributes,"binding",0),wt=this.getTypeInfo(bt.type,bt.attributes),St=new o(bt.name,wt,Tt,Et,bt.attributes,i.Sampler,bt.access);this.samplers.push(St);continue}}for(const vt of yt)if(vt instanceof D){const bt=this._getAttribute(vt,"vertex"),Tt=this._getAttribute(vt,"fragment"),Et=this._getAttribute(vt,"compute"),wt=bt||Tt||Et,St=new p(vt.name,wt==null?void 0:wt.name,vt.attributes);St.attributes=vt.attributes,St.startLine=vt.startLine,St.endLine=vt.endLine,this.functions.push(St),this._functions.get(vt.name).info=St,wt&&(this._functions.get(vt.name).inUse=!0,St.inUse=!0,St.resources=this._findResources(vt,!!wt),St.inputs=this._getInputs(vt.args),St.outputs=this._getOutputs(vt.returnType),this.entry[wt.name].push(St)),St.arguments=vt.args.map(At=>new f(At.name,this.getTypeInfo(At.type,At.attributes),At.attributes)),St.returnType=vt.returnType?this.getTypeInfo(vt.returnType,vt.attributes):null;continue}for(const vt of this._functions.values())vt.info&&(vt.info.inUse=vt.inUse,this._addCalls(vt.node,vt.info.calls));for(const vt of this._functions.values())vt.node.search(bt=>{var Tt,Et,wt;if(bt instanceof De){if(bt.value)if(Ge(bt.value))for(const St of bt.value)for(const At of this.overrides)St===At.name&&((Tt=vt.info)===null||Tt===void 0||Tt.overrides.push(At));else for(const St of this.overrides)bt.value===St.name&&((Et=vt.info)===null||Et===void 0||Et.overrides.push(St))}else if(bt instanceof ge)for(const St of this.overrides)bt.name===St.name&&((wt=vt.info)===null||wt===void 0||wt.overrides.push(St))});for(const vt of this.uniforms)this._markStructsInUse(vt.type);for(const vt of this.storage)this._markStructsInUse(vt.type)}getFunctionInfo(yt){for(const vt of this.functions)if(vt.name==yt)return vt;return null}getStructInfo(yt){for(const vt of this.structs)if(vt.name==yt)return vt;return null}getOverrideInfo(yt){for(const vt of this.overrides)if(vt.name==yt)return vt;return null}_markStructsInUse(yt){if(yt)if(yt.isStruct){if(yt.inUse=!0,yt.members)for(const vt of yt.members)this._markStructsInUse(vt.type)}else if(yt.isArray)this._markStructsInUse(yt.format);else if(yt.isTemplate)yt.format&&this._markStructsInUse(yt.format);else{const vt=this._getAlias(yt.name);vt&&this._markStructsInUse(vt)}}_addCalls(yt,vt){var bt;for(const Tt of yt.calls){const Et=(bt=this._functions.get(Tt.name))===null||bt===void 0?void 0:bt.info;Et&&vt.add(Et)}}findResource(yt,vt,bt){if(bt){for(const Tt of this.entry.compute)if(Tt.name===bt){for(const Et of Tt.resources)if(Et.group==yt&&Et.binding==vt)return Et}for(const Tt of this.entry.vertex)if(Tt.name===bt){for(const Et of Tt.resources)if(Et.group==yt&&Et.binding==vt)return Et}for(const Tt of this.entry.fragment)if(Tt.name===bt){for(const Et of Tt.resources)if(Et.group==yt&&Et.binding==vt)return Et}}for(const Tt of this.uniforms)if(Tt.group==yt&&Tt.binding==vt)return Tt;for(const Tt of this.storage)if(Tt.group==yt&&Tt.binding==vt)return Tt;for(const Tt of this.textures)if(Tt.group==yt&&Tt.binding==vt)return Tt;for(const Tt of this.samplers)if(Tt.group==yt&&Tt.binding==vt)return Tt;return null}_findResource(yt){for(const vt of this.uniforms)if(vt.name==yt)return vt;for(const vt of this.storage)if(vt.name==yt)return vt;for(const vt of this.textures)if(vt.name==yt)return vt;for(const vt of this.samplers)if(vt.name==yt)return vt;return null}_markStructsFromAST(yt){const vt=this.getTypeInfo(yt,null);this._markStructsInUse(vt)}_findResources(yt,vt){const bt=[],Tt=this,Et=[];return yt.search(wt=>{if(wt instanceof E)Et.push({});else if(wt instanceof $)Et.pop();else if(wt instanceof F){const St=wt;vt&&St.type!==null&&this._markStructsFromAST(St.type),Et.length>0&&(Et[Et.length-1][St.name]=St)}else if(wt instanceof de){const St=wt;vt&&St.type!==null&&this._markStructsFromAST(St.type)}else if(wt instanceof U){const St=wt;vt&&St.type!==null&&this._markStructsFromAST(St.type),Et.length>0&&(Et[Et.length-1][St.name]=St)}else if(wt instanceof ge){const St=wt;if(Et.length>0&&Et[Et.length-1][St.name])return;const At=Tt._findResource(St.name);At&&bt.push(At)}else if(wt instanceof me){const St=wt,At=Tt._functions.get(St.name);At&&(vt&&(At.inUse=!0),yt.calls.add(At.node),At.resources===null&&(At.resources=Tt._findResources(At.node,vt)),bt.push(...At.resources))}else if(wt instanceof X){const St=wt,At=Tt._functions.get(St.name);At&&(vt&&(At.inUse=!0),yt.calls.add(At.node),At.resources===null&&(At.resources=Tt._findResources(At.node,vt)),bt.push(...At.resources))}}),[...new Map(bt.map(wt=>[wt.name,wt])).values()]}getBindGroups(){const yt=[];function vt(bt,Tt){bt>=yt.length&&(yt.length=bt+1),yt[bt]===void 0&&(yt[bt]=[]),Tt>=yt[bt].length&&(yt[bt].length=Tt+1)}for(const bt of this.uniforms)vt(bt.group,bt.binding),yt[bt.group][bt.binding]=bt;for(const bt of this.storage)vt(bt.group,bt.binding),yt[bt.group][bt.binding]=bt;for(const bt of this.textures)vt(bt.group,bt.binding),yt[bt.group][bt.binding]=bt;for(const bt of this.samplers)vt(bt.group,bt.binding),yt[bt.group][bt.binding]=bt;return yt}_getOutputs(yt,vt=void 0){if(vt===void 0&&(vt=[]),yt instanceof oe)this._getStructOutputs(yt,vt);else{const bt=this._getOutputInfo(yt);bt!==null&&vt.push(bt)}return vt}_getStructOutputs(yt,vt){for(const bt of yt.members)if(bt.type instanceof oe)this._getStructOutputs(bt.type,vt);else{const Tt=this._getAttribute(bt,"location")||this._getAttribute(bt,"builtin");if(Tt!==null){const Et=this.getTypeInfo(bt.type,bt.type.attributes),wt=this._parseInt(Tt.value),St=new u(bt.name,Et,Tt.name,wt);vt.push(St)}}}_getOutputInfo(yt){const vt=this._getAttribute(yt,"location")||this._getAttribute(yt,"builtin");if(vt!==null){const bt=this.getTypeInfo(yt,yt.attributes),Tt=this._parseInt(vt.value);return new u("",bt,vt.name,Tt)}return null}_getInputs(yt,vt=void 0){vt===void 0&&(vt=[]);for(const bt of yt)if(bt.type instanceof oe)this._getStructInputs(bt.type,vt);else{const Tt=this._getInputInfo(bt);Tt!==null&&vt.push(Tt)}return vt}_getStructInputs(yt,vt){for(const bt of yt.members)if(bt.type instanceof oe)this._getStructInputs(bt.type,vt);else{const Tt=this._getInputInfo(bt);Tt!==null&&vt.push(Tt)}}_getInputInfo(yt){const vt=this._getAttribute(yt,"location")||this._getAttribute(yt,"builtin");if(vt!==null){const bt=this._getAttribute(yt,"interpolation"),Tt=this.getTypeInfo(yt.type,yt.attributes),Et=this._parseInt(vt.value),wt=new l(yt.name,Tt,vt.name,Et);return bt!==null&&(wt.interpolation=this._parseString(bt.value)),wt}return null}_parseString(yt){return yt instanceof Array&&(yt=yt[0]),yt}_parseInt(yt){yt instanceof Array&&(yt=yt[0]);const vt=parseInt(yt);return isNaN(vt)?yt:vt}_getAlias(yt){for(const vt of this.aliases)if(vt.name==yt)return vt.type;return null}_getAliasInfo(yt){return new c(yt.name,this.getTypeInfo(yt.type,null))}getTypeInfoByName(yt){for(const vt of this.structs)if(vt.name==yt)return vt;for(const vt of this.aliases)if(vt.name==yt)return vt.type;return null}getTypeInfo(yt,vt=null){if(this._types.has(yt))return this._types.get(yt);if(yt instanceof le){const Tt=yt.type?this.getTypeInfo(yt.type,yt.attributes):null,Et=new r(yt.name,Tt,vt);return this._types.set(yt,Et),this._updateTypeInfo(Et),Et}if(yt instanceof ue){const Tt=yt,Et=Tt.format?this.getTypeInfo(Tt.format,Tt.attributes):null,wt=new s(Tt.name,vt);return wt.format=Et,wt.count=Tt.count,this._types.set(yt,wt),this._updateTypeInfo(wt),wt}if(yt instanceof oe){const Tt=yt,Et=new n(Tt.name,vt);Et.startLine=Tt.startLine,Et.endLine=Tt.endLine;for(const wt of Tt.members){const St=this.getTypeInfo(wt.type,wt.attributes);Et.members.push(new t(wt.name,St,wt.attributes))}return this._types.set(yt,Et),this._updateTypeInfo(Et),Et}if(yt instanceof he){const Tt=yt,Et=Tt.format instanceof ae,wt=Tt.format?Et?this.getTypeInfo(Tt.format,null):new e(Tt.format,null):null,St=new a(Tt.name,wt,vt,Tt.access);return this._types.set(yt,St),this._updateTypeInfo(St),St}if(yt instanceof ce){const Tt=yt,Et=Tt.format?this.getTypeInfo(Tt.format,null):null,wt=new a(Tt.name,Et,vt,Tt.access);return this._types.set(yt,wt),this._updateTypeInfo(wt),wt}const bt=new e(yt.name,vt);return this._types.set(yt,bt),this._updateTypeInfo(bt),bt}_updateTypeInfo(yt){var vt,bt,Tt;const Et=this._getTypeSize(yt);if(yt.size=(vt=Et==null?void 0:Et.size)!==null&&vt!==void 0?vt:0,yt instanceof s&&yt.format){const wt=this._getTypeSize(yt.format);yt.stride=Math.max((bt=wt==null?void 0:wt.size)!==null&&bt!==void 0?bt:0,(Tt=wt==null?void 0:wt.align)!==null&&Tt!==void 0?Tt:0),this._updateTypeInfo(yt.format)}yt instanceof r&&this._updateTypeInfo(yt.format),yt instanceof n&&this._updateStructInfo(yt)}_updateStructInfo(yt){var vt;let bt=0,Tt=0,Et=0,wt=0;for(let St=0,At=yt.members.length;St<At;++St){const Rt=yt.members[St],Pt=this._getTypeSize(Rt);if(!Pt)continue;(vt=this._getAlias(Rt.type.name))!==null&&vt!==void 0||Rt.type;const Ct=Pt.align,It=Pt.size;bt=this._roundUp(Ct,bt+Tt),Tt=It,Et=bt,wt=Math.max(wt,Ct),Rt.offset=bt,Rt.size=It,this._updateTypeInfo(Rt.type)}yt.size=this._roundUp(wt,Et+Tt),yt.align=wt}_getTypeSize(yt){var vt,bt;if(yt==null)return null;const Tt=this._getAttributeNum(yt.attributes,"size",0),Et=this._getAttributeNum(yt.attributes,"align",0);if(yt instanceof t&&(yt=yt.type),yt instanceof e){const wt=this._getAlias(yt.name);wt!==null&&(yt=wt)}{const wt=at._typeInfo[yt.name];if(wt!==void 0){const St=((vt=yt.format)===null||vt===void 0?void 0:vt.name)==="f16"?2:1;return new rt(Math.max(Et,wt.align/St),Math.max(Tt,wt.size/St))}}{const wt=at._typeInfo[yt.name.substring(0,yt.name.length-1)];if(wt){const St=yt.name[yt.name.length-1]==="h"?2:1;return new rt(Math.max(Et,wt.align/St),Math.max(Tt,wt.size/St))}}if(yt instanceof s){let wt=yt,St=8,At=8;const Rt=this._getTypeSize(wt.format);return Rt!==null&&(At=Rt.size,St=Rt.align),At=wt.count*this._getAttributeNum((bt=yt==null?void 0:yt.attributes)!==null&&bt!==void 0?bt:null,"stride",this._roundUp(St,At)),Tt&&(At=Tt),new rt(Math.max(Et,St),Math.max(Tt,At))}if(yt instanceof n){let wt=0,St=0,At=0,Rt=0,Pt=0;for(const Ct of yt.members){const It=this._getTypeSize(Ct.type);It!==null&&(wt=Math.max(It.align,wt),At=this._roundUp(It.align,At+Rt),Rt=It.size,Pt=At)}return St=this._roundUp(wt,Pt+Rt),new rt(Math.max(Et,wt),Math.max(Tt,St))}return null}_isUniformVar(yt){return yt instanceof F&&yt.storage=="uniform"}_isStorageVar(yt){return yt instanceof F&&yt.storage=="storage"}_isTextureVar(yt){return yt instanceof F&&yt.type!==null&&at._textureTypes.indexOf(yt.type.name)!=-1}_isSamplerVar(yt){return yt instanceof F&&yt.type!==null&&at._samplerTypes.indexOf(yt.type.name)!=-1}_getAttribute(yt,vt){const bt=yt;if(!bt||!bt.attributes)return null;const Tt=bt.attributes;for(let Et of Tt)if(Et.name==vt)return Et;return null}_getAttributeNum(yt,vt,bt){if(yt===null)return bt;for(let Tt of yt)if(Tt.name==vt){let Et=Tt!==null&&Tt.value!==null?Tt.value:bt;return Et instanceof Array&&(Et=Et[0]),typeof Et=="number"?Et:typeof Et=="string"?parseInt(Et):bt}return bt}_roundUp(yt,vt){return Math.ceil(vt/yt)*yt}}at._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},at._textureTypes=He.any_texture_type.map(xt=>xt.name),at._samplerTypes=He.sampler_type.map(xt=>xt.name);let it=0;class ot{constructor(yt,vt,bt){this.id=it++,this.name=yt,this.value=vt,this.node=bt}clone(){return new ot(this.name,this.value,this.node)}}class ct{constructor(yt){this.id=it++,this.name=yt.name,this.node=yt}clone(){return new ct(this.node)}}class lt{constructor(yt){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=it++,yt&&(this.parent=yt,this.currentFunctionName=yt.currentFunctionName)}getVariable(yt){var vt;return this.variables.has(yt)?(vt=this.variables.get(yt))!==null&&vt!==void 0?vt:null:this.parent?this.parent.getVariable(yt):null}getFunction(yt){var vt;return this.functions.has(yt)?(vt=this.functions.get(yt))!==null&&vt!==void 0?vt:null:this.parent?this.parent.getFunction(yt):null}createVariable(yt,vt,bt){this.variables.set(yt,new ot(yt,vt,bt??null))}setVariable(yt,vt,bt){const Tt=this.getVariable(yt);Tt!==null?Tt.value=vt:this.createVariable(yt,vt,bt)}getVariableValue(yt){var vt;const bt=this.getVariable(yt);return(vt=bt==null?void 0:bt.value)!==null&&vt!==void 0?vt:null}clone(){return new lt(this)}}class ut{evalExpression(yt,vt){return null}getTypeInfo(yt){return null}getVariableName(yt,vt){return""}}class ht{constructor(yt){this.exec=yt}getTypeInfo(yt){return this.exec.getTypeInfo(yt)}All(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);let Tt=!0;if(bt instanceof Me)return bt.data.forEach(Et=>{Et||(Tt=!1)}),new Be(Tt?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${yt.line}`)}Any(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me){const Tt=bt.data.some(Et=>Et);return new Be(Tt?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${yt.line}`)}Select(yt,vt){const bt=this.exec.evalExpression(yt.args[2],vt);if(!(bt instanceof Be))throw new Error(`Select() expects a bool condition. Line ${yt.line}`);return bt.value?this.exec.evalExpression(yt.args[1],vt):this.exec.evalExpression(yt.args[0],vt)}ArrayLength(yt,vt){let bt=yt.args[0];bt instanceof ke&&(bt=bt.right);const Tt=this.exec.evalExpression(bt,vt);if(Tt instanceof Pe&&Tt.typeInfo.size===0){const Et=Tt.typeInfo,wt=Tt.buffer.byteLength/Et.stride;return new Be(wt,this.getTypeInfo("u32"))}return new Be(Tt.typeInfo.size,this.getTypeInfo("u32"))}Abs(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.abs(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.abs(Tt.value),Tt.typeInfo)}Acos(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.acos(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.acos(Tt.value),bt.typeInfo)}Acosh(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.acosh(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.acosh(Tt.value),bt.typeInfo)}Asin(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.asin(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.asin(Tt.value),bt.typeInfo)}Asinh(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.asinh(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.asinh(Tt.value),bt.typeInfo)}Atan(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.atan(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.atan(Tt.value),bt.typeInfo)}Atanh(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.atanh(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.atanh(Tt.value),bt.typeInfo)}Atan2(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt);if(bt instanceof Me&&Tt instanceof Me)return new Me(bt.data.map((St,At)=>Math.atan2(St,Tt.data[At])),bt.typeInfo);const Et=bt,wt=Tt;return new Be(Math.atan2(Et.value,wt.value),bt.typeInfo)}Ceil(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.ceil(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.ceil(Tt.value),bt.typeInfo)}_clamp(yt,vt,bt){return Math.min(Math.max(yt,vt),bt)}Clamp(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt),Et=this.exec.evalExpression(yt.args[2],vt);if(bt instanceof Me&&Tt instanceof Me&&Et instanceof Me)return new Me(bt.data.map((Rt,Pt)=>this._clamp(Rt,Tt.data[Pt],Et.data[Pt])),bt.typeInfo);const wt=bt,St=Tt,At=Et;return new Be(this._clamp(wt.value,St.value,At.value),bt.typeInfo)}Cos(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.cos(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.cos(Tt.value),bt.typeInfo)}Cosh(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.cosh(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.cos(Tt.value),bt.typeInfo)}CountLeadingZeros(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.clz32(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.clz32(Tt.value),bt.typeInfo)}_countOneBits(yt){let vt=0;for(;yt!==0;)1&yt&&vt++,yt>>=1;return vt}CountOneBits(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>this._countOneBits(Et)),bt.typeInfo);const Tt=bt;return new Be(this._countOneBits(Tt.value),bt.typeInfo)}_countTrailingZeros(yt){if(yt===0)return 32;let vt=0;for(;!(1&yt);)yt>>=1,vt++;return vt}CountTrailingZeros(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>this._countTrailingZeros(Et)),bt.typeInfo);const Tt=bt;return new Be(this._countTrailingZeros(Tt.value),bt.typeInfo)}Cross(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt);if(bt instanceof Me&&Tt instanceof Me){if(bt.data.length!==3||Tt.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${yt.line}`),null;const Et=bt.data,wt=Tt.data;return new Me([Et[1]*wt[2]-wt[1]*Et[2],Et[2]*wt[0]-wt[2]*Et[0],Et[0]*wt[1]-wt[0]*Et[1]],bt.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${yt.line}`),null}Degrees(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=180/Math.PI;return bt instanceof Me?new Me(bt.data.map(Et=>Et*Tt),bt.typeInfo):new Be(bt.value*Tt,this.getTypeInfo("f32"))}Determinant(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Ue){const Tt=bt.data,Et=bt.typeInfo.getTypeName(),wt=Et.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(Et==="mat2x2"||Et==="mat2x2f"||Et==="mat2x2h")return new Be(Tt[0]*Tt[3]-Tt[1]*Tt[2],wt);if(Et==="mat2x3"||Et==="mat2x3f"||Et==="mat2x3h")return new Be(Tt[0]*(Tt[4]*Tt[8]-Tt[5]*Tt[7])-Tt[1]*(Tt[3]*Tt[8]-Tt[5]*Tt[6])+Tt[2]*(Tt[3]*Tt[7]-Tt[4]*Tt[6]),wt);if(Et==="mat2x4"||Et==="mat2x4f"||Et==="mat2x4h")console.error(`TODO: Determinant for ${Et}`);else if(Et==="mat3x2"||Et==="mat3x2f"||Et==="mat3x2h")console.error(`TODO: Determinant for ${Et}`);else{if(Et==="mat3x3"||Et==="mat3x3f"||Et==="mat3x3h")return new Be(Tt[0]*(Tt[4]*Tt[8]-Tt[5]*Tt[7])-Tt[1]*(Tt[3]*Tt[8]-Tt[5]*Tt[6])+Tt[2]*(Tt[3]*Tt[7]-Tt[4]*Tt[6]),wt);Et==="mat3x4"||Et==="mat3x4f"||Et==="mat3x4h"||Et==="mat4x2"||Et==="mat4x2f"||Et==="mat4x2h"||Et==="mat4x3"||Et==="mat4x3f"||Et==="mat4x3h"?console.error(`TODO: Determinant for ${Et}`):Et!=="mat4x4"&&Et!=="mat4x4f"&&Et!=="mat4x4h"||console.error(`TODO: Determinant for ${Et}`)}}return console.error(`Determinant expects a matrix argument. Line ${yt.line}`),null}Distance(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt);if(bt instanceof Me&&Tt instanceof Me){let St=0;for(let At=0;At<bt.data.length;++At)St+=(bt.data[At]-Tt.data[At])*(bt.data[At]-Tt.data[At]);return new Be(Math.sqrt(St),this.getTypeInfo("f32"))}const Et=bt,wt=Tt;return new Be(Math.abs(Et.value-wt.value),bt.typeInfo)}_dot(yt,vt){let bt=0;for(let Tt=0;Tt<yt.length;++Tt)bt+=vt[Tt]*yt[Tt];return bt}Dot(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt);return bt instanceof Me&&Tt instanceof Me?new Be(this._dot(bt.data,Tt.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${yt.line}`),null)}Dot4U8Packed(yt,vt){return console.error(`TODO: dot4U8Packed. Line ${yt.line}`),null}Dot4I8Packed(yt,vt){return console.error(`TODO: dot4I8Packed. Line ${yt.line}`),null}Exp(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.exp(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.exp(Tt.value),bt.typeInfo)}Exp2(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.pow(2,Et)),bt.typeInfo);const Tt=bt;return new Be(Math.pow(2,Tt.value),bt.typeInfo)}ExtractBits(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt),Et=this.exec.evalExpression(yt.args[2],vt);if(Tt.typeInfo.name!=="u32"&&Tt.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${yt.line}`),null;if(Et.typeInfo.name!=="u32"&&Et.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${yt.line}`),null;const wt=Tt.value,St=Et.value;if(bt instanceof Me)return new Me(bt.data.map(Rt=>Rt>>wt&(1<<St)-1),bt.typeInfo);if(bt.typeInfo.name!=="i32"&&bt.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${yt.line}`),null;const At=bt.value;return new Be(At>>wt&(1<<St)-1,this.getTypeInfo("i32"))}FaceForward(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt),Et=this.exec.evalExpression(yt.args[2],vt);if(bt instanceof Me&&Tt instanceof Me&&Et instanceof Me){const wt=this._dot(Tt.data,Et.data);return new Me(wt<0?Array.from(bt.data):bt.data.map(St=>-St),bt.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${yt.line}`),null}_firstLeadingBit(yt){return yt===0?-1:31-Math.clz32(yt)}FirstLeadingBit(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>this._firstLeadingBit(Et)),bt.typeInfo);const Tt=bt;return new Be(this._firstLeadingBit(Tt.value),bt.typeInfo)}_firstTrailingBit(yt){return yt===0?-1:Math.log2(yt&-yt)}FirstTrailingBit(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>this._firstTrailingBit(Et)),bt.typeInfo);const Tt=bt;return new Be(this._firstTrailingBit(Tt.value),bt.typeInfo)}Floor(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.floor(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.floor(Tt.value),bt.typeInfo)}Fma(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt),Et=this.exec.evalExpression(yt.args[2],vt);if(bt instanceof Me&&Tt instanceof Me&&Et instanceof Me)return bt.data.length!==Tt.data.length||bt.data.length!==Et.data.length?(console.error(`Fma() expects vectors of the same length. Line ${yt.line}`),null):new Me(bt.data.map((Rt,Pt)=>Rt*Tt.data[Pt]+Et.data[Pt]),bt.typeInfo);const wt=bt,St=Tt,At=Et;return new Be(wt.value*St.value+At.value,wt.typeInfo)}Fract(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Et-Math.floor(Et)),bt.typeInfo);const Tt=bt;return new Be(Tt.value-Math.floor(Tt.value),bt.typeInfo)}Frexp(yt,vt){return console.error(`TODO: frexp. Line ${yt.line}`),null}InsertBits(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt),Et=this.exec.evalExpression(yt.args[2],vt),wt=this.exec.evalExpression(yt.args[3],vt);if(Et.typeInfo.name!=="u32"&&Et.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${yt.line}`),null;const St=Et.value,At=(1<<wt.value)-1<<St,Rt=~At;if(bt instanceof Me&&Tt instanceof Me)return new Me(bt.data.map((It,Mt)=>It&Rt|Tt.data[Mt]<<St&At),bt.typeInfo);const Pt=bt.value,Ct=Tt.value;return new Be(Pt&Rt|Ct<<St&At,bt.typeInfo)}InverseSqrt(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>1/Math.sqrt(Et)),bt.typeInfo);const Tt=bt;return new Be(1/Math.sqrt(Tt.value),bt.typeInfo)}Ldexp(yt,vt){return console.error(`TODO: ldexp. Line ${yt.line}`),null}Length(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me){let Et=0;return bt.data.forEach(wt=>{Et+=wt*wt}),new Be(Math.sqrt(Et),this.getTypeInfo("f32"))}const Tt=bt;return new Be(Math.abs(Tt.value),bt.typeInfo)}Log(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.log(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.log(Tt.value),bt.typeInfo)}Log2(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.log2(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.log2(Tt.value),bt.typeInfo)}Max(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt);if(bt instanceof Me&&Tt instanceof Me)return new Me(bt.data.map((St,At)=>Math.max(St,Tt.data[At])),bt.typeInfo);const Et=bt,wt=Tt;return new Be(Math.max(Et.value,wt.value),bt.typeInfo)}Min(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt);if(bt instanceof Me&&Tt instanceof Me)return new Me(bt.data.map((St,At)=>Math.min(St,Tt.data[At])),bt.typeInfo);const Et=bt,wt=Tt;return new Be(Math.min(Et.value,wt.value),bt.typeInfo)}Mix(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt),Et=this.exec.evalExpression(yt.args[2],vt);if(bt instanceof Me&&Tt instanceof Me&&Et instanceof Me)return new Me(bt.data.map((At,Rt)=>bt.data[Rt]*(1-Et.data[Rt])+Tt.data[Rt]*Et.data[Rt]),bt.typeInfo);const wt=Tt,St=Et;return new Be(bt.value*(1-St.value)+wt.value*St.value,bt.typeInfo)}Modf(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt);if(bt instanceof Me&&Tt instanceof Me)return new Me(bt.data.map((wt,St)=>wt%Tt.data[St]),bt.typeInfo);const Et=Tt;return new Be(bt.value%Et.value,bt.typeInfo)}Normalize(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me){const Tt=this.Length(yt,vt).value;return new Me(bt.data.map(Et=>Et/Tt),bt.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${yt.line}`),null}Pow(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt);if(bt instanceof Me&&Tt instanceof Me)return new Me(bt.data.map((St,At)=>Math.pow(St,Tt.data[At])),bt.typeInfo);const Et=bt,wt=Tt;return new Be(Math.pow(Et.value,wt.value),bt.typeInfo)}QuantizeToF16(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);return bt instanceof Me?new Me(bt.data.map(Tt=>Tt),bt.typeInfo):new Be(bt.value,bt.typeInfo)}Radians(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);return bt instanceof Me?new Me(bt.data.map(Tt=>Tt*Math.PI/180),bt.typeInfo):new Be(bt.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(yt,vt){let bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt);if(bt instanceof Me&&Tt instanceof Me){const Et=this._dot(bt.data,Tt.data);return new Me(bt.data.map((wt,St)=>wt-2*Et*Tt.data[St]),bt.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${yt.line}`),null}Refract(yt,vt){let bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt),Et=this.exec.evalExpression(yt.args[2],vt);if(bt instanceof Me&&Tt instanceof Me&&Et instanceof Be){const wt=this._dot(Tt.data,bt.data);return new Me(bt.data.map((St,At)=>{const Rt=1-Et.value*Et.value*(1-wt*wt);if(Rt<0)return 0;const Pt=Math.sqrt(Rt);return Et.value*St-(Et.value*wt+Pt)*Tt.data[At]}),bt.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${yt.line}`),null}ReverseBits(yt,vt){return console.error(`TODO: reverseBits. Line ${yt.line}`),null}Round(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.round(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.round(Tt.value),bt.typeInfo)}Saturate(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.min(Math.max(Et,0),1)),bt.typeInfo);const Tt=bt;return new Be(Math.min(Math.max(Tt.value,0),1),bt.typeInfo)}Sign(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.sign(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.sign(Tt.value),bt.typeInfo)}Sin(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.sin(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.sin(Tt.value),bt.typeInfo)}Sinh(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.sinh(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.sinh(Tt.value),bt.typeInfo)}_smoothstep(yt,vt,bt){const Tt=Math.min(Math.max((bt-yt)/(vt-yt),0),1);return Tt*Tt*(3-2*Tt)}SmoothStep(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt),Et=this.exec.evalExpression(yt.args[2],vt);if(Et instanceof Me&&bt instanceof Me&&Tt instanceof Me)return new Me(Et.data.map((Rt,Pt)=>this._smoothstep(bt.data[Pt],Tt.data[Pt],Rt)),Et.typeInfo);const wt=bt,St=Tt,At=Et;return new Be(this._smoothstep(wt.value,St.value,At.value),Et.typeInfo)}Sqrt(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.sqrt(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.sqrt(Tt.value),bt.typeInfo)}Step(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt),Tt=this.exec.evalExpression(yt.args[1],vt);if(Tt instanceof Me&&bt instanceof Me)return new Me(Tt.data.map((wt,St)=>wt<bt.data[St]?0:1),Tt.typeInfo);const Et=bt;return new Be(Tt.value<Et.value?0:1,Et.typeInfo)}Tan(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.tan(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.tan(Tt.value),bt.typeInfo)}Tanh(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.tanh(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.tanh(Tt.value),bt.typeInfo)}_getTransposeType(yt){const vt=yt.getTypeName();return vt==="mat2x2f"||vt==="mat2x2h"?yt:vt==="mat2x3f"?this.getTypeInfo("mat3x2f"):vt==="mat2x3h"?this.getTypeInfo("mat3x2h"):vt==="mat2x4f"?this.getTypeInfo("mat4x2f"):vt==="mat2x4h"?this.getTypeInfo("mat4x2h"):vt==="mat3x2f"?this.getTypeInfo("mat2x3f"):vt==="mat3x2h"?this.getTypeInfo("mat2x3h"):vt==="mat3x3f"||vt==="mat3x3h"?yt:vt==="mat3x4f"?this.getTypeInfo("mat4x3f"):vt==="mat3x4h"?this.getTypeInfo("mat4x3h"):vt==="mat4x2f"?this.getTypeInfo("mat2x4f"):vt==="mat4x2h"?this.getTypeInfo("mat2x4h"):vt==="mat4x3f"?this.getTypeInfo("mat3x4f"):vt==="mat4x3h"?this.getTypeInfo("mat3x4h"):(vt==="mat4x4f"||vt==="mat4x4h"||console.error(`Invalid matrix type ${vt}`),yt)}Transpose(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(!(bt instanceof Ue))return console.error(`Transpose() expects a matrix argument. Line ${yt.line}`),null;const Tt=this._getTransposeType(bt.typeInfo);if(bt.typeInfo.name==="mat2x2"||bt.typeInfo.name==="mat2x2f"||bt.typeInfo.name==="mat2x2h"){const Et=bt.data;return new Ue([Et[0],Et[2],Et[1],Et[3]],Tt)}if(bt.typeInfo.name==="mat2x3"||bt.typeInfo.name==="mat2x3f"||bt.typeInfo.name==="mat2x3h"){const Et=bt.data;return new Ue([Et[0],Et[3],Et[6],Et[1],Et[4],Et[7]],Tt)}if(bt.typeInfo.name==="mat2x4"||bt.typeInfo.name==="mat2x4f"||bt.typeInfo.name==="mat2x4h"){const Et=bt.data;return new Ue([Et[0],Et[4],Et[8],Et[12],Et[1],Et[5],Et[9],Et[13]],Tt)}if(bt.typeInfo.name==="mat3x2"||bt.typeInfo.name==="mat3x2f"||bt.typeInfo.name==="mat3x2h"){const Et=bt.data;return new Ue([Et[0],Et[3],Et[1],Et[4],Et[2],Et[5]],Tt)}if(bt.typeInfo.name==="mat3x3"||bt.typeInfo.name==="mat3x3f"||bt.typeInfo.name==="mat3x3h"){const Et=bt.data;return new Ue([Et[0],Et[3],Et[6],Et[1],Et[4],Et[7],Et[2],Et[5],Et[8]],Tt)}if(bt.typeInfo.name==="mat3x4"||bt.typeInfo.name==="mat3x4f"||bt.typeInfo.name==="mat3x4h"){const Et=bt.data;return new Ue([Et[0],Et[4],Et[8],Et[12],Et[1],Et[5],Et[9],Et[13],Et[2],Et[6],Et[10],Et[14]],Tt)}if(bt.typeInfo.name==="mat4x2"||bt.typeInfo.name==="mat4x2f"||bt.typeInfo.name==="mat4x2h"){const Et=bt.data;return new Ue([Et[0],Et[4],Et[1],Et[5],Et[2],Et[6]],Tt)}if(bt.typeInfo.name==="mat4x3"||bt.typeInfo.name==="mat4x3f"||bt.typeInfo.name==="mat4x3h"){const Et=bt.data;return new Ue([Et[0],Et[4],Et[8],Et[1],Et[5],Et[9],Et[2],Et[6],Et[10]],Tt)}if(bt.typeInfo.name==="mat4x4"||bt.typeInfo.name==="mat4x4f"||bt.typeInfo.name==="mat4x4h"){const Et=bt.data;return new Ue([Et[0],Et[4],Et[8],Et[12],Et[1],Et[5],Et[9],Et[13],Et[2],Et[6],Et[10],Et[14],Et[3],Et[7],Et[11],Et[15]],Tt)}return console.error(`Invalid matrix type ${bt.typeInfo.name}`),null}Trunc(yt,vt){const bt=this.exec.evalExpression(yt.args[0],vt);if(bt instanceof Me)return new Me(bt.data.map(Et=>Math.trunc(Et)),bt.typeInfo);const Tt=bt;return new Be(Math.trunc(Tt.value),bt.typeInfo)}Dpdx(yt,vt){return console.error(`TODO: dpdx. Line ${yt.line}`),null}DpdxCoarse(yt,vt){return console.error(`TODO: dpdxCoarse. Line ${yt.line}`),null}DpdxFine(yt,vt){return console.error("TODO: dpdxFine"),null}Dpdy(yt,vt){return console.error("TODO: dpdy"),null}DpdyCoarse(yt,vt){return console.error("TODO: dpdyCoarse"),null}DpdyFine(yt,vt){return console.error("TODO: dpdyFine"),null}Fwidth(yt,vt){return console.error("TODO: fwidth"),null}FwidthCoarse(yt,vt){return console.error("TODO: fwidthCoarse"),null}FwidthFine(yt,vt){return console.error("TODO: fwidthFine"),null}TextureDimensions(yt,vt){const bt=yt.args[0],Tt=yt.args.length>1?this.exec.evalExpression(yt.args[1],vt).value:0;if(bt instanceof ge){const Et=bt.name,wt=vt.getVariableValue(Et);if(wt instanceof We){if(Tt<0||Tt>=wt.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${yt.line}`),null;const St=wt.getMipLevelSize(Tt),At=wt.dimension;return At==="1d"?new Be(St[0],this.getTypeInfo("u32")):At==="3d"?new Me(St,this.getTypeInfo("vec3u")):At==="2d"?new Me(St.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${At} not found. Line ${yt.line}`),null)}return console.error(`Texture ${Et} not found. Line ${yt.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${yt.line}`),null}TextureGather(yt,vt){return console.error("TODO: textureGather"),null}TextureGatherCompare(yt,vt){return console.error("TODO: textureGatherCompare"),null}TextureLoad(yt,vt){const bt=yt.args[0],Tt=this.exec.evalExpression(yt.args[1],vt),Et=yt.args.length>2?this.exec.evalExpression(yt.args[2],vt).value:0;if(!(Tt instanceof Me)||Tt.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${yt.line}`),null;if(bt instanceof ge){const wt=bt.name,St=vt.getVariableValue(wt);if(St instanceof We){const At=Math.floor(Tt.data[0]),Rt=Math.floor(Tt.data[1]);if(At<0||At>=St.width||Rt<0||Rt>=St.height)return console.error(`Texture ${wt} out of bounds. Line ${yt.line}`),null;const Pt=St.getPixel(At,Rt,0,Et);return Pt===null?(console.error(`Invalid texture format for textureLoad. Line ${yt.line}`),null):new Me(Pt,this.getTypeInfo("vec4f"))}return console.error(`Texture ${wt} not found. Line ${yt.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${yt.line}`),null}TextureNumLayers(yt,vt){const bt=yt.args[0];if(bt instanceof ge){const Tt=bt.name,Et=vt.getVariableValue(Tt);return Et instanceof We?new Be(Et.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${Tt} not found. Line ${yt.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${yt.line}`),null}TextureNumLevels(yt,vt){const bt=yt.args[0];if(bt instanceof ge){const Tt=bt.name,Et=vt.getVariableValue(Tt);return Et instanceof We?new Be(Et.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${Tt} not found. Line ${yt.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${yt.line}`),null}TextureNumSamples(yt,vt){const bt=yt.args[0];if(bt instanceof ge){const Tt=bt.name,Et=vt.getVariableValue(Tt);return Et instanceof We?new Be(Et.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${Tt} not found. Line ${yt.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${yt.line}`),null}TextureSample(yt,vt){return console.error("TODO: textureSample"),null}TextureSampleBias(yt,vt){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(yt,vt){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(yt,vt){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(yt,vt){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(yt,vt){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(yt,vt){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(yt,vt){const bt=yt.args[0],Tt=this.exec.evalExpression(yt.args[1],vt),Et=yt.args.length===4?this.exec.evalExpression(yt.args[2],vt).value:0,wt=yt.args.length===4?this.exec.evalExpression(yt.args[3],vt).data:this.exec.evalExpression(yt.args[2],vt).data;if(wt.length!==4)return console.error(`Invalid value argument for textureStore. Line ${yt.line}`),null;if(!(Tt instanceof Me)||Tt.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${yt.line}`),null;if(bt instanceof ge){const St=bt.name,At=vt.getVariableValue(St);if(At instanceof We){const Rt=At.getMipLevelSize(0),Pt=Math.floor(Tt.data[0]),Ct=Math.floor(Tt.data[1]);return Pt<0||Pt>=Rt[0]||Ct<0||Ct>=Rt[1]?(console.error(`Texture ${St} out of bounds. Line ${yt.line}`),null):(At.setPixel(Pt,Ct,0,Et,Array.from(wt)),null)}return console.error(`Texture ${St} not found. Line ${yt.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${yt.line}`),null}AtomicLoad(yt,vt){let bt=yt.args[0];bt instanceof ke&&(bt=bt.right);const Tt=this.exec.getVariableName(bt,vt);return vt.getVariable(Tt).value.getSubData(this.exec,bt.postfix,vt)}AtomicStore(yt,vt){let bt=yt.args[0];bt instanceof ke&&(bt=bt.right);const Tt=this.exec.getVariableName(bt,vt),Et=vt.getVariable(Tt);let wt=yt.args[1];const St=this.exec.evalExpression(wt,vt),At=Et.value.getSubData(this.exec,bt.postfix,vt);return At instanceof Be&&St instanceof Be&&(At.value=St.value),Et.value instanceof Pe&&Et.value.setDataValue(this.exec,At,bt.postfix,vt),null}AtomicAdd(yt,vt){let bt=yt.args[0];bt instanceof ke&&(bt=bt.right);const Tt=this.exec.getVariableName(bt,vt),Et=vt.getVariable(Tt);let wt=yt.args[1];const St=this.exec.evalExpression(wt,vt),At=Et.value.getSubData(this.exec,bt.postfix,vt),Rt=new Be(At.value,At.typeInfo);return At instanceof Be&&St instanceof Be&&(At.value+=St.value),Et.value instanceof Pe&&Et.value.setDataValue(this.exec,At,bt.postfix,vt),Rt}AtomicSub(yt,vt){let bt=yt.args[0];bt instanceof ke&&(bt=bt.right);const Tt=this.exec.getVariableName(bt,vt),Et=vt.getVariable(Tt);let wt=yt.args[1];const St=this.exec.evalExpression(wt,vt),At=Et.value.getSubData(this.exec,bt.postfix,vt),Rt=new Be(At.value,At.typeInfo);return At instanceof Be&&St instanceof Be&&(At.value-=St.value),Et.value instanceof Pe&&Et.value.setDataValue(this.exec,At,bt.postfix,vt),Rt}AtomicMax(yt,vt){let bt=yt.args[0];bt instanceof ke&&(bt=bt.right);const Tt=this.exec.getVariableName(bt,vt),Et=vt.getVariable(Tt);let wt=yt.args[1];const St=this.exec.evalExpression(wt,vt),At=Et.value.getSubData(this.exec,bt.postfix,vt),Rt=new Be(At.value,At.typeInfo);return At instanceof Be&&St instanceof Be&&(At.value=Math.max(At.value,St.value)),Et.value instanceof Pe&&Et.value.setDataValue(this.exec,At,bt.postfix,vt),Rt}AtomicMin(yt,vt){let bt=yt.args[0];bt instanceof ke&&(bt=bt.right);const Tt=this.exec.getVariableName(bt,vt),Et=vt.getVariable(Tt);let wt=yt.args[1];const St=this.exec.evalExpression(wt,vt),At=Et.value.getSubData(this.exec,bt.postfix,vt),Rt=new Be(At.value,At.typeInfo);return At instanceof Be&&St instanceof Be&&(At.value=Math.min(At.value,St.value)),Et.value instanceof Pe&&Et.value.setDataValue(this.exec,At,bt.postfix,vt),Rt}AtomicAnd(yt,vt){let bt=yt.args[0];bt instanceof ke&&(bt=bt.right);const Tt=this.exec.getVariableName(bt,vt),Et=vt.getVariable(Tt);let wt=yt.args[1];const St=this.exec.evalExpression(wt,vt),At=Et.value.getSubData(this.exec,bt.postfix,vt),Rt=new Be(At.value,At.typeInfo);return At instanceof Be&&St instanceof Be&&(At.value=At.value&St.value),Et.value instanceof Pe&&Et.value.setDataValue(this.exec,At,bt.postfix,vt),Rt}AtomicOr(yt,vt){let bt=yt.args[0];bt instanceof ke&&(bt=bt.right);const Tt=this.exec.getVariableName(bt,vt),Et=vt.getVariable(Tt);let wt=yt.args[1];const St=this.exec.evalExpression(wt,vt),At=Et.value.getSubData(this.exec,bt.postfix,vt),Rt=new Be(At.value,At.typeInfo);return At instanceof Be&&St instanceof Be&&(At.value=At.value|St.value),Et.value instanceof Pe&&Et.value.setDataValue(this.exec,At,bt.postfix,vt),Rt}AtomicXor(yt,vt){let bt=yt.args[0];bt instanceof ke&&(bt=bt.right);const Tt=this.exec.getVariableName(bt,vt),Et=vt.getVariable(Tt);let wt=yt.args[1];const St=this.exec.evalExpression(wt,vt),At=Et.value.getSubData(this.exec,bt.postfix,vt),Rt=new Be(At.value,At.typeInfo);return At instanceof Be&&St instanceof Be&&(At.value=At.value^St.value),Et.value instanceof Pe&&Et.value.setDataValue(this.exec,At,bt.postfix,vt),Rt}AtomicExchange(yt,vt){let bt=yt.args[0];bt instanceof ke&&(bt=bt.right);const Tt=this.exec.getVariableName(bt,vt),Et=vt.getVariable(Tt);let wt=yt.args[1];const St=this.exec.evalExpression(wt,vt),At=Et.value.getSubData(this.exec,bt.postfix,vt),Rt=new Be(At.value,At.typeInfo);return At instanceof Be&&St instanceof Be&&(At.value=St.value),Et.value instanceof Pe&&Et.value.setDataValue(this.exec,At,bt.postfix,vt),Rt}AtomicCompareExchangeWeak(yt,vt){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(yt,vt){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(yt,vt){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(yt,vt){return console.error("TODO: pack4xI8"),null}Pack4xU8(yt,vt){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(yt,vt){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(yt,vt){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(yt,vt){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(yt,vt){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(yt,vt){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(yt,vt){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(yt,vt){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(yt,vt){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(yt,vt){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(yt,vt){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(yt,vt){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(yt,vt){return console.error("TODO: unpack2x16float"),null}StorageBarrier(yt,vt){return null}TextureBarrier(yt,vt){return null}WorkgroupBarrier(yt,vt){return null}WorkgroupUniformLoad(yt,vt){return null}SubgroupAdd(yt,vt){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(yt,vt){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(yt,vt){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(yt,vt){return console.error("TODO: subgroupAll"),null}SubgroupAnd(yt,vt){return console.error("TODO: subgroupAnd"),null}SubgroupAny(yt,vt){return console.error("TODO: subgroupAny"),null}SubgroupBallot(yt,vt){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(yt,vt){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(yt,vt){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(yt,vt){return console.error("TODO: subgroupElect"),null}SubgroupMax(yt,vt){return console.error("TODO: subgroupMax"),null}SubgroupMin(yt,vt){return console.error("TODO: subgroupMin"),null}SubgroupMul(yt,vt){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(yt,vt){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(yt,vt){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(yt,vt){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(yt,vt){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(yt,vt){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(yt,vt){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(yt,vt){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(yt,vt){return console.error("TODO: subgroupXor"),null}QuadBroadcast(yt,vt){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(yt,vt){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(yt,vt){return console.error("TODO: quadSwapX"),null}QuadSwapY(yt,vt){return console.error("TODO: quadSwapY"),null}}const ft={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},pt={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class dt extends ut{constructor(yt,vt){var bt;super(),this.ast=yt??[],this.reflection=new at,this.reflection.updateAST(this.ast),this.context=(bt=vt==null?void 0:vt.clone())!==null&&bt!==void 0?bt:new lt,this.builtins=new ht(this),this.typeInfo={bool:this.getTypeInfo(ae.bool),i32:this.getTypeInfo(ae.i32),u32:this.getTypeInfo(ae.u32),f32:this.getTypeInfo(ae.f32),f16:this.getTypeInfo(ae.f16),vec2f:this.getTypeInfo(ce.vec2f),vec2u:this.getTypeInfo(ce.vec2u),vec2i:this.getTypeInfo(ce.vec2i),vec2h:this.getTypeInfo(ce.vec2h),vec3f:this.getTypeInfo(ce.vec3f),vec3u:this.getTypeInfo(ce.vec3u),vec3i:this.getTypeInfo(ce.vec3i),vec3h:this.getTypeInfo(ce.vec3h),vec4f:this.getTypeInfo(ce.vec4f),vec4u:this.getTypeInfo(ce.vec4u),vec4i:this.getTypeInfo(ce.vec4i),vec4h:this.getTypeInfo(ce.vec4h),mat2x2f:this.getTypeInfo(ce.mat2x2f),mat2x3f:this.getTypeInfo(ce.mat2x3f),mat2x4f:this.getTypeInfo(ce.mat2x4f),mat3x2f:this.getTypeInfo(ce.mat3x2f),mat3x3f:this.getTypeInfo(ce.mat3x3f),mat3x4f:this.getTypeInfo(ce.mat3x4f),mat4x2f:this.getTypeInfo(ce.mat4x2f),mat4x3f:this.getTypeInfo(ce.mat4x3f),mat4x4f:this.getTypeInfo(ce.mat4x4f)}}getVariableValue(yt){var vt,bt;const Tt=(bt=(vt=this.context.getVariable(yt))===null||vt===void 0?void 0:vt.value)!==null&&bt!==void 0?bt:null;if(Tt===null)return null;if(Tt instanceof Be)return Tt.value;if(Tt instanceof Me||Tt instanceof Ue)return Array.from(Tt.data);if(Tt instanceof Pe&&Tt.typeInfo instanceof s){if(Tt.typeInfo.format.name==="u32")return Array.from(new Uint32Array(Tt.buffer,Tt.offset,Tt.typeInfo.count));if(Tt.typeInfo.format.name==="i32")return Array.from(new Int32Array(Tt.buffer,Tt.offset,Tt.typeInfo.count));if(Tt.typeInfo.format.name==="f32")return Array.from(new Float32Array(Tt.buffer,Tt.offset,Tt.typeInfo.count))}return console.error(`Unsupported return variable type ${Tt.typeInfo.name}`),null}execute(yt){(yt=yt??{}).constants&&this._setOverrides(yt.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(yt,vt,bt,Tt){const Et=this.context.clone();(Tt=Tt??{}).constants&&this._setOverrides(Tt.constants,Et),this._execStatements(this.ast,Et);const wt=Et.getFunction(yt);if(!wt)return void console.error(`Function ${yt} not found`);if(typeof vt=="number")vt=[vt,1,1];else{if(vt.length===0)return void console.error("Invalid dispatch count");vt.length===1?vt=[vt[0],1,1]:vt.length===2?vt=[vt[0],vt[1],1]:vt.length>3&&(vt=[vt[0],vt[1],vt[2]])}const St=vt[0],At=vt[1],Rt=vt[2],Pt=this.getTypeInfo("vec3u");Et.setVariable("@num_workgroups",new Me(vt,Pt));const Ct=this.reflection.getFunctionInfo(yt);Ct===null&&console.error(`Function ${yt} not found in reflection data`);for(const It in bt)for(const Mt in bt[It]){const Ot=bt[It][Mt];Et.variables.forEach(kt=>{var Ft;const Nt=kt.node;if(Nt!=null&&Nt.attributes){let Lt=null,Dt=null;for(const $t of Nt.attributes)$t.name==="binding"?Lt=$t.value:$t.name==="group"&&(Dt=$t.value);if(Mt==Lt&&It==Dt){let $t=!1;for(const zt of Ct.resources)if(zt.name===kt.name&&zt.group===parseInt(It)&&zt.binding===parseInt(Mt)){$t=!0;break}if($t)if(Ot.texture!==void 0&&Ot.descriptor!==void 0){const zt=new We(Ot.texture,this.getTypeInfo(Nt.type),Ot.descriptor,(Ft=Ot.texture.view)!==null&&Ft!==void 0?Ft:null);kt.value=zt}else Ot.uniform!==void 0?kt.value=new Pe(Ot.uniform,this.getTypeInfo(Nt.type)):kt.value=new Pe(Ot,this.getTypeInfo(Nt.type))}}})}for(let It=0;It<Rt;++It)for(let Mt=0;Mt<At;++Mt)for(let Ot=0;Ot<St;++Ot)Et.setVariable("@workgroup_id",new Me([Ot,Mt,It],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(wt,[Ot,Mt,It],Et)}execStatement(yt,vt){if(yt instanceof Y)return this.evalExpression(yt.value,vt);if(yt instanceof se){if(yt.condition){const bt=this.evalExpression(yt.condition,vt);if(!(bt instanceof Be))throw new Error("Invalid break-if condition");if(!bt.value)return null}return dt._breakObj}if(yt instanceof re)return dt._continueObj;if(yt instanceof U)this._let(yt,vt);else if(yt instanceof F)this._var(yt,vt);else if(yt instanceof P)this._const(yt,vt);else if(yt instanceof D)this._function(yt,vt);else{if(yt instanceof Q)return this._if(yt,vt);if(yt instanceof Z)return this._switch(yt,vt);if(yt instanceof B)return this._for(yt,vt);if(yt instanceof V)return this._while(yt,vt);if(yt instanceof j)return this._loop(yt,vt);if(yt instanceof O){const bt=vt.clone();return bt.currentFunctionName=vt.currentFunctionName,this._execStatements(yt.body,bt)}if(yt instanceof G)this._assign(yt,vt);else if(yt instanceof R)this._increment(yt,vt);else{if(yt instanceof oe)return null;if(yt instanceof M){const bt=yt.name;vt.getVariable(bt)===null&&vt.setVariable(bt,new Be(0,this.getTypeInfo("u32")))}else if(yt instanceof X)this._call(yt,vt);else{if(yt instanceof ee||yt instanceof te)return null;console.error("Invalid statement type.",yt,`Line ${yt.line}`)}}}return null}evalExpression(yt,vt){return yt instanceof Ie?this._evalBinaryOp(yt,vt):yt instanceof xe?this._evalLiteral(yt,vt):yt instanceof ge?this._evalVariable(yt,vt):yt instanceof me?this._evalCall(yt,vt):yt instanceof de?this._evalCreate(yt,vt):yt instanceof _e?this._evalConst(yt,vt):yt instanceof ye?this._evalBitcast(yt,vt):yt instanceof ke?this._evalUnaryOp(yt,vt):(console.error("Invalid expression type",yt,`Line ${yt.line}`),null)}getTypeInfo(yt){var vt;if(yt instanceof ae){const Tt=this.reflection.getTypeInfo(yt);if(Tt!==null)return Tt}let bt=(vt=this.typeInfo[yt])!==null&&vt!==void 0?vt:null;return bt!==null||(bt=this.reflection.getTypeInfoByName(yt)),bt}_setOverrides(yt,vt){for(const bt in yt){const Tt=yt[bt],Et=this.reflection.getOverrideInfo(bt);Et!==null?(Et.type===null&&(Et.type=this.getTypeInfo("u32")),Et.type.name==="u32"||Et.type.name==="i32"||Et.type.name==="f32"||Et.type.name==="f16"?vt.setVariable(bt,new Be(Tt,Et.type)):Et.type.name==="bool"?vt.setVariable(bt,new Be(Tt?1:0,Et.type)):Et.type.name==="vec2"||Et.type.name==="vec3"||Et.type.name==="vec4"||Et.type.name==="vec2f"||Et.type.name==="vec3f"||Et.type.name==="vec4f"||Et.type.name==="vec2i"||Et.type.name==="vec3i"||Et.type.name==="vec4i"||Et.type.name==="vec2u"||Et.type.name==="vec3u"||Et.type.name==="vec4u"||Et.type.name==="vec2h"||Et.type.name==="vec3h"||Et.type.name==="vec4h"?vt.setVariable(bt,new Me(Tt,Et.type)):console.error(`Invalid constant type for ${bt}`)):console.error(`Override ${bt} does not exist in the shader.`)}}_dispatchWorkgroup(yt,vt,bt){const Tt=[1,1,1];for(const Pt of yt.node.attributes)if(Pt.name==="workgroup_size"){if(Pt.value.length>0){const Ct=bt.getVariableValue(Pt.value[0]);Tt[0]=Ct instanceof Be?Ct.value:parseInt(Pt.value[0])}if(Pt.value.length>1){const Ct=bt.getVariableValue(Pt.value[1]);Tt[1]=Ct instanceof Be?Ct.value:parseInt(Pt.value[1])}if(Pt.value.length>2){const Ct=bt.getVariableValue(Pt.value[2]);Tt[2]=Ct instanceof Be?Ct.value:parseInt(Pt.value[2])}}const Et=this.getTypeInfo("vec3u"),wt=this.getTypeInfo("u32");bt.setVariable("@workgroup_size",new Me(Tt,Et));const St=Tt[0],At=Tt[1],Rt=Tt[2];for(let Pt=0,Ct=0;Pt<Rt;++Pt)for(let It=0;It<At;++It)for(let Mt=0;Mt<St;++Mt,++Ct){const Ot=[Mt,It,Pt],kt=[Mt+vt[0]*Tt[0],It+vt[1]*Tt[1],Pt+vt[2]*Tt[2]];bt.setVariable("@local_invocation_id",new Me(Ot,Et)),bt.setVariable("@global_invocation_id",new Me(kt,Et)),bt.setVariable("@local_invocation_index",new Be(Ct,wt)),this._dispatchExec(yt,bt)}}_dispatchExec(yt,vt){for(const bt of yt.node.args)for(const Tt of bt.attributes)if(Tt.name==="builtin"){const Et=`@${Tt.value}`,wt=vt.getVariable(Et);wt!==void 0&&vt.variables.set(bt.name,wt)}this._execStatements(yt.node.body,vt)}getVariableName(yt,vt){for(;yt instanceof ke;)yt=yt.right;return yt instanceof ge?yt.name:(console.error("Unknown variable type",yt,"Line",yt.line),null)}_execStatements(yt,vt){for(const bt of yt){if(bt instanceof Array){const Et=vt.clone(),wt=this._execStatements(bt,Et);if(wt)return wt;continue}const Tt=this.execStatement(bt,vt);if(Tt)return Tt}return null}_call(yt,vt){const bt=vt.clone();bt.currentFunctionName=yt.name;const Tt=vt.getFunction(yt.name);if(Tt){for(let Et=0;Et<Tt.node.args.length;++Et){const wt=Tt.node.args[Et],St=this.evalExpression(yt.args[Et],bt);bt.setVariable(wt.name,St,wt)}this._execStatements(Tt.node.body,bt)}else yt.isBuiltin?this._callBuiltinFunction(yt,bt):this.getTypeInfo(yt.name)&&this._evalCreate(yt,vt)}_increment(yt,vt){const bt=this.getVariableName(yt.variable,vt),Tt=vt.getVariable(bt);Tt?yt.operator==="++"?Tt.value instanceof Be?Tt.value.value++:console.error(`Variable ${bt} is not a scalar. Line ${yt.line}`):yt.operator==="--"?Tt.value instanceof Be?Tt.value.value--:console.error(`Variable ${bt} is not a scalar. Line ${yt.line}`):console.error(`Unknown increment operator ${yt.operator}. Line ${yt.line}`):console.error(`Variable ${bt} not found. Line ${yt.line}`)}_getVariableData(yt,vt){if(yt instanceof ge){const bt=this.getVariableName(yt,vt),Tt=vt.getVariable(bt);return Tt===null?(console.error(`Variable ${bt} not found. Line ${yt.line}`),null):Tt.value.getSubData(this,yt.postfix,vt)}if(yt instanceof ke){if(yt.operator==="*"){const bt=this._getVariableData(yt.right,vt);return bt instanceof Oe?bt.reference.getSubData(this,yt.postfix,vt):(console.error(`Variable ${yt.right} is not a pointer. Line ${yt.line}`),null)}if(yt.operator==="&"){const bt=this._getVariableData(yt.right,vt);return new Oe(bt)}}return null}_assign(yt,vt){let bt=null,Tt="<var>",Et=null;if(yt.variable instanceof ke){const At=this._getVariableData(yt.variable,vt),Rt=this.evalExpression(yt.value,vt),Pt=yt.operator;if(Pt==="="){if(At instanceof Be||At instanceof Me||At instanceof Ue){if(Rt instanceof Be||Rt instanceof Me||Rt instanceof Ue&&At.data.length===Rt.data.length)return void At.data.set(Rt.data);console.error(`Invalid assignment. Line ${yt.line}`)}else if(At instanceof Pe&&Rt instanceof Pe&&At.buffer.byteLength-At.offset>=Rt.buffer.byteLength-Rt.offset)return void(At.buffer.byteLength%4==0?new Uint32Array(At.buffer,At.offset,At.typeInfo.size/4).set(new Uint32Array(Rt.buffer,Rt.offset,Rt.typeInfo.size/4)):new Uint8Array(At.buffer,At.offset,At.typeInfo.size).set(new Uint8Array(Rt.buffer,Rt.offset,Rt.typeInfo.size)));return console.error(`Invalid assignment. Line ${yt.line}`),null}if(Pt==="+=")return At instanceof Be||At instanceof Me||At instanceof Ue?Rt instanceof Be||Rt instanceof Me||Rt instanceof Ue?void At.data.set(Rt.data.map((Ct,It)=>At.data[It]+Ct)):void console.error(`Invalid assignment . Line ${yt.line}`):void console.error(`Invalid assignment. Line ${yt.line}`);if(Pt==="-=")return(At instanceof Be||At instanceof Me||At instanceof Ue)&&(Rt instanceof Be||Rt instanceof Me||Rt instanceof Ue)?void At.data.set(Rt.data.map((Ct,It)=>At.data[It]-Ct)):void console.error(`Invalid assignment. Line ${yt.line}`)}if(yt.variable instanceof ke){if(yt.variable.operator==="*"){Tt=this.getVariableName(yt.variable.right,vt);const At=vt.getVariable(Tt);if(!(At&&At.value instanceof Oe))return void console.error(`Variable ${Tt} is not a pointer. Line ${yt.line}`);bt=At.value.reference;let Rt=yt.variable.postfix;if(!Rt){let Pt=yt.variable.right;for(;Pt instanceof ke;){if(Pt.postfix){Rt=Pt.postfix;break}Pt=Pt.right}}Rt&&(bt=bt.getSubData(this,Rt,vt))}}else{Et=yt.variable.postfix,Tt=this.getVariableName(yt.variable,vt);const At=vt.getVariable(Tt);if(At===null)return void console.error(`Variable ${Tt} not found. Line ${yt.line}`);bt=At.value}if(bt instanceof Oe&&(bt=bt.reference),bt===null)return void console.error(`Variable ${Tt} not found. Line ${yt.line}`);const wt=this.evalExpression(yt.value,vt),St=yt.operator;if(St!=="="){const At=bt.getSubData(this,Et,vt);if(At instanceof Me&&wt instanceof Be){const Rt=At.data,Pt=wt.value;if(St==="+=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]+=Pt;else if(St==="-=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]-=Pt;else if(St==="*=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]*=Pt;else if(St==="/=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]/=Pt;else if(St==="%=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]%=Pt;else if(St==="&=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]&=Pt;else if(St==="|=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]|=Pt;else if(St==="^=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]^=Pt;else if(St==="<<=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]<<=Pt;else if(St===">>=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]>>=Pt;else console.error(`Invalid operator ${St}. Line ${yt.line}`)}else if(At instanceof Me&&wt instanceof Me){const Rt=At.data,Pt=wt.data;if(Rt.length!==Pt.length)return void console.error(`Vector length mismatch. Line ${yt.line}`);if(St==="+=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]+=Pt[Ct];else if(St==="-=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]-=Pt[Ct];else if(St==="*=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]*=Pt[Ct];else if(St==="/=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]/=Pt[Ct];else if(St==="%=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]%=Pt[Ct];else if(St==="&=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]&=Pt[Ct];else if(St==="|=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]|=Pt[Ct];else if(St==="^=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]^=Pt[Ct];else if(St==="<<=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]<<=Pt[Ct];else if(St===">>=")for(let Ct=0;Ct<Rt.length;++Ct)Rt[Ct]>>=Pt[Ct];else console.error(`Invalid operator ${St}. Line ${yt.line}`)}else{if(!(At instanceof Be&&wt instanceof Be))return void console.error(`Invalid type for ${yt.operator} operator. Line ${yt.line}`);St==="+="?At.value+=wt.value:St==="-="?At.value-=wt.value:St==="*="?At.value*=wt.value:St==="/="?At.value/=wt.value:St==="%="?At.value%=wt.value:St==="&="?At.value&=wt.value:St==="|="?At.value|=wt.value:St==="^="?At.value^=wt.value:St==="<<="?At.value<<=wt.value:St===">>="?At.value>>=wt.value:console.error(`Invalid operator ${St}. Line ${yt.line}`)}return void(bt instanceof Pe&&bt.setDataValue(this,At,Et,vt))}if(bt instanceof Pe)bt.setDataValue(this,wt,Et,vt);else if(Et){if(!(bt instanceof Me||bt instanceof Ue))return void console.error(`Variable ${Tt} is not a vector or matrix. Line ${yt.line}`);if(Et instanceof ve){const At=this.evalExpression(Et.index,vt).value;if(bt instanceof Me){if(!(wt instanceof Be))return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);bt.data[At]=wt.value}else{if(!(bt instanceof Ue))return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);{const Rt=this.evalExpression(Et.index,vt).value;if(Rt<0)return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);if(!(wt instanceof Me))return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);{const Pt=bt.typeInfo.getTypeName();if(Pt==="mat2x2"||Pt==="mat2x2f"||Pt==="mat2x2h"){if(!(Rt<2&&wt.data.length===2))return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);bt.data[2*Rt]=wt.data[0],bt.data[2*Rt+1]=wt.data[1]}else if(Pt==="mat2x3"||Pt==="mat2x3f"||Pt==="mat2x3h"){if(!(Rt<2&&wt.data.length===3))return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);bt.data[3*Rt]=wt.data[0],bt.data[3*Rt+1]=wt.data[1],bt.data[3*Rt+2]=wt.data[2]}else if(Pt==="mat2x4"||Pt==="mat2x4f"||Pt==="mat2x4h"){if(!(Rt<2&&wt.data.length===4))return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);bt.data[4*Rt]=wt.data[0],bt.data[4*Rt+1]=wt.data[1],bt.data[4*Rt+2]=wt.data[2],bt.data[4*Rt+3]=wt.data[3]}else if(Pt==="mat3x2"||Pt==="mat3x2f"||Pt==="mat3x2h"){if(!(Rt<3&&wt.data.length===2))return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);bt.data[2*Rt]=wt.data[0],bt.data[2*Rt+1]=wt.data[1]}else if(Pt==="mat3x3"||Pt==="mat3x3f"||Pt==="mat3x3h"){if(!(Rt<3&&wt.data.length===3))return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);bt.data[3*Rt]=wt.data[0],bt.data[3*Rt+1]=wt.data[1],bt.data[3*Rt+2]=wt.data[2]}else if(Pt==="mat3x4"||Pt==="mat3x4f"||Pt==="mat3x4h"){if(!(Rt<3&&wt.data.length===4))return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);bt.data[4*Rt]=wt.data[0],bt.data[4*Rt+1]=wt.data[1],bt.data[4*Rt+2]=wt.data[2],bt.data[4*Rt+3]=wt.data[3]}else if(Pt==="mat4x2"||Pt==="mat4x2f"||Pt==="mat4x2h"){if(!(Rt<4&&wt.data.length===2))return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);bt.data[2*Rt]=wt.data[0],bt.data[2*Rt+1]=wt.data[1]}else if(Pt==="mat4x3"||Pt==="mat4x3f"||Pt==="mat4x3h"){if(!(Rt<4&&wt.data.length===3))return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);bt.data[3*Rt]=wt.data[0],bt.data[3*Rt+1]=wt.data[1],bt.data[3*Rt+2]=wt.data[2]}else{if(Pt!=="mat4x4"&&Pt!=="mat4x4f"&&Pt!=="mat4x4h")return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);if(!(Rt<4&&wt.data.length===4))return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);bt.data[4*Rt]=wt.data[0],bt.data[4*Rt+1]=wt.data[1],bt.data[4*Rt+2]=wt.data[2],bt.data[4*Rt+3]=wt.data[3]}}}}}else if(Et instanceof pe){const At=Et.value;if(!(bt instanceof Me))return void console.error(`Invalid assignment to ${At}. Variable ${Tt} is not a vector. Line ${yt.line}`);if(wt instanceof Be){if(At.length>1)return void console.error(`Invalid assignment to ${At} for variable ${Tt}. Line ${yt.line}`);if(At==="x")bt.data[0]=wt.value;else if(At==="y"){if(bt.data.length<2)return void console.error(`Invalid assignment to ${At} for variable ${Tt}. Line ${yt.line}`);bt.data[1]=wt.value}else if(At==="z"){if(bt.data.length<3)return void console.error(`Invalid assignment to ${At} for variable ${Tt}. Line ${yt.line}`);bt.data[2]=wt.value}else if(At==="w"){if(bt.data.length<4)return void console.error(`Invalid assignment to ${At} for variable ${Tt}. Line ${yt.line}`);bt.data[3]=wt.value}}else{if(!(wt instanceof Me))return void console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`);if(At.length!==wt.data.length)return void console.error(`Invalid assignment to ${At} for variable ${Tt}. Line ${yt.line}`);for(let Rt=0;Rt<At.length;++Rt){const Pt=At[Rt];if(Pt==="x"||Pt==="r")bt.data[0]=wt.data[Rt];else if(Pt==="y"||Pt==="g"){if(wt.data.length<2)return void console.error(`Invalid assignment to ${Pt} for variable ${Tt}. Line ${yt.line}`);bt.data[1]=wt.data[Rt]}else if(Pt==="z"||Pt==="b"){if(wt.data.length<3)return void console.error(`Invalid assignment to ${Pt} for variable ${Tt}. Line ${yt.line}`);bt.data[2]=wt.data[Rt]}else{if(Pt!=="w"&&Pt!=="a")return void console.error(`Invalid assignment to ${Pt} for variable ${Tt}. Line ${yt.line}`);if(wt.data.length<4)return void console.error(`Invalid assignment to ${Pt} for variable ${Tt}. Line ${yt.line}`);bt.data[3]=wt.data[Rt]}}}}}else bt instanceof Be&&wt instanceof Be?bt.value=wt.value:bt instanceof Me&&wt instanceof Me||bt instanceof Ue&&wt instanceof Ue?bt.data.set(wt.data):console.error(`Invalid assignment to ${Tt}. Line ${yt.line}`)}_function(yt,vt){const bt=new ct(yt);vt.functions.set(yt.name,bt)}_const(yt,vt){let bt=null;yt.value!==null&&(bt=this.evalExpression(yt.value,vt)),vt.createVariable(yt.name,bt,yt)}_let(yt,vt){let bt=null;if(yt.value!==null){if(bt=this.evalExpression(yt.value,vt),bt===null)return void console.error(`Invalid value for variable ${yt.name}. Line ${yt.line}`);yt.value instanceof ke||(bt=bt.clone())}else{const Tt=yt.type.name;if(Tt==="f32"||Tt==="i32"||Tt==="u32"||Tt==="bool"||Tt==="f16"||Tt==="vec2"||Tt==="vec3"||Tt==="vec4"||Tt==="vec2f"||Tt==="vec3f"||Tt==="vec4f"||Tt==="vec2i"||Tt==="vec3i"||Tt==="vec4i"||Tt==="vec2u"||Tt==="vec3u"||Tt==="vec4u"||Tt==="vec2h"||Tt==="vec3h"||Tt==="vec4h"||Tt==="vec2b"||Tt==="vec3b"||Tt==="vec4b"||Tt==="mat2x2"||Tt==="mat2x3"||Tt==="mat2x4"||Tt==="mat3x2"||Tt==="mat3x3"||Tt==="mat3x4"||Tt==="mat4x2"||Tt==="mat4x3"||Tt==="mat4x4"||Tt==="mat2x2f"||Tt==="mat2x3f"||Tt==="mat2x4f"||Tt==="mat3x2f"||Tt==="mat3x3f"||Tt==="mat3x4f"||Tt==="mat4x2f"||Tt==="mat4x3f"||Tt==="mat4x4f"||Tt==="mat2x2h"||Tt==="mat2x3h"||Tt==="mat2x4h"||Tt==="mat3x2h"||Tt==="mat3x3h"||Tt==="mat3x4h"||Tt==="mat4x2h"||Tt==="mat4x3h"||Tt==="mat4x4h"||Tt==="array"){const Et=new de(yt.type,[]);bt=this._evalCreate(Et,vt)}}vt.createVariable(yt.name,bt,yt)}_var(yt,vt){let bt=null;if(yt.value!==null){if(bt=this.evalExpression(yt.value,vt),bt===null)return void console.error(`Invalid value for variable ${yt.name}. Line ${yt.line}`);yt.value instanceof ke||(bt=bt.clone())}else{if(yt.type===null)return void console.error(`Variable ${yt.name} has no type. Line ${yt.line}`);const Tt=yt.type.name;if(Tt==="f32"||Tt==="i32"||Tt==="u32"||Tt==="bool"||Tt==="f16"||Tt==="vec2"||Tt==="vec3"||Tt==="vec4"||Tt==="vec2f"||Tt==="vec3f"||Tt==="vec4f"||Tt==="vec2i"||Tt==="vec3i"||Tt==="vec4i"||Tt==="vec2u"||Tt==="vec3u"||Tt==="vec4u"||Tt==="vec2h"||Tt==="vec3h"||Tt==="vec4h"||Tt==="vec2b"||Tt==="vec3b"||Tt==="vec4b"||Tt==="mat2x2"||Tt==="mat2x3"||Tt==="mat2x4"||Tt==="mat3x2"||Tt==="mat3x3"||Tt==="mat3x4"||Tt==="mat4x2"||Tt==="mat4x3"||Tt==="mat4x4"||Tt==="mat2x2f"||Tt==="mat2x3f"||Tt==="mat2x4f"||Tt==="mat3x2f"||Tt==="mat3x3f"||Tt==="mat3x4f"||Tt==="mat4x2f"||Tt==="mat4x3f"||Tt==="mat4x4f"||Tt==="mat2x2h"||Tt==="mat2x3h"||Tt==="mat2x4h"||Tt==="mat3x2h"||Tt==="mat3x3h"||Tt==="mat3x4h"||Tt==="mat4x2h"||Tt==="mat4x3h"||Tt==="mat4x4h"||yt.type instanceof ue||yt.type instanceof oe||yt.type instanceof ce){const Et=new de(yt.type,[]);bt=this._evalCreate(Et,vt)}}vt.createVariable(yt.name,bt,yt)}_switch(yt,vt){vt=vt.clone();const bt=this.evalExpression(yt.condition,vt);if(!(bt instanceof Be))return console.error(`Invalid if condition. Line ${yt.line}`),null;let Tt=null;for(const Et of yt.cases)if(Et instanceof Ae)for(const wt of Et.selectors){if(wt instanceof Se){Tt=Et;continue}const St=this.evalExpression(wt,vt);if(!(St instanceof Be))return console.error(`Invalid case selector. Line ${yt.line}`),null;if(St.value===bt.value)return this._execStatements(Et.body,vt)}else Et instanceof Ee&&(Tt=Et);return Tt?this._execStatements(Tt.body,vt):null}_if(yt,vt){vt=vt.clone();const bt=this.evalExpression(yt.condition,vt);if(!(bt instanceof Be))return console.error(`Invalid if condition. Line ${yt.line}`),null;if(bt.value)return this._execStatements(yt.body,vt);for(const Tt of yt.elseif){const Et=this.evalExpression(Tt.condition,vt);if(!(Et instanceof Be))return console.error(`Invalid if condition. Line ${yt.line}`),null;if(Et.value)return this._execStatements(Tt.body,vt)}return yt.else?this._execStatements(yt.else,vt):null}_getScalarValue(yt){return yt instanceof Be?yt.value:(console.error("Expected scalar value.",yt),0)}_for(yt,vt){for(vt=vt.clone(),this.execStatement(yt.init,vt);this._getScalarValue(this.evalExpression(yt.condition,vt));){const bt=this._execStatements(yt.body,vt);if(bt===dt._breakObj)break;if(bt!==null&&bt!==dt._continueObj)return bt;this.execStatement(yt.increment,vt)}return null}_loop(yt,vt){for(vt=vt.clone();;){const bt=this._execStatements(yt.body,vt);if(bt===dt._breakObj)break;if(bt===dt._continueObj){if(yt.continuing&&this._execStatements(yt.continuing.body,vt)===dt._breakObj)break}else if(bt!==null)return bt}return null}_while(yt,vt){for(vt=vt.clone();this._getScalarValue(this.evalExpression(yt.condition,vt));){const bt=this._execStatements(yt.body,vt);if(bt===dt._breakObj)break;if(bt!==dt._continueObj&&bt!==null)return bt}return null}_evalBitcast(yt,vt){const bt=this.evalExpression(yt.value,vt),Tt=yt.type;if(bt instanceof Be){const Et=nt(bt.value,bt.typeInfo.name,Tt.name);return new Be(Et,this.getTypeInfo(Tt))}if(bt instanceof Me){const Et=bt.typeInfo.getTypeName();let wt="";if(Et.endsWith("f"))wt="f32";else if(Et.endsWith("i"))wt="i32";else if(Et.endsWith("u"))wt="u32";else if(Et.endsWith("b"))wt="bool";else{if(!Et.endsWith("h"))return console.error(`Unknown vector type ${Et}. Line ${yt.line}`),null;wt="f16"}const St=Tt.getTypeName();let At="";if(St.endsWith("f"))At="f32";else if(St.endsWith("i"))At="i32";else if(St.endsWith("u"))At="u32";else if(St.endsWith("b"))At="bool";else{if(!St.endsWith("h"))return console.error(`Unknown vector type ${At}. Line ${yt.line}`),null;At="f16"}const Rt=function(Pt,Ct,It){if(Ct===It)return Pt;const Mt=new Array(Pt.length);for(let Ot=0;Ot<Pt.length;Ot++)Mt[Ot]=nt(Pt[Ot],Ct,It);return Mt}(Array.from(bt.data),wt,At);return new Me(Rt,this.getTypeInfo(Tt))}return console.error(`TODO: bitcast for ${bt.typeInfo.name}. Line ${yt.line}`),null}_evalConst(yt,vt){return vt.getVariableValue(yt.name).clone().getSubData(this,yt.postfix,vt)}_evalCreate(yt,vt){var bt;if(yt instanceof de){if(yt.type===null)return Ve.void;switch(yt.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(yt,vt);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(yt,vt);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(yt,vt)}}const Tt=yt instanceof de?yt.type.name:yt.name,Et=yt instanceof de?this.getTypeInfo(yt.type):this.getTypeInfo(yt.name);if(Et===null)return console.error(`Unknown type ${Tt}. Line ${yt.line}`),null;if(Et.size===0)return null;const wt=new Pe(new ArrayBuffer(Et.size),Et,0);if(Et instanceof n){if(yt.args)for(let St=0;St<yt.args.length;++St){const At=Et.members[St],Rt=yt.args[St],Pt=this.evalExpression(Rt,vt);wt.setData(this,Pt,At.type,At.offset,vt)}}else if(Et instanceof s){let St=0;if(yt.args)for(let At=0;At<yt.args.length;++At){const Rt=yt.args[At],Pt=this.evalExpression(Rt,vt);Et.format===null&&(((bt=Pt.typeInfo)===null||bt===void 0?void 0:bt.name)==="x32"?Et.format=this.getTypeInfo("i32"):Et.format=Pt.typeInfo),wt.setData(this,Pt,Et.format,St,vt),St+=Et.stride}}else console.error(`Unknown type "${Tt}". Line ${yt.line}`);return yt instanceof de?wt.getSubData(this,yt.postfix,vt):wt}_evalLiteral(yt,vt){const bt=this.getTypeInfo(yt.type),Tt=bt.name;return Tt==="x32"||Tt==="u32"||Tt==="f32"||Tt==="f16"||Tt==="i32"||Tt==="bool"?new Be(yt.scalarValue,bt):Tt==="vec2"||Tt==="vec3"||Tt==="vec4"||Tt==="vec2f"||Tt==="vec3f"||Tt==="vec4f"||Tt==="vec2h"||Tt==="vec3h"||Tt==="vec4h"||Tt==="vec2i"||Tt==="vec3i"||Tt==="vec4i"||Tt==="vec2u"||Tt==="vec3u"||Tt==="vec4u"?this._callConstructorVec(yt,vt):Tt==="mat2x2"||Tt==="mat2x3"||Tt==="mat2x4"||Tt==="mat3x2"||Tt==="mat3x3"||Tt==="mat3x4"||Tt==="mat4x2"||Tt==="mat4x3"||Tt==="mat4x4"||Tt==="mat2x2f"||Tt==="mat2x3f"||Tt==="mat2x4f"||Tt==="mat3x2f"||Tt==="mat3x3f"||Tt==="mat3x4f"||Tt==="mat4x2f"||Tt==="mat4x3f"||Tt==="mat4x4f"||Tt==="mat2x2h"||Tt==="mat2x3h"||Tt==="mat2x4h"||Tt==="mat3x2h"||Tt==="mat3x3h"||Tt==="mat3x4h"||Tt==="mat4x2h"||Tt==="mat4x3h"||Tt==="mat4x4h"?this._callConstructorMatrix(yt,vt):yt.value}_evalVariable(yt,vt){const bt=vt.getVariableValue(yt.name);return bt===null?bt:bt.getSubData(this,yt.postfix,vt)}_maxFormatTypeInfo(yt){let vt=yt[0];if(vt.name==="f32")return vt;for(let bt=1;bt<yt.length;++bt){const Tt=dt._priority.get(vt.name);dt._priority.get(yt[bt].name)<Tt&&(vt=yt[bt])}return vt.name==="x32"?this.getTypeInfo("i32"):vt}_evalUnaryOp(yt,vt){const bt=this.evalExpression(yt.right,vt);if(yt.operator==="&")return new Oe(bt);if(yt.operator==="*")return bt instanceof Oe?bt.reference.getSubData(this,yt.postfix,vt):(console.error(`Invalid dereference. Line ${yt.line}`),null);const Tt=bt instanceof Be?bt.value:bt instanceof Me?Array.from(bt.data):null;switch(yt.operator){case"+":{if(Ge(Tt)){const St=Tt.map((At,Rt)=>+At);return new Me(St,bt.typeInfo)}const Et=Tt,wt=this._maxFormatTypeInfo([bt.typeInfo,bt.typeInfo]);return new Be(+Et,wt)}case"-":{if(Ge(Tt)){const St=Tt.map((At,Rt)=>-At);return new Me(St,bt.typeInfo)}const Et=Tt,wt=this._maxFormatTypeInfo([bt.typeInfo,bt.typeInfo]);return new Be(-Et,wt)}case"!":{if(Ge(Tt)){const St=Tt.map((At,Rt)=>At?0:1);return new Me(St,bt.typeInfo)}const Et=Tt,wt=this._maxFormatTypeInfo([bt.typeInfo,bt.typeInfo]);return new Be(Et?0:1,wt)}case"~":{if(Ge(Tt)){const St=Tt.map((At,Rt)=>~At);return new Me(St,bt.typeInfo)}const Et=Tt,wt=this._maxFormatTypeInfo([bt.typeInfo,bt.typeInfo]);return new Be(~Et,wt)}}return console.error(`Invalid unary operator ${yt.operator}. Line ${yt.line}`),null}_evalBinaryOp(yt,vt){const bt=this.evalExpression(yt.left,vt),Tt=this.evalExpression(yt.right,vt),Et=bt instanceof Be?bt.value:bt instanceof Me||bt instanceof Ue?Array.from(bt.data):null,wt=Tt instanceof Be?Tt.value:Tt instanceof Me||Tt instanceof Ue?Array.from(Tt.data):null;switch(yt.operator){case"+":{if(Ge(Et)&&Ge(wt)){const Pt=Et,Ct=wt;if(Pt.length!==Ct.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const It=Pt.map((Mt,Ot)=>Mt+Ct[Ot]);return new Me(It,bt.typeInfo)}if(Ge(Et)){const Pt=wt,Ct=Et.map((It,Mt)=>It+Pt);return new Me(Ct,bt.typeInfo)}if(Ge(wt)){const Pt=Et,Ct=wt.map((It,Mt)=>Pt+It);return new Me(Ct,Tt.typeInfo)}const St=Et,At=wt,Rt=this._maxFormatTypeInfo([bt.typeInfo,Tt.typeInfo]);return new Be(St+At,Rt)}case"-":{if(Ge(Et)&&Ge(wt)){const Pt=Et,Ct=wt;if(Pt.length!==Ct.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const It=Pt.map((Mt,Ot)=>Mt-Ct[Ot]);return new Me(It,bt.typeInfo)}if(Ge(Et)){const Pt=wt,Ct=Et.map((It,Mt)=>It-Pt);return new Me(Ct,bt.typeInfo)}if(Ge(wt)){const Pt=Et,Ct=wt.map((It,Mt)=>Pt-It);return new Me(Ct,Tt.typeInfo)}const St=Et,At=wt,Rt=this._maxFormatTypeInfo([bt.typeInfo,Tt.typeInfo]);return new Be(St-At,Rt)}case"*":{if(Ge(Et)&&Ge(wt)){const Pt=Et,Ct=wt;if(bt instanceof Ue&&Tt instanceof Ue){const It=function(Ft,Nt,Lt,Dt){if(pt[Nt.name]===void 0||pt[Dt.name]===void 0)return null;const $t=pt[Nt.name][0],zt=pt[Nt.name][1],Ut=pt[Dt.name][0];if($t!==pt[Dt.name][1])return null;const jt=new Array(Ut*zt);for(let Ht=0;Ht<zt;Ht++)for(let Vt=0;Vt<Ut;Vt++){let Wt=0;for(let Yt=0;Yt<$t;Yt++)Wt+=Ft[Yt*zt+Ht]*Lt[Vt*$t+Yt];jt[Ht*Ut+Vt]=Wt}return jt}(Pt,bt.typeInfo,Ct,Tt.typeInfo);if(It===null)return console.error(`Matrix multiplication failed. Line ${yt.line}.`),null;const Mt=pt[Tt.typeInfo.name][0],Ot=pt[bt.typeInfo.name][1],kt=this.getTypeInfo(`mat${Mt}x${Ot}f`);return new Ue(It,kt)}if(bt instanceof Ue&&Tt instanceof Me){const It=function(Mt,Ot,kt,Ft){if(pt[Ot.name]===void 0||ft[Ft.name]===void 0)return null;const Nt=pt[Ot.name][0],Lt=pt[Ot.name][1];if(Nt!==kt.length)return null;const Dt=new Array(Lt);for(let $t=0;$t<Lt;$t++){let zt=0;for(let Ut=0;Ut<Nt;Ut++)zt+=Mt[Ut*Lt+$t]*kt[Ut];Dt[$t]=zt}return Dt}(Pt,bt.typeInfo,Ct,Tt.typeInfo);return It===null?(console.error(`Matrix vector multiplication failed. Line ${yt.line}.`),null):new Me(It,Tt.typeInfo)}if(bt instanceof Me&&Tt instanceof Ue){const It=function(Mt,Ot,kt,Ft){if(ft[Ot.name]===void 0||pt[Ft.name]===void 0)return null;const Nt=pt[Ft.name][0],Lt=pt[Ft.name][1];if(Lt!==Mt.length)return null;const Dt=[];for(let $t=0;$t<Nt;$t++){let zt=0;for(let Ut=0;Ut<Lt;Ut++)zt+=Mt[Ut]*kt[Ut*Nt+$t];Dt[$t]=zt}return Dt}(Pt,bt.typeInfo,Ct,Tt.typeInfo);return It===null?(console.error(`Matrix vector multiplication failed. Line ${yt.line}.`),null):new Me(It,bt.typeInfo)}{if(Pt.length!==Ct.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const It=Pt.map((Mt,Ot)=>Mt*Ct[Ot]);return new Me(It,bt.typeInfo)}}if(Ge(Et)){const Pt=wt,Ct=Et.map((It,Mt)=>It*Pt);return bt instanceof Ue?new Ue(Ct,bt.typeInfo):new Me(Ct,bt.typeInfo)}if(Ge(wt)){const Pt=Et,Ct=wt.map((It,Mt)=>Pt*It);return Tt instanceof Ue?new Ue(Ct,Tt.typeInfo):new Me(Ct,Tt.typeInfo)}const St=Et,At=wt,Rt=this._maxFormatTypeInfo([bt.typeInfo,Tt.typeInfo]);return new Be(St*At,Rt)}case"%":{if(Ge(Et)&&Ge(wt)){const Pt=Et,Ct=wt;if(Pt.length!==Ct.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const It=Pt.map((Mt,Ot)=>Mt%Ct[Ot]);return new Me(It,bt.typeInfo)}if(Ge(Et)){const Pt=wt,Ct=Et.map((It,Mt)=>It%Pt);return new Me(Ct,bt.typeInfo)}if(Ge(wt)){const Pt=Et,Ct=wt.map((It,Mt)=>Pt%It);return new Me(Ct,Tt.typeInfo)}const St=Et,At=wt,Rt=this._maxFormatTypeInfo([bt.typeInfo,Tt.typeInfo]);return new Be(St%At,Rt)}case"/":{if(Ge(Et)&&Ge(wt)){const Pt=Et,Ct=wt;if(Pt.length!==Ct.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const It=Pt.map((Mt,Ot)=>Mt/Ct[Ot]);return new Me(It,bt.typeInfo)}if(Ge(Et)){const Pt=wt,Ct=Et.map((It,Mt)=>It/Pt);return new Me(Ct,bt.typeInfo)}if(Ge(wt)){const Pt=Et,Ct=wt.map((It,Mt)=>Pt/It);return new Me(Ct,Tt.typeInfo)}const St=Et,At=wt,Rt=this._maxFormatTypeInfo([bt.typeInfo,Tt.typeInfo]);return new Be(St/At,Rt)}case"&":{if(Ge(Et)&&Ge(wt)){const Pt=Et,Ct=wt;if(Pt.length!==Ct.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const It=Pt.map((Mt,Ot)=>Mt&Ct[Ot]);return new Me(It,bt.typeInfo)}if(Ge(Et)){const Pt=wt,Ct=Et.map((It,Mt)=>It&Pt);return new Me(Ct,bt.typeInfo)}if(Ge(wt)){const Pt=Et,Ct=wt.map((It,Mt)=>Pt&It);return new Me(Ct,Tt.typeInfo)}const St=Et,At=wt,Rt=this._maxFormatTypeInfo([bt.typeInfo,Tt.typeInfo]);return new Be(St&At,Rt)}case"|":{if(Ge(Et)&&Ge(wt)){const Pt=Et,Ct=wt;if(Pt.length!==Ct.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const It=Pt.map((Mt,Ot)=>Mt|Ct[Ot]);return new Me(It,bt.typeInfo)}if(Ge(Et)){const Pt=wt,Ct=Et.map((It,Mt)=>It|Pt);return new Me(Ct,bt.typeInfo)}if(Ge(wt)){const Pt=Et,Ct=wt.map((It,Mt)=>Pt|It);return new Me(Ct,Tt.typeInfo)}const St=Et,At=wt,Rt=this._maxFormatTypeInfo([bt.typeInfo,Tt.typeInfo]);return new Be(St|At,Rt)}case"^":{if(Ge(Et)&&Ge(wt)){const Pt=Et,Ct=wt;if(Pt.length!==Ct.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const It=Pt.map((Mt,Ot)=>Mt^Ct[Ot]);return new Me(It,bt.typeInfo)}if(Ge(Et)){const Pt=wt,Ct=Et.map((It,Mt)=>It^Pt);return new Me(Ct,bt.typeInfo)}if(Ge(wt)){const Pt=Et,Ct=wt.map((It,Mt)=>Pt^It);return new Me(Ct,Tt.typeInfo)}const St=Et,At=wt,Rt=this._maxFormatTypeInfo([bt.typeInfo,Tt.typeInfo]);return new Be(St^At,Rt)}case"<<":{if(Ge(Et)&&Ge(wt)){const Pt=Et,Ct=wt;if(Pt.length!==Ct.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const It=Pt.map((Mt,Ot)=>Mt<<Ct[Ot]);return new Me(It,bt.typeInfo)}if(Ge(Et)){const Pt=wt,Ct=Et.map((It,Mt)=>It<<Pt);return new Me(Ct,bt.typeInfo)}if(Ge(wt)){const Pt=Et,Ct=wt.map((It,Mt)=>Pt<<It);return new Me(Ct,Tt.typeInfo)}const St=Et,At=wt,Rt=this._maxFormatTypeInfo([bt.typeInfo,Tt.typeInfo]);return new Be(St<<At,Rt)}case">>":{if(Ge(Et)&&Ge(wt)){const Pt=Et,Ct=wt;if(Pt.length!==Ct.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const It=Pt.map((Mt,Ot)=>Mt>>Ct[Ot]);return new Me(It,bt.typeInfo)}if(Ge(Et)){const Pt=wt,Ct=Et.map((It,Mt)=>It>>Pt);return new Me(Ct,bt.typeInfo)}if(Ge(wt)){const Pt=Et,Ct=wt.map((It,Mt)=>Pt>>It);return new Me(Ct,Tt.typeInfo)}const St=Et,At=wt,Rt=this._maxFormatTypeInfo([bt.typeInfo,Tt.typeInfo]);return new Be(St>>At,Rt)}case">":if(Ge(Et)&&Ge(wt)){const St=Et,At=wt;if(St.length!==At.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const Rt=St.map((Pt,Ct)=>Pt>At[Ct]?1:0);return new Me(Rt,bt.typeInfo)}if(Ge(Et)){const St=wt,At=Et.map((Rt,Pt)=>Rt>St?1:0);return new Me(At,bt.typeInfo)}if(Ge(wt)){const St=Et,At=wt.map((Rt,Pt)=>St>Rt?1:0);return new Me(At,Tt.typeInfo)}return new Be(Et>wt?1:0,this.getTypeInfo("bool"));case"<":if(Ge(Et)&&Ge(wt)){const St=Et,At=wt;if(St.length!==At.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const Rt=St.map((Pt,Ct)=>Pt<At[Ct]?1:0);return new Me(Rt,bt.typeInfo)}if(Ge(Et)){const St=wt,At=Et.map((Rt,Pt)=>Rt<St?1:0);return new Me(At,bt.typeInfo)}if(Ge(wt)){const St=Et,At=wt.map((Rt,Pt)=>St<Rt?1:0);return new Me(At,Tt.typeInfo)}return new Be(Et<wt?1:0,this.getTypeInfo("bool"));case"==":if(Ge(Et)&&Ge(wt)){const St=Et,At=wt;if(St.length!==At.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const Rt=St.map((Pt,Ct)=>Pt===At[Ct]?1:0);return new Me(Rt,bt.typeInfo)}if(Ge(Et)){const St=wt,At=Et.map((Rt,Pt)=>Rt==St?1:0);return new Me(At,bt.typeInfo)}if(Ge(wt)){const St=Et,At=wt.map((Rt,Pt)=>St==Rt?1:0);return new Me(At,Tt.typeInfo)}return new Be(Et===wt?1:0,this.getTypeInfo("bool"));case"!=":if(Ge(Et)&&Ge(wt)){const St=Et,At=wt;if(St.length!==At.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const Rt=St.map((Pt,Ct)=>Pt!==At[Ct]?1:0);return new Me(Rt,bt.typeInfo)}if(Ge(Et)){const St=wt,At=Et.map((Rt,Pt)=>Rt!==St?1:0);return new Me(At,bt.typeInfo)}if(Ge(wt)){const St=Et,At=wt.map((Rt,Pt)=>St!==Rt?1:0);return new Me(At,Tt.typeInfo)}return new Be(Et!==wt?1:0,this.getTypeInfo("bool"));case">=":if(Ge(Et)&&Ge(wt)){const St=Et,At=wt;if(St.length!==At.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const Rt=St.map((Pt,Ct)=>Pt>=At[Ct]?1:0);return new Me(Rt,bt.typeInfo)}if(Ge(Et)){const St=wt,At=Et.map((Rt,Pt)=>Rt>=St?1:0);return new Me(At,bt.typeInfo)}if(Ge(wt)){const St=Et,At=wt.map((Rt,Pt)=>St>=Rt?1:0);return new Me(At,Tt.typeInfo)}return new Be(Et>=wt?1:0,this.getTypeInfo("bool"));case"<=":if(Ge(Et)&&Ge(wt)){const St=Et,At=wt;if(St.length!==At.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const Rt=St.map((Pt,Ct)=>Pt<=At[Ct]?1:0);return new Me(Rt,bt.typeInfo)}if(Ge(Et)){const St=wt,At=Et.map((Rt,Pt)=>Rt<=St?1:0);return new Me(At,bt.typeInfo)}if(Ge(wt)){const St=Et,At=wt.map((Rt,Pt)=>St<=Rt?1:0);return new Me(At,Tt.typeInfo)}return new Be(Et<=wt?1:0,this.getTypeInfo("bool"));case"&&":if(Ge(Et)&&Ge(wt)){const St=Et,At=wt;if(St.length!==At.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const Rt=St.map((Pt,Ct)=>Pt&&At[Ct]?1:0);return new Me(Rt,bt.typeInfo)}if(Ge(Et)){const St=wt,At=Et.map((Rt,Pt)=>Rt&&St?1:0);return new Me(At,bt.typeInfo)}if(Ge(wt)){const St=Et,At=wt.map((Rt,Pt)=>St&&Rt?1:0);return new Me(At,Tt.typeInfo)}return new Be(Et&&wt?1:0,this.getTypeInfo("bool"));case"||":if(Ge(Et)&&Ge(wt)){const St=Et,At=wt;if(St.length!==At.length)return console.error(`Vector length mismatch. Line ${yt.line}.`),null;const Rt=St.map((Pt,Ct)=>Pt||At[Ct]?1:0);return new Me(Rt,bt.typeInfo)}if(Ge(Et)){const St=wt,At=Et.map((Rt,Pt)=>Rt||St?1:0);return new Me(At,bt.typeInfo)}if(Ge(wt)){const St=Et,At=wt.map((Rt,Pt)=>St||Rt?1:0);return new Me(At,Tt.typeInfo)}return new Be(Et||wt?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${yt.operator}. Line ${yt.line}`),null}_evalCall(yt,vt){if(yt.cachedReturnValue!==null)return yt.cachedReturnValue;const bt=vt.clone();bt.currentFunctionName=yt.name;const Tt=vt.getFunction(yt.name);if(!Tt)return yt.isBuiltin?this._callBuiltinFunction(yt,bt):this.getTypeInfo(yt.name)?this._evalCreate(yt,vt):(console.error(`Unknown function "${yt.name}". Line ${yt.line}`),null);for(let Et=0;Et<Tt.node.args.length;++Et){const wt=Tt.node.args[Et],St=this.evalExpression(yt.args[Et],bt);bt.createVariable(wt.name,St,wt)}return this._execStatements(Tt.node.body,bt)}_callBuiltinFunction(yt,vt){switch(yt.name){case"all":return this.builtins.All(yt,vt);case"any":return this.builtins.Any(yt,vt);case"select":return this.builtins.Select(yt,vt);case"arrayLength":return this.builtins.ArrayLength(yt,vt);case"abs":return this.builtins.Abs(yt,vt);case"acos":return this.builtins.Acos(yt,vt);case"acosh":return this.builtins.Acosh(yt,vt);case"asin":return this.builtins.Asin(yt,vt);case"asinh":return this.builtins.Asinh(yt,vt);case"atan":return this.builtins.Atan(yt,vt);case"atanh":return this.builtins.Atanh(yt,vt);case"atan2":return this.builtins.Atan2(yt,vt);case"ceil":return this.builtins.Ceil(yt,vt);case"clamp":return this.builtins.Clamp(yt,vt);case"cos":return this.builtins.Cos(yt,vt);case"cosh":return this.builtins.Cosh(yt,vt);case"countLeadingZeros":return this.builtins.CountLeadingZeros(yt,vt);case"countOneBits":return this.builtins.CountOneBits(yt,vt);case"countTrailingZeros":return this.builtins.CountTrailingZeros(yt,vt);case"cross":return this.builtins.Cross(yt,vt);case"degrees":return this.builtins.Degrees(yt,vt);case"determinant":return this.builtins.Determinant(yt,vt);case"distance":return this.builtins.Distance(yt,vt);case"dot":return this.builtins.Dot(yt,vt);case"dot4U8Packed":return this.builtins.Dot4U8Packed(yt,vt);case"dot4I8Packed":return this.builtins.Dot4I8Packed(yt,vt);case"exp":return this.builtins.Exp(yt,vt);case"exp2":return this.builtins.Exp2(yt,vt);case"extractBits":return this.builtins.ExtractBits(yt,vt);case"faceForward":return this.builtins.FaceForward(yt,vt);case"firstLeadingBit":return this.builtins.FirstLeadingBit(yt,vt);case"firstTrailingBit":return this.builtins.FirstTrailingBit(yt,vt);case"floor":return this.builtins.Floor(yt,vt);case"fma":return this.builtins.Fma(yt,vt);case"fract":return this.builtins.Fract(yt,vt);case"frexp":return this.builtins.Frexp(yt,vt);case"insertBits":return this.builtins.InsertBits(yt,vt);case"inverseSqrt":return this.builtins.InverseSqrt(yt,vt);case"ldexp":return this.builtins.Ldexp(yt,vt);case"length":return this.builtins.Length(yt,vt);case"log":return this.builtins.Log(yt,vt);case"log2":return this.builtins.Log2(yt,vt);case"max":return this.builtins.Max(yt,vt);case"min":return this.builtins.Min(yt,vt);case"mix":return this.builtins.Mix(yt,vt);case"modf":return this.builtins.Modf(yt,vt);case"normalize":return this.builtins.Normalize(yt,vt);case"pow":return this.builtins.Pow(yt,vt);case"quantizeToF16":return this.builtins.QuantizeToF16(yt,vt);case"radians":return this.builtins.Radians(yt,vt);case"reflect":return this.builtins.Reflect(yt,vt);case"refract":return this.builtins.Refract(yt,vt);case"reverseBits":return this.builtins.ReverseBits(yt,vt);case"round":return this.builtins.Round(yt,vt);case"saturate":return this.builtins.Saturate(yt,vt);case"sign":return this.builtins.Sign(yt,vt);case"sin":return this.builtins.Sin(yt,vt);case"sinh":return this.builtins.Sinh(yt,vt);case"smoothstep":return this.builtins.SmoothStep(yt,vt);case"sqrt":return this.builtins.Sqrt(yt,vt);case"step":return this.builtins.Step(yt,vt);case"tan":return this.builtins.Tan(yt,vt);case"tanh":return this.builtins.Tanh(yt,vt);case"transpose":return this.builtins.Transpose(yt,vt);case"trunc":return this.builtins.Trunc(yt,vt);case"dpdx":return this.builtins.Dpdx(yt,vt);case"dpdxCoarse":return this.builtins.DpdxCoarse(yt,vt);case"dpdxFine":return this.builtins.DpdxFine(yt,vt);case"dpdy":return this.builtins.Dpdy(yt,vt);case"dpdyCoarse":return this.builtins.DpdyCoarse(yt,vt);case"dpdyFine":return this.builtins.DpdyFine(yt,vt);case"fwidth":return this.builtins.Fwidth(yt,vt);case"fwidthCoarse":return this.builtins.FwidthCoarse(yt,vt);case"fwidthFine":return this.builtins.FwidthFine(yt,vt);case"textureDimensions":return this.builtins.TextureDimensions(yt,vt);case"textureGather":return this.builtins.TextureGather(yt,vt);case"textureGatherCompare":return this.builtins.TextureGatherCompare(yt,vt);case"textureLoad":return this.builtins.TextureLoad(yt,vt);case"textureNumLayers":return this.builtins.TextureNumLayers(yt,vt);case"textureNumLevels":return this.builtins.TextureNumLevels(yt,vt);case"textureNumSamples":return this.builtins.TextureNumSamples(yt,vt);case"textureSample":return this.builtins.TextureSample(yt,vt);case"textureSampleBias":return this.builtins.TextureSampleBias(yt,vt);case"textureSampleCompare":return this.builtins.TextureSampleCompare(yt,vt);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(yt,vt);case"textureSampleGrad":return this.builtins.TextureSampleGrad(yt,vt);case"textureSampleLevel":return this.builtins.TextureSampleLevel(yt,vt);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(yt,vt);case"textureStore":return this.builtins.TextureStore(yt,vt);case"atomicLoad":return this.builtins.AtomicLoad(yt,vt);case"atomicStore":return this.builtins.AtomicStore(yt,vt);case"atomicAdd":return this.builtins.AtomicAdd(yt,vt);case"atomicSub":return this.builtins.AtomicSub(yt,vt);case"atomicMax":return this.builtins.AtomicMax(yt,vt);case"atomicMin":return this.builtins.AtomicMin(yt,vt);case"atomicAnd":return this.builtins.AtomicAnd(yt,vt);case"atomicOr":return this.builtins.AtomicOr(yt,vt);case"atomicXor":return this.builtins.AtomicXor(yt,vt);case"atomicExchange":return this.builtins.AtomicExchange(yt,vt);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(yt,vt);case"pack4x8snorm":return this.builtins.Pack4x8snorm(yt,vt);case"pack4x8unorm":return this.builtins.Pack4x8unorm(yt,vt);case"pack4xI8":return this.builtins.Pack4xI8(yt,vt);case"pack4xU8":return this.builtins.Pack4xU8(yt,vt);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(yt,vt);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(yt,vt);case"pack2x16snorm":return this.builtins.Pack2x16snorm(yt,vt);case"pack2x16unorm":return this.builtins.Pack2x16unorm(yt,vt);case"pack2x16float":return this.builtins.Pack2x16float(yt,vt);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(yt,vt);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(yt,vt);case"unpack4xI8":return this.builtins.Unpack4xI8(yt,vt);case"unpack4xU8":return this.builtins.Unpack4xU8(yt,vt);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(yt,vt);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(yt,vt);case"unpack2x16float":return this.builtins.Unpack2x16float(yt,vt);case"storageBarrier":return this.builtins.StorageBarrier(yt,vt);case"textureBarrier":return this.builtins.TextureBarrier(yt,vt);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(yt,vt);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(yt,vt);case"subgroupAdd":return this.builtins.SubgroupAdd(yt,vt);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(yt,vt);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(yt,vt);case"subgroupAll":return this.builtins.SubgroupAll(yt,vt);case"subgroupAnd":return this.builtins.SubgroupAnd(yt,vt);case"subgroupAny":return this.builtins.SubgroupAny(yt,vt);case"subgroupBallot":return this.builtins.SubgroupBallot(yt,vt);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(yt,vt);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(yt,vt);case"subgroupElect":return this.builtins.SubgroupElect(yt,vt);case"subgroupMax":return this.builtins.SubgroupMax(yt,vt);case"subgroupMin":return this.builtins.SubgroupMin(yt,vt);case"subgroupMul":return this.builtins.SubgroupMul(yt,vt);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(yt,vt);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(yt,vt);case"subgroupOr":return this.builtins.SubgroupOr(yt,vt);case"subgroupShuffle":return this.builtins.SubgroupShuffle(yt,vt);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(yt,vt);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(yt,vt);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(yt,vt);case"subgroupXor":return this.builtins.SubgroupXor(yt,vt);case"quadBroadcast":return this.builtins.QuadBroadcast(yt,vt);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(yt,vt);case"quadSwapX":return this.builtins.QuadSwapX(yt,vt);case"quadSwapY":return this.builtins.QuadSwapY(yt,vt)}const bt=vt.getFunction(yt.name);if(bt){const Tt=vt.clone();for(let Et=0;Et<bt.node.args.length;++Et){const wt=bt.node.args[Et],St=this.evalExpression(yt.args[Et],Tt);Tt.setVariable(wt.name,St,wt)}return this._execStatements(bt.node.body,Tt)}return null}_callConstructorValue(yt,vt){if(!yt.args||yt.args.length===0)return new Be(0,this.getTypeInfo(yt.type));const bt=this.evalExpression(yt.args[0],vt);return bt.typeInfo=this.getTypeInfo(yt.type),bt.getSubData(this,yt.postfix,vt).clone()}_callConstructorVec(yt,vt){const bt=this.getTypeInfo(yt.type),Tt=yt.type.getTypeName(),Et=ft[Tt];if(Et===void 0)return console.error(`Invalid vec constructor ${Tt}. Line ${yt.line}`),null;const wt=[];if(yt instanceof xe)if(yt.isVector){const St=yt.vectorValue;for(const At of St)wt.push(At)}else wt.push(yt.scalarValue);else if(yt.args)for(const St of yt.args){const At=this.evalExpression(St,vt);if(At instanceof Me){const Rt=At.data;for(let Pt=0;Pt<Rt.length;++Pt){let Ct=Rt[Pt];wt.push(Ct)}}else if(At instanceof Be){let Rt=At.value;wt.push(Rt)}}if(yt.type instanceof ce&&yt.type.format===null&&(yt.type.format=ce.f32),wt.length===0){const St=new Array(Et).fill(0);return new Me(St,bt).getSubData(this,yt.postfix,vt)}if(wt.length===1)for(;wt.length<Et;)wt.push(wt[0]);return wt.length<Et?(console.error(`Invalid vec constructor. Line ${yt.line}`),null):new Me(wt.length>Et?wt.slice(0,Et):wt,bt).getSubData(this,yt.postfix,vt)}_callConstructorMatrix(yt,vt){const bt=this.getTypeInfo(yt.type),Tt=yt.type.getTypeName(),Et=pt[Tt];if(Et===void 0)return console.error(`Invalid matrix constructor ${Tt}. Line ${yt.line}`),null;const wt=[];if(yt instanceof xe)if(yt.isVector){const St=yt.vectorValue;for(const At of St)wt.push(At)}else wt.push(yt.scalarValue);else if(yt.args)for(const St of yt.args){const At=this.evalExpression(St,vt);At instanceof Me?wt.push(...At.data):At instanceof Be?wt.push(At.value):At instanceof Ue&&wt.push(...At.data)}if(bt instanceof a&&bt.format===null&&(bt.format=this.getTypeInfo("f32")),wt.length===0){const St=new Array(Et[2]).fill(0);return new Ue(St,bt).getSubData(this,yt.postfix,vt)}return wt.length!==Et[2]?(console.error(`Invalid matrix constructor. Line ${yt.line}`),null):new Ue(wt,bt).getSubData(this,yt.postfix,vt)}}dt._breakObj=new Ne(new e("BREAK",null),null),dt._continueObj=new Ne(new e("CONTINUE",null),null),dt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class mt{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class gt{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new mt,this._exec=new dt,this._forwardTypeCount=0}parse(yt){this._initialize(yt),this._deferArrayCountEval.length=0;const vt=[];for(;!this._isAtEnd();){const bt=this._global_decl_or_directive();if(!bt)break;vt.push(bt)}if(this._deferArrayCountEval.length>0){for(const bt of this._deferArrayCountEval){const Tt=bt.arrayType,Et=bt.countNode;if(Et instanceof ge){const wt=Et.name,St=this._context.constants.get(wt);if(St)try{const At=St.constEvaluate(this._exec);Tt.count=At}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const bt of vt)bt.search(Tt=>{Tt instanceof Ce||Tt instanceof le?Tt.type=this._forwardType(Tt.type):Tt instanceof ue?Tt.format=this._forwardType(Tt.format):Tt instanceof F||Tt instanceof U||Tt instanceof P?Tt.type=this._forwardType(Tt.type):Tt instanceof D?Tt.returnType=this._forwardType(Tt.returnType):Tt instanceof $e&&(Tt.type=this._forwardType(Tt.type))});return vt}_forwardType(yt){if(yt instanceof ie){const vt=this._getType(yt.name);if(vt)return vt}else yt instanceof le?yt.type=this._forwardType(yt.type):yt instanceof ue&&(yt.format=this._forwardType(yt.format));return yt}_initialize(yt){if(yt)if(typeof yt=="string"){const vt=new Re(yt);this._tokens=vt.scanTokens()}else this._tokens=yt;else this._tokens=[];this._current=0}_updateNode(yt,vt){return yt.line=vt??this._currentLine,yt}_error(yt,vt){return{token:yt,message:vt,toString:()=>`${vt}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==He.eof}_match(yt){if(yt instanceof qe)return!!this._check(yt)&&(this._advance(),!0);for(let vt=0,bt=yt.length;vt<bt;++vt){const Tt=yt[vt];if(this._check(Tt))return this._advance(),!0}return!1}_consume(yt,vt){if(this._check(yt))return this._advance();throw this._error(this._peek(),`${vt}. Line:${this._currentLine}`)}_check(yt){if(this._isAtEnd())return!1;const vt=this._peek();if(yt instanceof Array){const bt=vt.type;let Tt=!1;for(const Et of yt){if(bt===Et)return!0;Et===He.tokens.name&&(Tt=!0)}if(Tt){const Et=He.tokens.name.rule.exec(vt.lexeme);if(Et&&Et.index==0&&Et[0]==vt.lexeme)return!0}return!1}if(vt.type===yt)return!0;if(yt===He.tokens.name){const bt=He.tokens.name.rule.exec(vt.lexeme);return bt&&bt.index==0&&bt[0]==vt.lexeme}return!1}_advance(){var yt,vt;return this._currentLine=(vt=(yt=this._peek())===null||yt===void 0?void 0:yt.line)!==null&&vt!==void 0?vt:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(He.tokens.semicolon)&&!this._isAtEnd(););if(this._match(He.keywords.alias)){const vt=this._type_alias();return this._consume(He.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([vt]),vt}if(this._match(He.keywords.diagnostic)){const vt=this._diagnostic();return this._consume(He.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([vt]),vt}if(this._match(He.keywords.requires)){const vt=this._requires_directive();return this._consume(He.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([vt]),vt}if(this._match(He.keywords.enable)){const vt=this._enable_directive();return this._consume(He.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([vt]),vt}const yt=this._attribute();if(this._check(He.keywords.var)){const vt=this._global_variable_decl();return vt!=null&&(vt.attributes=yt),this._consume(He.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([vt]),vt}if(this._check(He.keywords.override)){const vt=this._override_variable_decl();return vt!=null&&(vt.attributes=yt),this._consume(He.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([vt]),vt}if(this._check(He.keywords.let)){const vt=this._global_let_decl();return vt!=null&&(vt.attributes=yt),this._consume(He.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([vt]),vt}if(this._check(He.keywords.const)){const vt=this._global_const_decl();return vt!=null&&(vt.attributes=yt),this._consume(He.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([vt]),vt}if(this._check(He.keywords.struct)){const vt=this._struct_decl();return vt!=null&&(vt.attributes=yt),this._exec.reflection.updateAST([vt]),vt}if(this._check(He.keywords.fn)){const vt=this._function_decl();return vt!=null&&(vt.attributes=yt),this._exec.reflection.updateAST([vt]),vt}return null}_function_decl(){if(!this._match(He.keywords.fn))return null;const yt=this._currentLine,vt=this._consume(He.tokens.ident,"Expected function name.").toString();this._consume(He.tokens.paren_left,"Expected '(' for function arguments.");const bt=[];if(!this._check(He.tokens.paren_right))do{if(this._check(He.tokens.paren_right))break;const St=this._attribute(),At=this._consume(He.tokens.name,"Expected argument name.").toString();this._consume(He.tokens.colon,"Expected ':' for argument type.");const Rt=this._attribute(),Pt=this._type_decl();Pt!=null&&(Pt.attributes=Rt,bt.push(this._updateNode(new $e(At,Pt,St))))}while(this._match(He.tokens.comma));this._consume(He.tokens.paren_right,"Expected ')' after function arguments.");let Tt=null;if(this._match(He.tokens.arrow)){const St=this._attribute();Tt=this._type_decl(),Tt!=null&&(Tt.attributes=St)}const Et=this._compound_statement(),wt=this._currentLine;return this._updateNode(new D(vt,bt,Tt,Et,yt,wt),yt)}_compound_statement(){const yt=[];for(this._consume(He.tokens.brace_left,"Expected '{' for block.");!this._check(He.tokens.brace_right);){const vt=this._statement();vt!==null&&yt.push(vt)}return this._consume(He.tokens.brace_right,"Expected '}' for block."),yt}_statement(){for(;this._match(He.tokens.semicolon)&&!this._isAtEnd(););if(this._check(He.tokens.attr)&&this._attribute(),this._check(He.keywords.if))return this._if_statement();if(this._check(He.keywords.switch))return this._switch_statement();if(this._check(He.keywords.loop))return this._loop_statement();if(this._check(He.keywords.for))return this._for_statement();if(this._check(He.keywords.while))return this._while_statement();if(this._check(He.keywords.continuing))return this._continuing_statement();if(this._check(He.keywords.static_assert))return this._static_assert_statement();if(this._check(He.tokens.brace_left))return this._compound_statement();let yt=null;if(this._check(He.keywords.return))yt=this._return_statement();else if(this._check([He.keywords.var,He.keywords.let,He.keywords.const]))yt=this._variable_statement();else if(this._match(He.keywords.discard))yt=this._updateNode(new ne);else if(this._match(He.keywords.break)){const vt=this._updateNode(new se);if(this._currentLoop.length>0){const bt=this._currentLoop[this._currentLoop.length-1];vt.loopId=bt.id}yt=vt,this._check(He.keywords.if)&&(this._advance(),vt.condition=this._optional_paren_expression())}else if(this._match(He.keywords.continue)){const vt=this._updateNode(new re);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${vt.line}`);{const bt=this._currentLoop[this._currentLoop.length-1];vt.loopId=bt.id}yt=vt}else yt=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return yt!=null&&this._consume(He.tokens.semicolon,"Expected ';' after statement."),yt}_static_assert_statement(){if(!this._match(He.keywords.static_assert))return null;const yt=this._currentLine,vt=this._optional_paren_expression();return this._updateNode(new N(vt),yt)}_while_statement(){if(!this._match(He.keywords.while))return null;const yt=this._updateNode(new V(null,null));return this._currentLoop.push(yt),yt.condition=this._optional_paren_expression(),this._check(He.tokens.attr)&&this._attribute(),yt.body=this._compound_statement(),this._currentLoop.pop(),yt}_continuing_statement(){const yt=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(He.keywords.continuing))return null;const vt=this._currentLine,bt=this._compound_statement();return this._updateNode(new O(bt,yt),vt)}_for_statement(){if(!this._match(He.keywords.for))return null;this._consume(He.tokens.paren_left,"Expected '('.");const yt=this._updateNode(new B(null,null,null,null));return this._currentLoop.push(yt),yt.init=this._check(He.tokens.semicolon)?null:this._for_init(),this._consume(He.tokens.semicolon,"Expected ';'."),yt.condition=this._check(He.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(He.tokens.semicolon,"Expected ';'."),yt.increment=this._check(He.tokens.paren_right)?null:this._for_increment(),this._consume(He.tokens.paren_right,"Expected ')'."),this._check(He.tokens.attr)&&this._attribute(),yt.body=this._compound_statement(),this._currentLoop.pop(),yt}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(He.keywords.var)){const yt=this._variable_decl();if(yt===null)throw this._error(this._peek(),"Variable declaration expected.");let vt=null;return this._match(He.tokens.equal)&&(vt=this._short_circuit_or_expression()),this._updateNode(new F(yt.name,yt.type,yt.storage,yt.access,vt),yt.line)}if(this._match(He.keywords.let)){const yt=this._currentLine,vt=this._consume(He.tokens.name,"Expected name for let.").toString();let bt=null;if(this._match(He.tokens.colon)){const Et=this._attribute();bt=this._type_decl(),bt!=null&&(bt.attributes=Et)}this._consume(He.tokens.equal,"Expected '=' for let.");const Tt=this._short_circuit_or_expression();return this._updateNode(new U(vt,bt,null,null,Tt),yt)}if(this._match(He.keywords.const)){const yt=this._currentLine,vt=this._consume(He.tokens.name,"Expected name for const.").toString();let bt=null;if(this._match(He.tokens.colon)){const Et=this._attribute();bt=this._type_decl(),bt!=null&&(bt.attributes=Et)}this._consume(He.tokens.equal,"Expected '=' for const.");const Tt=this._short_circuit_or_expression();return bt===null&&Tt instanceof xe&&(bt=Tt.type),this._updateNode(new P(vt,bt,null,null,Tt),yt)}return null}_increment_decrement_statement(){const yt=this._current,vt=this._unary_expression();if(vt==null)return null;if(!this._check(He.increment_operators))return this._current=yt,null;const bt=this._consume(He.increment_operators,"Expected increment operator");return this._updateNode(new R(bt.type===He.tokens.plus_plus?W.increment:W.decrement,vt))}_assignment_statement(){let yt=null;const vt=this._currentLine;if(this._check(He.tokens.brace_right))return null;let bt=this._match(He.tokens.underscore);if(bt||(yt=this._unary_expression()),!bt&&yt==null)return null;const Tt=this._consume(He.assignment_operators,"Expected assignment operator."),Et=this._short_circuit_or_expression();return this._updateNode(new G(q.parse(Tt.lexeme),yt,Et),vt)}_func_call_statement(){if(!this._check(He.tokens.ident))return null;const yt=this._currentLine,vt=this._current,bt=this._consume(He.tokens.ident,"Expected function name."),Tt=this._argument_expression_list();return Tt===null?(this._current=vt,null):this._updateNode(new X(bt.lexeme,Tt),yt)}_loop_statement(){if(!this._match(He.keywords.loop))return null;this._check(He.tokens.attr)&&this._attribute(),this._consume(He.tokens.brace_left,"Expected '{' for loop.");const yt=this._updateNode(new j([],null));this._currentLoop.push(yt);let vt=this._statement();for(;vt!==null;){if(Array.isArray(vt))for(let bt of vt)yt.body.push(bt);else yt.body.push(vt);if(vt instanceof O){yt.continuing=vt;break}vt=this._statement()}return this._currentLoop.pop(),this._consume(He.tokens.brace_right,"Expected '}' for loop."),yt}_switch_statement(){if(!this._match(He.keywords.switch))return null;const yt=this._updateNode(new Z(null,[]));if(this._currentLoop.push(yt),yt.condition=this._optional_paren_expression(),this._check(He.tokens.attr)&&this._attribute(),this._consume(He.tokens.brace_left,"Expected '{' for switch."),yt.cases=this._switch_body(),yt.cases==null||yt.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(He.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),yt}_switch_body(){const yt=[];let vt=!1;for(;this._check([He.keywords.default,He.keywords.case]);){if(this._match(He.keywords.case)){const bt=this._case_selectors();for(const Et of bt)if(Et instanceof Se){if(vt)throw this._error(this._previous(),"Multiple default cases in switch statement.");vt=!0;break}this._match(He.tokens.colon),this._check(He.tokens.attr)&&this._attribute(),this._consume(He.tokens.brace_left,"Exected '{' for switch case.");const Tt=this._case_body();this._consume(He.tokens.brace_right,"Exected '}' for switch case."),yt.push(this._updateNode(new Ae(bt,Tt)))}if(this._match(He.keywords.default)){if(vt)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(He.tokens.colon),this._check(He.tokens.attr)&&this._attribute(),this._consume(He.tokens.brace_left,"Exected '{' for switch default.");const bt=this._case_body();this._consume(He.tokens.brace_right,"Exected '}' for switch default."),yt.push(this._updateNode(new Ee(bt)))}}return yt}_case_selectors(){const yt=[];for(this._match(He.keywords.default)?yt.push(this._updateNode(new Se)):yt.push(this._shift_expression());this._match(He.tokens.comma);)this._match(He.keywords.default)?yt.push(this._updateNode(new Se)):yt.push(this._shift_expression());return yt}_case_body(){if(this._match(He.keywords.fallthrough))return this._consume(He.tokens.semicolon,"Expected ';'"),[];let yt=this._statement();if(yt==null)return[];yt instanceof Array||(yt=[yt]);const vt=this._case_body();return vt.length==0?yt:[...yt,vt[0]]}_if_statement(){if(!this._match(He.keywords.if))return null;const yt=this._currentLine,vt=this._optional_paren_expression();this._check(He.tokens.attr)&&this._attribute();const bt=this._compound_statement();let Tt=[];this._match_elseif()&&(this._check(He.tokens.attr)&&this._attribute(),Tt=this._elseif_statement(Tt));let Et=null;return this._match(He.keywords.else)&&(this._check(He.tokens.attr)&&this._attribute(),Et=this._compound_statement()),this._updateNode(new Q(vt,bt,Tt,Et),yt)}_match_elseif(){return this._tokens[this._current].type===He.keywords.else&&this._tokens[this._current+1].type===He.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(yt=[]){const vt=this._optional_paren_expression(),bt=this._compound_statement();return yt.push(this._updateNode(new Le(vt,bt))),this._match_elseif()&&(this._check(He.tokens.attr)&&this._attribute(),this._elseif_statement(yt)),yt}_return_statement(){if(!this._match(He.keywords.return))return null;const yt=this._short_circuit_or_expression();return this._updateNode(new Y(yt))}_short_circuit_or_expression(){let yt=this._short_circuit_and_expr();for(;this._match(He.tokens.or_or);)yt=this._updateNode(new Ie(this._previous().toString(),yt,this._short_circuit_and_expr()));return yt}_short_circuit_and_expr(){let yt=this._inclusive_or_expression();for(;this._match(He.tokens.and_and);)yt=this._updateNode(new Ie(this._previous().toString(),yt,this._inclusive_or_expression()));return yt}_inclusive_or_expression(){let yt=this._exclusive_or_expression();for(;this._match(He.tokens.or);)yt=this._updateNode(new Ie(this._previous().toString(),yt,this._exclusive_or_expression()));return yt}_exclusive_or_expression(){let yt=this._and_expression();for(;this._match(He.tokens.xor);)yt=this._updateNode(new Ie(this._previous().toString(),yt,this._and_expression()));return yt}_and_expression(){let yt=this._equality_expression();for(;this._match(He.tokens.and);)yt=this._updateNode(new Ie(this._previous().toString(),yt,this._equality_expression()));return yt}_equality_expression(){const yt=this._relational_expression();return this._match([He.tokens.equal_equal,He.tokens.not_equal])?this._updateNode(new Ie(this._previous().toString(),yt,this._relational_expression())):yt}_relational_expression(){let yt=this._shift_expression();for(;this._match([He.tokens.less_than,He.tokens.greater_than,He.tokens.less_than_equal,He.tokens.greater_than_equal]);)yt=this._updateNode(new Ie(this._previous().toString(),yt,this._shift_expression()));return yt}_shift_expression(){let yt=this._additive_expression();for(;this._match([He.tokens.shift_left,He.tokens.shift_right]);)yt=this._updateNode(new Ie(this._previous().toString(),yt,this._additive_expression()));return yt}_additive_expression(){let yt=this._multiplicative_expression();for(;this._match([He.tokens.plus,He.tokens.minus]);)yt=this._updateNode(new Ie(this._previous().toString(),yt,this._multiplicative_expression()));return yt}_multiplicative_expression(){let yt=this._unary_expression();for(;this._match([He.tokens.star,He.tokens.forward_slash,He.tokens.modulo]);)yt=this._updateNode(new Ie(this._previous().toString(),yt,this._unary_expression()));return yt}_unary_expression(){return this._match([He.tokens.minus,He.tokens.bang,He.tokens.tilde,He.tokens.star,He.tokens.and])?this._updateNode(new ke(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const yt=this._primary_expression(),vt=this._postfix_expression();return vt&&(yt.postfix=vt),yt}_postfix_expression(){if(this._match(He.tokens.bracket_left)){const yt=this._short_circuit_or_expression();this._consume(He.tokens.bracket_right,"Expected ']'.");const vt=this._updateNode(new ve(yt)),bt=this._postfix_expression();return bt&&(vt.postfix=bt),vt}if(this._match(He.tokens.period)){const yt=this._consume(He.tokens.name,"Expected member name."),vt=this._postfix_expression(),bt=this._updateNode(new pe(yt.lexeme));return vt&&(bt.postfix=vt),bt}return null}_getStruct(yt){return this._context.aliases.has(yt)?this._context.aliases.get(yt).type:this._context.structs.has(yt)?this._context.structs.get(yt):null}_getType(yt){const vt=this._getStruct(yt);if(vt!==null)return vt;switch(yt){case"void":return ae.void;case"bool":return ae.bool;case"i32":return ae.i32;case"u32":return ae.u32;case"f32":return ae.f32;case"f16":return ae.f16;case"vec2f":return ce.vec2f;case"vec3f":return ce.vec3f;case"vec4f":return ce.vec4f;case"vec2i":return ce.vec2i;case"vec3i":return ce.vec3i;case"vec4i":return ce.vec4i;case"vec2u":return ce.vec2u;case"vec3u":return ce.vec3u;case"vec4u":return ce.vec4u;case"vec2h":return ce.vec2h;case"vec3h":return ce.vec3h;case"vec4h":return ce.vec4h;case"mat2x2f":return ce.mat2x2f;case"mat2x3f":return ce.mat2x3f;case"mat2x4f":return ce.mat2x4f;case"mat3x2f":return ce.mat3x2f;case"mat3x3f":return ce.mat3x3f;case"mat3x4f":return ce.mat3x4f;case"mat4x2f":return ce.mat4x2f;case"mat4x3f":return ce.mat4x3f;case"mat4x4f":return ce.mat4x4f;case"mat2x2h":return ce.mat2x2h;case"mat2x3h":return ce.mat2x3h;case"mat2x4h":return ce.mat2x4h;case"mat3x2h":return ce.mat3x2h;case"mat3x3h":return ce.mat3x3h;case"mat3x4h":return ce.mat3x4h;case"mat4x2h":return ce.mat4x2h;case"mat4x3h":return ce.mat4x3h;case"mat4x4h":return ce.mat4x4h;case"mat2x2i":return ce.mat2x2i;case"mat2x3i":return ce.mat2x3i;case"mat2x4i":return ce.mat2x4i;case"mat3x2i":return ce.mat3x2i;case"mat3x3i":return ce.mat3x3i;case"mat3x4i":return ce.mat3x4i;case"mat4x2i":return ce.mat4x2i;case"mat4x3i":return ce.mat4x3i;case"mat4x4i":return ce.mat4x4i;case"mat2x2u":return ce.mat2x2u;case"mat2x3u":return ce.mat2x3u;case"mat2x4u":return ce.mat2x4u;case"mat3x2u":return ce.mat3x2u;case"mat3x3u":return ce.mat3x3u;case"mat3x4u":return ce.mat3x4u;case"mat4x2u":return ce.mat4x2u;case"mat4x3u":return ce.mat4x3u;case"mat4x4u":return ce.mat4x4u}return null}_validateTypeRange(yt,vt){if(vt.name==="i32"){if(yt<-2147483648||yt>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${yt}. Line: ${this._currentLine}.`)}else if(vt.name==="u32"&&(yt<0||yt>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${yt}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(He.tokens.ident)){const bt=this._previous().toString();if(this._check(He.tokens.paren_left)){const Tt=this._argument_expression_list(),Et=this._getType(bt);return Et!==null?this._updateNode(new de(Et,Tt)):this._updateNode(new me(bt,Tt))}if(this._context.constants.has(bt)){const Tt=this._context.constants.get(bt);return this._updateNode(new _e(bt,Tt.value))}return this._updateNode(new ge(bt))}if(this._match(He.tokens.int_literal)){const bt=this._previous().toString();let Tt=bt.endsWith("i")||bt.endsWith("i")?ae.i32:bt.endsWith("u")||bt.endsWith("U")?ae.u32:ae.x32;const Et=parseInt(bt);return this._validateTypeRange(Et,Tt),this._updateNode(new xe(new Be(Et,this._exec.getTypeInfo(Tt)),Tt))}if(this._match(He.tokens.uint_literal)){const bt=parseInt(this._previous().toString());return this._validateTypeRange(bt,ae.u32),this._updateNode(new xe(new Be(bt,this._exec.getTypeInfo(ae.u32)),ae.u32))}if(this._match([He.tokens.decimal_float_literal,He.tokens.hex_float_literal])){let bt=this._previous().toString(),Tt=bt.endsWith("h");Tt&&(bt=bt.substring(0,bt.length-1));const Et=parseFloat(bt);this._validateTypeRange(Et,Tt?ae.f16:ae.f32);const wt=Tt?ae.f16:ae.f32;return this._updateNode(new xe(new Be(Et,this._exec.getTypeInfo(wt)),wt))}if(this._match([He.keywords.true,He.keywords.false])){let bt=this._previous().toString()===He.keywords.true.rule;return this._updateNode(new xe(new Be(bt?1:0,this._exec.getTypeInfo(ae.bool)),ae.bool))}if(this._check(He.tokens.paren_left))return this._paren_expression();if(this._match(He.keywords.bitcast)){this._consume(He.tokens.less_than,"Expected '<'.");const bt=this._type_decl();this._consume(He.tokens.greater_than,"Expected '>'.");const Tt=this._paren_expression();return this._updateNode(new ye(bt,Tt))}const yt=this._type_decl(),vt=this._argument_expression_list();return this._updateNode(new de(yt,vt))}_argument_expression_list(){if(!this._match(He.tokens.paren_left))return null;const yt=[];do{if(this._check(He.tokens.paren_right))break;const vt=this._short_circuit_or_expression();yt.push(vt)}while(this._match(He.tokens.comma));return this._consume(He.tokens.paren_right,"Expected ')' for agument list"),yt}_optional_paren_expression(){this._match(He.tokens.paren_left);const yt=this._short_circuit_or_expression();return this._match(He.tokens.paren_right),yt}_paren_expression(){this._consume(He.tokens.paren_left,"Expected '('.");const yt=this._short_circuit_or_expression();return this._consume(He.tokens.paren_right,"Expected ')'."),yt}_struct_decl(){if(!this._match(He.keywords.struct))return null;const yt=this._currentLine,vt=this._consume(He.tokens.ident,"Expected name for struct.").toString();this._consume(He.tokens.brace_left,"Expected '{' for struct body.");const bt=[];for(;!this._check(He.tokens.brace_right);){const wt=this._attribute(),St=this._consume(He.tokens.name,"Expected variable name.").toString();this._consume(He.tokens.colon,"Expected ':' for struct member type.");const At=this._attribute(),Rt=this._type_decl();Rt!=null&&(Rt.attributes=At),this._check(He.tokens.brace_right)?this._match(He.tokens.comma):this._consume(He.tokens.comma,"Expected ',' for struct member."),bt.push(this._updateNode(new Ce(St,Rt,wt)))}this._consume(He.tokens.brace_right,"Expected '}' after struct body.");const Tt=this._currentLine,Et=this._updateNode(new oe(vt,bt,yt,Tt),yt);return this._context.structs.set(vt,Et),Et}_global_variable_decl(){const yt=this._variable_decl();if(!yt)return null;if(this._match(He.tokens.equal)){const vt=this._const_expression();yt.value=vt}if(yt.type!==null&&yt.value instanceof xe){if(yt.value.type.name!=="x32"&&yt.type.getTypeName()!==yt.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${yt.value.type.name} to ${yt.type.name}. Line:${this._currentLine}`);yt.value.isScalar&&this._validateTypeRange(yt.value.scalarValue,yt.type),yt.value.type=yt.type}else yt.type===null&&yt.value instanceof xe&&(yt.type=yt.value.type.name==="x32"?ae.i32:yt.value.type,yt.value.isScalar&&this._validateTypeRange(yt.value.scalarValue,yt.type));return yt}_override_variable_decl(){const yt=this._override_decl();return yt&&this._match(He.tokens.equal)&&(yt.value=this._const_expression()),yt}_global_const_decl(){var yt;if(!this._match(He.keywords.const))return null;const vt=this._consume(He.tokens.name,"Expected variable name"),bt=this._currentLine;let Tt=null;if(this._match(He.tokens.colon)){const At=this._attribute();Tt=this._type_decl(),Tt!=null&&(Tt.attributes=At)}let Et=null;this._consume(He.tokens.equal,"const declarations require an assignment");const wt=this._short_circuit_or_expression();try{let At=[ae.f32],Rt=wt.constEvaluate(this._exec,At);Rt instanceof Be&&this._validateTypeRange(Rt.value,At[0]),At[0]instanceof ce&&At[0].format===null&&Rt.typeInfo instanceof a&&Rt.typeInfo.format!==null&&(Rt.typeInfo.format.name==="f16"?At[0].format=ae.f16:Rt.typeInfo.format.name==="f32"?At[0].format=ae.f32:Rt.typeInfo.format.name==="i32"?At[0].format=ae.i32:Rt.typeInfo.format.name==="u32"?At[0].format=ae.u32:Rt.typeInfo.format.name==="bool"?At[0].format=ae.bool:console.error(`TODO: impelement template format type ${Rt.typeInfo.format.name}`)),Et=this._updateNode(new xe(Rt,At[0])),this._exec.context.setVariable(vt.toString(),Rt)}catch{Et=wt}if(Tt!==null&&Et instanceof xe){if(Et.type.name!=="x32"&&Tt.getTypeName()!==Et.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${Et.type.name} to ${Tt.name}. Line:${this._currentLine}`);Et.type=Tt,Et.isScalar&&this._validateTypeRange(Et.scalarValue,Et.type)}else Tt===null&&Et instanceof xe&&(Tt=(yt=Et==null?void 0:Et.type)!==null&&yt!==void 0?yt:ae.f32,Tt===ae.x32&&(Tt=ae.i32));const St=this._updateNode(new P(vt.toString(),Tt,"","",Et),bt);return this._context.constants.set(St.name,St),St}_global_let_decl(){if(!this._match(He.keywords.let))return null;const yt=this._currentLine,vt=this._consume(He.tokens.name,"Expected variable name");let bt=null;if(this._match(He.tokens.colon)){const Et=this._attribute();bt=this._type_decl(),bt!=null&&(bt.attributes=Et)}let Tt=null;if(this._match(He.tokens.equal)&&(Tt=this._const_expression()),bt!==null&&Tt instanceof xe){if(Tt.type.name!=="x32"&&bt.getTypeName()!==Tt.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${Tt.type.name} to ${bt.name}. Line:${this._currentLine}`);Tt.type=bt}else bt===null&&Tt instanceof xe&&(bt=Tt.type.name==="x32"?ae.i32:Tt.type);return Tt instanceof xe&&Tt.isScalar&&this._validateTypeRange(Tt.scalarValue,bt),this._updateNode(new U(vt.toString(),bt,"","",Tt),yt)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(He.keywords.var))return null;const yt=this._currentLine;let vt="",bt="";this._match(He.tokens.less_than)&&(vt=this._consume(He.storage_class,"Expected storage_class.").toString(),this._match(He.tokens.comma)&&(bt=this._consume(He.access_mode,"Expected access_mode.").toString()),this._consume(He.tokens.greater_than,"Expected '>'."));const Tt=this._consume(He.tokens.name,"Expected variable name");let Et=null;if(this._match(He.tokens.colon)){const wt=this._attribute();Et=this._type_decl(),Et!=null&&(Et.attributes=wt)}return this._updateNode(new F(Tt.toString(),Et,vt,bt,null),yt)}_override_decl(){if(!this._match(He.keywords.override))return null;const yt=this._consume(He.tokens.name,"Expected variable name");let vt=null;if(this._match(He.tokens.colon)){const bt=this._attribute();vt=this._type_decl(),vt!=null&&(vt.attributes=bt)}return this._updateNode(new M(yt.toString(),vt,null))}_diagnostic(){this._consume(He.tokens.paren_left,"Expected '('");const yt=this._consume(He.tokens.ident,"Expected severity control name.");this._consume(He.tokens.comma,"Expected ','");let vt=this._consume(He.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(He.tokens.period)&&(vt+=`.${this._consume(He.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(He.tokens.paren_right,"Expected ')'"),this._updateNode(new ee(yt.toString(),vt))}_enable_directive(){const yt=this._consume(He.tokens.ident,"identity expected.");return this._updateNode(new K(yt.toString()))}_requires_directive(){const yt=[this._consume(He.tokens.ident,"identity expected.").toString()];for(;this._match(He.tokens.comma);){const vt=this._consume(He.tokens.ident,"identity expected.");yt.push(vt.toString())}return this._updateNode(new J(yt))}_type_alias(){const yt=this._consume(He.tokens.ident,"identity expected.");this._consume(He.tokens.equal,"Expected '=' for type alias.");let vt=this._type_decl();if(vt===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(vt.name)&&(vt=this._context.aliases.get(vt.name).type);const bt=this._updateNode(new te(yt.toString(),vt));return this._context.aliases.set(bt.name,bt),bt}_type_decl(){if(this._check([He.tokens.ident,...He.texel_format,He.keywords.bool,He.keywords.f32,He.keywords.i32,He.keywords.u32])){const bt=this._advance().toString();if(this._context.structs.has(bt))return this._context.structs.get(bt);if(this._context.aliases.has(bt))return this._context.aliases.get(bt).type;if(!this._getType(bt)){const Tt=this._updateNode(new ie(bt));return this._forwardTypeCount++,Tt}return this._updateNode(new ae(bt))}let yt=this._texture_sampler_types();if(yt)return yt;if(this._check(He.template_types)){let bt=this._advance().toString(),Tt=null,Et=null;return this._match(He.tokens.less_than)&&(Tt=this._type_decl(),Et=null,this._match(He.tokens.comma)&&(Et=this._consume(He.access_mode,"Expected access_mode for pointer").toString()),this._consume(He.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new ce(bt,Tt,Et))}if(this._match(He.keywords.ptr)){let bt=this._previous().toString();this._consume(He.tokens.less_than,"Expected '<' for pointer.");const Tt=this._consume(He.storage_class,"Expected storage_class for pointer");this._consume(He.tokens.comma,"Expected ',' for pointer.");const Et=this._type_decl();let wt=null;return this._match(He.tokens.comma)&&(wt=this._consume(He.access_mode,"Expected access_mode for pointer").toString()),this._consume(He.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new le(bt,Tt.toString(),Et,wt))}const vt=this._attribute();if(this._match(He.keywords.array)){let bt=null,Tt=-1;const Et=this._previous();let wt=null;if(this._match(He.tokens.less_than)){bt=this._type_decl(),this._context.aliases.has(bt.name)&&(bt=this._context.aliases.get(bt.name).type);let At="";if(this._match(He.tokens.comma)){wt=this._shift_expression();try{At=wt.constEvaluate(this._exec).toString(),wt=null}catch{At="1"}}this._consume(He.tokens.greater_than,"Expected '>' for array."),Tt=At?parseInt(At):0}const St=this._updateNode(new ue(Et.toString(),vt,bt,Tt));return wt&&this._deferArrayCountEval.push({arrayType:St,countNode:wt}),St}return null}_texture_sampler_types(){if(this._match(He.sampler_type))return this._updateNode(new he(this._previous().toString(),null,null));if(this._match(He.depth_texture_type))return this._updateNode(new he(this._previous().toString(),null,null));if(this._match(He.sampled_texture_type)||this._match(He.multisampled_texture_type)){const yt=this._previous();this._consume(He.tokens.less_than,"Expected '<' for sampler type.");const vt=this._type_decl();return this._consume(He.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new he(yt.toString(),vt,null))}if(this._match(He.storage_texture_type)){const yt=this._previous();this._consume(He.tokens.less_than,"Expected '<' for sampler type.");const vt=this._consume(He.texel_format,"Invalid texel format.").toString();this._consume(He.tokens.comma,"Expected ',' after texel format.");const bt=this._consume(He.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(He.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new he(yt.toString(),vt,bt))}return null}_attribute(){let yt=[];for(;this._match(He.tokens.attr);){const vt=this._consume(He.attribute_name,"Expected attribute name"),bt=this._updateNode(new De(vt.toString(),null));if(this._match(He.tokens.paren_left)){if(bt.value=this._consume(He.literal_or_ident,"Expected attribute value").toString(),this._check(He.tokens.comma)){this._advance();do{const Tt=this._consume(He.literal_or_ident,"Expected attribute value").toString();bt.value instanceof Array||(bt.value=[bt.value]),bt.value.push(Tt)}while(this._match(He.tokens.comma))}this._consume(He.tokens.paren_right,"Expected ')'")}yt.push(bt)}return yt.length==0?null:yt}}class _t extends at{constructor(yt){super(),yt&&this.update(yt)}update(yt){const vt=new gt().parse(yt);this.updateAST(vt)}}function getShaderLayoutFromWGSL(xt){var Et;const yt={attributes:[],bindings:[]};let vt;try{vt=parseWGSL(xt)}catch(wt){return log.error(wt.message)(),yt}for(const wt of vt.uniforms){const St=[];for(const At of((Et=wt.type)==null?void 0:Et.members)||[])St.push({name:At.name,type:getType(At.type)});yt.bindings.push({type:"uniform",name:wt.name,group:wt.group,location:wt.binding,members:St})}for(const wt of vt.textures)yt.bindings.push({type:"texture",name:wt.name,group:wt.group,location:wt.binding});for(const wt of vt.samplers)yt.bindings.push({type:"sampler",name:wt.name,group:wt.group,location:wt.binding});const bt=vt.entry.vertex[0],Tt=(bt==null?void 0:bt.inputs.length)||0;for(let wt=0;wt<Tt;wt++){const St=bt.inputs[wt];if(St.locationType==="location"){const At=getType(St.type);yt.attributes.push({name:St.name,location:Number(St.location),type:At})}}return yt}function getType(xt){return xt.format?`${xt.name}<${xt.format.name}>`:xt.name}function parseWGSL(xt){try{return new _t(xt)}catch(yt){if(yt instanceof Error)throw yt;let vt="WGSL parse error";throw typeof yt=="object"&&(yt!=null&&yt.message)&&(vt+=`: ${yt.message} `),typeof yt=="object"&&(yt!=null&&yt.token)&&(vt+=yt.token.line||""),new Error(vt,{cause:yt})}}const DEFAULT_CONFIG={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...DEFAULT_CONFIG}};const config=globalThis.mathgl.config;function formatValue(xt,{precision:yt=config.precision}={}){return xt=round(xt),`${parseFloat(xt.toPrecision(yt))}`}function isArray$2(xt){return Array.isArray(xt)||ArrayBuffer.isView(xt)&&!(xt instanceof DataView)}function clamp$1(xt,yt,vt){return map$1(xt,bt=>Math.max(yt,Math.min(vt,bt)))}function lerp$1(xt,yt,vt){return isArray$2(xt)?xt.map((bt,Tt)=>lerp$1(bt,yt[Tt],vt)):vt*yt+(1-vt)*xt}function equals$1(xt,yt,vt){const bt=config.EPSILON;try{if(xt===yt)return!0;if(isArray$2(xt)&&isArray$2(yt)){if(xt.length!==yt.length)return!1;for(let Tt=0;Tt<xt.length;++Tt)if(!equals$1(xt[Tt],yt[Tt]))return!1;return!0}return xt&&xt.equals?xt.equals(yt):yt&&yt.equals?yt.equals(xt):typeof xt=="number"&&typeof yt=="number"?Math.abs(xt-yt)<=config.EPSILON*Math.max(1,Math.abs(xt),Math.abs(yt)):!1}finally{config.EPSILON=bt}}function round(xt){return Math.round(xt/config.EPSILON)*config.EPSILON}function duplicateArray(xt){return xt.clone?xt.clone():new Array(xt.length)}function map$1(xt,yt,vt){if(isArray$2(xt)){const bt=xt;vt=vt||duplicateArray(bt);for(let Tt=0;Tt<vt.length&&Tt<bt.length;++Tt){const Et=typeof xt=="number"?xt:xt[Tt];vt[Tt]=yt(Et,Tt,vt)}return vt}return yt(xt)}class MathArray extends Array{clone(){return new this.constructor().copy(this)}fromArray(yt,vt=0){for(let bt=0;bt<this.ELEMENTS;++bt)this[bt]=yt[bt+vt];return this.check()}toArray(yt=[],vt=0){for(let bt=0;bt<this.ELEMENTS;++bt)yt[vt+bt]=this[bt];return yt}toObject(yt){return yt}from(yt){return Array.isArray(yt)?this.copy(yt):this.fromObject(yt)}to(yt){return yt===this?this:isArray$2(yt)?this.toArray(yt):this.toObject(yt)}toTarget(yt){return yt?this.to(yt):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(config)}formatString(yt){let vt="";for(let bt=0;bt<this.ELEMENTS;++bt)vt+=(bt>0?", ":"")+formatValue(this[bt],yt);return`${yt.printTypes?this.constructor.name:""}[${vt}]`}equals(yt){if(!yt||this.length!==yt.length)return!1;for(let vt=0;vt<this.ELEMENTS;++vt)if(!equals$1(this[vt],yt[vt]))return!1;return!0}exactEquals(yt){if(!yt||this.length!==yt.length)return!1;for(let vt=0;vt<this.ELEMENTS;++vt)if(this[vt]!==yt[vt])return!1;return!0}negate(){for(let yt=0;yt<this.ELEMENTS;++yt)this[yt]=-this[yt];return this.check()}lerp(yt,vt,bt){if(bt===void 0)return this.lerp(this,yt,vt);for(let Tt=0;Tt<this.ELEMENTS;++Tt){const Et=yt[Tt],wt=typeof vt=="number"?vt:vt[Tt];this[Tt]=Et+bt*(wt-Et)}return this.check()}min(yt){for(let vt=0;vt<this.ELEMENTS;++vt)this[vt]=Math.min(yt[vt],this[vt]);return this.check()}max(yt){for(let vt=0;vt<this.ELEMENTS;++vt)this[vt]=Math.max(yt[vt],this[vt]);return this.check()}clamp(yt,vt){for(let bt=0;bt<this.ELEMENTS;++bt)this[bt]=Math.min(Math.max(this[bt],yt[bt]),vt[bt]);return this.check()}add(...yt){for(const vt of yt)for(let bt=0;bt<this.ELEMENTS;++bt)this[bt]+=vt[bt];return this.check()}subtract(...yt){for(const vt of yt)for(let bt=0;bt<this.ELEMENTS;++bt)this[bt]-=vt[bt];return this.check()}scale(yt){if(typeof yt=="number")for(let vt=0;vt<this.ELEMENTS;++vt)this[vt]*=yt;else for(let vt=0;vt<this.ELEMENTS&&vt<yt.length;++vt)this[vt]*=yt[vt];return this.check()}multiplyByScalar(yt){for(let vt=0;vt<this.ELEMENTS;++vt)this[vt]*=yt;return this.check()}check(){if(config.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let yt=this.length===this.ELEMENTS;for(let vt=0;vt<this.ELEMENTS;++vt)yt=yt&&Number.isFinite(this[vt]);return yt}sub(yt){return this.subtract(yt)}setScalar(yt){for(let vt=0;vt<this.ELEMENTS;++vt)this[vt]=yt;return this.check()}addScalar(yt){for(let vt=0;vt<this.ELEMENTS;++vt)this[vt]+=yt;return this.check()}subScalar(yt){return this.addScalar(-yt)}multiplyScalar(yt){for(let vt=0;vt<this.ELEMENTS;++vt)this[vt]*=yt;return this.check()}divideScalar(yt){return this.multiplyByScalar(1/yt)}clampScalar(yt,vt){for(let bt=0;bt<this.ELEMENTS;++bt)this[bt]=Math.min(Math.max(this[bt],yt),vt);return this.check()}get elements(){return this}}function validateVector(xt,yt){if(xt.length!==yt)return!1;for(let vt=0;vt<xt.length;++vt)if(!Number.isFinite(xt[vt]))return!1;return!0}function checkNumber(xt){if(!Number.isFinite(xt))throw new Error(`Invalid number ${JSON.stringify(xt)}`);return xt}function checkVector(xt,yt,vt=""){if(config.debug&&!validateVector(xt,yt))throw new Error(`math.gl: ${vt} some fields set to invalid numbers'`);return xt}function assert$2(xt,yt){if(!xt)throw new Error(`math.gl assertion ${yt}`)}class Vector extends MathArray{get x(){return this[0]}set x(yt){this[0]=checkNumber(yt)}get y(){return this[1]}set y(yt){this[1]=checkNumber(yt)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let yt=0;for(let vt=0;vt<this.ELEMENTS;++vt)yt+=this[vt]*this[vt];return yt}magnitudeSquared(){return this.lengthSquared()}distance(yt){return Math.sqrt(this.distanceSquared(yt))}distanceSquared(yt){let vt=0;for(let bt=0;bt<this.ELEMENTS;++bt){const Tt=this[bt]-yt[bt];vt+=Tt*Tt}return checkNumber(vt)}dot(yt){let vt=0;for(let bt=0;bt<this.ELEMENTS;++bt)vt+=this[bt]*yt[bt];return checkNumber(vt)}normalize(){const yt=this.magnitude();if(yt!==0)for(let vt=0;vt<this.ELEMENTS;++vt)this[vt]/=yt;return this.check()}multiply(...yt){for(const vt of yt)for(let bt=0;bt<this.ELEMENTS;++bt)this[bt]*=vt[bt];return this.check()}divide(...yt){for(const vt of yt)for(let bt=0;bt<this.ELEMENTS;++bt)this[bt]/=vt[bt];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(yt){return this.distance(yt)}distanceToSquared(yt){return this.distanceSquared(yt)}getComponent(yt){return assert$2(yt>=0&&yt<this.ELEMENTS,"index is out of range"),checkNumber(this[yt])}setComponent(yt,vt){return assert$2(yt>=0&&yt<this.ELEMENTS,"index is out of range"),this[yt]=vt,this.check()}addVectors(yt,vt){return this.copy(yt).add(vt)}subVectors(yt,vt){return this.copy(yt).subtract(vt)}multiplyVectors(yt,vt){return this.copy(yt).multiply(vt)}addScaledVector(yt,vt){return this.add(new this.constructor(yt).multiplyScalar(vt))}}const EPSILON$1=1e-6;let ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array;function create$2(){const xt=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(xt[0]=0,xt[1]=0),xt}function add$1(xt,yt,vt){return xt[0]=yt[0]+vt[0],xt[1]=yt[1]+vt[1],xt}function negate$1(xt,yt){return xt[0]=-yt[0],xt[1]=-yt[1],xt}function lerp(xt,yt,vt,bt){const Tt=yt[0],Et=yt[1];return xt[0]=Tt+bt*(vt[0]-Tt),xt[1]=Et+bt*(vt[1]-Et),xt}function transformMat4$2(xt,yt,vt){const bt=yt[0],Tt=yt[1];return xt[0]=vt[0]*bt+vt[4]*Tt+vt[12],xt[1]=vt[1]*bt+vt[5]*Tt+vt[13],xt}(function(){const xt=create$2();return function(yt,vt,bt,Tt,Et,wt){let St,At;for(vt||(vt=2),bt||(bt=0),Tt?At=Math.min(Tt*vt+bt,yt.length):At=yt.length,St=bt;St<At;St+=vt)xt[0]=yt[St],xt[1]=yt[St+1],Et(xt,xt,wt),yt[St]=xt[0],yt[St+1]=xt[1];return yt}})();function vec2_transformMat4AsVector(xt,yt,vt){const bt=yt[0],Tt=yt[1],Et=vt[3]*bt+vt[7]*Tt||1;return xt[0]=(vt[0]*bt+vt[4]*Tt)/Et,xt[1]=(vt[1]*bt+vt[5]*Tt)/Et,xt}function vec3_transformMat4AsVector(xt,yt,vt){const bt=yt[0],Tt=yt[1],Et=yt[2],wt=vt[3]*bt+vt[7]*Tt+vt[11]*Et||1;return xt[0]=(vt[0]*bt+vt[4]*Tt+vt[8]*Et)/wt,xt[1]=(vt[1]*bt+vt[5]*Tt+vt[9]*Et)/wt,xt[2]=(vt[2]*bt+vt[6]*Tt+vt[10]*Et)/wt,xt}function vec3_transformMat2(xt,yt,vt){const bt=yt[0],Tt=yt[1];return xt[0]=vt[0]*bt+vt[2]*Tt,xt[1]=vt[1]*bt+vt[3]*Tt,xt[2]=yt[2],xt}function create$1(){const xt=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(xt[0]=0,xt[1]=0,xt[2]=0),xt}function subtract(xt,yt,vt){return xt[0]=yt[0]-vt[0],xt[1]=yt[1]-vt[1],xt[2]=yt[2]-vt[2],xt}function negate(xt,yt){return xt[0]=-yt[0],xt[1]=-yt[1],xt[2]=-yt[2],xt}function dot(xt,yt){return xt[0]*yt[0]+xt[1]*yt[1]+xt[2]*yt[2]}function cross(xt,yt,vt){const bt=yt[0],Tt=yt[1],Et=yt[2],wt=vt[0],St=vt[1],At=vt[2];return xt[0]=Tt*At-Et*St,xt[1]=Et*wt-bt*At,xt[2]=bt*St-Tt*wt,xt}function transformMat4$1(xt,yt,vt){const bt=yt[0],Tt=yt[1],Et=yt[2];let wt=vt[3]*bt+vt[7]*Tt+vt[11]*Et+vt[15];return wt=wt||1,xt[0]=(vt[0]*bt+vt[4]*Tt+vt[8]*Et+vt[12])/wt,xt[1]=(vt[1]*bt+vt[5]*Tt+vt[9]*Et+vt[13])/wt,xt[2]=(vt[2]*bt+vt[6]*Tt+vt[10]*Et+vt[14])/wt,xt}function transformMat3(xt,yt,vt){const bt=yt[0],Tt=yt[1],Et=yt[2];return xt[0]=bt*vt[0]+Tt*vt[3]+Et*vt[6],xt[1]=bt*vt[1]+Tt*vt[4]+Et*vt[7],xt[2]=bt*vt[2]+Tt*vt[5]+Et*vt[8],xt}function transformQuat(xt,yt,vt){const bt=vt[0],Tt=vt[1],Et=vt[2],wt=vt[3],St=yt[0],At=yt[1],Rt=yt[2];let Pt=Tt*Rt-Et*At,Ct=Et*St-bt*Rt,It=bt*At-Tt*St,Mt=Tt*It-Et*Ct,Ot=Et*Pt-bt*It,kt=bt*Ct-Tt*Pt;const Ft=wt*2;return Pt*=Ft,Ct*=Ft,It*=Ft,Mt*=2,Ot*=2,kt*=2,xt[0]=St+Pt+Mt,xt[1]=At+Ct+Ot,xt[2]=Rt+It+kt,xt}function rotateX$1(xt,yt,vt,bt){const Tt=[],Et=[];return Tt[0]=yt[0]-vt[0],Tt[1]=yt[1]-vt[1],Tt[2]=yt[2]-vt[2],Et[0]=Tt[0],Et[1]=Tt[1]*Math.cos(bt)-Tt[2]*Math.sin(bt),Et[2]=Tt[1]*Math.sin(bt)+Tt[2]*Math.cos(bt),xt[0]=Et[0]+vt[0],xt[1]=Et[1]+vt[1],xt[2]=Et[2]+vt[2],xt}function rotateY$1(xt,yt,vt,bt){const Tt=[],Et=[];return Tt[0]=yt[0]-vt[0],Tt[1]=yt[1]-vt[1],Tt[2]=yt[2]-vt[2],Et[0]=Tt[2]*Math.sin(bt)+Tt[0]*Math.cos(bt),Et[1]=Tt[1],Et[2]=Tt[2]*Math.cos(bt)-Tt[0]*Math.sin(bt),xt[0]=Et[0]+vt[0],xt[1]=Et[1]+vt[1],xt[2]=Et[2]+vt[2],xt}function rotateZ$1(xt,yt,vt,bt){const Tt=[],Et=[];return Tt[0]=yt[0]-vt[0],Tt[1]=yt[1]-vt[1],Tt[2]=yt[2]-vt[2],Et[0]=Tt[0]*Math.cos(bt)-Tt[1]*Math.sin(bt),Et[1]=Tt[0]*Math.sin(bt)+Tt[1]*Math.cos(bt),Et[2]=Tt[2],xt[0]=Et[0]+vt[0],xt[1]=Et[1]+vt[1],xt[2]=Et[2]+vt[2],xt}function angle(xt,yt){const vt=xt[0],bt=xt[1],Tt=xt[2],Et=yt[0],wt=yt[1],St=yt[2],At=Math.sqrt((vt*vt+bt*bt+Tt*Tt)*(Et*Et+wt*wt+St*St)),Rt=At&&dot(xt,yt)/At;return Math.acos(Math.min(Math.max(Rt,-1),1))}const sub=subtract;(function(){const xt=create$1();return function(yt,vt,bt,Tt,Et,wt){let St,At;for(vt||(vt=3),bt||(bt=0),Tt?At=Math.min(Tt*vt+bt,yt.length):At=yt.length,St=bt;St<At;St+=vt)xt[0]=yt[St],xt[1]=yt[St+1],xt[2]=yt[St+2],Et(xt,xt,wt),yt[St]=xt[0],yt[St+1]=xt[1],yt[St+2]=xt[2];return yt}})();const ORIGIN=[0,0,0];let ZERO$1;class Vector3 extends Vector{static get ZERO(){return ZERO$1||(ZERO$1=new Vector3(0,0,0),Object.freeze(ZERO$1)),ZERO$1}constructor(yt=0,vt=0,bt=0){super(-0,-0,-0),arguments.length===1&&isArray$2(yt)?this.copy(yt):(config.debug&&(checkNumber(yt),checkNumber(vt),checkNumber(bt)),this[0]=yt,this[1]=vt,this[2]=bt)}set(yt,vt,bt){return this[0]=yt,this[1]=vt,this[2]=bt,this.check()}copy(yt){return this[0]=yt[0],this[1]=yt[1],this[2]=yt[2],this.check()}fromObject(yt){return config.debug&&(checkNumber(yt.x),checkNumber(yt.y),checkNumber(yt.z)),this[0]=yt.x,this[1]=yt.y,this[2]=yt.z,this.check()}toObject(yt){return yt.x=this[0],yt.y=this[1],yt.z=this[2],yt}get ELEMENTS(){return 3}get z(){return this[2]}set z(yt){this[2]=checkNumber(yt)}angle(yt){return angle(this,yt)}cross(yt){return cross(this,this,yt),this.check()}rotateX({radians:yt,origin:vt=ORIGIN}){return rotateX$1(this,this,vt,yt),this.check()}rotateY({radians:yt,origin:vt=ORIGIN}){return rotateY$1(this,this,vt,yt),this.check()}rotateZ({radians:yt,origin:vt=ORIGIN}){return rotateZ$1(this,this,vt,yt),this.check()}transform(yt){return this.transformAsPoint(yt)}transformAsPoint(yt){return transformMat4$1(this,this,yt),this.check()}transformAsVector(yt){return vec3_transformMat4AsVector(this,this,yt),this.check()}transformByMatrix3(yt){return transformMat3(this,this,yt),this.check()}transformByMatrix2(yt){return vec3_transformMat2(this,this,yt),this.check()}transformByQuaternion(yt){return transformQuat(this,this,yt),this.check()}}class Matrix extends MathArray{toString(){let yt="[";if(config.printRowMajor){yt+="row-major:";for(let vt=0;vt<this.RANK;++vt)for(let bt=0;bt<this.RANK;++bt)yt+=` ${this[bt*this.RANK+vt]}`}else{yt+="column-major:";for(let vt=0;vt<this.ELEMENTS;++vt)yt+=` ${this[vt]}`}return yt+="]",yt}getElementIndex(yt,vt){return vt*this.RANK+yt}getElement(yt,vt){return this[vt*this.RANK+yt]}setElement(yt,vt,bt){return this[vt*this.RANK+yt]=checkNumber(bt),this}getColumn(yt,vt=new Array(this.RANK).fill(-0)){const bt=yt*this.RANK;for(let Tt=0;Tt<this.RANK;++Tt)vt[Tt]=this[bt+Tt];return vt}setColumn(yt,vt){const bt=yt*this.RANK;for(let Tt=0;Tt<this.RANK;++Tt)this[bt+Tt]=vt[Tt];return this}}function identity(xt){return xt[0]=1,xt[1]=0,xt[2]=0,xt[3]=0,xt[4]=0,xt[5]=1,xt[6]=0,xt[7]=0,xt[8]=0,xt[9]=0,xt[10]=1,xt[11]=0,xt[12]=0,xt[13]=0,xt[14]=0,xt[15]=1,xt}function transpose(xt,yt){if(xt===yt){const vt=yt[1],bt=yt[2],Tt=yt[3],Et=yt[6],wt=yt[7],St=yt[11];xt[1]=yt[4],xt[2]=yt[8],xt[3]=yt[12],xt[4]=vt,xt[6]=yt[9],xt[7]=yt[13],xt[8]=bt,xt[9]=Et,xt[11]=yt[14],xt[12]=Tt,xt[13]=wt,xt[14]=St}else xt[0]=yt[0],xt[1]=yt[4],xt[2]=yt[8],xt[3]=yt[12],xt[4]=yt[1],xt[5]=yt[5],xt[6]=yt[9],xt[7]=yt[13],xt[8]=yt[2],xt[9]=yt[6],xt[10]=yt[10],xt[11]=yt[14],xt[12]=yt[3],xt[13]=yt[7],xt[14]=yt[11],xt[15]=yt[15];return xt}function invert(xt,yt){const vt=yt[0],bt=yt[1],Tt=yt[2],Et=yt[3],wt=yt[4],St=yt[5],At=yt[6],Rt=yt[7],Pt=yt[8],Ct=yt[9],It=yt[10],Mt=yt[11],Ot=yt[12],kt=yt[13],Ft=yt[14],Nt=yt[15],Lt=vt*St-bt*wt,Dt=vt*At-Tt*wt,$t=vt*Rt-Et*wt,zt=bt*At-Tt*St,Ut=bt*Rt-Et*St,jt=Tt*Rt-Et*At,Ht=Pt*kt-Ct*Ot,Vt=Pt*Ft-It*Ot,Wt=Pt*Nt-Mt*Ot,Yt=Ct*Ft-It*kt,Kt=Ct*Nt-Mt*kt,Zt=It*Nt-Mt*Ft;let Xt=Lt*Zt-Dt*Kt+$t*Yt+zt*Wt-Ut*Vt+jt*Ht;return Xt?(Xt=1/Xt,xt[0]=(St*Zt-At*Kt+Rt*Yt)*Xt,xt[1]=(Tt*Kt-bt*Zt-Et*Yt)*Xt,xt[2]=(kt*jt-Ft*Ut+Nt*zt)*Xt,xt[3]=(It*Ut-Ct*jt-Mt*zt)*Xt,xt[4]=(At*Wt-wt*Zt-Rt*Vt)*Xt,xt[5]=(vt*Zt-Tt*Wt+Et*Vt)*Xt,xt[6]=(Ft*$t-Ot*jt-Nt*Dt)*Xt,xt[7]=(Pt*jt-It*$t+Mt*Dt)*Xt,xt[8]=(wt*Kt-St*Wt+Rt*Ht)*Xt,xt[9]=(bt*Wt-vt*Kt-Et*Ht)*Xt,xt[10]=(Ot*Ut-kt*$t+Nt*Lt)*Xt,xt[11]=(Ct*$t-Pt*Ut-Mt*Lt)*Xt,xt[12]=(St*Vt-wt*Yt-At*Ht)*Xt,xt[13]=(vt*Yt-bt*Vt+Tt*Ht)*Xt,xt[14]=(kt*Dt-Ot*zt-Ft*Lt)*Xt,xt[15]=(Pt*zt-Ct*Dt+It*Lt)*Xt,xt):null}function determinant(xt){const yt=xt[0],vt=xt[1],bt=xt[2],Tt=xt[3],Et=xt[4],wt=xt[5],St=xt[6],At=xt[7],Rt=xt[8],Pt=xt[9],Ct=xt[10],It=xt[11],Mt=xt[12],Ot=xt[13],kt=xt[14],Ft=xt[15],Nt=yt*wt-vt*Et,Lt=yt*St-bt*Et,Dt=vt*St-bt*wt,$t=Rt*Ot-Pt*Mt,zt=Rt*kt-Ct*Mt,Ut=Pt*kt-Ct*Ot,jt=yt*Ut-vt*zt+bt*$t,Ht=Et*Ut-wt*zt+St*$t,Vt=Rt*Dt-Pt*Lt+Ct*Nt,Wt=Mt*Dt-Ot*Lt+kt*Nt;return At*jt-Tt*Ht+Ft*Vt-It*Wt}function multiply(xt,yt,vt){const bt=yt[0],Tt=yt[1],Et=yt[2],wt=yt[3],St=yt[4],At=yt[5],Rt=yt[6],Pt=yt[7],Ct=yt[8],It=yt[9],Mt=yt[10],Ot=yt[11],kt=yt[12],Ft=yt[13],Nt=yt[14],Lt=yt[15];let Dt=vt[0],$t=vt[1],zt=vt[2],Ut=vt[3];return xt[0]=Dt*bt+$t*St+zt*Ct+Ut*kt,xt[1]=Dt*Tt+$t*At+zt*It+Ut*Ft,xt[2]=Dt*Et+$t*Rt+zt*Mt+Ut*Nt,xt[3]=Dt*wt+$t*Pt+zt*Ot+Ut*Lt,Dt=vt[4],$t=vt[5],zt=vt[6],Ut=vt[7],xt[4]=Dt*bt+$t*St+zt*Ct+Ut*kt,xt[5]=Dt*Tt+$t*At+zt*It+Ut*Ft,xt[6]=Dt*Et+$t*Rt+zt*Mt+Ut*Nt,xt[7]=Dt*wt+$t*Pt+zt*Ot+Ut*Lt,Dt=vt[8],$t=vt[9],zt=vt[10],Ut=vt[11],xt[8]=Dt*bt+$t*St+zt*Ct+Ut*kt,xt[9]=Dt*Tt+$t*At+zt*It+Ut*Ft,xt[10]=Dt*Et+$t*Rt+zt*Mt+Ut*Nt,xt[11]=Dt*wt+$t*Pt+zt*Ot+Ut*Lt,Dt=vt[12],$t=vt[13],zt=vt[14],Ut=vt[15],xt[12]=Dt*bt+$t*St+zt*Ct+Ut*kt,xt[13]=Dt*Tt+$t*At+zt*It+Ut*Ft,xt[14]=Dt*Et+$t*Rt+zt*Mt+Ut*Nt,xt[15]=Dt*wt+$t*Pt+zt*Ot+Ut*Lt,xt}function translate(xt,yt,vt){const bt=vt[0],Tt=vt[1],Et=vt[2];let wt,St,At,Rt,Pt,Ct,It,Mt,Ot,kt,Ft,Nt;return yt===xt?(xt[12]=yt[0]*bt+yt[4]*Tt+yt[8]*Et+yt[12],xt[13]=yt[1]*bt+yt[5]*Tt+yt[9]*Et+yt[13],xt[14]=yt[2]*bt+yt[6]*Tt+yt[10]*Et+yt[14],xt[15]=yt[3]*bt+yt[7]*Tt+yt[11]*Et+yt[15]):(wt=yt[0],St=yt[1],At=yt[2],Rt=yt[3],Pt=yt[4],Ct=yt[5],It=yt[6],Mt=yt[7],Ot=yt[8],kt=yt[9],Ft=yt[10],Nt=yt[11],xt[0]=wt,xt[1]=St,xt[2]=At,xt[3]=Rt,xt[4]=Pt,xt[5]=Ct,xt[6]=It,xt[7]=Mt,xt[8]=Ot,xt[9]=kt,xt[10]=Ft,xt[11]=Nt,xt[12]=wt*bt+Pt*Tt+Ot*Et+yt[12],xt[13]=St*bt+Ct*Tt+kt*Et+yt[13],xt[14]=At*bt+It*Tt+Ft*Et+yt[14],xt[15]=Rt*bt+Mt*Tt+Nt*Et+yt[15]),xt}function scale$1(xt,yt,vt){const bt=vt[0],Tt=vt[1],Et=vt[2];return xt[0]=yt[0]*bt,xt[1]=yt[1]*bt,xt[2]=yt[2]*bt,xt[3]=yt[3]*bt,xt[4]=yt[4]*Tt,xt[5]=yt[5]*Tt,xt[6]=yt[6]*Tt,xt[7]=yt[7]*Tt,xt[8]=yt[8]*Et,xt[9]=yt[9]*Et,xt[10]=yt[10]*Et,xt[11]=yt[11]*Et,xt[12]=yt[12],xt[13]=yt[13],xt[14]=yt[14],xt[15]=yt[15],xt}function rotate(xt,yt,vt,bt){let Tt=bt[0],Et=bt[1],wt=bt[2],St=Math.sqrt(Tt*Tt+Et*Et+wt*wt),At,Rt,Pt,Ct,It,Mt,Ot,kt,Ft,Nt,Lt,Dt,$t,zt,Ut,jt,Ht,Vt,Wt,Yt,Kt,Zt,Xt,en;return St<EPSILON$1?null:(St=1/St,Tt*=St,Et*=St,wt*=St,Rt=Math.sin(vt),At=Math.cos(vt),Pt=1-At,Ct=yt[0],It=yt[1],Mt=yt[2],Ot=yt[3],kt=yt[4],Ft=yt[5],Nt=yt[6],Lt=yt[7],Dt=yt[8],$t=yt[9],zt=yt[10],Ut=yt[11],jt=Tt*Tt*Pt+At,Ht=Et*Tt*Pt+wt*Rt,Vt=wt*Tt*Pt-Et*Rt,Wt=Tt*Et*Pt-wt*Rt,Yt=Et*Et*Pt+At,Kt=wt*Et*Pt+Tt*Rt,Zt=Tt*wt*Pt+Et*Rt,Xt=Et*wt*Pt-Tt*Rt,en=wt*wt*Pt+At,xt[0]=Ct*jt+kt*Ht+Dt*Vt,xt[1]=It*jt+Ft*Ht+$t*Vt,xt[2]=Mt*jt+Nt*Ht+zt*Vt,xt[3]=Ot*jt+Lt*Ht+Ut*Vt,xt[4]=Ct*Wt+kt*Yt+Dt*Kt,xt[5]=It*Wt+Ft*Yt+$t*Kt,xt[6]=Mt*Wt+Nt*Yt+zt*Kt,xt[7]=Ot*Wt+Lt*Yt+Ut*Kt,xt[8]=Ct*Zt+kt*Xt+Dt*en,xt[9]=It*Zt+Ft*Xt+$t*en,xt[10]=Mt*Zt+Nt*Xt+zt*en,xt[11]=Ot*Zt+Lt*Xt+Ut*en,yt!==xt&&(xt[12]=yt[12],xt[13]=yt[13],xt[14]=yt[14],xt[15]=yt[15]),xt)}function rotateX(xt,yt,vt){const bt=Math.sin(vt),Tt=Math.cos(vt),Et=yt[4],wt=yt[5],St=yt[6],At=yt[7],Rt=yt[8],Pt=yt[9],Ct=yt[10],It=yt[11];return yt!==xt&&(xt[0]=yt[0],xt[1]=yt[1],xt[2]=yt[2],xt[3]=yt[3],xt[12]=yt[12],xt[13]=yt[13],xt[14]=yt[14],xt[15]=yt[15]),xt[4]=Et*Tt+Rt*bt,xt[5]=wt*Tt+Pt*bt,xt[6]=St*Tt+Ct*bt,xt[7]=At*Tt+It*bt,xt[8]=Rt*Tt-Et*bt,xt[9]=Pt*Tt-wt*bt,xt[10]=Ct*Tt-St*bt,xt[11]=It*Tt-At*bt,xt}function rotateY(xt,yt,vt){const bt=Math.sin(vt),Tt=Math.cos(vt),Et=yt[0],wt=yt[1],St=yt[2],At=yt[3],Rt=yt[8],Pt=yt[9],Ct=yt[10],It=yt[11];return yt!==xt&&(xt[4]=yt[4],xt[5]=yt[5],xt[6]=yt[6],xt[7]=yt[7],xt[12]=yt[12],xt[13]=yt[13],xt[14]=yt[14],xt[15]=yt[15]),xt[0]=Et*Tt-Rt*bt,xt[1]=wt*Tt-Pt*bt,xt[2]=St*Tt-Ct*bt,xt[3]=At*Tt-It*bt,xt[8]=Et*bt+Rt*Tt,xt[9]=wt*bt+Pt*Tt,xt[10]=St*bt+Ct*Tt,xt[11]=At*bt+It*Tt,xt}function rotateZ(xt,yt,vt){const bt=Math.sin(vt),Tt=Math.cos(vt),Et=yt[0],wt=yt[1],St=yt[2],At=yt[3],Rt=yt[4],Pt=yt[5],Ct=yt[6],It=yt[7];return yt!==xt&&(xt[8]=yt[8],xt[9]=yt[9],xt[10]=yt[10],xt[11]=yt[11],xt[12]=yt[12],xt[13]=yt[13],xt[14]=yt[14],xt[15]=yt[15]),xt[0]=Et*Tt+Rt*bt,xt[1]=wt*Tt+Pt*bt,xt[2]=St*Tt+Ct*bt,xt[3]=At*Tt+It*bt,xt[4]=Rt*Tt-Et*bt,xt[5]=Pt*Tt-wt*bt,xt[6]=Ct*Tt-St*bt,xt[7]=It*Tt-At*bt,xt}function fromQuat(xt,yt){const vt=yt[0],bt=yt[1],Tt=yt[2],Et=yt[3],wt=vt+vt,St=bt+bt,At=Tt+Tt,Rt=vt*wt,Pt=bt*wt,Ct=bt*St,It=Tt*wt,Mt=Tt*St,Ot=Tt*At,kt=Et*wt,Ft=Et*St,Nt=Et*At;return xt[0]=1-Ct-Ot,xt[1]=Pt+Nt,xt[2]=It-Ft,xt[3]=0,xt[4]=Pt-Nt,xt[5]=1-Rt-Ot,xt[6]=Mt+kt,xt[7]=0,xt[8]=It+Ft,xt[9]=Mt-kt,xt[10]=1-Rt-Ct,xt[11]=0,xt[12]=0,xt[13]=0,xt[14]=0,xt[15]=1,xt}function frustum(xt,yt,vt,bt,Tt,Et,wt){const St=1/(vt-yt),At=1/(Tt-bt),Rt=1/(Et-wt);return xt[0]=Et*2*St,xt[1]=0,xt[2]=0,xt[3]=0,xt[4]=0,xt[5]=Et*2*At,xt[6]=0,xt[7]=0,xt[8]=(vt+yt)*St,xt[9]=(Tt+bt)*At,xt[10]=(wt+Et)*Rt,xt[11]=-1,xt[12]=0,xt[13]=0,xt[14]=wt*Et*2*Rt,xt[15]=0,xt}function perspectiveNO(xt,yt,vt,bt,Tt){const Et=1/Math.tan(yt/2);if(xt[0]=Et/vt,xt[1]=0,xt[2]=0,xt[3]=0,xt[4]=0,xt[5]=Et,xt[6]=0,xt[7]=0,xt[8]=0,xt[9]=0,xt[11]=-1,xt[12]=0,xt[13]=0,xt[15]=0,Tt!=null&&Tt!==1/0){const wt=1/(bt-Tt);xt[10]=(Tt+bt)*wt,xt[14]=2*Tt*bt*wt}else xt[10]=-1,xt[14]=-2*bt;return xt}const perspective=perspectiveNO;function orthoNO(xt,yt,vt,bt,Tt,Et,wt){const St=1/(yt-vt),At=1/(bt-Tt),Rt=1/(Et-wt);return xt[0]=-2*St,xt[1]=0,xt[2]=0,xt[3]=0,xt[4]=0,xt[5]=-2*At,xt[6]=0,xt[7]=0,xt[8]=0,xt[9]=0,xt[10]=2*Rt,xt[11]=0,xt[12]=(yt+vt)*St,xt[13]=(Tt+bt)*At,xt[14]=(wt+Et)*Rt,xt[15]=1,xt}const ortho=orthoNO;function lookAt(xt,yt,vt,bt){let Tt,Et,wt,St,At,Rt,Pt,Ct,It,Mt;const Ot=yt[0],kt=yt[1],Ft=yt[2],Nt=bt[0],Lt=bt[1],Dt=bt[2],$t=vt[0],zt=vt[1],Ut=vt[2];return Math.abs(Ot-$t)<EPSILON$1&&Math.abs(kt-zt)<EPSILON$1&&Math.abs(Ft-Ut)<EPSILON$1?identity(xt):(Ct=Ot-$t,It=kt-zt,Mt=Ft-Ut,Tt=1/Math.sqrt(Ct*Ct+It*It+Mt*Mt),Ct*=Tt,It*=Tt,Mt*=Tt,Et=Lt*Mt-Dt*It,wt=Dt*Ct-Nt*Mt,St=Nt*It-Lt*Ct,Tt=Math.sqrt(Et*Et+wt*wt+St*St),Tt?(Tt=1/Tt,Et*=Tt,wt*=Tt,St*=Tt):(Et=0,wt=0,St=0),At=It*St-Mt*wt,Rt=Mt*Et-Ct*St,Pt=Ct*wt-It*Et,Tt=Math.sqrt(At*At+Rt*Rt+Pt*Pt),Tt?(Tt=1/Tt,At*=Tt,Rt*=Tt,Pt*=Tt):(At=0,Rt=0,Pt=0),xt[0]=Et,xt[1]=At,xt[2]=Ct,xt[3]=0,xt[4]=wt,xt[5]=Rt,xt[6]=It,xt[7]=0,xt[8]=St,xt[9]=Pt,xt[10]=Mt,xt[11]=0,xt[12]=-(Et*Ot+wt*kt+St*Ft),xt[13]=-(At*Ot+Rt*kt+Pt*Ft),xt[14]=-(Ct*Ot+It*kt+Mt*Ft),xt[15]=1,xt)}function create(){const xt=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(xt[0]=0,xt[1]=0,xt[2]=0,xt[3]=0),xt}function scale(xt,yt,vt){return xt[0]=yt[0]*vt,xt[1]=yt[1]*vt,xt[2]=yt[2]*vt,xt[3]=yt[3]*vt,xt}function transformMat4(xt,yt,vt){const bt=yt[0],Tt=yt[1],Et=yt[2],wt=yt[3];return xt[0]=vt[0]*bt+vt[4]*Tt+vt[8]*Et+vt[12]*wt,xt[1]=vt[1]*bt+vt[5]*Tt+vt[9]*Et+vt[13]*wt,xt[2]=vt[2]*bt+vt[6]*Tt+vt[10]*Et+vt[14]*wt,xt[3]=vt[3]*bt+vt[7]*Tt+vt[11]*Et+vt[15]*wt,xt}(function(){const xt=create();return function(yt,vt,bt,Tt,Et,wt){let St,At;for(vt||(vt=4),bt||(bt=0),Tt?At=Math.min(Tt*vt+bt,yt.length):At=yt.length,St=bt;St<At;St+=vt)xt[0]=yt[St],xt[1]=yt[St+1],xt[2]=yt[St+2],xt[3]=yt[St+3],Et(xt,xt,wt),yt[St]=xt[0],yt[St+1]=xt[1],yt[St+2]=xt[2],yt[St+3]=xt[3];return yt}})();var INDICES;(function(xt){xt[xt.COL0ROW0=0]="COL0ROW0",xt[xt.COL0ROW1=1]="COL0ROW1",xt[xt.COL0ROW2=2]="COL0ROW2",xt[xt.COL0ROW3=3]="COL0ROW3",xt[xt.COL1ROW0=4]="COL1ROW0",xt[xt.COL1ROW1=5]="COL1ROW1",xt[xt.COL1ROW2=6]="COL1ROW2",xt[xt.COL1ROW3=7]="COL1ROW3",xt[xt.COL2ROW0=8]="COL2ROW0",xt[xt.COL2ROW1=9]="COL2ROW1",xt[xt.COL2ROW2=10]="COL2ROW2",xt[xt.COL2ROW3=11]="COL2ROW3",xt[xt.COL3ROW0=12]="COL3ROW0",xt[xt.COL3ROW1=13]="COL3ROW1",xt[xt.COL3ROW2=14]="COL3ROW2",xt[xt.COL3ROW3=15]="COL3ROW3"})(INDICES||(INDICES={}));const DEFAULT_FOVY=45*Math.PI/180,DEFAULT_ASPECT=1,DEFAULT_NEAR=.1,DEFAULT_FAR=500,IDENTITY_MATRIX$1=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Matrix4 extends Matrix{static get IDENTITY(){return getIdentityMatrix()}static get ZERO(){return getZeroMatrix()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return INDICES}constructor(yt){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(yt)?this.copy(yt):this.identity()}copy(yt){return this[0]=yt[0],this[1]=yt[1],this[2]=yt[2],this[3]=yt[3],this[4]=yt[4],this[5]=yt[5],this[6]=yt[6],this[7]=yt[7],this[8]=yt[8],this[9]=yt[9],this[10]=yt[10],this[11]=yt[11],this[12]=yt[12],this[13]=yt[13],this[14]=yt[14],this[15]=yt[15],this.check()}set(yt,vt,bt,Tt,Et,wt,St,At,Rt,Pt,Ct,It,Mt,Ot,kt,Ft){return this[0]=yt,this[1]=vt,this[2]=bt,this[3]=Tt,this[4]=Et,this[5]=wt,this[6]=St,this[7]=At,this[8]=Rt,this[9]=Pt,this[10]=Ct,this[11]=It,this[12]=Mt,this[13]=Ot,this[14]=kt,this[15]=Ft,this.check()}setRowMajor(yt,vt,bt,Tt,Et,wt,St,At,Rt,Pt,Ct,It,Mt,Ot,kt,Ft){return this[0]=yt,this[1]=Et,this[2]=Rt,this[3]=Mt,this[4]=vt,this[5]=wt,this[6]=Pt,this[7]=Ot,this[8]=bt,this[9]=St,this[10]=Ct,this[11]=kt,this[12]=Tt,this[13]=At,this[14]=It,this[15]=Ft,this.check()}toRowMajor(yt){return yt[0]=this[0],yt[1]=this[4],yt[2]=this[8],yt[3]=this[12],yt[4]=this[1],yt[5]=this[5],yt[6]=this[9],yt[7]=this[13],yt[8]=this[2],yt[9]=this[6],yt[10]=this[10],yt[11]=this[14],yt[12]=this[3],yt[13]=this[7],yt[14]=this[11],yt[15]=this[15],yt}identity(){return this.copy(IDENTITY_MATRIX$1)}fromObject(yt){return this.check()}fromQuaternion(yt){return fromQuat(this,yt),this.check()}frustum(yt){const{left:vt,right:bt,bottom:Tt,top:Et,near:wt=DEFAULT_NEAR,far:St=DEFAULT_FAR}=yt;return St===1/0?computeInfinitePerspectiveOffCenter(this,vt,bt,Tt,Et,wt):frustum(this,vt,bt,Tt,Et,wt,St),this.check()}lookAt(yt){const{eye:vt,center:bt=[0,0,0],up:Tt=[0,1,0]}=yt;return lookAt(this,vt,bt,Tt),this.check()}ortho(yt){const{left:vt,right:bt,bottom:Tt,top:Et,near:wt=DEFAULT_NEAR,far:St=DEFAULT_FAR}=yt;return ortho(this,vt,bt,Tt,Et,wt,St),this.check()}orthographic(yt){const{fovy:vt=DEFAULT_FOVY,aspect:bt=DEFAULT_ASPECT,focalDistance:Tt=1,near:Et=DEFAULT_NEAR,far:wt=DEFAULT_FAR}=yt;checkRadians(vt);const St=vt/2,At=Tt*Math.tan(St),Rt=At*bt;return this.ortho({left:-Rt,right:Rt,bottom:-At,top:At,near:Et,far:wt})}perspective(yt){const{fovy:vt=45*Math.PI/180,aspect:bt=1,near:Tt=.1,far:Et=500}=yt;return checkRadians(vt),perspective(this,vt,bt,Tt,Et),this.check()}determinant(){return determinant(this)}getScale(yt=[-0,-0,-0]){return yt[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),yt[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),yt[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),yt}getTranslation(yt=[-0,-0,-0]){return yt[0]=this[12],yt[1]=this[13],yt[2]=this[14],yt}getRotation(yt,vt){yt=yt||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],vt=vt||[-0,-0,-0];const bt=this.getScale(vt),Tt=1/bt[0],Et=1/bt[1],wt=1/bt[2];return yt[0]=this[0]*Tt,yt[1]=this[1]*Et,yt[2]=this[2]*wt,yt[3]=0,yt[4]=this[4]*Tt,yt[5]=this[5]*Et,yt[6]=this[6]*wt,yt[7]=0,yt[8]=this[8]*Tt,yt[9]=this[9]*Et,yt[10]=this[10]*wt,yt[11]=0,yt[12]=0,yt[13]=0,yt[14]=0,yt[15]=1,yt}getRotationMatrix3(yt,vt){yt=yt||[-0,-0,-0,-0,-0,-0,-0,-0,-0],vt=vt||[-0,-0,-0];const bt=this.getScale(vt),Tt=1/bt[0],Et=1/bt[1],wt=1/bt[2];return yt[0]=this[0]*Tt,yt[1]=this[1]*Et,yt[2]=this[2]*wt,yt[3]=this[4]*Tt,yt[4]=this[5]*Et,yt[5]=this[6]*wt,yt[6]=this[8]*Tt,yt[7]=this[9]*Et,yt[8]=this[10]*wt,yt}transpose(){return transpose(this,this),this.check()}invert(){return invert(this,this),this.check()}multiplyLeft(yt){return multiply(this,yt,this),this.check()}multiplyRight(yt){return multiply(this,this,yt),this.check()}rotateX(yt){return rotateX(this,this,yt),this.check()}rotateY(yt){return rotateY(this,this,yt),this.check()}rotateZ(yt){return rotateZ(this,this,yt),this.check()}rotateXYZ(yt){return this.rotateX(yt[0]).rotateY(yt[1]).rotateZ(yt[2])}rotateAxis(yt,vt){return rotate(this,this,yt,vt),this.check()}scale(yt){return scale$1(this,this,Array.isArray(yt)?yt:[yt,yt,yt]),this.check()}translate(yt){return translate(this,this,yt),this.check()}transform(yt,vt){return yt.length===4?(vt=transformMat4(vt||[-0,-0,-0,-0],yt,this),checkVector(vt,4),vt):this.transformAsPoint(yt,vt)}transformAsPoint(yt,vt){const{length:bt}=yt;let Tt;switch(bt){case 2:Tt=transformMat4$2(vt||[-0,-0],yt,this);break;case 3:Tt=transformMat4$1(vt||[-0,-0,-0],yt,this);break;default:throw new Error("Illegal vector")}return checkVector(Tt,yt.length),Tt}transformAsVector(yt,vt){let bt;switch(yt.length){case 2:bt=vec2_transformMat4AsVector(vt||[-0,-0],yt,this);break;case 3:bt=vec3_transformMat4AsVector(vt||[-0,-0,-0],yt,this);break;default:throw new Error("Illegal vector")}return checkVector(bt,yt.length),bt}transformPoint(yt,vt){return this.transformAsPoint(yt,vt)}transformVector(yt,vt){return this.transformAsPoint(yt,vt)}transformDirection(yt,vt){return this.transformAsVector(yt,vt)}makeRotationX(yt){return this.identity().rotateX(yt)}makeTranslation(yt,vt,bt){return this.identity().translate([yt,vt,bt])}}let ZERO,IDENTITY$1;function getZeroMatrix(){return ZERO||(ZERO=new Matrix4([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ZERO)),ZERO}function getIdentityMatrix(){return IDENTITY$1||(IDENTITY$1=new Matrix4,Object.freeze(IDENTITY$1)),IDENTITY$1}function checkRadians(xt){if(xt>Math.PI*2)throw Error("expected radians")}function computeInfinitePerspectiveOffCenter(xt,yt,vt,bt,Tt,Et){const wt=2*Et/(vt-yt),St=2*Et/(Tt-bt),At=(vt+yt)/(vt-yt),Rt=(Tt+bt)/(Tt-bt),Pt=-1,Ct=-1,It=-2*Et;return xt[0]=wt,xt[1]=0,xt[2]=0,xt[3]=0,xt[4]=0,xt[5]=St,xt[6]=0,xt[7]=0,xt[8]=At,xt[9]=Rt,xt[10]=Pt,xt[11]=Ct,xt[12]=0,xt[13]=0,xt[14]=It,xt[15]=0,xt}function fp64ify(xt,yt=[],vt=0){const bt=Math.fround(xt),Tt=xt-bt;return yt[vt]=bt,yt[vt+1]=Tt,yt}function fp64LowPart$1(xt){return xt-Math.fround(xt)}function fp64ifyMatrix4(xt){const yt=new Float32Array(32);for(let vt=0;vt<4;++vt)for(let bt=0;bt<4;++bt){const Tt=vt*4+bt;fp64ify(xt[bt*4+vt],yt,Tt*2)}return yt}const fp32shader=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fp32={name:"fp32",vs:fp32shader},fp64arithmeticShader=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,defaultUniforms={ONE:1},fp64arithmetic={name:"fp64arithmetic",vs:fp64arithmeticShader,defaultUniforms,uniformTypes:{ONE:"f32"},fp64ify,fp64LowPart:fp64LowPart$1,fp64ifyMatrix4},DEFAULT_HIGHLIGHT_COLOR=[0,1,1,1],vs$9=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs$9=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,picking$1={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:DEFAULT_HIGHLIGHT_COLOR},vs:vs$9,fs:fs$9,getUniforms:getUniforms$2};function getUniforms$2(xt={},yt){const vt={};if(xt.highlightedObjectColor!==void 0)if(xt.highlightedObjectColor===null)vt.isHighlightActive=!1;else{vt.isHighlightActive=!0;const bt=xt.highlightedObjectColor.slice(0,3);vt.highlightedObjectColor=bt}if(xt.highlightColor){const bt=Array.from(xt.highlightColor,Tt=>Tt/255);Number.isFinite(bt[3])||(bt[3]=1),vt.highlightColor=bt}return xt.isActive!==void 0&&(vt.isActive=!!xt.isActive,vt.isAttribute=!!xt.isAttribute),xt.useFloatColors!==void 0&&(vt.useFloatColors=!!xt.useFloatColors),vt}const lightingUniformsGLSL=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,lightingUniformsWGSL=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,MAX_LIGHTS=3,COLOR_FACTOR=255;var LIGHT_TYPE;(function(xt){xt[xt.POINT=0]="POINT",xt[xt.DIRECTIONAL=1]="DIRECTIONAL"})(LIGHT_TYPE||(LIGHT_TYPE={}));const lighting={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:LIGHT_TYPE.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:lightingUniformsWGSL,vs:lightingUniformsGLSL,fs:lightingUniformsGLSL,getUniforms:getUniforms$1};function getUniforms$1(xt,yt={}){if(xt=xt&&{...xt},!xt)return{...lighting.defaultUniforms};xt.lights&&(xt={...xt,...extractLightTypes(xt.lights),lights:void 0});const{ambientLight:vt,pointLights:bt,directionalLights:Tt}=xt||{};if(!(vt||bt&&bt.length>0||Tt&&Tt.length>0))return{...lighting.defaultUniforms,enabled:0};const wt={...lighting.defaultUniforms,...yt,...getLightSourceUniforms({ambientLight:vt,pointLights:bt,directionalLights:Tt})};return xt.enabled!==void 0&&(wt.enabled=xt.enabled?1:0),wt}function getLightSourceUniforms({ambientLight:xt,pointLights:yt=[],directionalLights:vt=[]}){const bt={};bt.ambientLightColor=convertColor(xt);let Tt=0;for(const Et of yt){bt.lightType=LIGHT_TYPE.POINT;const wt=Tt;bt[`lightColor${wt}`]=convertColor(Et),bt[`lightPosition${wt}`]=Et.position,bt[`lightAttenuation${wt}`]=Et.attenuation||[1,0,0],Tt++}for(const Et of vt){bt.lightType=LIGHT_TYPE.DIRECTIONAL;const wt=Tt;bt[`lightColor${wt}`]=convertColor(Et),bt[`lightDirection${wt}`]=Et.direction,Tt++}return Tt>MAX_LIGHTS&&log.warn("MAX_LIGHTS exceeded")(),bt.directionalLightCount=vt.length,bt.pointLightCount=yt.length,bt}function extractLightTypes(xt){var vt,bt;const yt={pointLights:[],directionalLights:[]};for(const Tt of xt||[])switch(Tt.type){case"ambient":yt.ambientLight=Tt;break;case"directional":(vt=yt.directionalLights)==null||vt.push(Tt);break;case"point":(bt=yt.pointLights)==null||bt.push(Tt);break}return yt}function convertColor(xt={}){const{color:yt=[0,0,0],intensity:vt=1}=xt;return yt.map(bt=>bt*vt/COLOR_FACTOR)}const PHONG_VS=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,PHONG_FS=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,PHONG_WGSL=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,gouraudMaterial={props:{},name:"gouraudMaterial",vs:PHONG_FS.replace("phongMaterial","gouraudMaterial"),fs:PHONG_VS.replace("phongMaterial","gouraudMaterial"),source:PHONG_WGSL.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[lighting],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(xt){const yt={...xt};return yt.specularColor&&(yt.specularColor=yt.specularColor.map(vt=>vt/255)),{...gouraudMaterial.defaultUniforms,...yt}}},uniformBlock$8=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,layerUniforms={name:"layer",vs:uniformBlock$8,fs:uniformBlock$8,getUniforms:xt=>({opacity:Math.pow(xt.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},source$2=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,defines="#define SMOOTH_EDGE_RADIUS 0.5",vs$8=`${defines}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,fs$8=`${defines}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,geometry={name:"geometry",source:source$2,vs:vs$8,fs:fs$8},COMPUTE_INTERVAL=25;var InputEvent;(function(xt){xt[xt.Start=1]="Start",xt[xt.Move=2]="Move",xt[xt.End=4]="End",xt[xt.Cancel=8]="Cancel"})(InputEvent||(InputEvent={}));var InputDirection;(function(xt){xt[xt.None=0]="None",xt[xt.Left=1]="Left",xt[xt.Right=2]="Right",xt[xt.Up=4]="Up",xt[xt.Down=8]="Down",xt[xt.Horizontal=3]="Horizontal",xt[xt.Vertical=12]="Vertical",xt[xt.All=15]="All"})(InputDirection||(InputDirection={}));var RecognizerState;(function(xt){xt[xt.Possible=1]="Possible",xt[xt.Began=2]="Began",xt[xt.Changed=4]="Changed",xt[xt.Ended=8]="Ended",xt[xt.Recognized=8]="Recognized",xt[xt.Cancelled=16]="Cancelled",xt[xt.Failed=32]="Failed"})(RecognizerState||(RecognizerState={}));const TOUCH_ACTION_COMPUTE="compute",TOUCH_ACTION_AUTO="auto",TOUCH_ACTION_MANIPULATION="manipulation",TOUCH_ACTION_NONE="none",TOUCH_ACTION_PAN_X="pan-x",TOUCH_ACTION_PAN_Y="pan-y";function cleanTouchActions(xt){if(xt.includes(TOUCH_ACTION_NONE))return TOUCH_ACTION_NONE;const yt=xt.includes(TOUCH_ACTION_PAN_X),vt=xt.includes(TOUCH_ACTION_PAN_Y);return yt&&vt?TOUCH_ACTION_NONE:yt||vt?yt?TOUCH_ACTION_PAN_X:TOUCH_ACTION_PAN_Y:xt.includes(TOUCH_ACTION_MANIPULATION)?TOUCH_ACTION_MANIPULATION:TOUCH_ACTION_AUTO}class TouchAction{constructor(yt,vt){this.actions="",this.manager=yt,this.set(vt)}set(yt){yt===TOUCH_ACTION_COMPUTE&&(yt=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=yt,this.actions=yt)}update(){this.set(this.manager.options.touchAction)}compute(){let yt=[];for(const vt of this.manager.recognizers)vt.options.enable&&(yt=yt.concat(vt.getTouchAction()));return cleanTouchActions(yt.join(" "))}}function splitStr(xt){return xt.trim().split(/\s+/g)}function addEventListeners(xt,yt,vt){if(xt)for(const bt of splitStr(yt))xt.addEventListener(bt,vt,!1)}function removeEventListeners(xt,yt,vt){if(xt)for(const bt of splitStr(yt))xt.removeEventListener(bt,vt,!1)}function getWindowForElement(xt){return(xt.ownerDocument||xt).defaultView}function hasParent(xt,yt){let vt=xt;for(;vt;){if(vt===yt)return!0;vt=vt.parentNode}return!1}function getCenter(xt){const yt=xt.length;if(yt===1)return{x:Math.round(xt[0].clientX),y:Math.round(xt[0].clientY)};let vt=0,bt=0,Tt=0;for(;Tt<yt;)vt+=xt[Tt].clientX,bt+=xt[Tt].clientY,Tt++;return{x:Math.round(vt/yt),y:Math.round(bt/yt)}}function simpleCloneInputData(xt){const yt=[];let vt=0;for(;vt<xt.pointers.length;)yt[vt]={clientX:Math.round(xt.pointers[vt].clientX),clientY:Math.round(xt.pointers[vt].clientY)},vt++;return{timeStamp:Date.now(),pointers:yt,center:getCenter(yt),deltaX:xt.deltaX,deltaY:xt.deltaY}}function getPointDistance(xt,yt){const vt=yt.x-xt.x,bt=yt.y-xt.y;return Math.sqrt(vt*vt+bt*bt)}function getEventDistance(xt,yt){const vt=yt.clientX-xt.clientX,bt=yt.clientY-xt.clientY;return Math.sqrt(vt*vt+bt*bt)}function getPointAngle(xt,yt){const vt=yt.x-xt.x,bt=yt.y-xt.y;return Math.atan2(bt,vt)*180/Math.PI}function getEventAngle(xt,yt){const vt=yt.clientX-xt.clientX,bt=yt.clientY-xt.clientY;return Math.atan2(bt,vt)*180/Math.PI}function getDirection(xt,yt){return xt===yt?InputDirection.None:Math.abs(xt)>=Math.abs(yt)?xt<0?InputDirection.Left:InputDirection.Right:yt<0?InputDirection.Up:InputDirection.Down}function computeDeltaXY(xt,yt){const vt=yt.center;let bt=xt.offsetDelta,Tt=xt.prevDelta;const Et=xt.prevInput;return(yt.eventType===InputEvent.Start||(Et==null?void 0:Et.eventType)===InputEvent.End)&&(Tt=xt.prevDelta={x:(Et==null?void 0:Et.deltaX)||0,y:(Et==null?void 0:Et.deltaY)||0},bt=xt.offsetDelta={x:vt.x,y:vt.y}),{deltaX:Tt.x+(vt.x-bt.x),deltaY:Tt.y+(vt.y-bt.y)}}function getVelocity(xt,yt,vt){return{x:yt/xt||0,y:vt/xt||0}}function getScale(xt,yt){return getEventDistance(yt[0],yt[1])/getEventDistance(xt[0],xt[1])}function getRotation(xt,yt){return getEventAngle(yt[1],yt[0])-getEventAngle(xt[1],xt[0])}function computeIntervalInputData(xt,yt){const vt=xt.lastInterval||yt,bt=yt.timeStamp-vt.timeStamp;let Tt,Et,wt,St;if(yt.eventType!==InputEvent.Cancel&&(bt>COMPUTE_INTERVAL||vt.velocity===void 0)){const At=yt.deltaX-vt.deltaX,Rt=yt.deltaY-vt.deltaY,Pt=getVelocity(bt,At,Rt);Et=Pt.x,wt=Pt.y,Tt=Math.abs(Pt.x)>Math.abs(Pt.y)?Pt.x:Pt.y,St=getDirection(At,Rt),xt.lastInterval=yt}else Tt=vt.velocity,Et=vt.velocityX,wt=vt.velocityY,St=vt.direction;yt.velocity=Tt,yt.velocityX=Et,yt.velocityY=wt,yt.direction=St}function computeInputData(xt,yt){const{session:vt}=xt,{pointers:bt}=yt,{length:Tt}=bt;vt.firstInput||(vt.firstInput=simpleCloneInputData(yt)),Tt>1&&!vt.firstMultiple?vt.firstMultiple=simpleCloneInputData(yt):Tt===1&&(vt.firstMultiple=!1);const{firstInput:Et,firstMultiple:wt}=vt,St=wt?wt.center:Et.center,At=yt.center=getCenter(bt);yt.timeStamp=Date.now(),yt.deltaTime=yt.timeStamp-Et.timeStamp,yt.angle=getPointAngle(St,At),yt.distance=getPointDistance(St,At);const{deltaX:Rt,deltaY:Pt}=computeDeltaXY(vt,yt);yt.deltaX=Rt,yt.deltaY=Pt,yt.offsetDirection=getDirection(yt.deltaX,yt.deltaY);const Ct=getVelocity(yt.deltaTime,yt.deltaX,yt.deltaY);yt.overallVelocityX=Ct.x,yt.overallVelocityY=Ct.y,yt.overallVelocity=Math.abs(Ct.x)>Math.abs(Ct.y)?Ct.x:Ct.y,yt.scale=wt?getScale(wt.pointers,bt):1,yt.rotation=wt?getRotation(wt.pointers,bt):0,yt.maxPointers=vt.prevInput?yt.pointers.length>vt.prevInput.maxPointers?yt.pointers.length:vt.prevInput.maxPointers:yt.pointers.length;let It=xt.element;return hasParent(yt.srcEvent.target,It)&&(It=yt.srcEvent.target),yt.target=It,computeIntervalInputData(vt,yt),yt}function inputHandler(xt,yt,vt){const bt=vt.pointers.length,Tt=vt.changedPointers.length,Et=yt&InputEvent.Start&&bt-Tt===0,wt=yt&(InputEvent.End|InputEvent.Cancel)&&bt-Tt===0;vt.isFirst=!!Et,vt.isFinal=!!wt,Et&&(xt.session={}),vt.eventType=yt;const St=computeInputData(xt,vt);xt.emit("hammer.input",St),xt.recognize(St),xt.session.prevInput=St}let Input$1=class{constructor(yt){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=vt=>{this.manager.options.enable&&this.handler(vt)},this.manager=yt,this.element=yt.element,this.target=yt.options.inputTarget||yt.element}callback(yt,vt){inputHandler(this.manager,yt,vt)}init(){addEventListeners(this.element,this.evEl,this.domHandler),addEventListeners(this.target,this.evTarget,this.domHandler),addEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)}destroy(){removeEventListeners(this.element,this.evEl,this.domHandler),removeEventListeners(this.target,this.evTarget,this.domHandler),removeEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)}};const POINTER_INPUT_MAP={pointerdown:InputEvent.Start,pointermove:InputEvent.Move,pointerup:InputEvent.End,pointercancel:InputEvent.Cancel,pointerout:InputEvent.Cancel},POINTER_ELEMENT_EVENTS="pointerdown",POINTER_WINDOW_EVENTS="pointermove pointerup pointercancel";class PointerEventInput extends Input$1{constructor(yt){super(yt),this.evEl=POINTER_ELEMENT_EVENTS,this.evWin=POINTER_WINDOW_EVENTS,this.store=this.manager.session.pointerEvents=[],this.init()}handler(yt){const{store:vt}=this;let bt=!1;const Tt=POINTER_INPUT_MAP[yt.type],Et=yt.pointerType,wt=Et==="touch";let St=vt.findIndex(At=>At.pointerId===yt.pointerId);Tt&InputEvent.Start&&(yt.buttons||wt)?St<0&&(vt.push(yt),St=vt.length-1):Tt&(InputEvent.End|InputEvent.Cancel)&&(bt=!0),!(St<0)&&(vt[St]=yt,this.callback(Tt,{pointers:vt,changedPointers:[yt],eventType:Tt,pointerType:Et,srcEvent:yt}),bt&&vt.splice(St,1))}}const VENDOR_PREFIXES=["","webkit","Moz","MS","ms","o"];function prefixed(xt,yt){const vt=yt[0].toUpperCase()+yt.slice(1);for(const bt of VENDOR_PREFIXES){const Tt=bt?bt+vt:yt;if(Tt in xt)return Tt}}const STOP=1,FORCED_STOP=2,defaultOptions={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class Manager{constructor(yt,vt){this.options={...defaultOptions,...vt,cssProps:{...defaultOptions.cssProps,...vt.cssProps},inputTarget:vt.inputTarget||yt},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=yt,this.input=new PointerEventInput(this),this.touchAction=new TouchAction(this,this.options.touchAction),this.toggleCssProps(!0)}set(yt){return Object.assign(this.options,yt),yt.touchAction&&this.touchAction.update(),yt.inputTarget&&(this.input.destroy(),this.input.target=yt.inputTarget,this.input.init()),this}stop(yt){this.session.stopped=yt?FORCED_STOP:STOP}recognize(yt){const{session:vt}=this;if(vt.stopped)return;this.session.prevented&&yt.srcEvent.preventDefault();let bt;const{recognizers:Tt}=this;let{curRecognizer:Et}=vt;(!Et||Et&&Et.state&RecognizerState.Recognized)&&(Et=vt.curRecognizer=null);let wt=0;for(;wt<Tt.length;)bt=Tt[wt],vt.stopped!==FORCED_STOP&&(!Et||bt===Et||bt.canRecognizeWith(Et))?bt.recognize(yt):bt.reset(),!Et&&bt.state&(RecognizerState.Began|RecognizerState.Changed|RecognizerState.Ended)&&(Et=vt.curRecognizer=bt),wt++}get(yt){const{recognizers:vt}=this;for(let bt=0;bt<vt.length;bt++)if(vt[bt].options.event===yt)return vt[bt];return null}add(yt){if(Array.isArray(yt)){for(const bt of yt)this.add(bt);return this}const vt=this.get(yt.options.event);return vt&&this.remove(vt),this.recognizers.push(yt),yt.manager=this,this.touchAction.update(),yt}remove(yt){if(Array.isArray(yt)){for(const bt of yt)this.remove(bt);return this}const vt=typeof yt=="string"?this.get(yt):yt;if(vt){const{recognizers:bt}=this,Tt=bt.indexOf(vt);Tt!==-1&&(bt.splice(Tt,1),this.touchAction.update())}return this}on(yt,vt){if(!yt||!vt)return;const{handlers:bt}=this;for(const Tt of splitStr(yt))bt[Tt]=bt[Tt]||[],bt[Tt].push(vt)}off(yt,vt){if(!yt)return;const{handlers:bt}=this;for(const Tt of splitStr(yt))vt?bt[Tt]&&bt[Tt].splice(bt[Tt].indexOf(vt),1):delete bt[Tt]}emit(yt,vt){const bt=this.handlers[yt]&&this.handlers[yt].slice();if(!bt||!bt.length)return;const Tt=vt;Tt.type=yt,Tt.preventDefault=function(){vt.srcEvent.preventDefault()};let Et=0;for(;Et<bt.length;)bt[Et](Tt),Et++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(yt){const{element:vt}=this;if(vt){for(const[bt,Tt]of Object.entries(this.options.cssProps)){const Et=prefixed(vt.style,bt);yt?(this.oldCssProps[Et]=vt.style[Et],vt.style[Et]=Tt):vt.style[Et]=this.oldCssProps[Et]||""}yt||(this.oldCssProps={})}}}let _uniqueId=1;function uniqueId(){return _uniqueId++}function stateStr(xt){return xt&RecognizerState.Cancelled?"cancel":xt&RecognizerState.Ended?"end":xt&RecognizerState.Changed?"move":xt&RecognizerState.Began?"start":""}class Recognizer{constructor(yt){this.options=yt,this.id=uniqueId(),this.state=RecognizerState.Possible,this.simultaneous={},this.requireFail=[]}set(yt){return Object.assign(this.options,yt),this.manager.touchAction.update(),this}recognizeWith(yt){if(Array.isArray(yt)){for(const Tt of yt)this.recognizeWith(Tt);return this}let vt;if(typeof yt=="string"){if(vt=this.manager.get(yt),!vt)throw new Error(`Cannot find recognizer ${yt}`)}else vt=yt;const{simultaneous:bt}=this;return bt[vt.id]||(bt[vt.id]=vt,vt.recognizeWith(this)),this}dropRecognizeWith(yt){if(Array.isArray(yt)){for(const bt of yt)this.dropRecognizeWith(bt);return this}let vt;return typeof yt=="string"?vt=this.manager.get(yt):vt=yt,vt&&delete this.simultaneous[vt.id],this}requireFailure(yt){if(Array.isArray(yt)){for(const Tt of yt)this.requireFailure(Tt);return this}let vt;if(typeof yt=="string"){if(vt=this.manager.get(yt),!vt)throw new Error(`Cannot find recognizer ${yt}`)}else vt=yt;const{requireFail:bt}=this;return bt.indexOf(vt)===-1&&(bt.push(vt),vt.requireFailure(this)),this}dropRequireFailure(yt){if(Array.isArray(yt)){for(const bt of yt)this.dropRequireFailure(bt);return this}let vt;if(typeof yt=="string"?vt=this.manager.get(yt):vt=yt,vt){const bt=this.requireFail.indexOf(vt);bt>-1&&this.requireFail.splice(bt,1)}return this}hasRequireFailures(){return!!this.requireFail.find(yt=>yt.options.enable)}canRecognizeWith(yt){return!!this.simultaneous[yt.id]}emit(yt){if(!yt)return;const{state:vt}=this;vt<RecognizerState.Ended&&this.manager.emit(this.options.event+stateStr(vt),yt),this.manager.emit(this.options.event,yt),yt.additionalEvent&&this.manager.emit(yt.additionalEvent,yt),vt>=RecognizerState.Ended&&this.manager.emit(this.options.event+stateStr(vt),yt)}tryEmit(yt){this.canEmit()?this.emit(yt):this.state=RecognizerState.Failed}canEmit(){let yt=0;for(;yt<this.requireFail.length;){if(!(this.requireFail[yt].state&(RecognizerState.Failed|RecognizerState.Possible)))return!1;yt++}return!0}recognize(yt){const vt={...yt};if(!this.options.enable){this.reset(),this.state=RecognizerState.Failed;return}this.state&(RecognizerState.Recognized|RecognizerState.Cancelled|RecognizerState.Failed)&&(this.state=RecognizerState.Possible),this.state=this.process(vt),this.state&(RecognizerState.Began|RecognizerState.Changed|RecognizerState.Ended|RecognizerState.Cancelled)&&this.tryEmit(vt)}getEventNames(){return[this.options.event]}reset(){}}class AttrRecognizer extends Recognizer{attrTest(yt){const vt=this.options.pointers;return vt===0||yt.pointers.length===vt}process(yt){const{state:vt}=this,{eventType:bt}=yt,Tt=vt&(RecognizerState.Began|RecognizerState.Changed),Et=this.attrTest(yt);return Tt&&(bt&InputEvent.Cancel||!Et)?vt|RecognizerState.Cancelled:Tt||Et?bt&InputEvent.End?vt|RecognizerState.Ended:vt&RecognizerState.Began?vt|RecognizerState.Changed:RecognizerState.Began:RecognizerState.Failed}}class TapRecognizer extends Recognizer{constructor(yt={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...yt}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[TOUCH_ACTION_MANIPULATION]}process(yt){const{options:vt}=this,bt=yt.pointers.length===vt.pointers,Tt=yt.distance<vt.threshold,Et=yt.deltaTime<vt.time;if(this.reset(),yt.eventType&InputEvent.Start&&this.count===0)return this.failTimeout();if(Tt&&Et&&bt){if(yt.eventType!==InputEvent.End)return this.failTimeout();const wt=this.pTime?yt.timeStamp-this.pTime<vt.interval:!0,St=!this.pCenter||getPointDistance(this.pCenter,yt.center)<vt.posThreshold;if(this.pTime=yt.timeStamp,this.pCenter=yt.center,!St||!wt?this.count=1:this.count+=1,this._input=yt,this.count%vt.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=RecognizerState.Recognized,this.tryEmit(this._input)},vt.interval),RecognizerState.Began):RecognizerState.Recognized}return RecognizerState.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=RecognizerState.Failed},this.options.interval),RecognizerState.Failed}reset(){clearTimeout(this._timer)}emit(yt){this.state===RecognizerState.Recognized&&(yt.tapCount=this.count,this.manager.emit(this.options.event,yt))}}const EVENT_NAMES$1=["","start","move","end","cancel","up","down","left","right"];class PanRecognizer extends AttrRecognizer{constructor(yt={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:InputDirection.All,...yt}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:yt}}=this,vt=[];return yt&InputDirection.Horizontal&&vt.push(TOUCH_ACTION_PAN_Y),yt&InputDirection.Vertical&&vt.push(TOUCH_ACTION_PAN_X),vt}getEventNames(){return EVENT_NAMES$1.map(yt=>this.options.event+yt)}directionTest(yt){const{options:vt}=this;let bt=!0,{distance:Tt}=yt,{direction:Et}=yt;const wt=yt.deltaX,St=yt.deltaY;return Et&vt.direction||(vt.direction&InputDirection.Horizontal?(Et=wt===0?InputDirection.None:wt<0?InputDirection.Left:InputDirection.Right,bt=wt!==this.pX,Tt=Math.abs(yt.deltaX)):(Et=St===0?InputDirection.None:St<0?InputDirection.Up:InputDirection.Down,bt=St!==this.pY,Tt=Math.abs(yt.deltaY))),yt.direction=Et,bt&&Tt>vt.threshold&&!!(Et&vt.direction)}attrTest(yt){return super.attrTest(yt)&&(!!(this.state&RecognizerState.Began)||!(this.state&RecognizerState.Began)&&this.directionTest(yt))}emit(yt){this.pX=yt.deltaX,this.pY=yt.deltaY;const vt=InputDirection[yt.direction].toLowerCase();vt&&(yt.additionalEvent=this.options.event+vt),super.emit(yt)}}const EVENT_NAMES=["","start","move","end","cancel","in","out"];class PinchRecognizer extends AttrRecognizer{constructor(yt={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...yt})}getTouchAction(){return[TOUCH_ACTION_NONE]}getEventNames(){return EVENT_NAMES.map(yt=>this.options.event+yt)}attrTest(yt){return super.attrTest(yt)&&(Math.abs(yt.scale-1)>this.options.threshold||!!(this.state&RecognizerState.Began))}emit(yt){if(yt.scale!==1){const vt=yt.scale<1?"in":"out";yt.additionalEvent=this.options.event+vt}super.emit(yt)}}class Input{constructor(yt,vt,bt){this.element=yt,this.callback=vt,this.options=bt}}const userAgent=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",firefox=userAgent.indexOf("firefox")!==-1,WHEEL_DELTA_MAGIC_SCALER=4.000244140625,WHEEL_DELTA_PER_LINE=40,SHIFT_MULTIPLIER=.25;class WheelInput extends Input{constructor(yt,vt,bt){super(yt,vt,{enable:!0,...bt}),this.handleEvent=Tt=>{if(!this.options.enable)return;let Et=Tt.deltaY;globalThis.WheelEvent&&(firefox&&Tt.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(Et/=globalThis.devicePixelRatio),Tt.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(Et*=WHEEL_DELTA_PER_LINE)),Et!==0&&Et%WHEEL_DELTA_MAGIC_SCALER===0&&(Et=Math.floor(Et/WHEEL_DELTA_MAGIC_SCALER)),Tt.shiftKey&&Et&&(Et=Et*SHIFT_MULTIPLIER),this.callback({type:"wheel",center:{x:Tt.clientX,y:Tt.clientY},delta:-Et,srcEvent:Tt,pointerType:"mouse",target:Tt.target})},yt.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(yt,vt){yt==="wheel"&&(this.options.enable=vt)}}const MOUSE_EVENTS$1=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class MoveInput extends Input{constructor(yt,vt,bt){super(yt,vt,{enable:!0,...bt}),this.handleEvent=Et=>{this.handleOverEvent(Et),this.handleOutEvent(Et),this.handleEnterEvent(Et),this.handleLeaveEvent(Et),this.handleMoveEvent(Et)},this.pressed=!1;const{enable:Tt}=this.options;this.enableMoveEvent=Tt,this.enableLeaveEvent=Tt,this.enableEnterEvent=Tt,this.enableOutEvent=Tt,this.enableOverEvent=Tt,MOUSE_EVENTS$1.forEach(Et=>yt.addEventListener(Et,this.handleEvent))}destroy(){MOUSE_EVENTS$1.forEach(yt=>this.element.removeEventListener(yt,this.handleEvent))}enableEventType(yt,vt){switch(yt){case"pointermove":this.enableMoveEvent=vt;break;case"pointerover":this.enableOverEvent=vt;break;case"pointerout":this.enableOutEvent=vt;break;case"pointerenter":this.enableEnterEvent=vt;break;case"pointerleave":this.enableLeaveEvent=vt;break}}handleOverEvent(yt){this.enableOverEvent&&yt.type==="mouseover"&&this._emit("pointerover",yt)}handleOutEvent(yt){this.enableOutEvent&&yt.type==="mouseout"&&this._emit("pointerout",yt)}handleEnterEvent(yt){this.enableEnterEvent&&yt.type==="mouseenter"&&this._emit("pointerenter",yt)}handleLeaveEvent(yt){this.enableLeaveEvent&&yt.type==="mouseleave"&&this._emit("pointerleave",yt)}handleMoveEvent(yt){if(this.enableMoveEvent)switch(yt.type){case"mousedown":yt.button>=0&&(this.pressed=!0);break;case"mousemove":yt.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",yt);break;case"mouseup":this.pressed=!1;break}}_emit(yt,vt){this.callback({type:yt,center:{x:vt.clientX,y:vt.clientY},srcEvent:vt,pointerType:"mouse",target:vt.target})}}const KEY_EVENTS=["keydown","keyup"];class KeyInput extends Input{constructor(yt,vt,bt){super(yt,vt,{enable:!0,tabIndex:0,...bt}),this.handleEvent=Tt=>{const Et=Tt.target||Tt.srcElement;Et.tagName==="INPUT"&&Et.type==="text"||Et.tagName==="TEXTAREA"||(this.enableDownEvent&&Tt.type==="keydown"&&this.callback({type:"keydown",srcEvent:Tt,key:Tt.key,target:Tt.target}),this.enableUpEvent&&Tt.type==="keyup"&&this.callback({type:"keyup",srcEvent:Tt,key:Tt.key,target:Tt.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,yt.tabIndex=this.options.tabIndex,yt.style.outline="none",KEY_EVENTS.forEach(Tt=>yt.addEventListener(Tt,this.handleEvent))}destroy(){KEY_EVENTS.forEach(yt=>this.element.removeEventListener(yt,this.handleEvent))}enableEventType(yt,vt){yt==="keydown"&&(this.enableDownEvent=vt),yt==="keyup"&&(this.enableUpEvent=vt)}}class ContextmenuInput extends Input{constructor(yt,vt,bt){super(yt,vt,bt),this.handleEvent=Tt=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:Tt.clientX,y:Tt.clientY},srcEvent:Tt,pointerType:"mouse",target:Tt.target})},yt.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(yt,vt){yt==="contextmenu"&&(this.options.enable=vt)}}const DOWN_EVENT=1,MOVE_EVENT=2,UP_EVENT=4,MOUSE_EVENTS={pointerdown:DOWN_EVENT,pointermove:MOVE_EVENT,pointerup:UP_EVENT,mousedown:DOWN_EVENT,mousemove:MOVE_EVENT,mouseup:UP_EVENT},MOUSE_EVENT_BUTTON_LEFT=0,MOUSE_EVENT_BUTTON_MIDDLE=1,MOUSE_EVENT_BUTTON_RIGHT=2,MOUSE_EVENT_BUTTONS_LEFT_MASK=1,MOUSE_EVENT_BUTTONS_RIGHT_MASK=2,MOUSE_EVENT_BUTTONS_MIDDLE_MASK=4;function whichButtons(xt){const yt=MOUSE_EVENTS[xt.srcEvent.type];if(!yt)return null;const{buttons:vt,button:bt}=xt.srcEvent;let Tt=!1,Et=!1,wt=!1;return yt===MOVE_EVENT?(Tt=!!(vt&MOUSE_EVENT_BUTTONS_LEFT_MASK),Et=!!(vt&MOUSE_EVENT_BUTTONS_MIDDLE_MASK),wt=!!(vt&MOUSE_EVENT_BUTTONS_RIGHT_MASK)):(Tt=bt===MOUSE_EVENT_BUTTON_LEFT,Et=bt===MOUSE_EVENT_BUTTON_MIDDLE,wt=bt===MOUSE_EVENT_BUTTON_RIGHT),{leftButton:Tt,middleButton:Et,rightButton:wt}}function getOffsetPosition(xt,yt){const vt=xt.center;if(!vt)return null;const bt=yt.getBoundingClientRect(),Tt=bt.width/yt.offsetWidth||1,Et=bt.height/yt.offsetHeight||1,wt={x:(vt.x-bt.left-yt.clientLeft)/Tt,y:(vt.y-bt.top-yt.clientTop)/Et};return{center:vt,offsetCenter:wt}}const DEFAULT_OPTIONS={srcElement:"root",priority:0};class EventRegistrar{constructor(yt,vt){this.handleEvent=bt=>{if(this.isEmpty())return;const Tt=this._normalizeEvent(bt);let Et=bt.srcEvent.target;for(;Et&&Et!==Tt.rootElement;){if(this._emit(Tt,Et),Tt.handled)return;Et=Et.parentNode}this._emit(Tt,"root")},this.eventManager=yt,this.recognizerName=vt,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(yt,vt,bt,Tt=!1,Et=!1){const{handlers:wt,handlersByElement:St}=this,At={...DEFAULT_OPTIONS,...bt};let Rt=St.get(At.srcElement);Rt||(Rt=[],St.set(At.srcElement,Rt));const Pt={type:yt,handler:vt,srcElement:At.srcElement,priority:At.priority};Tt&&(Pt.once=!0),Et&&(Pt.passive=!0),wt.push(Pt),this._active=this._active||!Pt.passive;let Ct=Rt.length-1;for(;Ct>=0&&!(Rt[Ct].priority>=Pt.priority);)Ct--;Rt.splice(Ct+1,0,Pt)}remove(yt,vt){const{handlers:bt,handlersByElement:Tt}=this;for(let Et=bt.length-1;Et>=0;Et--){const wt=bt[Et];if(wt.type===yt&&wt.handler===vt){bt.splice(Et,1);const St=Tt.get(wt.srcElement);St.splice(St.indexOf(wt),1),St.length===0&&Tt.delete(wt.srcElement)}}this._active=bt.some(Et=>!Et.passive)}_emit(yt,vt){const bt=this.handlersByElement.get(vt);if(bt){let Tt=!1;const Et=()=>{yt.handled=!0},wt=()=>{yt.handled=!0,Tt=!0},St=[];for(let At=0;At<bt.length;At++){const{type:Rt,handler:Pt,once:Ct}=bt[At];if(Pt({...yt,type:Rt,stopPropagation:Et,stopImmediatePropagation:wt}),Ct&&St.push(bt[At]),Tt)break}for(let At=0;At<St.length;At++){const{type:Rt,handler:Pt}=St[At];this.remove(Rt,Pt)}}}_normalizeEvent(yt){const vt=this.eventManager.getElement();return{...yt,...whichButtons(yt),...getOffsetPosition(yt,vt),preventDefault:()=>{yt.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:vt}}}function normalizeRecognizer(xt){if("recognizer"in xt)return xt;let yt;const vt=Array.isArray(xt)?[...xt]:[xt];if(typeof vt[0]=="function"){const bt=vt.shift(),Tt=vt.shift()||{};yt=new bt(Tt)}else yt=vt.shift();return{recognizer:yt,recognizeWith:typeof vt[0]=="string"?[vt[0]]:vt[0],requireFailure:typeof vt[1]=="string"?[vt[1]]:vt[1]}}class EventManager{constructor(yt=null,vt={}){if(this._onBasicInput=bt=>{this.manager.emit(bt.srcEvent.type,bt)},this._onOtherEvent=bt=>{this.manager.emit(bt.type,bt)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...vt},this.events=new Map,this.element=yt,!!yt){this.manager=new Manager(yt,this.options);for(const bt of this.options.recognizers){const{recognizer:Tt,recognizeWith:Et,requireFailure:wt}=normalizeRecognizer(bt);this.manager.add(Tt),Et&&Tt.recognizeWith(Et),wt&&Tt.requireFailure(wt)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new WheelInput(yt,this._onOtherEvent,{enable:!1}),this.moveInput=new MoveInput(yt,this._onOtherEvent,{enable:!1}),this.keyInput=new KeyInput(yt,this._onOtherEvent,{enable:!1,tabIndex:vt.tabIndex}),this.contextmenuInput=new ContextmenuInput(yt,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(yt,vt,bt){this._addEventHandler(yt,vt,bt,!1)}once(yt,vt,bt){this._addEventHandler(yt,vt,bt,!0)}watch(yt,vt,bt){this._addEventHandler(yt,vt,bt,!1,!0)}off(yt,vt){this._removeEventHandler(yt,vt)}_toggleRecognizer(yt,vt){var Et,wt,St,At;const{manager:bt}=this;if(!bt)return;const Tt=bt.get(yt);Tt&&(Tt.set({enable:vt}),bt.touchAction.update()),(Et=this.wheelInput)==null||Et.enableEventType(yt,vt),(wt=this.moveInput)==null||wt.enableEventType(yt,vt),(St=this.keyInput)==null||St.enableEventType(yt,vt),(At=this.contextmenuInput)==null||At.enableEventType(yt,vt)}_addEventHandler(yt,vt,bt,Tt,Et){if(typeof yt!="string"){bt=vt;for(const[Rt,Pt]of Object.entries(yt))this._addEventHandler(Rt,Pt,bt,Tt,Et);return}const{manager:wt,events:St}=this;if(!wt)return;let At=St.get(yt);if(!At){const Rt=this._getRecognizerName(yt)||yt;At=new EventRegistrar(this,Rt),St.set(yt,At),wt&&wt.on(yt,At.handleEvent)}At.add(yt,vt,bt,Tt,Et),At.isEmpty()||this._toggleRecognizer(At.recognizerName,!0)}_removeEventHandler(yt,vt){if(typeof yt!="string"){for(const[Et,wt]of Object.entries(yt))this._removeEventHandler(Et,wt);return}const{events:bt}=this,Tt=bt.get(yt);if(Tt&&(Tt.remove(yt,vt),Tt.isEmpty())){const{recognizerName:Et}=Tt;let wt=!1;for(const St of bt.values())if(St.recognizerName===Et&&!St.isEmpty()){wt=!0;break}wt||this._toggleRecognizer(Et,!1)}}_getRecognizerName(yt){var vt;return(vt=this.manager.recognizers.find(bt=>bt.getEventNames().includes(yt)))==null?void 0:vt.options.event}}const COORDINATE_SYSTEM={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(COORDINATE_SYSTEM,"IDENTITY",{get:()=>(defaultLogger.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const PROJECTION_MODE={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},UNIT={common:0,meters:1,pixels:2},EVENT_HANDLERS={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},RECOGNIZERS={multipan:[PanRecognizer,{threshold:10,direction:InputDirection.Vertical,pointers:2}],pinch:[PinchRecognizer,{},null,["multipan"]],pan:[PanRecognizer,{threshold:1},["pinch"],["multipan"]],dblclick:[TapRecognizer,{event:"dblclick",taps:2}],click:[TapRecognizer,{event:"click"},null,["dblclick"]]};function isEqual(xt,yt){if(xt===yt)return!0;if(Array.isArray(xt)){const vt=xt.length;if(!yt||yt.length!==vt)return!1;for(let bt=0;bt<vt;bt++)if(xt[bt]!==yt[bt])return!1;return!0}return!1}function memoize(xt){let yt={},vt;return bt=>{for(const Tt in bt)if(!isEqual(bt[Tt],yt[Tt])){vt=xt(bt),yt=bt;break}return vt}}const ZERO_VECTOR$1=[0,0,0,0],VECTOR_TO_POINT_MATRIX$1=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],IDENTITY_MATRIX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],DEFAULT_PIXELS_PER_UNIT2=[0,0,0],DEFAULT_COORDINATE_ORIGIN$1=[0,0,0],getMemoizedViewportUniforms=memoize(calculateViewportUniforms);function getOffsetOrigin(xt,yt,vt=DEFAULT_COORDINATE_ORIGIN$1){vt.length<3&&(vt=[vt[0],vt[1],0]);let bt=vt,Tt,Et=!0;switch(yt===COORDINATE_SYSTEM.LNGLAT_OFFSETS||yt===COORDINATE_SYSTEM.METER_OFFSETS?Tt=vt:Tt=xt.isGeospatial?[Math.fround(xt.longitude),Math.fround(xt.latitude),0]:null,xt.projectionMode){case PROJECTION_MODE.WEB_MERCATOR:(yt===COORDINATE_SYSTEM.LNGLAT||yt===COORDINATE_SYSTEM.CARTESIAN)&&(Tt=[0,0,0],Et=!1);break;case PROJECTION_MODE.WEB_MERCATOR_AUTO_OFFSET:yt===COORDINATE_SYSTEM.LNGLAT?bt=Tt:yt===COORDINATE_SYSTEM.CARTESIAN&&(bt=[Math.fround(xt.center[0]),Math.fround(xt.center[1]),0],Tt=xt.unprojectPosition(bt),bt[0]-=vt[0],bt[1]-=vt[1],bt[2]-=vt[2]);break;case PROJECTION_MODE.IDENTITY:bt=xt.position.map(Math.fround),bt[2]=bt[2]||0;break;case PROJECTION_MODE.GLOBE:Et=!1,Tt=null;break;default:Et=!1}return{geospatialOrigin:Tt,shaderCoordinateOrigin:bt,offsetMode:Et}}function calculateMatrixAndOffset(xt,yt,vt){const{viewMatrixUncentered:bt,projectionMatrix:Tt}=xt;let{viewMatrix:Et,viewProjectionMatrix:wt}=xt,St=ZERO_VECTOR$1,At=ZERO_VECTOR$1,Rt=xt.cameraPosition;const{geospatialOrigin:Pt,shaderCoordinateOrigin:Ct,offsetMode:It}=getOffsetOrigin(xt,yt,vt);return It&&(At=xt.projectPosition(Pt||Ct),Rt=[Rt[0]-At[0],Rt[1]-At[1],Rt[2]-At[2]],At[3]=1,St=transformMat4([],At,wt),Et=bt||Et,wt=multiply([],Tt,Et),wt=multiply([],wt,VECTOR_TO_POINT_MATRIX$1)),{viewMatrix:Et,viewProjectionMatrix:wt,projectionCenter:St,originCommon:At,cameraPosCommon:Rt,shaderCoordinateOrigin:Ct,geospatialOrigin:Pt}}function getUniformsFromViewport({viewport:xt,devicePixelRatio:yt=1,modelMatrix:vt=null,coordinateSystem:bt=COORDINATE_SYSTEM.DEFAULT,coordinateOrigin:Tt=DEFAULT_COORDINATE_ORIGIN$1,autoWrapLongitude:Et=!1}){bt===COORDINATE_SYSTEM.DEFAULT&&(bt=xt.isGeospatial?COORDINATE_SYSTEM.LNGLAT:COORDINATE_SYSTEM.CARTESIAN);const wt=getMemoizedViewportUniforms({viewport:xt,devicePixelRatio:yt,coordinateSystem:bt,coordinateOrigin:Tt});return wt.wrapLongitude=Et,wt.modelMatrix=vt||IDENTITY_MATRIX,wt}function calculateViewportUniforms({viewport:xt,devicePixelRatio:yt,coordinateSystem:vt,coordinateOrigin:bt}){const{projectionCenter:Tt,viewProjectionMatrix:Et,originCommon:wt,cameraPosCommon:St,shaderCoordinateOrigin:At,geospatialOrigin:Rt}=calculateMatrixAndOffset(xt,vt,bt),Pt=xt.getDistanceScales(),Ct=[xt.width*yt,xt.height*yt],It=transformMat4([],[0,0,-xt.focalDistance,1],xt.projectionMatrix)[3]||1,Mt={coordinateSystem:vt,projectionMode:xt.projectionMode,coordinateOrigin:At,commonOrigin:wt.slice(0,3),center:Tt,pseudoMeters:!!xt._pseudoMeters,viewportSize:Ct,devicePixelRatio:yt,focalDistance:It,commonUnitsPerMeter:Pt.unitsPerMeter,commonUnitsPerWorldUnit:Pt.unitsPerMeter,commonUnitsPerWorldUnit2:DEFAULT_PIXELS_PER_UNIT2,scale:xt.scale,wrapLongitude:!1,viewProjectionMatrix:Et,modelMatrix:IDENTITY_MATRIX,cameraPosition:St};if(Rt){const Ot=xt.getDistanceScales(Rt);switch(vt){case COORDINATE_SYSTEM.METER_OFFSETS:Mt.commonUnitsPerWorldUnit=Ot.unitsPerMeter,Mt.commonUnitsPerWorldUnit2=Ot.unitsPerMeter2;break;case COORDINATE_SYSTEM.LNGLAT:case COORDINATE_SYSTEM.LNGLAT_OFFSETS:xt._pseudoMeters||(Mt.commonUnitsPerMeter=Ot.unitsPerMeter),Mt.commonUnitsPerWorldUnit=Ot.unitsPerDegree,Mt.commonUnitsPerWorldUnit2=Ot.unitsPerDegree2;break;case COORDINATE_SYSTEM.CARTESIAN:Mt.commonUnitsPerWorldUnit=[1,1,Ot.unitsPerMeter[2]],Mt.commonUnitsPerWorldUnit2=[0,0,Ot.unitsPerMeter2[2]];break}}return Mt}const COORDINATE_SYSTEM_WGSL_CONSTANTS=Object.keys(COORDINATE_SYSTEM).map(xt=>`const COORDINATE_SYSTEM_${xt}: i32 = ${COORDINATE_SYSTEM[xt]};`).join(""),PROJECTION_MODE_WGSL_CONSTANTS=Object.keys(PROJECTION_MODE).map(xt=>`const PROJECTION_MODE_${xt}: i32 = ${PROJECTION_MODE[xt]};`).join(""),UNIT_WGSL_CONSTANTS=Object.keys(UNIT).map(xt=>`const UNIT_${xt.toUpperCase()}: i32 = ${UNIT[xt]};`).join(""),projectWGSLHeader=`${COORDINATE_SYSTEM_WGSL_CONSTANTS}
${PROJECTION_MODE_WGSL_CONSTANTS}
${UNIT_WGSL_CONSTANTS}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,projectWGSL=`${projectWGSLHeader}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,COORDINATE_SYSTEM_GLSL_CONSTANTS=Object.keys(COORDINATE_SYSTEM).map(xt=>`const int COORDINATE_SYSTEM_${xt} = ${COORDINATE_SYSTEM[xt]};`).join(""),PROJECTION_MODE_GLSL_CONSTANTS=Object.keys(PROJECTION_MODE).map(xt=>`const int PROJECTION_MODE_${xt} = ${PROJECTION_MODE[xt]};`).join(""),UNIT_GLSL_CONSTANTS=Object.keys(UNIT).map(xt=>`const int UNIT_${xt.toUpperCase()} = ${UNIT[xt]};`).join(""),projectGLSL=`${COORDINATE_SYSTEM_GLSL_CONSTANTS}
${PROJECTION_MODE_GLSL_CONSTANTS}
${UNIT_GLSL_CONSTANTS}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,INITIAL_MODULE_OPTIONS={};function getUniforms(xt=INITIAL_MODULE_OPTIONS){return"viewport"in xt?getUniformsFromViewport(xt):{}}const project={name:"project",dependencies:[fp32,geometry],source:projectWGSL,vs:projectGLSL,getUniforms,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},source$1=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,vs$7=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,project32={name:"project32",dependencies:[project],source:source$1,vs:vs$7};function createMat4$1(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function transformVector(xt,yt){const vt=transformMat4([],yt,xt);return scale(vt,vt,1/vt[3]),vt}function mod(xt,yt){const vt=xt%yt;return vt<0?yt+vt:vt}function clamp(xt,yt,vt){return xt<yt?yt:xt>vt?vt:xt}function ieLog2(xt){return Math.log(xt)*Math.LOG2E}const log2=Math.log2||ieLog2;function assert$1(xt,yt){if(!xt)throw new Error(yt||"@math.gl/web-mercator: assertion failed.")}const PI=Math.PI,PI_4=PI/4,DEGREES_TO_RADIANS$2=PI/180,RADIANS_TO_DEGREES=180/PI,TILE_SIZE$1=512,EARTH_CIRCUMFERENCE=4003e4,MAX_LATITUDE=85.051129,DEFAULT_ALTITUDE=1.5;function scaleToZoom(xt){return log2(xt)}function lngLatToWorld(xt){const[yt,vt]=xt;assert$1(Number.isFinite(yt)),assert$1(Number.isFinite(vt)&&vt>=-90&&vt<=90,"invalid latitude");const bt=yt*DEGREES_TO_RADIANS$2,Tt=vt*DEGREES_TO_RADIANS$2,Et=TILE_SIZE$1*(bt+PI)/(2*PI),wt=TILE_SIZE$1*(PI+Math.log(Math.tan(PI_4+Tt*.5)))/(2*PI);return[Et,wt]}function worldToLngLat(xt){const[yt,vt]=xt,bt=yt/TILE_SIZE$1*(2*PI)-PI,Tt=2*(Math.atan(Math.exp(vt/TILE_SIZE$1*(2*PI)-PI))-PI_4);return[bt*RADIANS_TO_DEGREES,Tt*RADIANS_TO_DEGREES]}function getMeterZoom(xt){const{latitude:yt}=xt;assert$1(Number.isFinite(yt));const vt=Math.cos(yt*DEGREES_TO_RADIANS$2);return scaleToZoom(EARTH_CIRCUMFERENCE*vt)-9}function unitsPerMeter(xt){const yt=Math.cos(xt*DEGREES_TO_RADIANS$2);return TILE_SIZE$1/EARTH_CIRCUMFERENCE/yt}function getDistanceScales(xt){const{latitude:yt,longitude:vt,highPrecision:bt=!1}=xt;assert$1(Number.isFinite(yt)&&Number.isFinite(vt));const Tt=TILE_SIZE$1,Et=Math.cos(yt*DEGREES_TO_RADIANS$2),wt=Tt/360,St=wt/Et,At=Tt/EARTH_CIRCUMFERENCE/Et,Rt={unitsPerMeter:[At,At,At],metersPerUnit:[1/At,1/At,1/At],unitsPerDegree:[wt,St,At],degreesPerUnit:[1/wt,1/St,1/At]};if(bt){const Pt=DEGREES_TO_RADIANS$2*Math.tan(yt*DEGREES_TO_RADIANS$2)/Et,Ct=wt*Pt/2,It=Tt/EARTH_CIRCUMFERENCE*Pt,Mt=It/St*At;Rt.unitsPerDegree2=[0,Ct,It],Rt.unitsPerMeter2=[Mt,0,Mt]}return Rt}function addMetersToLngLat(xt,yt){const[vt,bt,Tt]=xt,[Et,wt,St]=yt,{unitsPerMeter:At,unitsPerMeter2:Rt}=getDistanceScales({longitude:vt,latitude:bt,highPrecision:!0}),Pt=lngLatToWorld(xt);Pt[0]+=Et*(At[0]+Rt[0]*wt),Pt[1]+=wt*(At[1]+Rt[1]*wt);const Ct=worldToLngLat(Pt),It=(Tt||0)+(St||0);return Number.isFinite(Tt)||Number.isFinite(St)?[Ct[0],Ct[1],It]:Ct}function getViewMatrix(xt){const{height:yt,pitch:vt,bearing:bt,altitude:Tt,scale:Et,center:wt}=xt,St=createMat4$1();translate(St,St,[0,0,-Tt]),rotateX(St,St,-vt*DEGREES_TO_RADIANS$2),rotateZ(St,St,bt*DEGREES_TO_RADIANS$2);const At=Et/yt;return scale$1(St,St,[At,At,At]),wt&&translate(St,St,negate([],wt)),St}function getProjectionParameters(xt){const{width:yt,height:vt,altitude:bt,pitch:Tt=0,offset:Et,center:wt,scale:St,nearZMultiplier:At=1,farZMultiplier:Rt=1}=xt;let{fovy:Pt=altitudeToFovy(DEFAULT_ALTITUDE)}=xt;bt!==void 0&&(Pt=altitudeToFovy(bt));const Ct=Pt*DEGREES_TO_RADIANS$2,It=Tt*DEGREES_TO_RADIANS$2,Mt=fovyToAltitude(Pt);let Ot=Mt;wt&&(Ot+=wt[2]*St/Math.cos(It)/vt);const kt=Ct*(.5+(Et?Et[1]:0)/vt),Ft=Math.sin(kt)*Ot/Math.sin(clamp(Math.PI/2-It-kt,.01,Math.PI-.01)),Nt=Math.sin(It)*Ft+Ot,Lt=Ot*10,Dt=Math.min(Nt*Rt,Lt);return{fov:Ct,aspect:yt/vt,focalDistance:Mt,near:At,far:Dt}}function altitudeToFovy(xt){return 2*Math.atan(.5/xt)*RADIANS_TO_DEGREES}function fovyToAltitude(xt){return .5/Math.tan(.5*xt*DEGREES_TO_RADIANS$2)}function worldToPixels(xt,yt){const[vt,bt,Tt=0]=xt;return assert$1(Number.isFinite(vt)&&Number.isFinite(bt)&&Number.isFinite(Tt)),transformVector(yt,[vt,bt,Tt,1])}function pixelsToWorld(xt,yt,vt=0){const[bt,Tt,Et]=xt;if(assert$1(Number.isFinite(bt)&&Number.isFinite(Tt),"invalid pixel coordinate"),Number.isFinite(Et))return transformVector(yt,[bt,Tt,Et,1]);const wt=transformVector(yt,[bt,Tt,0,1]),St=transformVector(yt,[bt,Tt,1,1]),At=wt[2],Rt=St[2],Pt=At===Rt?0:((vt||0)-At)/(Rt-At);return lerp([],wt,St,Pt)}function fitBounds(xt){const{width:yt,height:vt,bounds:bt,minExtent:Tt=0,maxZoom:Et=24,offset:wt=[0,0]}=xt,[[St,At],[Rt,Pt]]=bt,Ct=getPaddingObject(xt.padding),It=lngLatToWorld([St,clamp(Pt,-MAX_LATITUDE,MAX_LATITUDE)]),Mt=lngLatToWorld([Rt,clamp(At,-MAX_LATITUDE,MAX_LATITUDE)]),Ot=[Math.max(Math.abs(Mt[0]-It[0]),Tt),Math.max(Math.abs(Mt[1]-It[1]),Tt)],kt=[yt-Ct.left-Ct.right-Math.abs(wt[0])*2,vt-Ct.top-Ct.bottom-Math.abs(wt[1])*2];assert$1(kt[0]>0&&kt[1]>0);const Ft=kt[0]/Ot[0],Nt=kt[1]/Ot[1],Lt=(Ct.right-Ct.left)/2/Ft,Dt=(Ct.top-Ct.bottom)/2/Nt,$t=[(Mt[0]+It[0])/2+Lt,(Mt[1]+It[1])/2+Dt],zt=worldToLngLat($t),Ut=Math.min(Et,log2(Math.abs(Math.min(Ft,Nt))));return assert$1(Number.isFinite(Ut)),{longitude:zt[0],latitude:zt[1],zoom:Ut}}function getPaddingObject(xt=0){return typeof xt=="number"?{top:xt,bottom:xt,left:xt,right:xt}:(assert$1(Number.isFinite(xt.top)&&Number.isFinite(xt.bottom)&&Number.isFinite(xt.left)&&Number.isFinite(xt.right)),xt)}const DEGREES_TO_RADIANS$1=Math.PI/180;function getBounds(xt,yt=0){const{width:vt,height:bt,unproject:Tt}=xt,Et={targetZ:yt},wt=Tt([0,bt],Et),St=Tt([vt,bt],Et);let At,Rt;const Pt=xt.fovy?.5*xt.fovy*DEGREES_TO_RADIANS$1:Math.atan(.5/xt.altitude),Ct=(90-xt.pitch)*DEGREES_TO_RADIANS$1;return Pt>Ct-.01?(At=unprojectOnFarPlane(xt,0,yt),Rt=unprojectOnFarPlane(xt,vt,yt)):(At=Tt([0,0],Et),Rt=Tt([vt,0],Et)),[wt,St,Rt,At]}function unprojectOnFarPlane(xt,yt,vt){const{pixelUnprojectionMatrix:bt}=xt,Tt=transformVector(bt,[yt,0,1,1]),Et=transformVector(bt,[yt,xt.height,1,1]),St=(vt*xt.distanceScales.unitsPerMeter[2]-Tt[2])/(Et[2]-Tt[2]),At=lerp([],Tt,Et,St),Rt=worldToLngLat(At);return Rt.push(vt),Rt}const TILE_SIZE=512;function normalizeViewportProps(xt){const{width:yt,height:vt,pitch:bt=0}=xt;let{longitude:Tt,latitude:Et,zoom:wt,bearing:St=0}=xt;(Tt<-180||Tt>180)&&(Tt=mod(Tt+180,360)-180),(St<-180||St>180)&&(St=mod(St+180,360)-180);const At=log2(vt/TILE_SIZE);if(wt<=At)wt=At,Et=0;else{const Rt=vt/2/Math.pow(2,wt),Pt=worldToLngLat([0,Rt])[1];if(Et<Pt)Et=Pt;else{const Ct=worldToLngLat([0,TILE_SIZE-Rt])[1];Et>Ct&&(Et=Ct)}}return{width:yt,height:vt,longitude:Tt,latitude:Et,zoom:wt,pitch:bt,bearing:St}}const uniformBlock$7=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,vertex=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,vs$6=`
${uniformBlock$7}
${vertex}
`,fragment=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,fs$7=`
${uniformBlock$7}
${fragment}
`,getMemoizedViewportCenterPosition=memoize(getViewportCenterPosition),getMemoizedViewProjectionMatrices=memoize(getViewProjectionMatrices),DEFAULT_SHADOW_COLOR$1=[0,0,0,1],VECTOR_TO_POINT_MATRIX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function screenToCommonSpace(xt,yt){const[vt,bt,Tt]=xt,Et=pixelsToWorld([vt,bt,Tt],yt);return Number.isFinite(Tt)?Et:[Et[0],Et[1],0]}function getViewportCenterPosition({viewport:xt,center:yt}){return new Matrix4(xt.viewProjectionMatrix).invert().transform(yt)}function getViewProjectionMatrices({viewport:xt,shadowMatrices:yt}){const vt=[],bt=xt.pixelUnprojectionMatrix,Tt=xt.isGeospatial?void 0:1,Et=[[0,0,Tt],[xt.width,0,Tt],[0,xt.height,Tt],[xt.width,xt.height,Tt],[0,0,-1],[xt.width,0,-1],[0,xt.height,-1],[xt.width,xt.height,-1]].map(wt=>screenToCommonSpace(wt,bt));for(const wt of yt){const St=wt.clone().translate(new Vector3(xt.center).negate()),At=Et.map(Pt=>St.transform(Pt)),Rt=new Matrix4().ortho({left:Math.min(...At.map(Pt=>Pt[0])),right:Math.max(...At.map(Pt=>Pt[0])),bottom:Math.min(...At.map(Pt=>Pt[1])),top:Math.max(...At.map(Pt=>Pt[1])),near:Math.min(...At.map(Pt=>-Pt[2])),far:Math.max(...At.map(Pt=>-Pt[2]))});vt.push(Rt.multiplyRight(wt))}return vt}function createShadowUniforms(xt){const{shadowEnabled:yt=!0,project:vt}=xt;if(!yt||!vt||!xt.shadowMatrices||!xt.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:xt.dummyShadowMap,shadow_uShadowMap1:xt.dummyShadowMap};const bt=project.getUniforms(vt),Tt=getMemoizedViewportCenterPosition({viewport:vt.viewport,center:bt.center}),Et=[],wt=getMemoizedViewProjectionMatrices({shadowMatrices:xt.shadowMatrices,viewport:vt.viewport}).slice();for(let At=0;At<xt.shadowMatrices.length;At++){const Rt=wt[At],Pt=Rt.clone().translate(new Vector3(vt.viewport.center).negate());bt.coordinateSystem===COORDINATE_SYSTEM.LNGLAT&&bt.projectionMode===PROJECTION_MODE.WEB_MERCATOR?(wt[At]=Pt,Et[At]=Tt):(wt[At]=Rt.clone().multiplyRight(VECTOR_TO_POINT_MATRIX),Et[At]=Pt.transform(Tt))}const St={drawShadowMap:!!xt.drawToShadowMap,useShadowMap:xt.shadowMaps?xt.shadowMaps.length>0:!1,color:xt.shadowColor||DEFAULT_SHADOW_COLOR$1,lightId:xt.shadowLightId||0,lightCount:xt.shadowMatrices.length,shadow_uShadowMap0:xt.dummyShadowMap,shadow_uShadowMap1:xt.dummyShadowMap};for(let At=0;At<wt.length;At++)St[`viewProjectionMatrix${At}`]=wt[At],St[`projectCenter${At}`]=Et[At];for(let At=0;At<2;At++)St[`shadow_uShadowMap${At}`]=xt.shadowMaps&&xt.shadowMaps[At]||xt.dummyShadowMap;return St}const shadow={name:"shadow",dependencies:[project],vs:vs$6,fs:fs$7,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:createShadowUniforms,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},picking={...picking$1,defaultUniforms:{...picking$1.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},DEFAULT_MODULES=[geometry],SHADER_HOOKS_GLSL=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],SHADER_HOOKS_WGSL=[];function getShaderAssembler(xt){const yt=ShaderAssembler.getDefaultShaderAssembler();for(const bt of DEFAULT_MODULES)yt.addDefaultModule(bt);const vt=xt==="glsl"?SHADER_HOOKS_GLSL:SHADER_HOOKS_WGSL;for(const bt of vt)yt.addShaderHook(bt);return yt}const DEFAULT_LIGHT_COLOR$1=[255,255,255],DEFAULT_LIGHT_INTENSITY$1=1;let idCount$1=0;class AmbientLight{constructor(yt={}){this.type="ambient";const{color:vt=DEFAULT_LIGHT_COLOR$1}=yt,{intensity:bt=DEFAULT_LIGHT_INTENSITY$1}=yt;this.id=yt.id||`ambient-${idCount$1++}`,this.color=vt,this.intensity=bt}}const DEFAULT_LIGHT_COLOR=[255,255,255],DEFAULT_LIGHT_INTENSITY=1,DEFAULT_LIGHT_DIRECTION=[0,0,-1];let idCount=0;class DirectionalLight{constructor(yt={}){this.type="directional";const{color:vt=DEFAULT_LIGHT_COLOR}=yt,{intensity:bt=DEFAULT_LIGHT_INTENSITY}=yt,{direction:Tt=DEFAULT_LIGHT_DIRECTION}=yt,{_shadow:Et=!1}=yt;this.id=yt.id||`directional-${idCount++}`,this.color=vt,this.intensity=bt,this.type="directional",this.direction=new Vector3(Tt).normalize().toArray(),this.shadow=Et}getProjectedLight(yt){return this}}class Pass{constructor(yt,vt={id:"pass"}){const{id:bt}=vt;this.id=bt,this.device=yt,this.props={...vt}}setProps(yt){Object.assign(this.props,yt)}render(yt){}cleanup(){}}class LayersPass extends Pass{constructor(){super(...arguments),this._lastRenderIndex=-1}render(yt){const[vt,bt]=this.device.canvasContext.getDrawingBufferSize(),Tt=yt.clearCanvas??!0,Et=yt.clearColor??(Tt?[0,0,0,0]:!1),wt=Tt?1:!1,St=Tt?0:!1,At=yt.colorMask??15,Rt={viewport:[0,0,vt,bt]};yt.colorMask&&(Rt.colorMask=At),yt.scissorRect&&(Rt.scissorRect=yt.scissorRect);const Pt=this.device.beginRenderPass({framebuffer:yt.target,parameters:Rt,clearColor:Et,clearDepth:wt,clearStencil:St});try{return this._drawLayers(Pt,yt)}finally{Pt.end(),this.device.submit()}}_drawLayers(yt,vt){const{target:bt,shaderModuleProps:Tt,viewports:Et,views:wt,onViewportActive:St,clearStack:At=!0}=vt;vt.pass=vt.pass||"unknown",At&&(this._lastRenderIndex=-1);const Rt=[];for(const Pt of Et){const Ct=wt&&wt[Pt.id];St==null||St(Pt);const It=this._getDrawLayerParams(Pt,vt),Mt=Pt.subViewports||[Pt];for(const Ot of Mt){const kt=this._drawLayersInViewport(yt,{target:bt,shaderModuleProps:Tt,viewport:Ot,view:Ct,pass:vt.pass,layers:vt.layers},It);Rt.push(kt)}}return Rt}_getDrawLayerParams(yt,{layers:vt,pass:bt,isPicking:Tt=!1,layerFilter:Et,cullRect:wt,effects:St,shaderModuleProps:At},Rt=!1){var Ot;const Pt=[],Ct=layerIndexResolver(this._lastRenderIndex+1),It={layer:vt[0],viewport:yt,isPicking:Tt,renderPass:bt,cullRect:wt},Mt={};for(let kt=0;kt<vt.length;kt++){const Ft=vt[kt],Nt=this._shouldDrawLayer(Ft,It,Et,Mt),Lt={shouldDrawLayer:Nt};Nt&&!Rt&&(Lt.shouldDrawLayer=!0,Lt.layerRenderIndex=Ct(Ft,Nt),Lt.shaderModuleProps=this._getShaderModuleProps(Ft,St,bt,At),Lt.layerParameters={...(Ot=Ft.context.deck)==null?void 0:Ot.props.parameters,...this.getLayerParameters(Ft,kt,yt)}),Pt[kt]=Lt}return Pt}_drawLayersInViewport(yt,{layers:vt,shaderModuleProps:bt,pass:Tt,target:Et,viewport:wt,view:St},At){const Rt=getGLViewport(this.device,{shaderModuleProps:bt,target:Et,viewport:wt});if(St&&St.props.clear){const Ct=St.props.clear===!0?{color:!0,depth:!0}:St.props.clear;this.device.beginRenderPass({framebuffer:Et,parameters:{viewport:Rt,scissorRect:Rt},clearColor:Ct.color?[0,0,0,0]:!1,clearDepth:Ct.depth?1:!1}).end()}const Pt={totalCount:vt.length,visibleCount:0,compositeCount:0,pickableCount:0};yt.setParameters({viewport:Rt});for(let Ct=0;Ct<vt.length;Ct++){const It=vt[Ct],Mt=At[Ct],{shouldDrawLayer:Ot}=Mt;if(Ot&&It.props.pickable&&Pt.pickableCount++,It.isComposite&&Pt.compositeCount++,It.isDrawable&&Mt.shouldDrawLayer){const{layerRenderIndex:kt,shaderModuleProps:Ft,layerParameters:Nt}=Mt;Pt.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,kt),Ft.project&&(Ft.project.viewport=wt),It.context.renderPass=yt;try{It._drawLayer({renderPass:yt,shaderModuleProps:Ft,uniforms:{layerIndex:kt},parameters:Nt})}catch(Lt){It.raiseError(Lt,`drawing ${It} to ${Tt}`)}}}return Pt}shouldDrawLayer(yt){return!0}getShaderModuleProps(yt,vt,bt){return null}getLayerParameters(yt,vt,bt){return yt.props.parameters}_shouldDrawLayer(yt,vt,bt,Tt){if(!(yt.props.visible&&this.shouldDrawLayer(yt)))return!1;vt.layer=yt;let wt=yt.parent;for(;wt;){if(!wt.props.visible||!wt.filterSubLayer(vt))return!1;vt.layer=wt,wt=wt.parent}if(bt){const St=vt.layer.id;if(St in Tt||(Tt[St]=bt(vt)),!Tt[St])return!1}return yt.activateViewport(vt.viewport),!0}_getShaderModuleProps(yt,vt,bt,Tt){var At,Rt;const Et=this.device.canvasContext.cssToDeviceRatio(),wt=((At=yt.internalState)==null?void 0:At.propsInTransition)||yt.props,St={layer:wt,picking:{isActive:!1},project:{viewport:yt.context.viewport,devicePixelRatio:Et,modelMatrix:wt.modelMatrix,coordinateSystem:wt.coordinateSystem,coordinateOrigin:wt.coordinateOrigin,autoWrapLongitude:yt.wrapLongitude}};if(vt)for(const Pt of vt)mergeModuleParameters(St,(Rt=Pt.getShaderModuleProps)==null?void 0:Rt.call(Pt,yt,St));return mergeModuleParameters(St,this.getShaderModuleProps(yt,vt,St),Tt)}}function layerIndexResolver(xt=0,yt={}){const vt={},bt=(Tt,Et)=>{const wt=Tt.props._offset,St=Tt.id,At=Tt.parent&&Tt.parent.id;let Rt;if(At&&!(At in yt)&&bt(Tt.parent,!1),At in vt){const Pt=vt[At]=vt[At]||layerIndexResolver(yt[At],yt);Rt=Pt(Tt,Et),vt[St]=Pt}else Number.isFinite(wt)?(Rt=wt+(yt[At]||0),vt[St]=null):Rt=xt;return Et&&Rt>=xt&&(xt=Rt+1),yt[St]=Rt,Rt};return bt}function getGLViewport(xt,{shaderModuleProps:yt,target:vt,viewport:bt}){var At;const Tt=((At=yt==null?void 0:yt.project)==null?void 0:At.devicePixelRatio)??xt.canvasContext.cssToDeviceRatio(),[,Et]=xt.canvasContext.getDrawingBufferSize(),wt=vt?vt.height:Et,St=bt;return[St.x*Tt,wt-(St.y+St.height)*Tt,St.width*Tt,St.height*Tt]}function mergeModuleParameters(xt,...yt){for(const vt of yt)if(vt)for(const bt in vt)xt[bt]?Object.assign(xt[bt],vt[bt]):xt[bt]=vt[bt];return xt}class ShadowPass extends LayersPass{constructor(yt,vt){super(yt,vt);const bt=yt.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),Tt=yt.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=yt.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[bt],depthStencilAttachment:Tt})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(yt){const vt=this.fbo,bt=this.device.canvasContext.cssToDeviceRatio(),Tt=yt.viewports[0],Et=Tt.width*bt,wt=Tt.height*bt,St=[1,1,1,1];(Et!==vt.width||wt!==vt.height)&&vt.resize({width:Et,height:wt}),super.render({...yt,clearColor:St,target:vt,pass:"shadow"})}getLayerParameters(yt,vt,bt){return{...yt.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(yt){return yt.props.shadowEnabled!==!1}getShaderModuleProps(yt,vt,bt){return{shadow:{project:bt.project,drawToShadowMap:!0}}}}const DEFAULT_AMBIENT_LIGHT_PROPS={color:[255,255,255],intensity:1},DEFAULT_DIRECTIONAL_LIGHT_PROPS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],DEFAULT_SHADOW_COLOR=[0,0,0,200/255];class LightingEffect{constructor(yt={}){this.id="lighting-effect",this.shadowColor=DEFAULT_SHADOW_COLOR,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(yt)}setup(yt){this.context=yt;const{device:vt,deck:bt}=yt;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(vt),bt._addDefaultShaderModule(shadow),this.dummyShadowMap=vt.createTexture({width:1,height:1}))}setProps(yt){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const vt in yt){const bt=yt[vt];switch(bt.type){case"ambient":this.ambientLight=bt;break;case"directional":this.directionalLights.push(bt);break;case"point":this.pointLights.push(bt);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(vt=>vt.shadow),this.context&&this.setup(this.context),this.props=yt}preRender({layers:yt,layerFilter:vt,viewports:bt,onViewportActive:Tt,views:Et}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let wt=0;wt<this.shadowPasses.length;wt++)this.shadowPasses[wt].render({layers:yt,layerFilter:vt,viewports:bt,onViewportActive:Tt,views:Et,shaderModuleProps:{shadow:{shadowLightId:wt,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(yt,vt){const bt=this.shadow?{project:vt.project,shadowMaps:this.shadowPasses.map(wt=>wt.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},Tt={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(wt=>wt.getProjectedLight({layer:yt})),pointLights:this.pointLights.map(wt=>wt.getProjectedLight({layer:yt}))},Et=yt.props.material;return{shadow:bt,lighting:Tt,phongMaterial:Et,gouraudMaterial:Et}}cleanup(yt){for(const vt of this.shadowPasses)vt.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,yt.deck._removeDefaultShaderModule(shadow))}_calculateMatrices(){const yt=[];for(const vt of this.directionalLights){const bt=new Matrix4().lookAt({eye:new Vector3(vt.direction).negate()});yt.push(bt)}return yt}_createShadowPasses(yt){for(let vt=0;vt<this.directionalLights.length;vt++){const bt=new ShadowPass(yt);this.shadowPasses[vt]=bt}}_applyDefaultLights(){const{ambientLight:yt,pointLights:vt,directionalLights:bt}=this;!yt&&vt.length===0&&bt.length===0&&(this.ambientLight=new AmbientLight(DEFAULT_AMBIENT_LIGHT_PROPS),this.directionalLights.push(new DirectionalLight(DEFAULT_DIRECTIONAL_LIGHT_PROPS[0]),new DirectionalLight(DEFAULT_DIRECTIONAL_LIGHT_PROPS[1])))}}class TypedArrayManager{constructor(yt={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(yt)}setOptions(yt){Object.assign(this.opts,yt)}allocate(yt,vt,{size:bt=1,type:Tt,padding:Et=0,copy:wt=!1,initialize:St=!1,maxCount:At}){const Rt=Tt||yt&&yt.constructor||Float32Array,Pt=vt*bt+Et;if(ArrayBuffer.isView(yt)){if(Pt<=yt.length)return yt;if(Pt*yt.BYTES_PER_ELEMENT<=yt.buffer.byteLength)return new Rt(yt.buffer,0,Pt)}let Ct=1/0;At&&(Ct=At*bt+Et);const It=this._allocate(Rt,Pt,St,Ct);return yt&&wt?It.set(yt):St||It.fill(0,0,4),this._release(yt),It}release(yt){this._release(yt)}_allocate(yt,vt,bt,Tt){let Et=Math.max(Math.ceil(vt*this.opts.overAlloc),1);Et>Tt&&(Et=Tt);const wt=this._pool,St=yt.BYTES_PER_ELEMENT*Et,At=wt.findIndex(Rt=>Rt.byteLength>=St);if(At>=0){const Rt=new yt(wt.splice(At,1)[0],0,Et);return bt&&Rt.fill(0),Rt}return new yt(Et)}_release(yt){if(!ArrayBuffer.isView(yt))return;const vt=this._pool,{buffer:bt}=yt,{byteLength:Tt}=bt,Et=vt.findIndex(wt=>wt.byteLength>=Tt);Et<0?vt.push(bt):(Et>0||vt.length<this.opts.poolSize)&&vt.splice(Et,0,bt),vt.length>this.opts.poolSize&&vt.shift()}}const defaultTypedArrayManager=new TypedArrayManager;function createMat4(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function getCameraPosition(xt){return[xt[12],xt[13],xt[14]]}function getFrustumPlanes(xt){return{left:getFrustumPlane(xt[3]+xt[0],xt[7]+xt[4],xt[11]+xt[8],xt[15]+xt[12]),right:getFrustumPlane(xt[3]-xt[0],xt[7]-xt[4],xt[11]-xt[8],xt[15]-xt[12]),bottom:getFrustumPlane(xt[3]+xt[1],xt[7]+xt[5],xt[11]+xt[9],xt[15]+xt[13]),top:getFrustumPlane(xt[3]-xt[1],xt[7]-xt[5],xt[11]-xt[9],xt[15]-xt[13]),near:getFrustumPlane(xt[3]+xt[2],xt[7]+xt[6],xt[11]+xt[10],xt[15]+xt[14]),far:getFrustumPlane(xt[3]-xt[2],xt[7]-xt[6],xt[11]-xt[10],xt[15]-xt[14])}}const scratchVector=new Vector3;function getFrustumPlane(xt,yt,vt,bt){scratchVector.set(xt,yt,vt);const Tt=scratchVector.len();return{distance:bt/Tt,normal:new Vector3(-xt/Tt,-yt/Tt,-vt/Tt)}}function fp64LowPart(xt){return xt-Math.fround(xt)}let scratchArray;function toDoublePrecisionArray(xt,yt){const{size:vt=1,startIndex:bt=0}=yt,Tt=yt.endIndex!==void 0?yt.endIndex:xt.length,Et=(Tt-bt)/vt;scratchArray=defaultTypedArrayManager.allocate(scratchArray,Et,{type:Float32Array,size:vt*2});let wt=bt,St=0;for(;wt<Tt;){for(let At=0;At<vt;At++){const Rt=xt[wt++];scratchArray[St+At]=Rt,scratchArray[St+At+vt]=fp64LowPart(Rt)}St+=vt*2}return scratchArray.subarray(0,Et*vt*2)}function mergeBounds(xt){let yt=null,vt=!1;for(const bt of xt)bt&&(yt?(vt||(yt=[[yt[0][0],yt[0][1]],[yt[1][0],yt[1][1]]],vt=!0),yt[0][0]=Math.min(yt[0][0],bt[0][0]),yt[0][1]=Math.min(yt[0][1],bt[0][1]),yt[1][0]=Math.max(yt[1][0],bt[1][0]),yt[1][1]=Math.max(yt[1][1],bt[1][1])):yt=bt);return yt}const DEGREES_TO_RADIANS=Math.PI/180,IDENTITY=createMat4(),ZERO_VECTOR=[0,0,0],DEFAULT_DISTANCE_SCALES={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function createProjectionMatrix({width:xt,height:yt,orthographic:vt,fovyRadians:bt,focalDistance:Tt,padding:Et,near:wt,far:St}){const At=xt/yt,Rt=vt?new Matrix4().orthographic({fovy:bt,aspect:At,focalDistance:Tt,near:wt,far:St}):new Matrix4().perspective({fovy:bt,aspect:At,near:wt,far:St});if(Et){const{left:Pt=0,right:Ct=0,top:It=0,bottom:Mt=0}=Et,Ot=clamp$1((Pt+xt-Ct)/2,0,xt)-xt/2,kt=clamp$1((It+yt-Mt)/2,0,yt)-yt/2;Rt[8]-=Ot*2/xt,Rt[9]+=kt*2/yt}return Rt}class Viewport{constructor(yt={}){this._frustumPlanes={},this.id=yt.id||this.constructor.displayName||"viewport",this.x=yt.x||0,this.y=yt.y||0,this.width=yt.width||1,this.height=yt.height||1,this.zoom=yt.zoom||0,this.padding=yt.padding,this.distanceScales=yt.distanceScales||DEFAULT_DISTANCE_SCALES,this.focalDistance=yt.focalDistance||1,this.position=yt.position||ZERO_VECTOR,this.modelMatrix=yt.modelMatrix||null;const{longitude:vt,latitude:bt}=yt;this.isGeospatial=Number.isFinite(bt)&&Number.isFinite(vt),this._initProps(yt),this._initMatrices(yt),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?PROJECTION_MODE.WEB_MERCATOR:PROJECTION_MODE.WEB_MERCATOR_AUTO_OFFSET:PROJECTION_MODE.IDENTITY}equals(yt){return yt instanceof Viewport?this===yt?!0:yt.width===this.width&&yt.height===this.height&&yt.scale===this.scale&&equals$1(yt.projectionMatrix,this.projectionMatrix)&&equals$1(yt.viewMatrix,this.viewMatrix):!1}project(yt,{topLeft:vt=!0}={}){const bt=this.projectPosition(yt),Tt=worldToPixels(bt,this.pixelProjectionMatrix),[Et,wt]=Tt,St=vt?wt:this.height-wt;return yt.length===2?[Et,St]:[Et,St,Tt[2]]}unproject(yt,{topLeft:vt=!0,targetZ:bt}={}){const[Tt,Et,wt]=yt,St=vt?Et:this.height-Et,At=bt&&bt*this.distanceScales.unitsPerMeter[2],Rt=pixelsToWorld([Tt,St,wt],this.pixelUnprojectionMatrix,At),[Pt,Ct,It]=this.unprojectPosition(Rt);return Number.isFinite(wt)?[Pt,Ct,It]:Number.isFinite(bt)?[Pt,Ct,bt]:[Pt,Ct]}projectPosition(yt){const[vt,bt]=this.projectFlat(yt),Tt=(yt[2]||0)*this.distanceScales.unitsPerMeter[2];return[vt,bt,Tt]}unprojectPosition(yt){const[vt,bt]=this.unprojectFlat(yt),Tt=(yt[2]||0)*this.distanceScales.metersPerUnit[2];return[vt,bt,Tt]}projectFlat(yt){if(this.isGeospatial){const vt=lngLatToWorld(yt);return vt[1]=clamp$1(vt[1],-318,830),vt}return yt}unprojectFlat(yt){return this.isGeospatial?worldToLngLat(yt):yt}getBounds(yt={}){const vt={targetZ:yt.z||0},bt=this.unproject([0,0],vt),Tt=this.unproject([this.width,0],vt),Et=this.unproject([0,this.height],vt),wt=this.unproject([this.width,this.height],vt);return[Math.min(bt[0],Tt[0],Et[0],wt[0]),Math.min(bt[1],Tt[1],Et[1],wt[1]),Math.max(bt[0],Tt[0],Et[0],wt[0]),Math.max(bt[1],Tt[1],Et[1],wt[1])]}getDistanceScales(yt){return yt&&this.isGeospatial?getDistanceScales({longitude:yt[0],latitude:yt[1],highPrecision:!0}):this.distanceScales}containsPixel({x:yt,y:vt,width:bt=1,height:Tt=1}){return yt<this.x+this.width&&this.x<yt+bt&&vt<this.y+this.height&&this.y<vt+Tt}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,getFrustumPlanes(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(yt,vt){return null}_initProps(yt){const vt=yt.longitude,bt=yt.latitude;this.isGeospatial&&(Number.isFinite(yt.zoom)||(this.zoom=getMeterZoom({latitude:bt})+Math.log2(this.focalDistance)),this.distanceScales=yt.distanceScales||getDistanceScales({latitude:bt,longitude:vt}));const Tt=Math.pow(2,this.zoom);this.scale=Tt;const{position:Et,modelMatrix:wt}=yt;let St=ZERO_VECTOR;if(Et&&(St=wt?new Matrix4(wt).transformAsVector(Et,[]):Et),this.isGeospatial){const At=this.projectPosition([vt,bt,0]);this.center=new Vector3(St).scale(this.distanceScales.unitsPerMeter).add(At)}else this.center=this.projectPosition(St)}_initMatrices(yt){const{viewMatrix:vt=IDENTITY,projectionMatrix:bt=null,orthographic:Tt=!1,fovyRadians:Et,fovy:wt=75,near:St=.1,far:At=1e3,padding:Rt=null,focalDistance:Pt=1}=yt;this.viewMatrixUncentered=vt,this.viewMatrix=new Matrix4().multiplyRight(vt).translate(new Vector3(this.center).negate()),this.projectionMatrix=bt||createProjectionMatrix({width:this.width,height:this.height,orthographic:Tt,fovyRadians:Et||wt*DEGREES_TO_RADIANS,focalDistance:Pt,padding:Rt,near:St,far:At});const Ct=createMat4();multiply(Ct,Ct,this.projectionMatrix),multiply(Ct,Ct,this.viewMatrix),this.viewProjectionMatrix=Ct,this.viewMatrixInverse=invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=getCameraPosition(this.viewMatrixInverse);const It=createMat4(),Mt=createMat4();scale$1(It,It,[this.width/2,-this.height/2,1]),translate(It,It,[1,-1,0]),multiply(Mt,It,this.viewProjectionMatrix),this.pixelProjectionMatrix=Mt,this.pixelUnprojectionMatrix=invert(createMat4(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||defaultLogger.warn("Pixel project matrix not invertible")()}}Viewport.displayName="Viewport";class WebMercatorViewport extends Viewport{constructor(yt={}){const{latitude:vt=0,longitude:bt=0,zoom:Tt=0,pitch:Et=0,bearing:wt=0,nearZMultiplier:St=.1,farZMultiplier:At=1.01,nearZ:Rt,farZ:Pt,orthographic:Ct=!1,projectionMatrix:It,repeat:Mt=!1,worldOffset:Ot=0,position:kt,padding:Ft,legacyMeterSizes:Nt=!1}=yt;let{width:Lt,height:Dt,altitude:$t=1.5}=yt;const zt=Math.pow(2,Tt);Lt=Lt||1,Dt=Dt||1;let Ut,jt=null;if(It)$t=It[5]/2,Ut=altitudeToFovy($t);else{yt.fovy?(Ut=yt.fovy,$t=fovyToAltitude(Ut)):Ut=altitudeToFovy($t);let Vt;if(Ft){const{top:Wt=0,bottom:Yt=0}=Ft;Vt=[0,clamp$1((Wt+Dt-Yt)/2,0,Dt)-Dt/2]}jt=getProjectionParameters({width:Lt,height:Dt,scale:zt,center:kt&&[0,0,kt[2]*unitsPerMeter(vt)],offset:Vt,pitch:Et,fovy:Ut,nearZMultiplier:St,farZMultiplier:At}),Number.isFinite(Rt)&&(jt.near=Rt),Number.isFinite(Pt)&&(jt.far=Pt)}let Ht=getViewMatrix({height:Dt,pitch:Et,bearing:wt,scale:zt,altitude:$t});Ot&&(Ht=new Matrix4().translate([512*Ot,0,0]).multiplyLeft(Ht)),super({...yt,width:Lt,height:Dt,viewMatrix:Ht,longitude:bt,latitude:vt,zoom:Tt,...jt,fovy:Ut,focalDistance:$t}),this.latitude=vt,this.longitude=bt,this.zoom=Tt,this.pitch=Et,this.bearing=wt,this.altitude=$t,this.fovy=Ut,this.orthographic=Ct,this._subViewports=Mt?[]:null,this._pseudoMeters=Nt,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const yt=this.getBounds(),vt=Math.floor((yt[0]+180)/360),bt=Math.ceil((yt[2]-180)/360);for(let Tt=vt;Tt<=bt;Tt++){const Et=Tt?new WebMercatorViewport({...this,worldOffset:Tt}):this;this._subViewports.push(Et)}}return this._subViewports}projectPosition(yt){if(this._pseudoMeters)return super.projectPosition(yt);const[vt,bt]=this.projectFlat(yt),Tt=(yt[2]||0)*unitsPerMeter(yt[1]);return[vt,bt,Tt]}unprojectPosition(yt){if(this._pseudoMeters)return super.unprojectPosition(yt);const[vt,bt]=this.unprojectFlat(yt),Tt=(yt[2]||0)/unitsPerMeter(bt);return[vt,bt,Tt]}addMetersToLngLat(yt,vt){return addMetersToLngLat(yt,vt)}panByPosition(yt,vt){const bt=pixelsToWorld(vt,this.pixelUnprojectionMatrix),Tt=this.projectFlat(yt),Et=add$1([],Tt,negate$1([],bt)),wt=add$1([],this.center,Et),[St,At]=this.unprojectFlat(wt);return{longitude:St,latitude:At}}getBounds(yt={}){const vt=getBounds(this,yt.z||0);return[Math.min(vt[0][0],vt[1][0],vt[2][0],vt[3][0]),Math.min(vt[0][1],vt[1][1],vt[2][1],vt[3][1]),Math.max(vt[0][0],vt[1][0],vt[2][0],vt[3][0]),Math.max(vt[0][1],vt[1][1],vt[2][1],vt[3][1])]}fitBounds(yt,vt={}){const{width:bt,height:Tt}=this,{longitude:Et,latitude:wt,zoom:St}=fitBounds({width:bt,height:Tt,bounds:yt,...vt});return new WebMercatorViewport({width:bt,height:Tt,longitude:Et,latitude:wt,zoom:St})}}WebMercatorViewport.displayName="WebMercatorViewport";const DEFAULT_COORDINATE_ORIGIN=[0,0,0];function lngLatZToWorldPosition(xt,yt,vt=!1){const bt=yt.projectPosition(xt);if(vt&&yt instanceof WebMercatorViewport){const[Tt,Et,wt=0]=xt,St=yt.getDistanceScales([Tt,Et]);bt[2]=wt*St.unitsPerMeter[2]}return bt}function normalizeParameters(xt){const{viewport:yt,modelMatrix:vt,coordinateOrigin:bt}=xt;let{coordinateSystem:Tt,fromCoordinateSystem:Et,fromCoordinateOrigin:wt}=xt;return Tt===COORDINATE_SYSTEM.DEFAULT&&(Tt=yt.isGeospatial?COORDINATE_SYSTEM.LNGLAT:COORDINATE_SYSTEM.CARTESIAN),Et===void 0&&(Et=Tt),wt===void 0&&(wt=bt),{viewport:yt,coordinateSystem:Tt,coordinateOrigin:bt,modelMatrix:vt,fromCoordinateSystem:Et,fromCoordinateOrigin:wt}}function getWorldPosition(xt,{viewport:yt,modelMatrix:vt,coordinateSystem:bt,coordinateOrigin:Tt,offsetMode:Et}){let[wt,St,At=0]=xt;switch(vt&&([wt,St,At]=transformMat4([],[wt,St,At,1],vt)),bt){case COORDINATE_SYSTEM.LNGLAT:return lngLatZToWorldPosition([wt,St,At],yt,Et);case COORDINATE_SYSTEM.LNGLAT_OFFSETS:return lngLatZToWorldPosition([wt+Tt[0],St+Tt[1],At+(Tt[2]||0)],yt,Et);case COORDINATE_SYSTEM.METER_OFFSETS:return lngLatZToWorldPosition(addMetersToLngLat(Tt,[wt,St,At]),yt,Et);case COORDINATE_SYSTEM.CARTESIAN:default:return yt.isGeospatial?[wt+Tt[0],St+Tt[1],At+Tt[2]]:yt.projectPosition([wt,St,At])}}function projectPosition(xt,yt){const{viewport:vt,coordinateSystem:bt,coordinateOrigin:Tt,modelMatrix:Et,fromCoordinateSystem:wt,fromCoordinateOrigin:St}=normalizeParameters(yt),{autoOffset:At=!0}=yt,{geospatialOrigin:Rt=DEFAULT_COORDINATE_ORIGIN,shaderCoordinateOrigin:Pt=DEFAULT_COORDINATE_ORIGIN,offsetMode:Ct=!1}=At?getOffsetOrigin(vt,bt,Tt):{},It=getWorldPosition(xt,{viewport:vt,modelMatrix:Et,coordinateSystem:wt,coordinateOrigin:St,offsetMode:Ct});if(Ct){const Mt=vt.projectPosition(Rt||Pt);sub(It,It,Mt)}return It}let channelHandles=1,animationHandles=1;class Timeline{constructor(){Bt(this,"time",0);Bt(this,"channels",new Map);Bt(this,"animations",new Map);Bt(this,"playing",!1);Bt(this,"lastEngineTime",-1)}addChannel(yt){const{delay:vt=0,duration:bt=Number.POSITIVE_INFINITY,rate:Tt=1,repeat:Et=1}=yt,wt=channelHandles++,St={time:0,delay:vt,duration:bt,rate:Tt,repeat:Et};return this._setChannelTime(St,this.time),this.channels.set(wt,St),wt}removeChannel(yt){this.channels.delete(yt);for(const[vt,bt]of this.animations)bt.channel===yt&&this.detachAnimation(vt)}isFinished(yt){const vt=this.channels.get(yt);return vt===void 0?!1:this.time>=vt.delay+vt.duration*vt.repeat}getTime(yt){if(yt===void 0)return this.time;const vt=this.channels.get(yt);return vt===void 0?-1:vt.time}setTime(yt){this.time=Math.max(0,yt);const vt=this.channels.values();for(const Tt of vt)this._setChannelTime(Tt,this.time);const bt=this.animations.values();for(const Tt of bt){const{animation:Et,channel:wt}=Tt;Et.setTime(this.getTime(wt))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(yt,vt){const bt=animationHandles++;return this.animations.set(bt,{animation:yt,channel:vt}),yt.setTime(this.getTime(vt)),bt}detachAnimation(yt){this.animations.delete(yt)}update(yt){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=yt),this.setTime(this.time+(yt-this.lastEngineTime)),this.lastEngineTime=yt)}_setChannelTime(yt,vt){const bt=vt-yt.delay,Tt=yt.duration*yt.repeat;bt>=Tt?yt.time=yt.duration*yt.rate:(yt.time=Math.max(0,bt)%yt.duration,yt.time*=yt.rate)}}function requestAnimationFramePolyfill(xt){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(xt):setTimeout(xt,1e3/60)}function cancelAnimationFramePolyfill(xt){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(xt):clearTimeout(xt)}let statIdCounter=0;const DEFAULT_ANIMATION_LOOP_PROPS={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:xt=>console.error(xt),stats:luma.stats.get(`animation-loop-${statIdCounter++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class AnimationLoop{constructor(yt){Bt(this,"device",null);Bt(this,"canvas",null);Bt(this,"props");Bt(this,"animationProps",null);Bt(this,"timeline",null);Bt(this,"stats");Bt(this,"cpuTime");Bt(this,"gpuTime");Bt(this,"frameRate");Bt(this,"display");Bt(this,"needsRedraw","initialized");Bt(this,"_initialized",!1);Bt(this,"_running",!1);Bt(this,"_animationFrameId",null);Bt(this,"_nextFramePromise",null);Bt(this,"_resolveNextFrame",null);Bt(this,"_cpuStartTime",0);Bt(this,"_error",null);if(this.props={...DEFAULT_ANIMATION_LOOP_PROPS,...yt},yt=this.props,!yt.device)throw new Error("No device provided");const{useDevicePixels:vt=!0}=this.props;this.stats=yt.stats||new Stats({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:yt.autoResizeViewport,autoResizeDrawingBuffer:yt.autoResizeDrawingBuffer,useDevicePixels:vt}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(yt){var bt,Tt;if(this.props.onError(yt),this._error=Error(),((Tt=(bt=this.device)==null?void 0:bt.canvasContext)==null?void 0:Tt.canvas)instanceof HTMLCanvasElement){const Et=document.createElement("h1");Et.innerHTML=yt.message,Et.style.position="absolute",Et.style.top="20%",Et.style.left="10px",Et.style.color="black",Et.style.backgroundColor="red",document.body.appendChild(Et)}}setNeedsRedraw(yt){return this.needsRedraw=this.needsRedraw||yt,this}setProps(yt){return"autoResizeViewport"in yt&&(this.props.autoResizeViewport=yt.autoResizeViewport||!1),"autoResizeDrawingBuffer"in yt&&(this.props.autoResizeDrawingBuffer=yt.autoResizeDrawingBuffer||!1),"useDevicePixels"in yt&&(this.props.useDevicePixels=yt.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let yt;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(yt!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(yt){const vt=yt instanceof Error?yt:new Error("Unknown error");throw this.props.onError(vt),vt}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var yt;return(yt=this.device)!=null&&yt.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(yt){return this.timeline=yt,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(yt=>{this._resolveNextFrame=yt})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(yt){this.display&&(this.display.destroy(),this.display.animationLoop=null),yt&&(yt.animationLoop=this),this.display=yt}_requestAnimationFrame(){this._running&&(this._animationFrameId=requestAnimationFramePolyfill(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(cancelAnimationFramePolyfill(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(yt){var vt;if(this.display){this.display._renderFrame(yt);return}this.props.onRender(this._getAnimationProps()),(vt=this.device)==null||vt.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var vt,bt;const yt=(bt=(vt=this.device)==null?void 0:vt.canvasContext)==null?void 0:bt.canvas;if(!this.device||!yt)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:yt,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:yt,height:vt,aspect:bt}=this._getSizeAndAspect();(yt!==this.animationProps.width||vt!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),bt!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=yt,this.animationProps.height=vt,this.animationProps.aspect=bt,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var yt;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((yt=this.device.canvasContext)==null?void 0:yt.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const yt=document.createElement("div");document.body.appendChild(yt),yt.style.position="relative";const vt=document.createElement("div");vt.style.position="absolute",vt.style.left="10px",vt.style.bottom="10px",vt.style.width="300px",vt.style.background="white",this.canvas instanceof HTMLCanvasElement&&yt.appendChild(this.canvas),yt.appendChild(vt);const bt=this.props.onAddHTML(vt);bt&&(vt.innerHTML=bt)}}_getSizeAndAspect(){var Et,wt,St,At;if(!this.device)return{width:1,height:1,aspect:1};const[yt,vt]=((wt=(Et=this.device)==null?void 0:Et.canvasContext)==null?void 0:wt.getPixelSize())||[1,1];let bt=1;const Tt=(At=(St=this.device)==null?void 0:St.canvasContext)==null?void 0:At.canvas;return Tt&&Tt.clientHeight?bt=Tt.clientWidth/Tt.clientHeight:yt>0&&vt>0&&(bt=yt/vt),{width:yt,height:vt,aspect:bt}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var yt,vt;this.props.autoResizeDrawingBuffer&&((vt=(yt=this.device)==null?void 0:yt.canvasContext)==null||vt.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(yt){yt instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[yt.offsetX,yt.offsetY])}_onMouseleave(yt){this._getAnimationProps()._mousePosition=null}}const uidCounters$1={};function uid$1(xt="id"){uidCounters$1[xt]=uidCounters$1[xt]||1;const yt=uidCounters$1[xt]++;return`${xt}-${yt}`}class GPUGeometry{constructor(yt){Bt(this,"id");Bt(this,"userData",{});Bt(this,"topology");Bt(this,"bufferLayout",[]);Bt(this,"vertexCount");Bt(this,"indices");Bt(this,"attributes");if(this.id=yt.id||uid$1("geometry"),this.topology=yt.topology,this.indices=yt.indices||null,this.attributes=yt.attributes,this.vertexCount=yt.vertexCount,this.bufferLayout=yt.bufferLayout||[],this.indices&&!(this.indices.usage&Buffer.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var yt;(yt=this.indices)==null||yt.destroy();for(const vt of Object.values(this.attributes))vt.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(yt){return yt.byteLength/12}}function makeGPUGeometry(xt,yt){if(yt instanceof GPUGeometry)return yt;const vt=getIndexBufferFromGeometry(xt,yt),{attributes:bt,bufferLayout:Tt}=getAttributeBuffersFromGeometry(xt,yt);return new GPUGeometry({topology:yt.topology||"triangle-list",bufferLayout:Tt,vertexCount:yt.vertexCount,indices:vt,attributes:bt})}function getIndexBufferFromGeometry(xt,yt){if(!yt.indices)return;const vt=yt.indices.value;return xt.createBuffer({usage:Buffer.INDEX,data:vt})}function getAttributeBuffersFromGeometry(xt,yt){const vt=[],bt={};for(const[Et,wt]of Object.entries(yt.attributes)){let St=Et;switch(Et){case"POSITION":St="positions";break;case"NORMAL":St="normals";break;case"TEXCOORD_0":St="texCoords";break;case"COLOR_0":St="colors";break}if(wt){bt[St]=xt.createBuffer({data:wt.value,id:`${Et}-buffer`});const{value:At,size:Rt,normalized:Pt}=wt;vt.push({name:St,format:getVertexFormatFromAttribute(At,Rt,Pt)})}}const Tt=yt._calculateVertexCount(yt.attributes,yt.indices);return{attributes:bt,bufferLayout:vt,vertexCount:Tt}}const On=class On{constructor(yt){Bt(this,"device");Bt(this,"destroyPolicy");Bt(this,"_hashCounter",0);Bt(this,"_hashes",{});Bt(this,"_renderPipelineCache",{});Bt(this,"_computePipelineCache",{});this.device=yt,this.destroyPolicy=yt.props._factoryDestroyPolicy}static getDefaultPipelineFactory(yt){return yt._lumaData.defaultPipelineFactory=yt._lumaData.defaultPipelineFactory||new On(yt),yt._lumaData.defaultPipelineFactory}createRenderPipeline(yt){const vt={...RenderPipeline.defaultProps,...yt},bt=this._hashRenderPipeline(vt);if(!this._renderPipelineCache[bt]){const Tt=this.device.createRenderPipeline({...vt,id:vt.id?`${vt.id}-cached`:void 0});Tt.hash=bt,this._renderPipelineCache[bt]={pipeline:Tt,useCount:0}}return this._renderPipelineCache[bt].useCount++,this._renderPipelineCache[bt].pipeline}createComputePipeline(yt){const vt={...ComputePipeline.defaultProps,...yt},bt=this._hashComputePipeline(vt);if(!this._computePipelineCache[bt]){const Tt=this.device.createComputePipeline({...vt,id:vt.id?`${vt.id}-cached`:void 0});Tt.hash=bt,this._computePipelineCache[bt]={pipeline:Tt,useCount:0}}return this._computePipelineCache[bt].useCount++,this._computePipelineCache[bt].pipeline}release(yt){const vt=yt.hash,bt=yt instanceof ComputePipeline?this._computePipelineCache:this._renderPipelineCache;bt[vt].useCount--,bt[vt].useCount===0&&this.destroyPolicy==="unused"&&(bt[vt].pipeline.destroy(),delete bt[vt])}_hashComputePipeline(yt){return`${this._getHash(yt.shader.source)}`}_hashRenderPipeline(yt){const vt=yt.vs?this._getHash(yt.vs.source):0,bt=yt.fs?this._getHash(yt.fs.source):0,Tt="-",Et=this._getHash(JSON.stringify(yt.bufferLayout));switch(this.device.type){case"webgl":return`${vt}/${bt}V${Tt}BL${Et}`;default:const wt=this._getHash(JSON.stringify(yt.parameters));return`${vt}/${bt}V${Tt}T${yt.topology}P${wt}BL${Et}`}}_getHash(yt){return this._hashes[yt]===void 0&&(this._hashes[yt]=this._hashCounter++),this._hashes[yt]}};Bt(On,"defaultProps",{...RenderPipeline.defaultProps});let PipelineFactory=On;const kn=class kn{constructor(yt){Bt(this,"device");Bt(this,"destroyPolicy");Bt(this,"_cache",{});this.device=yt,this.destroyPolicy=yt.props._factoryDestroyPolicy}static getDefaultShaderFactory(yt){var vt;return(vt=yt._lumaData).defaultShaderFactory||(vt.defaultShaderFactory=new kn(yt)),yt._lumaData.defaultShaderFactory}createShader(yt){const vt=this._hashShader(yt);let bt=this._cache[vt];if(!bt){const Tt=this.device.createShader({...yt,id:yt.id?`${yt.id}-cached`:void 0});this._cache[vt]=bt={shader:Tt,useCount:0}}return bt.useCount++,bt.shader}release(yt){const vt=this._hashShader(yt),bt=this._cache[vt];bt&&(bt.useCount--,bt.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[vt],bt.shader.destroy()))}_hashShader(yt){return`${yt.stage}:${yt.source}`}};Bt(kn,"defaultProps",{...Shader.defaultProps});let ShaderFactory=kn;function getDebugTableForShaderLayout(xt,yt){var Tt;const vt={},bt="Values";if(xt.attributes.length===0&&!((Tt=xt.varyings)!=null&&Tt.length))return{"No attributes or varyings":{[bt]:"N/A"}};for(const Et of xt.attributes)if(Et){const wt=`${Et.location} ${Et.name}: ${Et.type}`;vt[`in ${wt}`]={[bt]:Et.stepMode||"vertex"}}for(const Et of xt.varyings||[]){const wt=`${Et.location} ${Et.name}`;vt[`out ${wt}`]={[bt]:JSON.stringify(Et)}}return vt}let canvas=null,ctx=null;function debugFramebuffer(xt,{id:yt,minimap:vt,opaque:bt,top:Tt="0",left:Et="0",rgbaScale:wt=1}){canvas||(canvas=document.createElement("canvas"),canvas.id=yt,canvas.title=yt,canvas.style.zIndex="100",canvas.style.position="absolute",canvas.style.top=Tt,canvas.style.left=Et,canvas.style.border="blue 5px solid",canvas.style.transform="scaleY(-1)",document.body.appendChild(canvas),ctx=canvas.getContext("2d")),(canvas.width!==xt.width||canvas.height!==xt.height)&&(canvas.width=xt.width/2,canvas.height=xt.height/2,canvas.style.width="400px",canvas.style.height="400px");const St=xt.device.readPixelsToArrayWebGL(xt),At=ctx==null?void 0:ctx.createImageData(xt.width,xt.height);if(At){for(let Pt=0;Pt<St.length;Pt+=4)At.data[0+Pt+0]=St[Pt+0]*wt,At.data[0+Pt+1]=St[Pt+1]*wt,At.data[0+Pt+2]=St[Pt+2]*wt,At.data[0+Pt+3]=bt?255:St[Pt+3]*wt;ctx==null||ctx.putImageData(At,0,0)}}function deepEqual$1(xt,yt,vt){if(xt===yt)return!0;if(!vt||!xt||!yt)return!1;if(Array.isArray(xt)){if(!Array.isArray(yt)||xt.length!==yt.length)return!1;for(let bt=0;bt<xt.length;bt++)if(!deepEqual$1(xt[bt],yt[bt],vt-1))return!1;return!0}if(Array.isArray(yt))return!1;if(typeof xt=="object"&&typeof yt=="object"){const bt=Object.keys(xt),Tt=Object.keys(yt);if(bt.length!==Tt.length)return!1;for(const Et of bt)if(!yt.hasOwnProperty(Et)||!deepEqual$1(xt[Et],yt[Et],vt-1))return!1;return!0}return!1}function isTypedArray(xt){return ArrayBuffer.isView(xt)&&!(xt instanceof DataView)}function isNumberArray(xt){return Array.isArray(xt)?xt.length===0||typeof xt[0]=="number":!1}function isNumericArray(xt){return isTypedArray(xt)||isNumberArray(xt)}function isUniformValue$1(xt){return isNumericArray(xt)||typeof xt=="number"||typeof xt=="boolean"}function splitUniformsAndBindings$1(xt){const yt={bindings:{},uniforms:{}};return Object.keys(xt).forEach(vt=>{const bt=xt[vt];isUniformValue$1(bt)?yt.uniforms[vt]=bt:yt.bindings[vt]=bt}),yt}class ShaderInputs{constructor(yt,vt){Bt(this,"options",{disableWarnings:!1});Bt(this,"modules");Bt(this,"moduleUniforms");Bt(this,"moduleBindings");Object.assign(this.options,vt);const bt=getShaderModuleDependencies(Object.values(yt).filter(Tt=>Tt.dependencies));for(const Tt of bt)yt[Tt.name]=Tt;log.log(1,"Creating ShaderInputs with modules",Object.keys(yt))(),this.modules=yt,this.moduleUniforms={},this.moduleBindings={};for(const[Tt,Et]of Object.entries(yt))this._addModule(Et),Et.name&&Tt!==Et.name&&!this.options.disableWarnings&&log.warn(`Module name: ${Tt} vs ${Et.name}`)()}destroy(){}setProps(yt){var vt;for(const bt of Object.keys(yt)){const Tt=bt,Et=yt[Tt]||{},wt=this.modules[Tt];if(!wt){this.options.disableWarnings||log.warn(`Module ${bt} not found`)();continue}const St=this.moduleUniforms[Tt],At=this.moduleBindings[Tt],Rt=((vt=wt.getUniforms)==null?void 0:vt.call(wt,Et,St))||Et,{uniforms:Pt,bindings:Ct}=splitUniformsAndBindings$1(Rt);this.moduleUniforms[Tt]={...St,...Pt},this.moduleBindings[Tt]={...At,...Ct}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const yt={};for(const vt of Object.values(this.moduleBindings))Object.assign(yt,vt);return yt}getDebugTable(){var vt;const yt={};for(const[bt,Tt]of Object.entries(this.moduleUniforms))for(const[Et,wt]of Object.entries(Tt))yt[`${bt}.${Et}`]={type:(vt=this.modules[bt].uniformTypes)==null?void 0:vt[Et],value:String(wt)};return yt}_addModule(yt){const vt=yt.name;this.moduleUniforms[vt]=yt.defaultUniforms||{},this.moduleBindings[vt]={}}}let pathPrefix="";async function loadImageBitmap(xt,yt){const vt=new Image;return vt.crossOrigin="anonymous",vt.src=xt.startsWith("http")?xt:pathPrefix+xt,await vt.decode(),yt?await createImageBitmap(vt,yt):await createImageBitmap(vt)}class AsyncTexture{constructor(yt,vt){Bt(this,"device");Bt(this,"id");Bt(this,"texture");Bt(this,"sampler");Bt(this,"view");Bt(this,"ready");Bt(this,"isReady",!1);Bt(this,"destroyed",!1);Bt(this,"resolveReady",()=>{});Bt(this,"rejectReady",()=>{});this.device=yt,this.id=vt.id||uid$1("async-texture"),typeof(vt==null?void 0:vt.data)=="string"&&vt.dimension==="2d"&&(vt={...vt,data:loadImageBitmap(vt.data)}),this.ready=new Promise((bt,Tt)=>{this.resolveReady=()=>{this.isReady=!0,bt()},this.rejectReady=Tt}),this.initAsync(vt)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(yt){const vt=yt.data;let bt;try{bt=await awaitAllPromises(vt)}catch(Et){this.rejectReady(Et)}if(this.destroyed)return;const Tt={...yt,data:bt};this.texture=this.device.createTexture(Tt),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(yt){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(yt.width===this.texture.width&&yt.height===this.texture.height)return!1;if(this.texture){const vt=this.texture;this.texture=vt.clone(yt),vt.destroy()}return!0}}async function awaitAllPromises(xt){if(xt=await xt,Array.isArray(xt))return await Promise.all(xt.map(awaitAllPromises));if(xt&&typeof xt=="object"&&xt.constructor===Object){const yt=xt,vt=await Promise.all(Object.values(yt)),bt=Object.keys(yt),Tt={};for(let Et=0;Et<bt.length;Et++)Tt[bt[Et]]=vt[Et];return Tt}return xt}const LOG_DRAW_PRIORITY=2,LOG_DRAW_TIMEOUT=1e4,Nn=class Nn{constructor(yt,vt){Bt(this,"device");Bt(this,"id");Bt(this,"source");Bt(this,"vs");Bt(this,"fs");Bt(this,"pipelineFactory");Bt(this,"shaderFactory");Bt(this,"userData",{});Bt(this,"parameters");Bt(this,"topology");Bt(this,"bufferLayout");Bt(this,"isInstanced");Bt(this,"instanceCount",0);Bt(this,"vertexCount");Bt(this,"indexBuffer",null);Bt(this,"bufferAttributes",{});Bt(this,"constantAttributes",{});Bt(this,"bindings",{});Bt(this,"uniforms",{});Bt(this,"vertexArray");Bt(this,"transformFeedback",null);Bt(this,"pipeline");Bt(this,"shaderInputs");Bt(this,"_uniformStore");Bt(this,"_attributeInfos",{});Bt(this,"_gpuGeometry",null);Bt(this,"_getModuleUniforms");Bt(this,"props");Bt(this,"_pipelineNeedsUpdate","newly created");Bt(this,"_needsRedraw","initializing");Bt(this,"_destroyed",!1);Bt(this,"_lastDrawTimestamp",-1);Bt(this,"_lastLogTime",0);Bt(this,"_logOpen",!1);Bt(this,"_drawCount",0);var At,Rt,Pt,Ct;this.props={...Nn.defaultProps,...vt},vt=this.props,this.id=vt.id||uid$1("model"),this.device=yt,Object.assign(this.userData,vt.userData);const bt=Object.fromEntries(((At=this.props.modules)==null?void 0:At.map(It=>[It.name,It]))||[]),Tt=vt.shaderInputs||new ShaderInputs(bt,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(Tt);const Et=getPlatformInfo(yt),wt=(((Rt=this.props.modules)==null?void 0:Rt.length)>0?this.props.modules:(Pt=this.shaderInputs)==null?void 0:Pt.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:It,getUniforms:Mt}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:Et,...this.props,modules:wt});this.source=It,this._getModuleUniforms=Mt,(Ct=this.props).shaderLayout||(Ct.shaderLayout=getShaderLayoutFromWGSL(this.source))}else{const{vs:It,fs:Mt,getUniforms:Ot}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:Et,...this.props,modules:wt});this.vs=It,this.fs=Mt,this._getModuleUniforms=Ot}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,vt.geometry&&this.setGeometry(vt.geometry),this.pipelineFactory=vt.pipelineFactory||PipelineFactory.getDefaultPipelineFactory(this.device),this.shaderFactory=vt.shaderFactory||ShaderFactory.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=yt.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in vt&&(this.isInstanced=vt.isInstanced),vt.instanceCount&&this.setInstanceCount(vt.instanceCount),vt.vertexCount&&this.setVertexCount(vt.vertexCount),vt.indexBuffer&&this.setIndexBuffer(vt.indexBuffer),vt.attributes&&this.setAttributes(vt.attributes),vt.constantAttributes&&this.setConstantAttributes(vt.constantAttributes),vt.bindings&&this.setBindings(vt.bindings),vt.uniforms&&this.setUniformsWebGL(vt.uniforms),vt.moduleSettings&&this.updateModuleSettingsWebGL(vt.moduleSettings),vt.transformFeedback&&(this.transformFeedback=vt.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var yt;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(yt=this._gpuGeometry)==null||yt.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const yt=this._needsRedraw;return this._needsRedraw=!1,yt}setNeedsRedraw(yt){this._needsRedraw||(this._needsRedraw=yt)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(yt){const vt=this._areBindingsLoading();if(vt)return log.info(LOG_DRAW_PRIORITY,`>>> DRAWING ABORTED ${this.id}: ${vt} not loaded`)(),!1;try{yt.pushDebugGroup(`${this}.predraw(${yt})`),this.predraw()}finally{yt.popDebugGroup()}let bt;try{yt.pushDebugGroup(`${this}.draw(${yt})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const Tt=this._getBindings();this.pipeline.setBindings(Tt,{disableWarnings:this.props.disableWarnings}),isObjectEmpty$3(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:Et}=this.vertexArray,wt=Et?Et.byteLength/(Et.indexType==="uint32"?4:2):void 0;bt=this.pipeline.draw({renderPass:yt,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:wt,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{yt.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(yt),bt?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",bt}setGeometry(yt){var bt;(bt=this._gpuGeometry)==null||bt.destroy();const vt=yt&&makeGPUGeometry(this.device,yt);if(vt){this.setTopology(vt.topology||"triangle-list");const Tt=new BufferLayoutHelper(this.bufferLayout);this.bufferLayout=Tt.mergeBufferLayouts(vt.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(vt)}this._gpuGeometry=vt}setTopology(yt){yt!==this.topology&&(this.topology=yt,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(yt){const vt=new BufferLayoutHelper(this.bufferLayout);this.bufferLayout=this._gpuGeometry?vt.mergeBufferLayouts(yt,this._gpuGeometry.bufferLayout):yt,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(yt){deepEqual$1(yt,this.parameters,2)||(this.parameters=yt,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(yt){this.instanceCount=yt,this.isInstanced===void 0&&yt>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(yt){this.vertexCount=yt,this.setNeedsRedraw("vertexCount")}setShaderInputs(yt){this.shaderInputs=yt,this._uniformStore=new UniformStore(this.shaderInputs.modules);for(const[vt,bt]of Object.entries(this.shaderInputs.modules))if(shaderModuleHasUniforms(bt)){const Tt=this._uniformStore.getManagedUniformBuffer(this.device,vt);this.bindings[`${vt}Uniforms`]=Tt}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(yt){Object.assign(this.bindings,yt),this.setNeedsRedraw("bindings")}setTransformFeedback(yt){this.transformFeedback=yt,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(yt){this.vertexArray.setIndexBuffer(yt),this.setNeedsRedraw("indexBuffer")}setAttributes(yt,vt){const bt=(vt==null?void 0:vt.disableWarnings)??this.props.disableWarnings;yt.indices&&log.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=sortedBufferLayoutByShaderSourceLocations(this.pipeline.shaderLayout,this.bufferLayout);const Tt=new BufferLayoutHelper(this.bufferLayout);for(const[Et,wt]of Object.entries(yt)){const St=Tt.getBufferLayout(Et);if(!St){bt||log.warn(`Model(${this.id}): Missing layout for buffer "${Et}".`)();continue}const At=Tt.getAttributeNamesForBuffer(St);let Rt=!1;for(const Pt of At){const Ct=this._attributeInfos[Pt];if(Ct){const It=this.device.type==="webgpu"?Tt.getBufferIndex(Ct.bufferName):Ct.location;this.vertexArray.setBuffer(It,wt),Rt=!0}}!Rt&&!bt&&log.warn(`Model(${this.id}): Ignoring buffer "${wt.id}" for unknown attribute "${Et}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(yt,vt){for(const[bt,Tt]of Object.entries(yt)){const Et=this._attributeInfos[bt];Et?this.vertexArray.setConstantWebGL(Et.location,Tt):((vt==null?void 0:vt.disableWarnings)??this.props.disableWarnings)||log.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${bt}"`)()}this.setNeedsRedraw("constants")}setUniforms(yt){this.setUniformsWebGL(yt)}setUniformsWebGL(yt){isObjectEmpty$3(yt)||(this.pipeline.setUniformsWebGL(yt),Object.assign(this.uniforms,yt)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(yt){const{bindings:vt,uniforms:bt}=splitUniformsAndBindings$1(this._getModuleUniforms(yt));Object.assign(this.bindings,vt),Object.assign(this.uniforms,bt),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const yt of Object.values(this.bindings))if(yt instanceof AsyncTexture&&!yt.isReady)return yt.id;return!1}_getBindings(){const yt={};for(const[vt,bt]of Object.entries(this.bindings))bt instanceof AsyncTexture?bt.isReady&&(yt[vt]=bt.texture):yt[vt]=bt;return yt}_getBindingsUpdateTimestamp(){let yt=0;for(const vt of Object.values(this.bindings))vt instanceof TextureView?yt=Math.max(yt,vt.texture.updateTimestamp):vt instanceof Buffer||vt instanceof Texture?yt=Math.max(yt,vt.updateTimestamp):vt instanceof AsyncTexture?yt=vt.texture?Math.max(yt,vt.texture.updateTimestamp):1/0:vt instanceof Sampler||(yt=Math.max(yt,vt.buffer.updateTimestamp));return yt}_setGeometryAttributes(yt){const vt={...yt.attributes};for(const[bt]of Object.entries(vt))!this.pipeline.shaderLayout.attributes.find(Tt=>Tt.name===bt)&&bt!=="positions"&&delete vt[bt];this.vertexCount=yt.vertexCount,this.setIndexBuffer(yt.indices||null),this.setAttributes(yt.attributes,{disableWarnings:!0}),this.setAttributes(vt,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(yt){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=yt),this.setNeedsRedraw(yt)}_updatePipeline(){if(this._pipelineNeedsUpdate){let yt=null,vt=null;this.pipeline&&(log.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),yt=this.pipeline.vs,vt=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const bt=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let Tt=null;this.source?Tt=bt:this.fs&&(Tt=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:bt,fs:Tt}),this._attributeInfos=getAttributeInfosFromLayouts(this.pipeline.shaderLayout,this.bufferLayout),yt&&this.shaderFactory.release(yt),vt&&this.shaderFactory.release(vt)}return this.pipeline}_logDrawCallStart(){const yt=log.level>3?0:LOG_DRAW_TIMEOUT;log.level<2||Date.now()-this._lastLogTime<yt||(this._lastLogTime=Date.now(),this._logOpen=!0,log.group(LOG_DRAW_PRIORITY,`>>> DRAWING MODEL ${this.id}`,{collapsed:log.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const yt=getDebugTableForShaderLayout(this.pipeline.shaderLayout,this.id);log.table(LOG_DRAW_PRIORITY,yt)();const vt=this.shaderInputs.getDebugTable();for(const[Tt,Et]of Object.entries(this.uniforms))vt[Tt]={value:Et};log.table(LOG_DRAW_PRIORITY,vt)();const bt=this._getAttributeDebugTable();log.table(LOG_DRAW_PRIORITY,this._attributeInfos)(),log.table(LOG_DRAW_PRIORITY,bt)(),log.groupEnd(LOG_DRAW_PRIORITY)(),this._logOpen=!1}}_logFramebuffer(yt){const vt=this.device.props.debugFramebuffers;if(this._drawCount++,!vt)return;const bt=yt.props.framebuffer;bt&&debugFramebuffer(bt,{id:bt.id,minimap:!0})}_getAttributeDebugTable(){const yt={};for(const[vt,bt]of Object.entries(this._attributeInfos)){const Tt=this.vertexArray.attributes[bt.location];yt[bt.location]={name:vt,type:bt.shaderType,values:Tt?this._getBufferOrConstantValues(Tt,bt.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:vt}=this.vertexArray,bt=vt.indexType==="uint32"?new Uint32Array(vt.debugData):new Uint16Array(vt.debugData);yt.indices={name:"indices",type:vt.indexType,values:bt.toString()}}return yt}_getBufferOrConstantValues(yt,vt){const bt=getTypedArrayFromDataType(vt);return(yt instanceof Buffer?new bt(yt.debugData):yt).toString()}};Bt(Nn,"defaultProps",{...RenderPipeline.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:ShaderAssembler.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Model=Nn;function shaderModuleHasUniforms(xt){return!!(xt.uniformTypes&&!isObjectEmpty$3(xt.uniformTypes))}function getPlatformInfo(xt){return{type:xt.type,shaderLanguage:xt.info.shadingLanguage,shaderLanguageVersion:xt.info.shadingLanguageVersion,gpu:xt.info.gpu,features:xt.features}}function isObjectEmpty$3(xt){for(const yt in xt)return!1;return!0}const _n=class _n{constructor(yt,vt=_n.defaultProps){Bt(this,"device");Bt(this,"model");Bt(this,"transformFeedback");if(!_n.isSupported(yt))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=yt,this.model=new Model(this.device,{id:vt.id||"buffer-transform-model",fs:vt.fs||getPassthroughFS(),topology:vt.topology||"point-list",varyings:vt.outputs||vt.varyings,...vt}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:vt.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(yt){var vt;return((vt=yt==null?void 0:yt.info)==null?void 0:vt.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(yt){yt!=null&&yt.inputBuffers&&this.model.setAttributes(yt.inputBuffers),yt!=null&&yt.outputBuffers&&this.transformFeedback.setBuffers(yt.outputBuffers);const vt=this.device.beginRenderPass(yt);this.model.draw(vt),vt.end()}getBuffer(yt){return this.transformFeedback.getBuffer(yt)}readAsync(yt){const vt=this.getBuffer(yt);if(!vt)throw new Error("BufferTransform#getBuffer");if(vt instanceof Buffer)return vt.readAsync();const{buffer:bt,byteOffset:Tt=0,byteLength:Et=bt.byteLength}=vt;return bt.readAsync(Tt,Et)}};Bt(_n,"defaultProps",{...Model.defaultProps,outputs:void 0,feedbackBuffers:void 0});let BufferTransform=_n;class Geometry{constructor(yt){Bt(this,"id");Bt(this,"topology");Bt(this,"vertexCount");Bt(this,"indices");Bt(this,"attributes");Bt(this,"userData",{});const{attributes:vt={},indices:bt=null,vertexCount:Tt=null}=yt;this.id=yt.id||uid$1("geometry"),this.topology=yt.topology,bt&&(this.indices=ArrayBuffer.isView(bt)?{value:bt,size:1}:bt),this.attributes={};for(const[Et,wt]of Object.entries(vt)){const St=ArrayBuffer.isView(wt)?{value:wt}:wt;if(!ArrayBuffer.isView(St.value))throw new Error(`${this._print(Et)}: must be typed array or object with value as typed array`);if((Et==="POSITION"||Et==="positions")&&!St.size&&(St.size=3),Et==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=St}else this.attributes[Et]=St}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=Tt||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(yt){return`Geometry ${this.id} attribute ${yt}`}_setAttributes(yt,vt){return this}_calculateVertexCount(yt,vt){if(vt)return vt.value.length;let bt=1/0;for(const Tt of Object.values(yt)){const{value:Et,size:wt,constant:St}=Tt;!St&&Et&&wt!==void 0&&wt>=1&&(bt=Math.min(bt,Et.length/wt))}return bt}}const PICKING_BLENDING={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class PickLayersPass extends LayersPass{constructor(){super(...arguments),this._colorEncoderState=null}render(yt){return"pickingFBO"in yt?this._drawPickingBuffer(yt):super.render(yt)}_drawPickingBuffer({layers:yt,layerFilter:vt,views:bt,viewports:Tt,onViewportActive:Et,pickingFBO:wt,deviceRect:{x:St,y:At,width:Rt,height:Pt},cullRect:Ct,effects:It,pass:Mt="picking",pickZ:Ot,shaderModuleProps:kt}){this.pickZ=Ot;const Ft=this._resetColorEncoder(Ot),Nt=[St,At,Rt,Pt],Lt=super.render({target:wt,layers:yt,layerFilter:vt,views:bt,viewports:Tt,onViewportActive:Et,cullRect:Ct,effects:It==null?void 0:It.filter($t=>$t.useInPicking),pass:Mt,isPicking:!0,shaderModuleProps:kt,clearColor:[0,0,0,0],colorMask:15,scissorRect:Nt});return this._colorEncoderState=null,{decodePickingColor:Ft&&decodeColor.bind(null,Ft),stats:Lt}}shouldDrawLayer(yt){const{pickable:vt,operation:bt}=yt.props;return vt&&bt.includes("draw")||bt.includes("terrain")||bt.includes("mask")}getShaderModuleProps(yt,vt,bt){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(yt,vt,bt){const Tt={...yt.props.parameters},{pickable:Et,operation:wt}=yt.props;return!this._colorEncoderState||wt.includes("terrain")?Tt.blend=!1:Et&&wt.includes("draw")&&(Object.assign(Tt,PICKING_BLENDING),Tt.blend=!0,Tt.blendColor=encodeColor(this._colorEncoderState,yt,bt)),Tt}_resetColorEncoder(yt){return this._colorEncoderState=yt?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function encodeColor(xt,yt,vt){const{byLayer:bt,byAlpha:Tt}=xt;let Et,wt=bt.get(yt);return wt?(wt.viewports.push(vt),Et=wt.a):(Et=bt.size+1,Et<=255?(wt={a:Et,layer:yt,viewports:[vt]},bt.set(yt,wt),Tt[Et]=wt):(defaultLogger.warn("Too many pickable layers, only picking the first 255")(),Et=0)),[0,0,0,Et/255]}function decodeColor(xt,yt){const vt=xt.byAlpha[yt[3]];return vt&&{pickedLayer:vt.layer,pickedViewports:vt.viewports,pickedObjectIndex:vt.layer.decodePickingColor(yt)}}const LIFECYCLE={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},COMPONENT_SYMBOL=Symbol.for("component"),PROP_TYPES_SYMBOL=Symbol.for("propTypes"),DEPRECATED_PROPS_SYMBOL=Symbol.for("deprecatedProps"),ASYNC_DEFAULTS_SYMBOL=Symbol.for("asyncPropDefaults"),ASYNC_ORIGINAL_SYMBOL=Symbol.for("asyncPropOriginal"),ASYNC_RESOLVED_SYMBOL=Symbol.for("asyncPropResolved");function flatten(xt,yt=()=>!0){return Array.isArray(xt)?flattenArray(xt,yt,[]):yt(xt)?[xt]:[]}function flattenArray(xt,yt,vt){let bt=-1;for(;++bt<xt.length;){const Tt=xt[bt];Array.isArray(Tt)?flattenArray(Tt,yt,vt):yt(Tt)&&vt.push(Tt)}return vt}function fillArray$1({target:xt,source:yt,start:vt=0,count:bt=1}){const Tt=yt.length,Et=bt*Tt;let wt=0;for(let St=vt;wt<Tt;wt++)xt[St++]=yt[wt];for(;wt<Et;)wt<Et-wt?(xt.copyWithin(vt+wt,vt,vt+wt),wt*=2):(xt.copyWithin(vt+wt,vt,vt+Et-wt),wt=Et);return xt}class Resource{constructor(yt,vt,bt){this._loadCount=0,this._subscribers=new Set,this.id=yt,this.context=bt,this.setData(vt)}subscribe(yt){this._subscribers.add(yt)}unsubscribe(yt){this._subscribers.delete(yt)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(yt,vt){if(yt===this._data&&!vt)return;this._data=yt;const bt=++this._loadCount;let Tt=yt;typeof yt=="string"&&(Tt=load(yt)),Tt instanceof Promise?(this.isLoaded=!1,this._loader=Tt.then(Et=>{this._loadCount===bt&&(this.isLoaded=!0,this._error=void 0,this._content=Et)}).catch(Et=>{this._loadCount===bt&&(this.isLoaded=!0,this._error=Et||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=yt);for(const Et of this._subscribers)Et.onChange(this.getData())}}class ResourceManager{constructor(yt){var vt;this.protocol=yt.protocol||"resource://",this._context={device:yt.device,gl:(vt=yt.device)==null?void 0:vt.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(yt){return yt.startsWith(this.protocol)?!0:yt in this._resources}add({resourceId:yt,data:vt,forceUpdate:bt=!1,persistent:Tt=!0}){let Et=this._resources[yt];Et?Et.setData(vt,bt):(Et=new Resource(yt,vt,this._context),this._resources[yt]=Et),Et.persistent=Tt}remove(yt){const vt=this._resources[yt];vt&&(vt.delete(),delete this._resources[yt])}unsubscribe({consumerId:yt}){const vt=this._consumers[yt];if(vt){for(const bt in vt){const Tt=vt[bt],Et=this._resources[Tt.resourceId];Et&&Et.unsubscribe(Tt)}delete this._consumers[yt],this.prune()}}subscribe({resourceId:yt,onChange:vt,consumerId:bt,requestId:Tt="default"}){const{_resources:Et,protocol:wt}=this;yt.startsWith(wt)&&(yt=yt.replace(wt,""),Et[yt]||this.add({resourceId:yt,data:null,persistent:!1}));const St=Et[yt];if(this._track(bt,Tt,St,vt),St)return St.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const yt in this._resources)this._resources[yt].delete()}_track(yt,vt,bt,Tt){const Et=this._consumers,wt=Et[yt]=Et[yt]||{};let St=wt[vt];const At=St&&St.resourceId&&this._resources[St.resourceId];At&&(At.unsubscribe(St),this.prune()),bt&&(St?(St.onChange=Tt,St.resourceId=bt.id):St={onChange:Tt,resourceId:bt.id},wt[vt]=St,bt.subscribe(St))}_prune(){this._pruneRequest=null;for(const yt of Object.keys(this._resources)){const vt=this._resources[yt];!vt.persistent&&!vt.inUse()&&(vt.delete(),delete this._resources[yt])}}}const TRACE_SET_LAYERS="layerManager.setLayers",TRACE_ACTIVATE_VIEWPORT="layerManager.activateViewport";class LayerManager{constructor(yt,vt){var St;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=At=>{debug(TRACE_ACTIVATE_VIEWPORT,this,At),At&&(this.context.viewport=At)};const{deck:bt,stats:Tt,viewport:Et,timeline:wt}=vt||{};this.layers=[],this.resourceManager=new ResourceManager({device:yt,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:yt,gl:yt==null?void 0:yt.gl,deck:bt,shaderAssembler:getShaderAssembler(((St=yt==null?void 0:yt.info)==null?void 0:St.shadingLanguage)||"glsl"),defaultShaderModules:[layerUniforms],renderPass:void 0,stats:Tt||new Stats({id:"deck.gl"}),viewport:Et||new Viewport({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:wt||new Timeline,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const yt of this.layers)this._finalizeLayer(yt)}needsRedraw(yt={clearRedrawFlags:!1}){let vt=this._needsRedraw;yt.clearRedrawFlags&&(this._needsRedraw=!1);for(const bt of this.layers){const Tt=bt.getNeedsRedraw(yt);vt=vt||Tt}return vt}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(yt){this._needsRedraw=this._needsRedraw||yt}setNeedsUpdate(yt){this._needsUpdate=this._needsUpdate||yt}getLayers({layerIds:yt}={}){return yt?this.layers.filter(vt=>yt.find(bt=>vt.id.indexOf(bt)===0)):this.layers}setProps(yt){"debug"in yt&&(this._debug=yt.debug),"userData"in yt&&(this.context.userData=yt.userData),"layers"in yt&&(this._nextLayers=yt.layers),"onError"in yt&&(this.context.onError=yt.onError)}setLayers(yt,vt){debug(TRACE_SET_LAYERS,this,vt,yt),this._lastRenderedLayers=yt;const bt=flatten(yt,Boolean);for(const Tt of bt)Tt.context=this.context;this._updateLayers(this.layers,bt)}updateLayers(){const yt=this.needsUpdate();yt&&(this.setNeedsRedraw(`updating layers: ${yt}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,yt)),this._nextLayers=null}addDefaultShaderModule(yt){const{defaultShaderModules:vt}=this.context;vt.find(bt=>bt.name===yt.name)||(vt.push(yt),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(yt){const{defaultShaderModules:vt}=this.context,bt=vt.findIndex(Tt=>Tt.name===yt.name);bt>=0&&(vt.splice(bt,1),this._defaultShaderModulesChanged=!0)}_handleError(yt,vt,bt){bt.raiseError(vt,`${yt} of ${bt}`)}_updateLayers(yt,vt){const bt={};for(const wt of yt)bt[wt.id]?defaultLogger.warn(`Multiple old layers with same id ${wt.id}`)():bt[wt.id]=wt;if(this._defaultShaderModulesChanged){for(const wt of yt)wt.setNeedsUpdate(),wt.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const Tt=[];this._updateSublayersRecursively(vt,bt,Tt),this._finalizeOldLayers(bt);let Et=!1;for(const wt of Tt)if(wt.hasUniformTransition()){Et=`Uniform transition in ${wt}`;break}this._needsUpdate=Et,this.layers=Tt}_updateSublayersRecursively(yt,vt,bt){for(const Tt of yt){Tt.context=this.context;const Et=vt[Tt.id];Et===null&&defaultLogger.warn(`Multiple new layers with same id ${Tt.id}`)(),vt[Tt.id]=null;let wt=null;try{this._debug&&Et!==Tt&&Tt.validateProps(),Et?(this._transferLayerState(Et,Tt),this._updateLayer(Tt)):this._initializeLayer(Tt),bt.push(Tt),wt=Tt.isComposite?Tt.getSubLayers():null}catch(St){this._handleError("matching",St,Tt)}wt&&this._updateSublayersRecursively(wt,vt,bt)}}_finalizeOldLayers(yt){for(const vt in yt){const bt=yt[vt];bt&&this._finalizeLayer(bt)}}_initializeLayer(yt){try{yt._initialize(),yt.lifecycle=LIFECYCLE.INITIALIZED}catch(vt){this._handleError("initialization",vt,yt)}}_transferLayerState(yt,vt){vt._transferState(yt),vt.lifecycle=LIFECYCLE.MATCHED,vt!==yt&&(yt.lifecycle=LIFECYCLE.AWAITING_GC)}_updateLayer(yt){try{yt._update()}catch(vt){this._handleError("update",vt,yt)}}_finalizeLayer(yt){this._needsRedraw=this._needsRedraw||`finalized ${yt}`,yt.lifecycle=LIFECYCLE.AWAITING_FINALIZATION;try{yt._finalize(),yt.lifecycle=LIFECYCLE.FINALIZED}catch(vt){this._handleError("finalization",vt,yt)}}}function deepEqual(xt,yt,vt){if(xt===yt)return!0;if(!vt||!xt||!yt)return!1;if(Array.isArray(xt)){if(!Array.isArray(yt)||xt.length!==yt.length)return!1;for(let bt=0;bt<xt.length;bt++)if(!deepEqual(xt[bt],yt[bt],vt-1))return!1;return!0}if(Array.isArray(yt))return!1;if(typeof xt=="object"&&typeof yt=="object"){const bt=Object.keys(xt),Tt=Object.keys(yt);if(bt.length!==Tt.length)return!1;for(const Et of bt)if(!yt.hasOwnProperty(Et)||!deepEqual(xt[Et],yt[Et],vt-1))return!1;return!0}return!1}class ViewManager{constructor(yt){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=yt.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=yt.eventManager,this._eventCallbacks={onViewStateChange:yt.onViewStateChange,onInteractionStateChange:yt.onInteractionStateChange},Object.seal(this),this.setProps(yt)}finalize(){for(const yt in this.controllers){const vt=this.controllers[yt];vt&&vt.finalize()}this.controllers={}}needsRedraw(yt={clearRedrawFlags:!1}){const vt=this._needsRedraw;return yt.clearRedrawFlags&&(this._needsRedraw=!1),vt}setNeedsUpdate(yt){this._needsUpdate=this._needsUpdate||yt,this._needsRedraw=this._needsRedraw||yt}updateViewStates(){for(const yt in this.controllers){const vt=this.controllers[yt];vt&&vt.updateTransition()}}getViewports(yt){return yt?this._viewports.filter(vt=>vt.containsPixel(yt)):this._viewports}getViews(){const yt={};return this.views.forEach(vt=>{yt[vt.id]=vt}),yt}getView(yt){return this.views.find(vt=>vt.id===yt)}getViewState(yt){const vt=typeof yt=="string"?this.getView(yt):yt,bt=vt&&this.viewState[vt.getViewStateId()]||this.viewState;return vt?vt.filterViewState(bt):bt}getViewport(yt){return this._viewportMap[yt]}unproject(yt,vt){const bt=this.getViewports(),Tt={x:yt[0],y:yt[1]};for(let Et=bt.length-1;Et>=0;--Et){const wt=bt[Et];if(wt.containsPixel(Tt)){const St=yt.slice();return St[0]-=wt.x,St[1]-=wt.y,wt.unproject(St,vt)}}return null}setProps(yt){yt.views&&this._setViews(yt.views),yt.viewState&&this._setViewState(yt.viewState),("width"in yt||"height"in yt)&&this._setSize(yt.width,yt.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(yt,vt){(yt!==this.width||vt!==this.height)&&(this.width=yt,this.height=vt,this.setNeedsUpdate("Size changed"))}_setViews(yt){yt=flatten(yt,Boolean),this._diffViews(yt,this.views)&&this.setNeedsUpdate("views changed"),this.views=yt}_setViewState(yt){yt?(!deepEqual(yt,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=yt):defaultLogger.warn("missing `viewState` or `initialViewState`")()}_createController(yt,vt){const bt=vt.type;return new bt({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:Et=>{var wt;return(wt=this.getView(yt.id))==null?void 0:wt.makeViewport({viewState:Et,width:this.width,height:this.height})}})}_updateController(yt,vt,bt,Tt){const Et=yt.controller;if(Et&&bt){const wt={...vt,...Et,id:yt.id,x:bt.x,y:bt.y,width:bt.width,height:bt.height};return(!Tt||Tt.constructor!==Et.type)&&(Tt=this._createController(yt,wt)),Tt&&Tt.setProps(wt),Tt}return null}_rebuildViewports(){const{views:yt}=this,vt=this.controllers;this._viewports=[],this.controllers={};let bt=!1;for(let Tt=yt.length;Tt--;){const Et=yt[Tt],wt=this.getViewState(Et),St=Et.makeViewport({viewState:wt,width:this.width,height:this.height});let At=vt[Et.id];const Rt=!!Et.controller;Rt&&!At&&(bt=!0),(bt||!Rt)&&At&&(At.finalize(),At=null),this.controllers[Et.id]=this._updateController(Et,wt,St,At),St&&this._viewports.unshift(St)}for(const Tt in vt){const Et=vt[Tt];Et&&!this.controllers[Tt]&&Et.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(yt=>{yt.id&&(this._viewportMap[yt.id]=this._viewportMap[yt.id]||yt)})}_diffViews(yt,vt){return yt.length!==vt.length?!0:yt.some((bt,Tt)=>!yt[Tt].equals(vt[Tt]))}}const PERCENT_OR_PIXELS_REGEX=/([0-9]+\.?[0-9]*)(%|px)/;function parsePosition(xt){switch(typeof xt){case"number":return{position:xt,relative:!1};case"string":const yt=PERCENT_OR_PIXELS_REGEX.exec(xt);if(yt&&yt.length>=3){const vt=yt[2]==="%",bt=parseFloat(yt[1]);return{position:vt?bt/100:bt,relative:vt}}default:throw new Error(`Could not parse position string ${xt}`)}}function getPosition(xt,yt){return xt.relative?Math.round(xt.position*yt):xt.position}class View{constructor(yt){const{id:vt,x:bt=0,y:Tt=0,width:Et="100%",height:wt="100%",padding:St=null}=yt;this.id=vt||this.constructor.displayName||"view",this.props={...yt,id:this.id},this._x=parsePosition(bt),this._y=parsePosition(Tt),this._width=parsePosition(Et),this._height=parsePosition(wt),this._padding=St&&{left:parsePosition(St.left||0),right:parsePosition(St.right||0),top:parsePosition(St.top||0),bottom:parsePosition(St.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(yt){return this===yt?!0:this.constructor===yt.constructor&&deepEqual(this.props,yt.props,2)}makeViewport({width:yt,height:vt,viewState:bt}){bt=this.filterViewState(bt);const Tt=this.getDimensions({width:yt,height:vt});if(!Tt.height||!Tt.width)return null;const Et=this.getViewportType(bt);return new Et({...bt,...this.props,...Tt})}getViewStateId(){const{viewState:yt}=this.props;return typeof yt=="string"?yt:(yt==null?void 0:yt.id)||this.id}filterViewState(yt){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const vt={...yt};for(const bt in this.props.viewState)bt!=="id"&&(vt[bt]=this.props.viewState[bt]);return vt}return yt}getDimensions({width:yt,height:vt}){const bt={x:getPosition(this._x,yt),y:getPosition(this._y,vt),width:getPosition(this._width,yt),height:getPosition(this._height,vt)};return this._padding&&(bt.padding={left:getPosition(this._padding.left,yt),top:getPosition(this._padding.top,vt),right:getPosition(this._padding.right,yt),bottom:getPosition(this._padding.bottom,vt)}),bt}get controller(){const yt=this.props.controller;return yt?yt===!0?{type:this.ControllerType}:typeof yt=="function"?{type:yt}:{type:this.ControllerType,...yt}:null}}class Transition{constructor(yt){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=yt}get inProgress(){return this._inProgress}start(yt){var vt,bt;this.cancel(),this.settings=yt,this._inProgress=!0,(bt=(vt=this.settings).onStart)==null||bt.call(vt,this)}end(){var yt,vt;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(vt=(yt=this.settings).onEnd)==null||vt.call(yt,this))}cancel(){var yt,vt;this._inProgress&&((vt=(yt=this.settings).onInterrupt)==null||vt.call(yt,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var yt,vt;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:bt,settings:Tt}=this;this._handle=bt.addChannel({delay:bt.getTime(),duration:Tt.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(vt=(yt=this.settings).onUpdate)==null||vt.call(yt,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const noop$2=()=>{},TRANSITION_EVENTS={BREAK:1,SNAP_TO_END:2,IGNORE:3},DEFAULT_EASING=xt=>xt,DEFAULT_INTERRUPTION=TRANSITION_EVENTS.BREAK;class TransitionManager{constructor(yt){this._onTransitionUpdate=vt=>{const{time:bt,settings:{interpolator:Tt,startProps:Et,endProps:wt,duration:St,easing:At}}=vt,Rt=At(bt/St),Pt=Tt.interpolateProps(Et,wt,Rt);this.propsInTransition=this.getControllerState({...this.props,...Pt}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=yt.getControllerState,this.propsInTransition=null,this.transition=new Transition(yt.timeline),this.onViewStateChange=yt.onViewStateChange||noop$2,this.onStateChange=yt.onStateChange||noop$2}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(yt){let vt=!1;const bt=this.props;if(this.props=yt,!bt||this._shouldIgnoreViewportChange(bt,yt))return!1;if(this._isTransitionEnabled(yt)){let Tt=bt;if(this.transition.inProgress){const{interruption:Et,endProps:wt}=this.transition.settings;Tt={...bt,...Et===TRANSITION_EVENTS.SNAP_TO_END?wt:this.propsInTransition||bt}}this._triggerTransition(Tt,yt),vt=!0}else this.transition.cancel();return vt}updateTransition(){this.transition.update()}_isTransitionEnabled(yt){const{transitionDuration:vt,transitionInterpolator:bt}=yt;return(vt>0||vt==="auto")&&!!bt}_isUpdateDueToCurrentTransition(yt){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(yt,this.propsInTransition):!1}_shouldIgnoreViewportChange(yt,vt){return this.transition.inProgress?this.transition.settings.interruption===TRANSITION_EVENTS.IGNORE||this._isUpdateDueToCurrentTransition(vt):this._isTransitionEnabled(vt)?vt.transitionInterpolator.arePropsEqual(yt,vt):!0}_triggerTransition(yt,vt){const bt=this.getControllerState(yt),Tt=this.getControllerState(vt).shortestPathFrom(bt),Et=vt.transitionInterpolator,wt=Et.getDuration?Et.getDuration(yt,vt):vt.transitionDuration;if(wt===0)return;const St=Et.initializeProps(yt,Tt);this.propsInTransition={};const At={duration:wt,easing:vt.transitionEasing||DEFAULT_EASING,interpolator:Et,interruption:vt.transitionInterruption||DEFAULT_INTERRUPTION,startProps:St.start,endProps:St.end,onStart:vt.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(vt.onTransitionInterrupt),onEnd:this._onTransitionEnd(vt.onTransitionEnd)};this.transition.start(At),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(yt){return vt=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),yt==null||yt(vt)}}}function assert(xt,yt){if(!xt)throw new Error(yt||"deck.gl: assertion failed.")}class TransitionInterpolator{constructor(yt){const{compare:vt,extract:bt,required:Tt}=yt;this._propsToCompare=vt,this._propsToExtract=bt||vt,this._requiredProps=Tt}arePropsEqual(yt,vt){for(const bt of this._propsToCompare)if(!(bt in yt)||!(bt in vt)||!equals$1(yt[bt],vt[bt]))return!1;return!0}initializeProps(yt,vt){const bt={},Tt={};for(const Et of this._propsToExtract)(Et in yt||Et in vt)&&(bt[Et]=yt[Et],Tt[Et]=vt[Et]);return this._checkRequiredProps(bt),this._checkRequiredProps(Tt),{start:bt,end:Tt}}getDuration(yt,vt){return vt.transitionDuration}_checkRequiredProps(yt){this._requiredProps&&this._requiredProps.forEach(vt=>{const bt=yt[vt];assert(Number.isFinite(bt)||Array.isArray(bt),`${vt} is required for transition`)})}}const DEFAULT_PROPS=["longitude","latitude","zoom","bearing","pitch"],DEFAULT_REQUIRED_PROPS=["longitude","latitude","zoom"];class LinearInterpolator extends TransitionInterpolator{constructor(yt={}){const vt=Array.isArray(yt)?yt:yt.transitionProps,bt=Array.isArray(yt)?{}:yt;bt.transitionProps=Array.isArray(vt)?{compare:vt,required:vt}:vt||{compare:DEFAULT_PROPS,required:DEFAULT_REQUIRED_PROPS},super(bt.transitionProps),this.opts=bt}initializeProps(yt,vt){const bt=super.initializeProps(yt,vt),{makeViewport:Tt,around:Et}=this.opts;if(Tt&&Et){const wt=Tt(yt),St=Tt(vt),At=wt.unproject(Et);bt.start.around=Et,Object.assign(bt.end,{around:St.project(At),aroundPosition:At,width:vt.width,height:vt.height})}return bt}interpolateProps(yt,vt,bt){const Tt={};for(const Et of this._propsToExtract)Tt[Et]=lerp$1(yt[Et]||0,vt[Et]||0,bt);if(vt.aroundPosition&&this.opts.makeViewport){const Et=this.opts.makeViewport({...vt,...Tt});Object.assign(Tt,Et.panByPosition(vt.aroundPosition,lerp$1(yt.around,vt.around,bt)))}return Tt}}const NO_TRANSITION_PROPS={transitionDuration:0},DEFAULT_INERTIA=300,INERTIA_EASING=xt=>1-(1-xt)*(1-xt),EVENT_TYPES={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},pinchEventWorkaround={};class Controller{constructor(yt){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new TransitionManager({...yt,getControllerState:vt=>new this.ControllerState(vt),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=yt.eventManager,this.onViewStateChange=yt.onViewStateChange||(()=>{}),this.onStateChange=yt.onStateChange||(()=>{}),this.makeViewport=yt.makeViewport}set events(yt){this.toggleEvents(this._customEvents,!1),this.toggleEvents(yt,!0),this._customEvents=yt,this.props&&this.setProps(this.props)}finalize(){var yt;for(const vt in this._events)this._events[vt]&&((yt=this.eventManager)==null||yt.off(vt,this.handleEvent));this.transitionManager.finalize()}handleEvent(yt){this._controllerState=void 0;const vt=this._eventStartBlocked;switch(yt.type){case"panstart":return vt?!1:this._onPanStart(yt);case"panmove":return this._onPan(yt);case"panend":return this._onPanEnd(yt);case"pinchstart":return vt?!1:this._onPinchStart(yt);case"pinchmove":return this._onPinch(yt);case"pinchend":return this._onPinchEnd(yt);case"multipanstart":return vt?!1:this._onMultiPanStart(yt);case"multipanmove":return this._onMultiPan(yt);case"multipanend":return this._onMultiPanEnd(yt);case"dblclick":return this._onDoubleClick(yt);case"wheel":return this._onWheel(yt);case"keydown":return this._onKeyDown(yt);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(yt){const{x:vt,y:bt}=this.props,{offsetCenter:Tt}=yt;return[Tt.x-vt,Tt.y-bt]}isPointInBounds(yt,vt){const{width:bt,height:Tt}=this.props;if(vt&&vt.handled)return!1;const Et=yt[0]>=0&&yt[0]<=bt&&yt[1]>=0&&yt[1]<=Tt;return Et&&vt&&vt.stopPropagation(),Et}isFunctionKeyPressed(yt){const{srcEvent:vt}=yt;return!!(vt.metaKey||vt.altKey||vt.ctrlKey||vt.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(yt){const vt=setTimeout(()=>{this._eventStartBlocked===vt&&(this._eventStartBlocked=null)},yt);this._eventStartBlocked=vt}setProps(yt){yt.dragMode&&(this.dragMode=yt.dragMode),this.props=yt,"transitionInterpolator"in yt||(yt.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(yt);const{inertia:vt}=yt;this.inertia=Number.isFinite(vt)?vt:vt===!0?DEFAULT_INERTIA:0;const{scrollZoom:bt=!0,dragPan:Tt=!0,dragRotate:Et=!0,doubleClickZoom:wt=!0,touchZoom:St=!0,touchRotate:At=!1,keyboard:Rt=!0}=yt,Pt=!!this.onViewStateChange;this.toggleEvents(EVENT_TYPES.WHEEL,Pt&&bt),this.toggleEvents(EVENT_TYPES.PAN,Pt),this.toggleEvents(EVENT_TYPES.PINCH,Pt&&(St||At)),this.toggleEvents(EVENT_TYPES.MULTI_PAN,Pt&&At),this.toggleEvents(EVENT_TYPES.DOUBLE_CLICK,Pt&&wt),this.toggleEvents(EVENT_TYPES.KEYBOARD,Pt&&Rt),this.scrollZoom=bt,this.dragPan=Tt,this.dragRotate=Et,this.doubleClickZoom=wt,this.touchZoom=St,this.touchRotate=At,this.keyboard=Rt}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(yt,vt){this.eventManager&&yt.forEach(bt=>{this._events[bt]!==vt&&(this._events[bt]=vt,vt?this.eventManager.on(bt,this.handleEvent):this.eventManager.off(bt,this.handleEvent))})}updateViewport(yt,vt=null,bt={}){const Tt={...yt.getViewportProps(),...vt},Et=this.controllerState!==yt;if(this.state=yt.getState(),this._setInteractionState(bt),Et){const wt=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:Tt,interactionState:this._interactionState,oldViewState:wt,viewId:this.props.id})}}_onTransition(yt){this.onViewStateChange({...yt,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(yt){Object.assign(this._interactionState,yt),this.onStateChange(this._interactionState)}_onPanStart(yt){const vt=this.getCenter(yt);if(!this.isPointInBounds(vt,yt))return!1;let bt=this.isFunctionKeyPressed(yt)||yt.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(bt=!bt);const Tt=this.controllerState[bt?"panStart":"rotateStart"]({pos:vt});return this._panMove=bt,this.updateViewport(Tt,NO_TRANSITION_PROPS,{isDragging:!0}),!0}_onPan(yt){return this.isDragging()?this._panMove?this._onPanMove(yt):this._onPanRotate(yt):!1}_onPanEnd(yt){return this.isDragging()?this._panMove?this._onPanMoveEnd(yt):this._onPanRotateEnd(yt):!1}_onPanMove(yt){if(!this.dragPan)return!1;const vt=this.getCenter(yt),bt=this.controllerState.pan({pos:vt});return this.updateViewport(bt,NO_TRANSITION_PROPS,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(yt){const{inertia:vt}=this;if(this.dragPan&&vt&&yt.velocity){const bt=this.getCenter(yt),Tt=[bt[0]+yt.velocityX*vt/2,bt[1]+yt.velocityY*vt/2],Et=this.controllerState.pan({pos:Tt}).panEnd();this.updateViewport(Et,{...this._getTransitionProps(),transitionDuration:vt,transitionEasing:INERTIA_EASING},{isDragging:!1,isPanning:!0})}else{const bt=this.controllerState.panEnd();this.updateViewport(bt,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(yt){if(!this.dragRotate)return!1;const vt=this.getCenter(yt),bt=this.controllerState.rotate({pos:vt});return this.updateViewport(bt,NO_TRANSITION_PROPS,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(yt){const{inertia:vt}=this;if(this.dragRotate&&vt&&yt.velocity){const bt=this.getCenter(yt),Tt=[bt[0]+yt.velocityX*vt/2,bt[1]+yt.velocityY*vt/2],Et=this.controllerState.rotate({pos:Tt}).rotateEnd();this.updateViewport(Et,{...this._getTransitionProps(),transitionDuration:vt,transitionEasing:INERTIA_EASING},{isDragging:!1,isRotating:!0})}else{const bt=this.controllerState.rotateEnd();this.updateViewport(bt,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(yt){if(!this.scrollZoom)return!1;const vt=this.getCenter(yt);if(!this.isPointInBounds(vt,yt))return!1;yt.srcEvent.preventDefault();const{speed:bt=.01,smooth:Tt=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:Et}=yt;let wt=2/(1+Math.exp(-Math.abs(Et*bt)));Et<0&&wt!==0&&(wt=1/wt);const St=this.controllerState.zoom({pos:vt,scale:wt});return this.updateViewport(St,{...this._getTransitionProps({around:vt}),transitionDuration:Tt?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(yt){const vt=this.getCenter(yt);if(!this.isPointInBounds(vt,yt))return!1;const bt=this.controllerState.rotateStart({pos:vt});return this.updateViewport(bt,NO_TRANSITION_PROPS,{isDragging:!0}),!0}_onMultiPan(yt){if(!this.touchRotate||!this.isDragging())return!1;const vt=this.getCenter(yt);vt[0]-=yt.deltaX;const bt=this.controllerState.rotate({pos:vt});return this.updateViewport(bt,NO_TRANSITION_PROPS,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(yt){if(!this.isDragging())return!1;const{inertia:vt}=this;if(this.touchRotate&&vt&&yt.velocityY){const bt=this.getCenter(yt),Tt=[bt[0],bt[1]+=yt.velocityY*vt/2],Et=this.controllerState.rotate({pos:Tt});this.updateViewport(Et,{...this._getTransitionProps(),transitionDuration:vt,transitionEasing:INERTIA_EASING},{isDragging:!1,isRotating:!0}),this.blockEvents(vt)}else{const bt=this.controllerState.rotateEnd();this.updateViewport(bt,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(yt){const vt=this.getCenter(yt);if(!this.isPointInBounds(vt,yt))return!1;const bt=this.controllerState.zoomStart({pos:vt}).rotateStart({pos:vt});return pinchEventWorkaround._startPinchRotation=yt.rotation,pinchEventWorkaround._lastPinchEvent=yt,this.updateViewport(bt,NO_TRANSITION_PROPS,{isDragging:!0}),!0}_onPinch(yt){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let vt=this.controllerState;if(this.touchZoom){const{scale:bt}=yt,Tt=this.getCenter(yt);vt=vt.zoom({pos:Tt,scale:bt})}if(this.touchRotate){const{rotation:bt}=yt;vt=vt.rotate({deltaAngleX:pinchEventWorkaround._startPinchRotation-bt})}return this.updateViewport(vt,NO_TRANSITION_PROPS,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),pinchEventWorkaround._lastPinchEvent=yt,!0}_onPinchEnd(yt){if(!this.isDragging())return!1;const{inertia:vt}=this,{_lastPinchEvent:bt}=pinchEventWorkaround;if(this.touchZoom&&vt&&bt&&yt.scale!==bt.scale){const Tt=this.getCenter(yt);let Et=this.controllerState.rotateEnd();const wt=Math.log2(yt.scale),St=(wt-Math.log2(bt.scale))/(yt.deltaTime-bt.deltaTime),At=Math.pow(2,wt+St*vt/2);Et=Et.zoom({pos:Tt,scale:At}).zoomEnd(),this.updateViewport(Et,{...this._getTransitionProps({around:Tt}),transitionDuration:vt,transitionEasing:INERTIA_EASING},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(vt)}else{const Tt=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(Tt,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return pinchEventWorkaround._startPinchRotation=null,pinchEventWorkaround._lastPinchEvent=null,!0}_onDoubleClick(yt){if(!this.doubleClickZoom)return!1;const vt=this.getCenter(yt);if(!this.isPointInBounds(vt,yt))return!1;const bt=this.isFunctionKeyPressed(yt),Tt=this.controllerState.zoom({pos:vt,scale:bt?.5:2});return this.updateViewport(Tt,this._getTransitionProps({around:vt}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(yt){if(!this.keyboard)return!1;const vt=this.isFunctionKeyPressed(yt),{zoomSpeed:bt,moveSpeed:Tt,rotateSpeedX:Et,rotateSpeedY:wt}=this.keyboard===!0?{}:this.keyboard,{controllerState:St}=this;let At;const Rt={};switch(yt.srcEvent.code){case"Minus":At=vt?St.zoomOut(bt).zoomOut(bt):St.zoomOut(bt),Rt.isZooming=!0;break;case"Equal":At=vt?St.zoomIn(bt).zoomIn(bt):St.zoomIn(bt),Rt.isZooming=!0;break;case"ArrowLeft":vt?(At=St.rotateLeft(Et),Rt.isRotating=!0):(At=St.moveLeft(Tt),Rt.isPanning=!0);break;case"ArrowRight":vt?(At=St.rotateRight(Et),Rt.isRotating=!0):(At=St.moveRight(Tt),Rt.isPanning=!0);break;case"ArrowUp":vt?(At=St.rotateUp(wt),Rt.isRotating=!0):(At=St.moveUp(Tt),Rt.isPanning=!0);break;case"ArrowDown":vt?(At=St.rotateDown(wt),Rt.isRotating=!0):(At=St.moveDown(Tt),Rt.isPanning=!0);break;default:return!1}return this.updateViewport(At,this._getTransitionProps(),Rt),!0}_getTransitionProps(yt){const{transition:vt}=this;return!vt||!vt.transitionInterpolator?NO_TRANSITION_PROPS:yt?{...vt,transitionInterpolator:new LinearInterpolator({...yt,...vt.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:vt}}class ViewState{constructor(yt,vt){this._viewportProps=this.applyConstraints(yt),this._state=vt}getViewportProps(){return this._viewportProps}getState(){return this._state}}const PITCH_MOUSE_THRESHOLD=5,PITCH_ACCEL=1.2;class MapState extends ViewState{constructor(yt){const{width:vt,height:bt,latitude:Tt,longitude:Et,zoom:wt,bearing:St=0,pitch:At=0,altitude:Rt=1.5,position:Pt=[0,0,0],maxZoom:Ct=20,minZoom:It=0,maxPitch:Mt=60,minPitch:Ot=0,startPanLngLat:kt,startZoomLngLat:Ft,startRotatePos:Nt,startBearing:Lt,startPitch:Dt,startZoom:$t,normalize:zt=!0}=yt;assert(Number.isFinite(Et)),assert(Number.isFinite(Tt)),assert(Number.isFinite(wt)),super({width:vt,height:bt,latitude:Tt,longitude:Et,zoom:wt,bearing:St,pitch:At,altitude:Rt,maxZoom:Ct,minZoom:It,maxPitch:Mt,minPitch:Ot,normalize:zt,position:Pt},{startPanLngLat:kt,startZoomLngLat:Ft,startRotatePos:Nt,startBearing:Lt,startPitch:Dt,startZoom:$t}),this.makeViewport=yt.makeViewport}panStart({pos:yt}){return this._getUpdatedState({startPanLngLat:this._unproject(yt)})}pan({pos:yt,startPos:vt}){const bt=this.getState().startPanLngLat||this._unproject(vt);if(!bt)return this;const Et=this.makeViewport(this.getViewportProps()).panByPosition(bt,yt);return this._getUpdatedState(Et)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:yt}){return this._getUpdatedState({startRotatePos:yt,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:yt,deltaAngleX:vt=0,deltaAngleY:bt=0}){const{startRotatePos:Tt,startBearing:Et,startPitch:wt}=this.getState();if(!Tt||Et===void 0||wt===void 0)return this;let St;return yt?St=this._getNewRotation(yt,Tt,wt,Et):St={bearing:Et+vt,pitch:wt+bt},this._getUpdatedState(St)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:yt}){return this._getUpdatedState({startZoomLngLat:this._unproject(yt),startZoom:this.getViewportProps().zoom})}zoom({pos:yt,startPos:vt,scale:bt}){let{startZoom:Tt,startZoomLngLat:Et}=this.getState();if(Et||(Tt=this.getViewportProps().zoom,Et=this._unproject(vt)||this._unproject(yt)),!Et)return this;const{maxZoom:wt,minZoom:St}=this.getViewportProps();let At=Tt+Math.log2(bt);At=clamp$1(At,St,wt);const Rt=this.makeViewport({...this.getViewportProps(),zoom:At});return this._getUpdatedState({zoom:At,...Rt.panByPosition(Et,yt)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(yt=2){return this._zoomFromCenter(yt)}zoomOut(yt=2){return this._zoomFromCenter(1/yt)}moveLeft(yt=100){return this._panFromCenter([yt,0])}moveRight(yt=100){return this._panFromCenter([-yt,0])}moveUp(yt=100){return this._panFromCenter([0,yt])}moveDown(yt=100){return this._panFromCenter([0,-yt])}rotateLeft(yt=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-yt})}rotateRight(yt=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+yt})}rotateUp(yt=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+yt})}rotateDown(yt=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-yt})}shortestPathFrom(yt){const vt=yt.getViewportProps(),bt={...this.getViewportProps()},{bearing:Tt,longitude:Et}=bt;return Math.abs(Tt-vt.bearing)>180&&(bt.bearing=Tt<0?Tt+360:Tt-360),Math.abs(Et-vt.longitude)>180&&(bt.longitude=Et<0?Et+360:Et-360),bt}applyConstraints(yt){const{maxZoom:vt,minZoom:bt,zoom:Tt}=yt;yt.zoom=clamp$1(Tt,bt,vt);const{maxPitch:Et,minPitch:wt,pitch:St}=yt;yt.pitch=clamp$1(St,wt,Et);const{normalize:At=!0}=yt;return At&&Object.assign(yt,normalizeViewportProps(yt)),yt}_zoomFromCenter(yt){const{width:vt,height:bt}=this.getViewportProps();return this.zoom({pos:[vt/2,bt/2],scale:yt})}_panFromCenter(yt){const{width:vt,height:bt}=this.getViewportProps();return this.pan({startPos:[vt/2,bt/2],pos:[vt/2+yt[0],bt/2+yt[1]]})}_getUpdatedState(yt){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...yt})}_unproject(yt){const vt=this.makeViewport(this.getViewportProps());return yt&&vt.unproject(yt)}_getNewRotation(yt,vt,bt,Tt){const Et=yt[0]-vt[0],wt=yt[1]-vt[1],St=yt[1],At=vt[1],{width:Rt,height:Pt}=this.getViewportProps(),Ct=Et/Rt;let It=0;wt>0?Math.abs(Pt-At)>PITCH_MOUSE_THRESHOLD&&(It=wt/(At-Pt)*PITCH_ACCEL):wt<0&&At>PITCH_MOUSE_THRESHOLD&&(It=1-St/At),It=clamp$1(It,-1,1);const{minPitch:Mt,maxPitch:Ot}=this.getViewportProps(),kt=Tt+180*Ct;let Ft=bt;return It>0?Ft=bt+It*(Ot-bt):It<0&&(Ft=bt-It*(Mt-bt)),{pitch:Ft,bearing:kt}}}class MapController extends Controller{constructor(){super(...arguments),this.ControllerState=MapState,this.transition={transitionDuration:300,transitionInterpolator:new LinearInterpolator({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(yt){yt.position=yt.position||[0,0,0];const vt=this.props;super.setProps(yt),(!vt||vt.height!==yt.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...yt,...this.state}))}}class MapView extends View{constructor(yt={}){super(yt)}getViewportType(){return WebMercatorViewport}get ControllerType(){return MapController}}MapView.displayName="MapView";const DEFAULT_LIGHTING_EFFECT=new LightingEffect;function compareEffects(xt,yt){const vt=xt.order??1/0,bt=yt.order??1/0;return vt-bt}class EffectManager{constructor(yt){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=yt,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(yt){const vt=this._defaultEffects;if(!vt.find(bt=>bt.id===yt.id)){const bt=vt.findIndex(Tt=>compareEffects(Tt,yt)>0);bt<0?vt.push(yt):vt.splice(bt,0,yt),yt.setup(this._context),this._setEffects(this.effects)}}setProps(yt){"effects"in yt&&(deepEqual(yt.effects,this.effects,1)||this._setEffects(yt.effects))}needsRedraw(yt={clearRedrawFlags:!1}){const vt=this._needsRedraw;return yt.clearRedrawFlags&&(this._needsRedraw=!1),vt}getEffects(){return this._resolvedEffects}_setEffects(yt){const vt={};for(const Tt of this.effects)vt[Tt.id]=Tt;const bt=[];for(const Tt of yt){const Et=vt[Tt.id];let wt=Tt;Et&&Et!==Tt?Et.setProps?(Et.setProps(Tt.props),wt=Et):Et.cleanup(this._context):Et||Tt.setup(this._context),bt.push(wt),delete vt[Tt.id]}for(const Tt in vt)vt[Tt].cleanup(this._context);this.effects=bt,this._resolvedEffects=bt.concat(this._defaultEffects),yt.some(Tt=>Tt instanceof LightingEffect)||this._resolvedEffects.push(DEFAULT_LIGHTING_EFFECT),this._needsRedraw="effects changed"}finalize(){for(const yt of this._resolvedEffects)yt.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class DrawLayersPass extends LayersPass{shouldDrawLayer(yt){const{operation:vt}=yt.props;return vt.includes("draw")||vt.includes("terrain")}}const TRACE_RENDER_LAYERS$1="deckRenderer.renderLayers";class DeckRenderer{constructor(yt){this.device=yt,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new DrawLayersPass(yt),this.pickLayersPass=new PickLayersPass(yt),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(yt){this.layerFilter!==yt.layerFilter&&(this.layerFilter=yt.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==yt.drawPickingColors&&(this.drawPickingColors=yt.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(yt){if(!yt.viewports.length)return;const vt=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,bt={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...yt};bt.effects&&this._preRender(bt.effects,bt);const Tt=this.lastPostProcessEffect?this.renderBuffers[0]:bt.target;this.lastPostProcessEffect&&(bt.clearColor=[0,0,0,0],bt.clearCanvas=!0);const Et=vt.render({...bt,target:Tt});bt.effects&&this._postRender(bt.effects,bt),this.renderCount++,debug(TRACE_RENDER_LAYERS$1,this,Et,yt)}needsRedraw(yt={clearRedrawFlags:!1}){const vt=this._needsRedraw;return yt.clearRedrawFlags&&(this._needsRedraw=!1),vt}finalize(){const{renderBuffers:yt}=this;for(const vt of yt)vt.delete();yt.length=0}_preRender(yt,vt){this.lastPostProcessEffect=null,vt.preRenderStats=vt.preRenderStats||{};for(const bt of yt)vt.preRenderStats[bt.id]=bt.preRender(vt),bt.postRender&&(this.lastPostProcessEffect=bt.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:yt}=this,vt=this.device.canvasContext.getDrawingBufferSize();yt.length===0&&[0,1].map(bt=>{const Tt=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});yt.push(this.device.createFramebuffer({id:`deck-renderbuffer-${bt}`,colorAttachments:[Tt]}))});for(const bt of yt)bt.resize(vt)}_postRender(yt,vt){const{renderBuffers:bt}=this,Tt={...vt,inputBuffer:bt[0],swapBuffer:bt[1]};for(const Et of yt)if(Et.postRender){Tt.target=Et.id===this.lastPostProcessEffect?vt.target:void 0;const wt=Et.postRender(Tt);Tt.inputBuffer=wt,Tt.swapBuffer=wt===bt[0]?bt[1]:bt[0]}}}const NO_PICKED_OBJECT={pickedColor:null,pickedObjectIndex:-1};function getClosestObject({pickedColors:xt,decodePickingColor:yt,deviceX:vt,deviceY:bt,deviceRadius:Tt,deviceRect:Et}){const{x:wt,y:St,width:At,height:Rt}=Et;let Pt=Tt*Tt,Ct=-1,It=0;for(let Mt=0;Mt<Rt;Mt++){const Ot=Mt+St-bt,kt=Ot*Ot;if(kt>Pt)It+=4*At;else for(let Ft=0;Ft<At;Ft++){if(xt[It+3]-1>=0){const Lt=Ft+wt-vt,Dt=Lt*Lt+kt;Dt<=Pt&&(Pt=Dt,Ct=It)}It+=4}}if(Ct>=0){const Mt=xt.slice(Ct,Ct+4),Ot=yt(Mt);if(Ot){const kt=Math.floor(Ct/4/At),Ft=Ct/4-kt*At;return{...Ot,pickedColor:Mt,pickedX:wt+Ft,pickedY:St+kt}}defaultLogger.error("Picked non-existent layer. Is picking buffer corrupt?")()}return NO_PICKED_OBJECT}function getUniqueObjects({pickedColors:xt,decodePickingColor:yt}){const vt=new Map;if(xt){for(let bt=0;bt<xt.length;bt+=4)if(xt[bt+3]-1>=0){const Et=xt.slice(bt,bt+4),wt=Et.join(",");if(!vt.has(wt)){const St=yt(Et);St?vt.set(wt,{...St,color:Et}):defaultLogger.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(vt.values())}function getEmptyPickingInfo({pickInfo:xt,viewports:yt,pixelRatio:vt,x:bt,y:Tt,z:Et}){let wt=yt[0];yt.length>1&&(wt=getViewportFromCoordinates((xt==null?void 0:xt.pickedViewports)||yt,{x:bt,y:Tt}));let St;if(wt){const At=[bt-wt.x,Tt-wt.y];Et!==void 0&&(At[2]=Et),St=wt.unproject(At)}return{color:null,layer:null,viewport:wt,index:-1,picked:!1,x:bt,y:Tt,pixel:[bt,Tt],coordinate:St,devicePixel:xt&&"pickedX"in xt?[xt.pickedX,xt.pickedY]:void 0,pixelRatio:vt}}function processPickInfo(xt){const{pickInfo:yt,lastPickedInfo:vt,mode:bt,layers:Tt}=xt,{pickedColor:Et,pickedLayer:wt,pickedObjectIndex:St}=yt,At=wt?[wt]:[];if(bt==="hover"){const Ct=vt.index,It=vt.layerId,Mt=wt?wt.props.id:null;if(Mt!==It||St!==Ct){if(Mt!==It){const Ot=Tt.find(kt=>kt.props.id===It);Ot&&At.unshift(Ot)}vt.layerId=Mt,vt.index=St,vt.info=null}}const Rt=getEmptyPickingInfo(xt),Pt=new Map;return Pt.set(null,Rt),At.forEach(Ct=>{let It={...Rt};Ct===wt&&(It.color=Et,It.index=St,It.picked=!0),It=getLayerPickingInfo({layer:Ct,info:It,mode:bt});const Mt=It.layer;Ct===wt&&bt==="hover"&&(vt.info=It),Pt.set(Mt.id,It),bt==="hover"&&Mt.updateAutoHighlight(It)}),Pt}function getLayerPickingInfo({layer:xt,info:yt,mode:vt}){for(;xt&&yt;){const bt=yt.layer||null;yt.sourceLayer=bt,yt.layer=xt,yt=xt.getPickingInfo({info:yt,mode:vt,sourceLayer:bt}),xt=xt.parent}return yt}function getViewportFromCoordinates(xt,yt){for(let vt=xt.length-1;vt>=0;vt--){const bt=xt[vt];if(bt.containsPixel(yt))return bt}return xt[0]}class DeckPicker{constructor(yt){this._pickable=!0,this.device=yt,this.pickLayersPass=new PickLayersPass(yt),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(yt){"layerFilter"in yt&&(this.layerFilter=yt.layerFilter),"_pickable"in yt&&(this._pickable=yt._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(yt){return this._pickClosestObject(yt)}pickObjects(yt){return this._pickVisibleObjects(yt)}getLastPickedObject({x:yt,y:vt,layers:bt,viewports:Tt},Et=this.lastPickedInfo.info){const wt=Et&&Et.layer&&Et.layer.id,St=Et&&Et.viewport&&Et.viewport.id,At=wt?bt.find(It=>It.id===wt):null,Rt=St&&Tt.find(It=>It.id===St)||Tt[0],Pt=Rt&&Rt.unproject([yt-Rt.x,vt-Rt.y]);return{...Et,...{x:yt,y:vt,viewport:Rt,coordinate:Pt,layer:At}}}_resizeBuffer(){var vt,bt;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const Tt=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=Tt}const{canvas:yt}=this.device.getDefaultCanvasContext();(vt=this.pickingFBO)==null||vt.resize({width:yt.width,height:yt.height}),(bt=this.depthFBO)==null||bt.resize({width:yt.width,height:yt.height})}_getPickable(yt){if(this._pickable===!1)return null;const vt=yt.filter(bt=>this.pickLayersPass.shouldDrawLayer(bt)&&!bt.isComposite);return vt.length?vt:null}_pickClosestObject({layers:yt,views:vt,viewports:bt,x:Tt,y:Et,radius:wt=0,depth:St=1,mode:At="query",unproject3D:Rt,onViewportActive:Pt,effects:Ct}){const It=this.device.canvasContext.cssToDeviceRatio(),Mt=this._getPickable(yt);if(!Mt||bt.length===0)return{result:[],emptyInfo:getEmptyPickingInfo({viewports:bt,x:Tt,y:Et,pixelRatio:It})};this._resizeBuffer();const Ot=this.device.canvasContext.cssToDevicePixels([Tt,Et],!0),kt=[Ot.x+Math.floor(Ot.width/2),Ot.y+Math.floor(Ot.height/2)],Ft=Math.round(wt*It),{width:Nt,height:Lt}=this.pickingFBO,Dt=this._getPickingRect({deviceX:kt[0],deviceY:kt[1],deviceRadius:Ft,deviceWidth:Nt,deviceHeight:Lt}),$t={x:Tt-wt,y:Et-wt,width:wt*2+1,height:wt*2+1};let zt;const Ut=[],jt=new Set;for(let Ht=0;Ht<St;Ht++){let Vt;if(Dt){const Yt=this._drawAndSample({layers:Mt,views:vt,viewports:bt,onViewportActive:Pt,deviceRect:Dt,cullRect:$t,effects:Ct,pass:`picking:${At}`});Vt=getClosestObject({...Yt,deviceX:kt[0],deviceY:kt[1],deviceRadius:Ft,deviceRect:Dt})}else Vt={pickedColor:null,pickedObjectIndex:-1};let Wt;if(Vt.pickedLayer&&Rt&&this.depthFBO){const{pickedColors:Yt}=this._drawAndSample({layers:[Vt.pickedLayer],views:vt,viewports:bt,onViewportActive:Pt,deviceRect:{x:Vt.pickedX,y:Vt.pickedY,width:1,height:1},cullRect:$t,effects:Ct,pass:`picking:${At}:z`},!0);Yt[3]&&(Wt=Yt[0])}Vt.pickedLayer&&Ht+1<St&&(jt.add(Vt.pickedLayer),Vt.pickedLayer.disablePickingIndex(Vt.pickedObjectIndex)),zt=processPickInfo({pickInfo:Vt,lastPickedInfo:this.lastPickedInfo,mode:At,layers:Mt,viewports:bt,x:Tt,y:Et,z:Wt,pixelRatio:It});for(const Yt of zt.values())Yt.layer&&Ut.push(Yt);if(!Vt.pickedColor)break}for(const Ht of jt)Ht.restorePickingColors();return{result:Ut,emptyInfo:zt.get(null)}}_pickVisibleObjects({layers:yt,views:vt,viewports:bt,x:Tt,y:Et,width:wt=1,height:St=1,mode:At="query",maxObjects:Rt=null,onViewportActive:Pt,effects:Ct}){const It=this._getPickable(yt);if(!It||bt.length===0)return[];this._resizeBuffer();const Mt=this.device.canvasContext.cssToDeviceRatio(),Ot=this.device.canvasContext.cssToDevicePixels([Tt,Et],!0),kt=Ot.x,Ft=Ot.y+Ot.height,Nt=this.device.canvasContext.cssToDevicePixels([Tt+wt,Et+St],!0),Lt=Nt.x+Nt.width,Dt=Nt.y,$t={x:kt,y:Dt,width:Lt-kt,height:Ft-Dt},zt=this._drawAndSample({layers:It,views:vt,viewports:bt,onViewportActive:Pt,deviceRect:$t,cullRect:{x:Tt,y:Et,width:wt,height:St},effects:Ct,pass:`picking:${At}`}),Ut=getUniqueObjects(zt),jt=new Map,Ht=[],Vt=Number.isFinite(Rt);for(let Wt=0;Wt<Ut.length&&!(Vt&&Ht.length>=Rt);Wt++){const Yt=Ut[Wt];let Kt={color:Yt.pickedColor,layer:null,index:Yt.pickedObjectIndex,picked:!0,x:Tt,y:Et,pixelRatio:Mt};Kt=getLayerPickingInfo({layer:Yt.pickedLayer,info:Kt,mode:At});const Zt=Kt.layer.id;jt.has(Zt)||jt.set(Zt,new Set);const Xt=jt.get(Zt),en=Kt.object??Kt.index;Xt.has(en)||(Xt.add(en),Ht.push(Kt))}return Ht}_drawAndSample({layers:yt,views:vt,viewports:bt,onViewportActive:Tt,deviceRect:Et,cullRect:wt,effects:St,pass:At},Rt=!1){const Pt=Rt?this.depthFBO:this.pickingFBO,Ct={layers:yt,layerFilter:this.layerFilter,views:vt,viewports:bt,onViewportActive:Tt,pickingFBO:Pt,deviceRect:Et,cullRect:wt,effects:St,pass:At,pickZ:Rt,preRenderStats:{},isPicking:!0};for(const Lt of St)Lt.useInPicking&&(Ct.preRenderStats[Lt.id]=Lt.preRender(Ct));const{decodePickingColor:It}=this.pickLayersPass.render(Ct),{x:Mt,y:Ot,width:kt,height:Ft}=Et,Nt=new(Rt?Float32Array:Uint8Array)(kt*Ft*4);return this.device.readPixelsToArrayWebGL(Pt,{sourceX:Mt,sourceY:Ot,sourceWidth:kt,sourceHeight:Ft,target:Nt}),{pickedColors:Nt,decodePickingColor:It}}_getPickingRect({deviceX:yt,deviceY:vt,deviceRadius:bt,deviceWidth:Tt,deviceHeight:Et}){const wt=Math.max(0,yt-bt),St=Math.max(0,vt-bt),At=Math.min(Tt,yt+bt+1)-wt,Rt=Math.min(Et,vt+bt+1)-St;return At<=0||Rt<=0?null:{x:wt,y:St,width:At,height:Rt}}}const PLACEMENTS={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},DEFAULT_PLACEMENT="top-left",ROOT_CONTAINER_ID="__root";class WidgetManager{constructor({deck:yt,parentElement:vt}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=yt,this.parentElement=vt}getWidgets(){return this.resolvedWidgets}setProps(yt){yt.widgets&&!deepEqual(yt.widgets,this.widgets,1)&&this._setWidgets(yt.widgets)}finalize(){for(const yt of this.getWidgets())this._remove(yt);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const yt in this.containers)this.containers[yt].remove()}addDefault(yt){this.defaultWidgets.find(vt=>vt.id===yt.id)||(this._add(yt),this.defaultWidgets.push(yt),this._setWidgets(this.widgets))}_setWidgets(yt){const vt={};for(const bt of this.resolvedWidgets)vt[bt.id]=bt;this.resolvedWidgets.length=0;for(const bt of this.defaultWidgets)vt[bt.id]=null,this.resolvedWidgets.push(bt);for(let bt of yt){const Tt=vt[bt.id];Tt?Tt.viewId!==bt.viewId||Tt.placement!==bt.placement?(this._remove(Tt),this._add(bt)):bt!==Tt&&(Tt.setProps(bt.props),bt=Tt):this._add(bt),vt[bt.id]=null,this.resolvedWidgets.push(bt)}for(const bt in vt){const Tt=vt[bt];Tt&&this._remove(Tt)}this.widgets=yt}_add(yt){const{viewId:vt=null,placement:bt=DEFAULT_PLACEMENT}=yt,Tt=yt.onAdd({deck:this.deck,viewId:vt});Tt&&this._getContainer(vt,bt).append(Tt),yt._element=Tt}_remove(yt){var vt;(vt=yt.onRemove)==null||vt.call(yt),yt._element&&yt._element.remove(),yt._element=void 0}_getContainer(yt,vt){var wt;const bt=yt||ROOT_CONTAINER_ID;let Tt=this.containers[bt];Tt||(Tt=document.createElement("div"),Tt.style.pointerEvents="none",Tt.style.position="absolute",Tt.style.overflow="hidden",(wt=this.parentElement)==null||wt.append(Tt),this.containers[bt]=Tt);let Et=Tt.querySelector(`.${vt}`);return Et||(Et=document.createElement("div"),Et.className=vt,Et.style.position="absolute",Et.style.zIndex="2",Object.assign(Et.style,PLACEMENTS[vt]),Tt.append(Et)),Et}_updateContainers(){const yt=this.deck.width,vt=this.deck.height;for(const bt in this.containers){const Tt=this.lastViewports[bt]||null,Et=bt===ROOT_CONTAINER_ID||Tt,wt=this.containers[bt];Et?(wt.style.display="block",wt.style.left=`${Tt?Tt.x:0}px`,wt.style.top=`${Tt?Tt.y:0}px`,wt.style.width=`${Tt?Tt.width:yt}px`,wt.style.height=`${Tt?Tt.height:vt}px`):wt.style.display="none"}}onRedraw({viewports:yt,layers:vt}){var Tt,Et;const bt=yt.reduce((wt,St)=>(wt[St.id]=St,wt),{});for(const wt of this.getWidgets()){const{viewId:St}=wt;if(St){const At=bt[St];At&&(wt.onViewportChange&&wt.onViewportChange(At),(Tt=wt.onRedraw)==null||Tt.call(wt,{viewports:[At],layers:vt}))}else{if(wt.onViewportChange)for(const At of yt)wt.onViewportChange(At);(Et=wt.onRedraw)==null||Et.call(wt,{viewports:yt,layers:vt})}}this.lastViewports=bt,this._updateContainers()}onHover(yt,vt){var bt,Tt;for(const Et of this.getWidgets()){const{viewId:wt}=Et;(!wt||wt===((bt=yt.viewport)==null?void 0:bt.id))&&((Tt=Et.onHover)==null||Tt.call(Et,yt,vt))}}onEvent(yt,vt){var Tt,Et;const bt=EVENT_HANDLERS[vt.type];if(bt)for(const wt of this.getWidgets()){const{viewId:St}=wt;(!St||St===((Tt=yt.viewport)==null?void 0:Tt.id))&&((Et=wt[bt])==null||Et.call(wt,yt,vt))}}}const defaultStyle={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Tooltip{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:yt}){const vt=document.createElement("div");return vt.className="deck-tooltip",Object.assign(vt.style,defaultStyle),this.deck=yt,this.element=vt,vt}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(yt){var vt;this.isVisible&&yt.id===((vt=this.lastViewport)==null?void 0:vt.id)&&yt!==this.lastViewport&&this.setTooltip(null)}onHover(yt){const{deck:vt}=this,bt=vt&&vt.props.getTooltip;if(!bt)return;const Tt=bt(yt);this.lastViewport=yt.viewport,this.setTooltip(Tt,yt.x,yt.y)}setTooltip(yt,vt,bt){const Tt=this.element;if(Tt){if(typeof yt=="string")Tt.innerText=yt;else if(yt)yt.text&&(Tt.innerText=yt.text),yt.html&&(Tt.innerHTML=yt.html),yt.className&&(Tt.className=yt.className);else{this.isVisible=!1,Tt.style.display="none";return}this.isVisible=!0,Tt.style.display="block",Tt.style.transform=`translate(${vt}px, ${bt}px)`,yt&&typeof yt=="object"&&"style"in yt&&Object.assign(Tt.style,yt.style)}}}var GLEnum;(function(xt){xt[xt.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",xt[xt.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",xt[xt.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",xt[xt.POINTS=0]="POINTS",xt[xt.LINES=1]="LINES",xt[xt.LINE_LOOP=2]="LINE_LOOP",xt[xt.LINE_STRIP=3]="LINE_STRIP",xt[xt.TRIANGLES=4]="TRIANGLES",xt[xt.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",xt[xt.TRIANGLE_FAN=6]="TRIANGLE_FAN",xt[xt.ZERO=0]="ZERO",xt[xt.ONE=1]="ONE",xt[xt.SRC_COLOR=768]="SRC_COLOR",xt[xt.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",xt[xt.SRC_ALPHA=770]="SRC_ALPHA",xt[xt.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",xt[xt.DST_ALPHA=772]="DST_ALPHA",xt[xt.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",xt[xt.DST_COLOR=774]="DST_COLOR",xt[xt.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",xt[xt.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",xt[xt.CONSTANT_COLOR=32769]="CONSTANT_COLOR",xt[xt.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",xt[xt.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",xt[xt.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",xt[xt.FUNC_ADD=32774]="FUNC_ADD",xt[xt.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",xt[xt.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",xt[xt.BLEND_EQUATION=32777]="BLEND_EQUATION",xt[xt.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",xt[xt.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",xt[xt.BLEND_DST_RGB=32968]="BLEND_DST_RGB",xt[xt.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",xt[xt.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",xt[xt.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",xt[xt.BLEND_COLOR=32773]="BLEND_COLOR",xt[xt.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",xt[xt.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",xt[xt.LINE_WIDTH=2849]="LINE_WIDTH",xt[xt.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",xt[xt.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",xt[xt.CULL_FACE_MODE=2885]="CULL_FACE_MODE",xt[xt.FRONT_FACE=2886]="FRONT_FACE",xt[xt.DEPTH_RANGE=2928]="DEPTH_RANGE",xt[xt.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",xt[xt.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",xt[xt.DEPTH_FUNC=2932]="DEPTH_FUNC",xt[xt.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",xt[xt.STENCIL_FUNC=2962]="STENCIL_FUNC",xt[xt.STENCIL_FAIL=2964]="STENCIL_FAIL",xt[xt.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",xt[xt.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",xt[xt.STENCIL_REF=2967]="STENCIL_REF",xt[xt.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",xt[xt.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",xt[xt.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",xt[xt.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",xt[xt.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",xt[xt.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",xt[xt.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",xt[xt.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",xt[xt.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",xt[xt.VIEWPORT=2978]="VIEWPORT",xt[xt.SCISSOR_BOX=3088]="SCISSOR_BOX",xt[xt.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",xt[xt.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",xt[xt.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",xt[xt.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",xt[xt.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",xt[xt.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",xt[xt.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",xt[xt.RED_BITS=3410]="RED_BITS",xt[xt.GREEN_BITS=3411]="GREEN_BITS",xt[xt.BLUE_BITS=3412]="BLUE_BITS",xt[xt.ALPHA_BITS=3413]="ALPHA_BITS",xt[xt.DEPTH_BITS=3414]="DEPTH_BITS",xt[xt.STENCIL_BITS=3415]="STENCIL_BITS",xt[xt.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",xt[xt.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",xt[xt.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",xt[xt.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",xt[xt.SAMPLES=32937]="SAMPLES",xt[xt.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",xt[xt.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",xt[xt.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",xt[xt.VENDOR=7936]="VENDOR",xt[xt.RENDERER=7937]="RENDERER",xt[xt.VERSION=7938]="VERSION",xt[xt.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",xt[xt.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",xt[xt.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",xt[xt.STATIC_DRAW=35044]="STATIC_DRAW",xt[xt.STREAM_DRAW=35040]="STREAM_DRAW",xt[xt.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",xt[xt.ARRAY_BUFFER=34962]="ARRAY_BUFFER",xt[xt.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",xt[xt.BUFFER_SIZE=34660]="BUFFER_SIZE",xt[xt.BUFFER_USAGE=34661]="BUFFER_USAGE",xt[xt.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",xt[xt.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",xt[xt.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",xt[xt.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",xt[xt.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",xt[xt.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",xt[xt.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",xt[xt.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",xt[xt.CULL_FACE=2884]="CULL_FACE",xt[xt.FRONT=1028]="FRONT",xt[xt.BACK=1029]="BACK",xt[xt.FRONT_AND_BACK=1032]="FRONT_AND_BACK",xt[xt.BLEND=3042]="BLEND",xt[xt.DEPTH_TEST=2929]="DEPTH_TEST",xt[xt.DITHER=3024]="DITHER",xt[xt.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",xt[xt.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",xt[xt.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",xt[xt.SCISSOR_TEST=3089]="SCISSOR_TEST",xt[xt.STENCIL_TEST=2960]="STENCIL_TEST",xt[xt.NO_ERROR=0]="NO_ERROR",xt[xt.INVALID_ENUM=1280]="INVALID_ENUM",xt[xt.INVALID_VALUE=1281]="INVALID_VALUE",xt[xt.INVALID_OPERATION=1282]="INVALID_OPERATION",xt[xt.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",xt[xt.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",xt[xt.CW=2304]="CW",xt[xt.CCW=2305]="CCW",xt[xt.DONT_CARE=4352]="DONT_CARE",xt[xt.FASTEST=4353]="FASTEST",xt[xt.NICEST=4354]="NICEST",xt[xt.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",xt[xt.BYTE=5120]="BYTE",xt[xt.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",xt[xt.SHORT=5122]="SHORT",xt[xt.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",xt[xt.INT=5124]="INT",xt[xt.UNSIGNED_INT=5125]="UNSIGNED_INT",xt[xt.FLOAT=5126]="FLOAT",xt[xt.DOUBLE=5130]="DOUBLE",xt[xt.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",xt[xt.ALPHA=6406]="ALPHA",xt[xt.RGB=6407]="RGB",xt[xt.RGBA=6408]="RGBA",xt[xt.LUMINANCE=6409]="LUMINANCE",xt[xt.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",xt[xt.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",xt[xt.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",xt[xt.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",xt[xt.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",xt[xt.VERTEX_SHADER=35633]="VERTEX_SHADER",xt[xt.COMPILE_STATUS=35713]="COMPILE_STATUS",xt[xt.DELETE_STATUS=35712]="DELETE_STATUS",xt[xt.LINK_STATUS=35714]="LINK_STATUS",xt[xt.VALIDATE_STATUS=35715]="VALIDATE_STATUS",xt[xt.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",xt[xt.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",xt[xt.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",xt[xt.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",xt[xt.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",xt[xt.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",xt[xt.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",xt[xt.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",xt[xt.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",xt[xt.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",xt[xt.SHADER_TYPE=35663]="SHADER_TYPE",xt[xt.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",xt[xt.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",xt[xt.NEVER=512]="NEVER",xt[xt.LESS=513]="LESS",xt[xt.EQUAL=514]="EQUAL",xt[xt.LEQUAL=515]="LEQUAL",xt[xt.GREATER=516]="GREATER",xt[xt.NOTEQUAL=517]="NOTEQUAL",xt[xt.GEQUAL=518]="GEQUAL",xt[xt.ALWAYS=519]="ALWAYS",xt[xt.KEEP=7680]="KEEP",xt[xt.REPLACE=7681]="REPLACE",xt[xt.INCR=7682]="INCR",xt[xt.DECR=7683]="DECR",xt[xt.INVERT=5386]="INVERT",xt[xt.INCR_WRAP=34055]="INCR_WRAP",xt[xt.DECR_WRAP=34056]="DECR_WRAP",xt[xt.NEAREST=9728]="NEAREST",xt[xt.LINEAR=9729]="LINEAR",xt[xt.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",xt[xt.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",xt[xt.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",xt[xt.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",xt[xt.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",xt[xt.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",xt[xt.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",xt[xt.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",xt[xt.TEXTURE_2D=3553]="TEXTURE_2D",xt[xt.TEXTURE=5890]="TEXTURE",xt[xt.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",xt[xt.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",xt[xt.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",xt[xt.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",xt[xt.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",xt[xt.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",xt[xt.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",xt[xt.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",xt[xt.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",xt[xt.TEXTURE0=33984]="TEXTURE0",xt[xt.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",xt[xt.REPEAT=10497]="REPEAT",xt[xt.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",xt[xt.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",xt[xt.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",xt[xt.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",xt[xt.FLOAT_VEC2=35664]="FLOAT_VEC2",xt[xt.FLOAT_VEC3=35665]="FLOAT_VEC3",xt[xt.FLOAT_VEC4=35666]="FLOAT_VEC4",xt[xt.INT_VEC2=35667]="INT_VEC2",xt[xt.INT_VEC3=35668]="INT_VEC3",xt[xt.INT_VEC4=35669]="INT_VEC4",xt[xt.BOOL=35670]="BOOL",xt[xt.BOOL_VEC2=35671]="BOOL_VEC2",xt[xt.BOOL_VEC3=35672]="BOOL_VEC3",xt[xt.BOOL_VEC4=35673]="BOOL_VEC4",xt[xt.FLOAT_MAT2=35674]="FLOAT_MAT2",xt[xt.FLOAT_MAT3=35675]="FLOAT_MAT3",xt[xt.FLOAT_MAT4=35676]="FLOAT_MAT4",xt[xt.SAMPLER_2D=35678]="SAMPLER_2D",xt[xt.SAMPLER_CUBE=35680]="SAMPLER_CUBE",xt[xt.LOW_FLOAT=36336]="LOW_FLOAT",xt[xt.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",xt[xt.HIGH_FLOAT=36338]="HIGH_FLOAT",xt[xt.LOW_INT=36339]="LOW_INT",xt[xt.MEDIUM_INT=36340]="MEDIUM_INT",xt[xt.HIGH_INT=36341]="HIGH_INT",xt[xt.FRAMEBUFFER=36160]="FRAMEBUFFER",xt[xt.RENDERBUFFER=36161]="RENDERBUFFER",xt[xt.RGBA4=32854]="RGBA4",xt[xt.RGB5_A1=32855]="RGB5_A1",xt[xt.RGB565=36194]="RGB565",xt[xt.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",xt[xt.STENCIL_INDEX=6401]="STENCIL_INDEX",xt[xt.STENCIL_INDEX8=36168]="STENCIL_INDEX8",xt[xt.DEPTH_STENCIL=34041]="DEPTH_STENCIL",xt[xt.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",xt[xt.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",xt[xt.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",xt[xt.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",xt[xt.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",xt[xt.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",xt[xt.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",xt[xt.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",xt[xt.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",xt[xt.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",xt[xt.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",xt[xt.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",xt[xt.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",xt[xt.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",xt[xt.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",xt[xt.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",xt[xt.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",xt[xt.NONE=0]="NONE",xt[xt.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",xt[xt.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",xt[xt.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",xt[xt.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",xt[xt.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",xt[xt.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",xt[xt.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",xt[xt.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",xt[xt.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",xt[xt.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",xt[xt.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",xt[xt.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",xt[xt.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",xt[xt.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",xt[xt.READ_BUFFER=3074]="READ_BUFFER",xt[xt.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",xt[xt.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",xt[xt.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",xt[xt.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",xt[xt.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",xt[xt.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",xt[xt.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",xt[xt.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",xt[xt.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",xt[xt.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",xt[xt.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",xt[xt.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",xt[xt.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",xt[xt.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",xt[xt.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",xt[xt.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",xt[xt.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",xt[xt.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",xt[xt.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",xt[xt.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",xt[xt.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",xt[xt.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",xt[xt.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",xt[xt.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",xt[xt.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",xt[xt.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",xt[xt.RED=6403]="RED",xt[xt.RGB8=32849]="RGB8",xt[xt.RGBA8=32856]="RGBA8",xt[xt.RGB10_A2=32857]="RGB10_A2",xt[xt.TEXTURE_3D=32879]="TEXTURE_3D",xt[xt.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",xt[xt.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",xt[xt.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",xt[xt.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",xt[xt.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",xt[xt.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",xt[xt.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",xt[xt.SRGB=35904]="SRGB",xt[xt.SRGB8=35905]="SRGB8",xt[xt.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",xt[xt.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",xt[xt.RGBA32F=34836]="RGBA32F",xt[xt.RGB32F=34837]="RGB32F",xt[xt.RGBA16F=34842]="RGBA16F",xt[xt.RGB16F=34843]="RGB16F",xt[xt.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",xt[xt.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",xt[xt.R11F_G11F_B10F=35898]="R11F_G11F_B10F",xt[xt.RGB9_E5=35901]="RGB9_E5",xt[xt.RGBA32UI=36208]="RGBA32UI",xt[xt.RGB32UI=36209]="RGB32UI",xt[xt.RGBA16UI=36214]="RGBA16UI",xt[xt.RGB16UI=36215]="RGB16UI",xt[xt.RGBA8UI=36220]="RGBA8UI",xt[xt.RGB8UI=36221]="RGB8UI",xt[xt.RGBA32I=36226]="RGBA32I",xt[xt.RGB32I=36227]="RGB32I",xt[xt.RGBA16I=36232]="RGBA16I",xt[xt.RGB16I=36233]="RGB16I",xt[xt.RGBA8I=36238]="RGBA8I",xt[xt.RGB8I=36239]="RGB8I",xt[xt.RED_INTEGER=36244]="RED_INTEGER",xt[xt.RGB_INTEGER=36248]="RGB_INTEGER",xt[xt.RGBA_INTEGER=36249]="RGBA_INTEGER",xt[xt.R8=33321]="R8",xt[xt.RG8=33323]="RG8",xt[xt.R16F=33325]="R16F",xt[xt.R32F=33326]="R32F",xt[xt.RG16F=33327]="RG16F",xt[xt.RG32F=33328]="RG32F",xt[xt.R8I=33329]="R8I",xt[xt.R8UI=33330]="R8UI",xt[xt.R16I=33331]="R16I",xt[xt.R16UI=33332]="R16UI",xt[xt.R32I=33333]="R32I",xt[xt.R32UI=33334]="R32UI",xt[xt.RG8I=33335]="RG8I",xt[xt.RG8UI=33336]="RG8UI",xt[xt.RG16I=33337]="RG16I",xt[xt.RG16UI=33338]="RG16UI",xt[xt.RG32I=33339]="RG32I",xt[xt.RG32UI=33340]="RG32UI",xt[xt.R8_SNORM=36756]="R8_SNORM",xt[xt.RG8_SNORM=36757]="RG8_SNORM",xt[xt.RGB8_SNORM=36758]="RGB8_SNORM",xt[xt.RGBA8_SNORM=36759]="RGBA8_SNORM",xt[xt.RGB10_A2UI=36975]="RGB10_A2UI",xt[xt.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",xt[xt.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",xt[xt.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",xt[xt.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",xt[xt.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",xt[xt.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",xt[xt.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",xt[xt.HALF_FLOAT=5131]="HALF_FLOAT",xt[xt.RG=33319]="RG",xt[xt.RG_INTEGER=33320]="RG_INTEGER",xt[xt.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",xt[xt.CURRENT_QUERY=34917]="CURRENT_QUERY",xt[xt.QUERY_RESULT=34918]="QUERY_RESULT",xt[xt.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",xt[xt.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",xt[xt.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",xt[xt.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",xt[xt.DRAW_BUFFER0=34853]="DRAW_BUFFER0",xt[xt.DRAW_BUFFER1=34854]="DRAW_BUFFER1",xt[xt.DRAW_BUFFER2=34855]="DRAW_BUFFER2",xt[xt.DRAW_BUFFER3=34856]="DRAW_BUFFER3",xt[xt.DRAW_BUFFER4=34857]="DRAW_BUFFER4",xt[xt.DRAW_BUFFER5=34858]="DRAW_BUFFER5",xt[xt.DRAW_BUFFER6=34859]="DRAW_BUFFER6",xt[xt.DRAW_BUFFER7=34860]="DRAW_BUFFER7",xt[xt.DRAW_BUFFER8=34861]="DRAW_BUFFER8",xt[xt.DRAW_BUFFER9=34862]="DRAW_BUFFER9",xt[xt.DRAW_BUFFER10=34863]="DRAW_BUFFER10",xt[xt.DRAW_BUFFER11=34864]="DRAW_BUFFER11",xt[xt.DRAW_BUFFER12=34865]="DRAW_BUFFER12",xt[xt.DRAW_BUFFER13=34866]="DRAW_BUFFER13",xt[xt.DRAW_BUFFER14=34867]="DRAW_BUFFER14",xt[xt.DRAW_BUFFER15=34868]="DRAW_BUFFER15",xt[xt.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",xt[xt.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",xt[xt.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",xt[xt.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",xt[xt.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",xt[xt.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",xt[xt.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",xt[xt.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",xt[xt.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",xt[xt.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",xt[xt.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",xt[xt.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",xt[xt.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",xt[xt.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",xt[xt.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",xt[xt.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",xt[xt.SAMPLER_3D=35679]="SAMPLER_3D",xt[xt.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",xt[xt.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",xt[xt.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",xt[xt.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",xt[xt.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",xt[xt.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",xt[xt.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",xt[xt.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",xt[xt.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",xt[xt.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",xt[xt.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",xt[xt.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",xt[xt.MAX_SAMPLES=36183]="MAX_SAMPLES",xt[xt.SAMPLER_BINDING=35097]="SAMPLER_BINDING",xt[xt.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",xt[xt.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",xt[xt.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",xt[xt.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",xt[xt.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",xt[xt.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",xt[xt.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",xt[xt.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",xt[xt.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",xt[xt.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",xt[xt.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",xt[xt.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",xt[xt.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",xt[xt.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",xt[xt.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",xt[xt.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",xt[xt.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",xt[xt.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",xt[xt.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",xt[xt.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",xt[xt.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",xt[xt.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",xt[xt.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",xt[xt.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",xt[xt.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",xt[xt.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",xt[xt.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",xt[xt.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",xt[xt.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",xt[xt.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",xt[xt.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",xt[xt.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",xt[xt.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",xt[xt.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",xt[xt.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",xt[xt.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",xt[xt.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",xt[xt.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",xt[xt.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",xt[xt.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",xt[xt.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",xt[xt.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",xt[xt.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",xt[xt.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",xt[xt.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",xt[xt.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",xt[xt.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",xt[xt.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",xt[xt.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",xt[xt.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",xt[xt.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",xt[xt.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",xt[xt.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",xt[xt.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",xt[xt.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",xt[xt.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",xt[xt.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",xt[xt.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",xt[xt.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",xt[xt.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",xt[xt.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",xt[xt.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",xt[xt.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",xt[xt.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",xt[xt.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",xt[xt.UNIFORM_TYPE=35383]="UNIFORM_TYPE",xt[xt.UNIFORM_SIZE=35384]="UNIFORM_SIZE",xt[xt.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",xt[xt.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",xt[xt.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",xt[xt.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",xt[xt.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",xt[xt.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",xt[xt.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",xt[xt.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",xt[xt.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",xt[xt.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",xt[xt.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",xt[xt.OBJECT_TYPE=37138]="OBJECT_TYPE",xt[xt.SYNC_CONDITION=37139]="SYNC_CONDITION",xt[xt.SYNC_STATUS=37140]="SYNC_STATUS",xt[xt.SYNC_FLAGS=37141]="SYNC_FLAGS",xt[xt.SYNC_FENCE=37142]="SYNC_FENCE",xt[xt.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",xt[xt.UNSIGNALED=37144]="UNSIGNALED",xt[xt.SIGNALED=37145]="SIGNALED",xt[xt.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",xt[xt.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",xt[xt.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",xt[xt.WAIT_FAILED=37149]="WAIT_FAILED",xt[xt.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",xt[xt.COLOR=6144]="COLOR",xt[xt.DEPTH=6145]="DEPTH",xt[xt.STENCIL=6146]="STENCIL",xt[xt.MIN=32775]="MIN",xt[xt.MAX=32776]="MAX",xt[xt.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",xt[xt.STREAM_READ=35041]="STREAM_READ",xt[xt.STREAM_COPY=35042]="STREAM_COPY",xt[xt.STATIC_READ=35045]="STATIC_READ",xt[xt.STATIC_COPY=35046]="STATIC_COPY",xt[xt.DYNAMIC_READ=35049]="DYNAMIC_READ",xt[xt.DYNAMIC_COPY=35050]="DYNAMIC_COPY",xt[xt.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",xt[xt.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",xt[xt.INVALID_INDEX=4294967295]="INVALID_INDEX",xt[xt.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",xt[xt.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",xt[xt.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",xt[xt.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",xt[xt.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",xt[xt.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",xt[xt.R16_EXT=33322]="R16_EXT",xt[xt.RG16_EXT=33324]="RG16_EXT",xt[xt.RGB16_EXT=32852]="RGB16_EXT",xt[xt.RGBA16_EXT=32859]="RGBA16_EXT",xt[xt.R16_SNORM_EXT=36760]="R16_SNORM_EXT",xt[xt.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",xt[xt.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",xt[xt.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",xt[xt.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",xt[xt.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",xt[xt.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",xt[xt.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",xt[xt.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",xt[xt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",xt[xt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",xt[xt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",xt[xt.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",xt[xt.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",xt[xt.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",xt[xt.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",xt[xt.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",xt[xt.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",xt[xt.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",xt[xt.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",xt[xt.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",xt[xt.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",xt[xt.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",xt[xt.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",xt[xt.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",xt[xt.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",xt[xt.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",xt[xt.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",xt[xt.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",xt[xt.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",xt[xt.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",xt[xt.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",xt[xt.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",xt[xt.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",xt[xt.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",xt[xt.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",xt[xt.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",xt[xt.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",xt[xt.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",xt[xt.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",xt[xt.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",xt[xt.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",xt[xt.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",xt[xt.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",xt[xt.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",xt[xt.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",xt[xt.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",xt[xt.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",xt[xt.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",xt[xt.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",xt[xt.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",xt[xt.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",xt[xt.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",xt[xt.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",xt[xt.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",xt[xt.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",xt[xt.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",xt[xt.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",xt[xt.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",xt[xt.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",xt[xt.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",xt[xt.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",xt[xt.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",xt[xt.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",xt[xt.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",xt[xt.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",xt[xt.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",xt[xt.LINE_WEBGL=6913]="LINE_WEBGL",xt[xt.FILL_WEBGL=6914]="FILL_WEBGL",xt[xt.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",xt[xt.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",xt[xt.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",xt[xt.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",xt[xt.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",xt[xt.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",xt[xt.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",xt[xt.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",xt[xt.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",xt[xt.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",xt[xt.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",xt[xt.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",xt[xt.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",xt[xt.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",xt[xt.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",xt[xt.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",xt[xt.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",xt[xt.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",xt[xt.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",xt[xt.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",xt[xt.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",xt[xt.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",xt[xt.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",xt[xt.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(GLEnum||(GLEnum={}));const GL_PARAMETER_DEFAULTS={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},enable=(xt,yt,vt)=>yt?xt.enable(vt):xt.disable(vt),hint=(xt,yt,vt)=>xt.hint(vt,yt),pixelStorei=(xt,yt,vt)=>xt.pixelStorei(vt,yt),bindFramebuffer=(xt,yt,vt)=>{const bt=vt===36006?36009:36008;return xt.bindFramebuffer(bt,yt)},bindBuffer=(xt,yt,vt)=>{const Tt={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[vt];xt.bindBuffer(Tt,yt)};function isArray$1(xt){return Array.isArray(xt)||ArrayBuffer.isView(xt)&&!(xt instanceof DataView)}const GL_PARAMETER_SETTERS={3042:enable,32773:(xt,yt)=>xt.blendColor(...yt),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(xt,yt)=>xt.clearColor(...yt),3107:(xt,yt)=>xt.colorMask(...yt),2884:enable,2885:(xt,yt)=>xt.cullFace(yt),2929:enable,2931:(xt,yt)=>xt.clearDepth(yt),2932:(xt,yt)=>xt.depthFunc(yt),2928:(xt,yt)=>xt.depthRange(...yt),2930:(xt,yt)=>xt.depthMask(yt),3024:enable,35723:hint,35725:(xt,yt)=>xt.useProgram(yt),36007:(xt,yt)=>xt.bindRenderbuffer(36161,yt),36389:(xt,yt)=>{var vt;return(vt=xt.bindTransformFeedback)==null?void 0:vt.call(xt,36386,yt)},34229:(xt,yt)=>xt.bindVertexArray(yt),36006:bindFramebuffer,36010:bindFramebuffer,34964:bindBuffer,36662:bindBuffer,36663:bindBuffer,35053:bindBuffer,35055:bindBuffer,2886:(xt,yt)=>xt.frontFace(yt),33170:hint,2849:(xt,yt)=>xt.lineWidth(yt),32823:enable,32824:"polygonOffset",10752:"polygonOffset",35977:enable,32926:enable,32928:enable,32938:"sampleCoverage",32939:"sampleCoverage",3089:enable,3088:(xt,yt)=>xt.scissor(...yt),2960:enable,2961:(xt,yt)=>xt.clearStencil(yt),2968:(xt,yt)=>xt.stencilMaskSeparate(1028,yt),36005:(xt,yt)=>xt.stencilMaskSeparate(1029,yt),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(xt,yt)=>xt.viewport(...yt),34383:enable,10754:enable,12288:enable,12289:enable,12290:enable,12291:enable,12292:enable,12293:enable,12294:enable,12295:enable,3333:pixelStorei,3317:pixelStorei,37440:pixelStorei,37441:pixelStorei,37443:pixelStorei,3330:pixelStorei,3332:pixelStorei,3331:pixelStorei,3314:pixelStorei,32878:pixelStorei,3316:pixelStorei,3315:pixelStorei,32877:pixelStorei,framebuffer:(xt,yt)=>{const vt=yt&&"handle"in yt?yt.handle:yt;return xt.bindFramebuffer(36160,vt)},blend:(xt,yt)=>yt?xt.enable(3042):xt.disable(3042),blendColor:(xt,yt)=>xt.blendColor(...yt),blendEquation:(xt,yt)=>{const vt=typeof yt=="number"?[yt,yt]:yt;xt.blendEquationSeparate(...vt)},blendFunc:(xt,yt)=>{const vt=(yt==null?void 0:yt.length)===2?[...yt,...yt]:yt;xt.blendFuncSeparate(...vt)},clearColor:(xt,yt)=>xt.clearColor(...yt),clearDepth:(xt,yt)=>xt.clearDepth(yt),clearStencil:(xt,yt)=>xt.clearStencil(yt),colorMask:(xt,yt)=>xt.colorMask(...yt),cull:(xt,yt)=>yt?xt.enable(2884):xt.disable(2884),cullFace:(xt,yt)=>xt.cullFace(yt),depthTest:(xt,yt)=>yt?xt.enable(2929):xt.disable(2929),depthFunc:(xt,yt)=>xt.depthFunc(yt),depthMask:(xt,yt)=>xt.depthMask(yt),depthRange:(xt,yt)=>xt.depthRange(...yt),dither:(xt,yt)=>yt?xt.enable(3024):xt.disable(3024),derivativeHint:(xt,yt)=>{xt.hint(35723,yt)},frontFace:(xt,yt)=>xt.frontFace(yt),mipmapHint:(xt,yt)=>xt.hint(33170,yt),lineWidth:(xt,yt)=>xt.lineWidth(yt),polygonOffsetFill:(xt,yt)=>yt?xt.enable(32823):xt.disable(32823),polygonOffset:(xt,yt)=>xt.polygonOffset(...yt),sampleCoverage:(xt,yt)=>xt.sampleCoverage(yt[0],yt[1]||!1),scissorTest:(xt,yt)=>yt?xt.enable(3089):xt.disable(3089),scissor:(xt,yt)=>xt.scissor(...yt),stencilTest:(xt,yt)=>yt?xt.enable(2960):xt.disable(2960),stencilMask:(xt,yt)=>{yt=isArray$1(yt)?yt:[yt,yt];const[vt,bt]=yt;xt.stencilMaskSeparate(1028,vt),xt.stencilMaskSeparate(1029,bt)},stencilFunc:(xt,yt)=>{yt=isArray$1(yt)&&yt.length===3?[...yt,...yt]:yt;const[vt,bt,Tt,Et,wt,St]=yt;xt.stencilFuncSeparate(1028,vt,bt,Tt),xt.stencilFuncSeparate(1029,Et,wt,St)},stencilOp:(xt,yt)=>{yt=isArray$1(yt)&&yt.length===3?[...yt,...yt]:yt;const[vt,bt,Tt,Et,wt,St]=yt;xt.stencilOpSeparate(1028,vt,bt,Tt),xt.stencilOpSeparate(1029,Et,wt,St)},viewport:(xt,yt)=>xt.viewport(...yt)};function getValue(xt,yt,vt){return yt[xt]!==void 0?yt[xt]:vt[xt]}const GL_COMPOSITE_PARAMETER_SETTERS={blendEquation:(xt,yt,vt)=>xt.blendEquationSeparate(getValue(32777,yt,vt),getValue(34877,yt,vt)),blendFunc:(xt,yt,vt)=>xt.blendFuncSeparate(getValue(32969,yt,vt),getValue(32968,yt,vt),getValue(32971,yt,vt),getValue(32970,yt,vt)),polygonOffset:(xt,yt,vt)=>xt.polygonOffset(getValue(32824,yt,vt),getValue(10752,yt,vt)),sampleCoverage:(xt,yt,vt)=>xt.sampleCoverage(getValue(32938,yt,vt),getValue(32939,yt,vt)),stencilFuncFront:(xt,yt,vt)=>xt.stencilFuncSeparate(1028,getValue(2962,yt,vt),getValue(2967,yt,vt),getValue(2963,yt,vt)),stencilFuncBack:(xt,yt,vt)=>xt.stencilFuncSeparate(1029,getValue(34816,yt,vt),getValue(36003,yt,vt),getValue(36004,yt,vt)),stencilOpFront:(xt,yt,vt)=>xt.stencilOpSeparate(1028,getValue(2964,yt,vt),getValue(2965,yt,vt),getValue(2966,yt,vt)),stencilOpBack:(xt,yt,vt)=>xt.stencilOpSeparate(1029,getValue(34817,yt,vt),getValue(34818,yt,vt),getValue(34819,yt,vt))},GL_HOOKED_SETTERS={enable:(xt,yt)=>xt({[yt]:!0}),disable:(xt,yt)=>xt({[yt]:!1}),pixelStorei:(xt,yt,vt)=>xt({[yt]:vt}),hint:(xt,yt,vt)=>xt({[yt]:vt}),useProgram:(xt,yt)=>xt({35725:yt}),bindRenderbuffer:(xt,yt,vt)=>xt({36007:vt}),bindTransformFeedback:(xt,yt,vt)=>xt({36389:vt}),bindVertexArray:(xt,yt)=>xt({34229:yt}),bindFramebuffer:(xt,yt,vt)=>{switch(yt){case 36160:return xt({36006:vt,36010:vt});case 36009:return xt({36006:vt});case 36008:return xt({36010:vt});default:return null}},bindBuffer:(xt,yt,vt)=>{const bt={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[yt];return bt?xt({[bt]:vt}):{valueChanged:!0}},blendColor:(xt,yt,vt,bt,Tt)=>xt({32773:new Float32Array([yt,vt,bt,Tt])}),blendEquation:(xt,yt)=>xt({32777:yt,34877:yt}),blendEquationSeparate:(xt,yt,vt)=>xt({32777:yt,34877:vt}),blendFunc:(xt,yt,vt)=>xt({32969:yt,32968:vt,32971:yt,32970:vt}),blendFuncSeparate:(xt,yt,vt,bt,Tt)=>xt({32969:yt,32968:vt,32971:bt,32970:Tt}),clearColor:(xt,yt,vt,bt,Tt)=>xt({3106:new Float32Array([yt,vt,bt,Tt])}),clearDepth:(xt,yt)=>xt({2931:yt}),clearStencil:(xt,yt)=>xt({2961:yt}),colorMask:(xt,yt,vt,bt,Tt)=>xt({3107:[yt,vt,bt,Tt]}),cullFace:(xt,yt)=>xt({2885:yt}),depthFunc:(xt,yt)=>xt({2932:yt}),depthRange:(xt,yt,vt)=>xt({2928:new Float32Array([yt,vt])}),depthMask:(xt,yt)=>xt({2930:yt}),frontFace:(xt,yt)=>xt({2886:yt}),lineWidth:(xt,yt)=>xt({2849:yt}),polygonOffset:(xt,yt,vt)=>xt({32824:yt,10752:vt}),sampleCoverage:(xt,yt,vt)=>xt({32938:yt,32939:vt}),scissor:(xt,yt,vt,bt,Tt)=>xt({3088:new Int32Array([yt,vt,bt,Tt])}),stencilMask:(xt,yt)=>xt({2968:yt,36005:yt}),stencilMaskSeparate:(xt,yt,vt)=>xt({[yt===1028?2968:36005]:vt}),stencilFunc:(xt,yt,vt,bt)=>xt({2962:yt,2967:vt,2963:bt,34816:yt,36003:vt,36004:bt}),stencilFuncSeparate:(xt,yt,vt,bt,Tt)=>xt({[yt===1028?2962:34816]:vt,[yt===1028?2967:36003]:bt,[yt===1028?2963:36004]:Tt}),stencilOp:(xt,yt,vt,bt)=>xt({2964:yt,2965:vt,2966:bt,34817:yt,34818:vt,34819:bt}),stencilOpSeparate:(xt,yt,vt,bt,Tt)=>xt({[yt===1028?2964:34817]:vt,[yt===1028?2965:34818]:bt,[yt===1028?2966:34819]:Tt}),viewport:(xt,yt,vt,bt,Tt)=>xt({2978:[yt,vt,bt,Tt]})},isEnabled=(xt,yt)=>xt.isEnabled(yt),GL_PARAMETER_GETTERS={3042:isEnabled,2884:isEnabled,2929:isEnabled,3024:isEnabled,32823:isEnabled,32926:isEnabled,32928:isEnabled,3089:isEnabled,2960:isEnabled,35977:isEnabled},NON_CACHE_PARAMETERS=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function setGLParameters(xt,yt){if(isObjectEmpty$2(yt))return;const vt={};for(const Tt in yt){const Et=Number(Tt),wt=GL_PARAMETER_SETTERS[Tt];wt&&(typeof wt=="string"?vt[wt]=!0:wt(xt,yt[Tt],Et))}const bt=xt.state&&xt.state.cache;if(bt)for(const Tt in vt){const Et=GL_COMPOSITE_PARAMETER_SETTERS[Tt];Et(xt,yt,bt)}}function getGLParameters(xt,yt=GL_PARAMETER_DEFAULTS){if(typeof yt=="number"){const Tt=yt,Et=GL_PARAMETER_GETTERS[Tt];return Et?Et(xt,Tt):xt.getParameter(Tt)}const vt=Array.isArray(yt)?yt:Object.keys(yt),bt={};for(const Tt of vt){const Et=GL_PARAMETER_GETTERS[Tt];bt[Tt]=Et?Et(xt,Number(Tt)):xt.getParameter(Number(Tt))}return bt}function resetGLParameters(xt){setGLParameters(xt,GL_PARAMETER_DEFAULTS)}function isObjectEmpty$2(xt){for(const yt in xt)return!1;return!0}function deepArrayEqual(xt,yt){if(xt===yt)return!0;const vt=Array.isArray(xt)||ArrayBuffer.isView(xt),bt=Array.isArray(yt)||ArrayBuffer.isView(yt);if(vt&&bt&&xt.length===yt.length){for(let Tt=0;Tt<xt.length;++Tt)if(xt[Tt]!==yt[Tt])return!1;return!0}return!1}class WebGLStateTracker{constructor(yt,vt){Bt(this,"gl");Bt(this,"program",null);Bt(this,"stateStack",[]);Bt(this,"enable",!0);Bt(this,"cache",null);Bt(this,"log");Bt(this,"initialized",!1);this.gl=yt,this.log=(vt==null?void 0:vt.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(yt){return yt.state}push(yt={}){this.stateStack.push({})}pop(){const yt=this.stateStack[this.stateStack.length-1];setGLParameters(this.gl,yt),this.stateStack.pop()}trackState(yt,vt){if(this.cache=vt.copyState?getGLParameters(yt):Object.assign({},GL_PARAMETER_DEFAULTS),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,installProgramSpy(yt);for(const bt in GL_HOOKED_SETTERS){const Tt=GL_HOOKED_SETTERS[bt];installSetterSpy(yt,bt,Tt)}installGetterOverride(yt,"getParameter"),installGetterOverride(yt,"isEnabled")}_updateCache(yt){let vt=!1,bt;const Tt=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const Et in yt){const wt=yt[Et],St=this.cache[Et];deepArrayEqual(wt,St)||(vt=!0,bt=St,Tt&&!(Et in Tt)&&(Tt[Et]=St),this.cache[Et]=wt)}return{valueChanged:vt,oldValue:bt}}}function installGetterOverride(xt,yt){const vt=xt[yt].bind(xt);xt[yt]=function(Tt){if(Tt===void 0||NON_CACHE_PARAMETERS.has(Tt))return vt(Tt);const Et=WebGLStateTracker.get(xt);return Tt in Et.cache||(Et.cache[Tt]=vt(Tt)),Et.enable?Et.cache[Tt]:vt(Tt)},Object.defineProperty(xt[yt],"name",{value:`${yt}-from-cache`,configurable:!1})}function installSetterSpy(xt,yt,vt){if(!xt[yt])return;const bt=xt[yt].bind(xt);xt[yt]=function(...Et){const wt=WebGLStateTracker.get(xt),{valueChanged:St,oldValue:At}=vt(wt._updateCache,...Et);return St&&bt(...Et),At},Object.defineProperty(xt[yt],"name",{value:`${yt}-to-cache`,configurable:!1})}function installProgramSpy(xt){const yt=xt.useProgram.bind(xt);xt.useProgram=function(bt){const Tt=WebGLStateTracker.get(xt);Tt.program!==bt&&(yt(bt),Tt.program=bt)}}function createBrowserContext(xt,yt,vt){let bt="";const Tt={preserveDrawingBuffer:!0,...vt};let Et=null;if(Et||(Et=xt.getContext("webgl2",Tt)),Tt.failIfMajorPerformanceCaveat&&(bt||(bt="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!Et&&!vt.failIfMajorPerformanceCaveat&&(Tt.failIfMajorPerformanceCaveat=!1,Et=xt.getContext("webgl2",Tt),Et.luma||(Et.luma={}),Et.luma.softwareRenderer=!0),Et||(Et=xt.getContext("webgl",{}),Et&&(Et=null,bt||(bt="Your browser only supports WebGL1"))),!Et)throw bt||(bt="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${bt}`);const{onContextLost:wt,onContextRestored:St}=yt;return xt.addEventListener("webglcontextlost",At=>wt(At),!1),xt.addEventListener("webglcontextrestored",At=>St(At),!1),Et.luma||(Et.luma={}),Et}function getWebGLExtension(xt,yt,vt){return vt[yt]===void 0&&(vt[yt]=xt.getExtension(yt)||null),vt[yt]}function getDeviceInfo(xt,yt){const vt=xt.getParameter(7936),bt=xt.getParameter(7937);getWebGLExtension(xt,"WEBGL_debug_renderer_info",yt);const Tt=yt.WEBGL_debug_renderer_info,Et=xt.getParameter(Tt?Tt.UNMASKED_VENDOR_WEBGL:7936),wt=xt.getParameter(Tt?Tt.UNMASKED_RENDERER_WEBGL:7937),St=Et||vt,At=wt||bt,Rt=xt.getParameter(7938),Pt=identifyGPUVendor(St,At),Ct=identifyGPUBackend(St,At),It=identifyGPUType(St,At);return{type:"webgl",gpu:Pt,gpuType:It,gpuBackend:Ct,vendor:St,renderer:At,version:Rt,shadingLanguage:"glsl",shadingLanguageVersion:300}}function identifyGPUVendor(xt,yt){return/NVIDIA/i.exec(xt)||/NVIDIA/i.exec(yt)?"nvidia":/INTEL/i.exec(xt)||/INTEL/i.exec(yt)?"intel":/Apple/i.exec(xt)||/Apple/i.exec(yt)?"apple":/AMD/i.exec(xt)||/AMD/i.exec(yt)||/ATI/i.exec(xt)||/ATI/i.exec(yt)?"amd":/SwiftShader/i.exec(xt)||/SwiftShader/i.exec(yt)?"software":"unknown"}function identifyGPUBackend(xt,yt){return/Metal/i.exec(xt)||/Metal/i.exec(yt)?"metal":/ANGLE/i.exec(xt)||/ANGLE/i.exec(yt)?"opengl":"unknown"}function identifyGPUType(xt,yt){if(/SwiftShader/i.exec(xt)||/SwiftShader/i.exec(yt))return"cpu";switch(identifyGPUVendor(xt,yt)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function getGLFromVertexType(xt){switch(xt){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(xt))}const X_S3TC="WEBGL_compressed_texture_s3tc",X_S3TC_SRGB="WEBGL_compressed_texture_s3tc_srgb",X_RGTC="EXT_texture_compression_rgtc",X_BPTC="EXT_texture_compression_bptc",X_ETC2="WEBGL_compressed_texture_etc",X_ASTC="WEBGL_compressed_texture_astc",X_ETC1="WEBGL_compressed_texture_etc1",X_PVRTC="WEBGL_compressed_texture_pvrtc",X_ATC="WEBGL_compressed_texture_atc",EXT_texture_norm16="EXT_texture_norm16",EXT_render_snorm="EXT_render_snorm",EXT_color_buffer_float="EXT_color_buffer_float",TEXTURE_FEATURES={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[EXT_render_snorm],"norm16-renderable-webgl":[EXT_texture_norm16],"snorm16-renderable-webgl":[EXT_texture_norm16,EXT_render_snorm],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[X_S3TC,X_S3TC_SRGB,X_RGTC,X_BPTC],"texture-compression-bc5-webgl":[X_RGTC],"texture-compression-bc7-webgl":[X_BPTC],"texture-compression-etc2":[X_ETC2],"texture-compression-astc":[X_ASTC],"texture-compression-etc1-webgl":[X_ETC1],"texture-compression-pvrtc-webgl":[X_PVRTC],"texture-compression-atc-webgl":[X_ATC]};function isTextureFeature(xt){return xt in TEXTURE_FEATURES}function checkTextureFeature(xt,yt,vt){return(TEXTURE_FEATURES[yt]||[]).every(Tt=>getWebGLExtension(xt,Tt,vt))}const WEBGL_TEXTURE_FORMATS={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:EXT_color_buffer_float,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:X_S3TC},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:X_S3TC_SRGB},"bc1-rgba-unorm":{gl:33777,x:X_S3TC},"bc1-rgba-unorm-srgb":{gl:35916,x:X_S3TC_SRGB},"bc2-rgba-unorm":{gl:33778,x:X_S3TC},"bc2-rgba-unorm-srgb":{gl:35918,x:X_S3TC_SRGB},"bc3-rgba-unorm":{gl:33779,x:X_S3TC},"bc3-rgba-unorm-srgb":{gl:35919,x:X_S3TC_SRGB},"bc4-r-unorm":{gl:36283,x:X_RGTC},"bc4-r-snorm":{gl:36284,x:X_RGTC},"bc5-rg-unorm":{gl:36285,x:X_RGTC},"bc5-rg-snorm":{gl:36286,x:X_RGTC},"bc6h-rgb-ufloat":{gl:36495,x:X_BPTC},"bc6h-rgb-float":{gl:36494,x:X_BPTC},"bc7-rgba-unorm":{gl:36492,x:X_BPTC},"bc7-rgba-unorm-srgb":{gl:36493,x:X_BPTC},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function getTextureFormatCapabilitiesWebGL(xt,yt,vt){let bt=yt.create;const Tt=WEBGL_TEXTURE_FORMATS[yt.format];return(Tt==null?void 0:Tt.gl)===void 0&&(bt=!1),Tt!=null&&Tt.x&&(bt=bt&&!!getWebGLExtension(xt,Tt.x,vt)),{format:yt.format,create:bt&&yt.create,render:bt&&yt.render,filter:bt&&yt.filter,blend:bt&&yt.blend,store:bt&&yt.store}}function getTextureFormatWebGL(xt){var Tt;const yt=WEBGL_TEXTURE_FORMATS[xt],vt=convertTextureFormatToGL(xt),bt=decodeTextureFormat(xt);return{internalFormat:vt,format:(yt==null?void 0:yt.dataFormat)||getWebGLPixelDataFormat(bt.channels,bt.integer,bt.normalized,vt),type:bt.dataType?getGLFromVertexType(bt.dataType):((Tt=yt==null?void 0:yt.types)==null?void 0:Tt[0])||5121,compressed:bt.compressed||!1}}function getDepthStencilAttachmentWebGL(xt){switch(decodeTextureFormat(xt).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${xt}`)}}function getWebGLPixelDataFormat(xt,yt,vt,bt){if(bt===6408||bt===6407)return bt;switch(xt){case"r":return yt&&!vt?36244:6403;case"rg":return yt&&!vt?33320:33319;case"rgb":return yt&&!vt?36248:6407;case"rgba":return yt&&!vt?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function convertTextureFormatToGL(xt){const yt=WEBGL_TEXTURE_FORMATS[xt],vt=yt==null?void 0:yt.gl;if(vt===void 0)throw new Error(`Unsupported texture format ${xt}`);return vt}const WEBGL_FEATURES={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class WebGLDeviceFeatures extends DeviceFeatures{constructor(vt,bt,Tt){super([],Tt);Bt(this,"gl");Bt(this,"extensions");Bt(this,"testedFeatures",new Set);this.gl=vt,this.extensions=bt,getWebGLExtension(vt,"EXT_color_buffer_float",bt)}*[Symbol.iterator](){const vt=this.getFeatures();for(const bt of vt)this.has(bt)&&(yield bt);return[]}has(vt){var bt;return(bt=this.disabledFeatures)!=null&&bt[vt]?!1:(this.testedFeatures.has(vt)||(this.testedFeatures.add(vt),isTextureFeature(vt)&&checkTextureFeature(this.gl,vt,this.extensions)&&this.features.add(vt),this.getWebGLFeature(vt)&&this.features.add(vt)),this.features.has(vt))}initializeFeatures(){const vt=this.getFeatures().filter(bt=>bt!=="polygon-mode-webgl");for(const bt of vt)this.has(bt)}getFeatures(){return[...Object.keys(WEBGL_FEATURES),...Object.keys(TEXTURE_FEATURES)]}getWebGLFeature(vt){const bt=WEBGL_FEATURES[vt];return typeof bt=="string"?!!getWebGLExtension(this.gl,bt,this.extensions):!!bt}}class WebGLDeviceLimits extends DeviceLimits{constructor(vt){super();Bt(this,"gl");Bt(this,"limits",{});this.gl=vt}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(vt){return this.limits[vt]===void 0&&(this.limits[vt]=this.gl.getParameter(vt)),this.limits[vt]||0}}class WEBGLFramebuffer extends Framebuffer{constructor(vt,bt){super(vt,bt);Bt(this,"device");Bt(this,"gl");Bt(this,"handle");Bt(this,"colorAttachments",[]);Bt(this,"depthStencilAttachment",null);const Tt=bt.handle===null;this.device=vt,this.gl=vt.gl,this.handle=this.props.handle||Tt?this.props.handle:this.gl.createFramebuffer(),Tt||(vt.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const vt=this.gl.bindFramebuffer(36160,this.handle);for(let bt=0;bt<this.colorAttachments.length;++bt){const Tt=this.colorAttachments[bt];if(Tt){const Et=36064+bt;this._attachTextureView(Et,Tt)}}if(this.depthStencilAttachment){const bt=getDepthStencilAttachmentWebGL(this.depthStencilAttachment.props.format);this._attachTextureView(bt,this.depthStencilAttachment)}if(this.device.props.debug){const bt=this.gl.checkFramebufferStatus(36160);if(bt!==36053)throw new Error(`Framebuffer ${_getFrameBufferStatus(bt)}`)}this.gl.bindFramebuffer(36160,vt)}_attachTextureView(vt,bt){const{gl:Tt}=this.device,{texture:Et}=bt,wt=bt.props.baseMipLevel,St=bt.props.baseArrayLayer;switch(Tt.bindTexture(Et.glTarget,Et.handle),Et.glTarget){case 35866:case 32879:Tt.framebufferTextureLayer(36160,vt,Et.handle,wt,St);break;case 34067:const At=mapIndexToCubeMapFace(St);Tt.framebufferTexture2D(36160,vt,At,Et.handle,wt);break;case 3553:Tt.framebufferTexture2D(36160,vt,3553,Et.handle,wt);break;default:throw new Error("Illegal texture type")}Tt.bindTexture(Et.glTarget,null)}}function mapIndexToCubeMapFace(xt){return xt<34069?xt+34069:xt}function _getFrameBufferStatus(xt){switch(xt){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${xt}`}}class WebGLCanvasContext extends CanvasContext{constructor(vt,bt){super(bt);Bt(this,"device");Bt(this,"format","rgba8unorm");Bt(this,"depthStencilFormat","depth24plus");Bt(this,"presentationSize");Bt(this,"_framebuffer",null);this.device=vt,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new WEBGLFramebuffer(this.device,{handle:null}),this._framebuffer}update(){const vt=this.getPixelSize();(vt[0]!==this.presentationSize[0]||vt[1]!==this.presentationSize[1])&&(this.presentationSize=vt,this.resize())}resize(vt){if(this.device.gl&&this.canvas){const bt=this.getDevicePixelRatio(vt==null?void 0:vt.useDevicePixels);this.setDevicePixelRatio(bt,vt);return}}commit(){}}async function loadScript(xt,yt){const vt=document.getElementsByTagName("head")[0];if(!vt)throw new Error("loadScript");const bt=document.createElement("script");return bt.setAttribute("type","text/javascript"),bt.setAttribute("src",xt),new Promise((Tt,Et)=>{bt.onload=Tt,bt.onerror=wt=>Et(new Error(`Unable to load script '${xt}': ${wt}`)),vt.appendChild(bt)})}const LOG_LEVEL$1=1;let spector=null,initialized=!1;const DEFAULT_SPECTOR_PROPS={debugSpectorJS:log.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function loadSpectorJS(xt){if(!globalThis.SPECTOR)try{await loadScript(xt.debugSpectorJSUrl||DEFAULT_SPECTOR_PROPS.debugSpectorJSUrl)}catch(yt){log.warn(String(yt))}}function initializeSpectorJS(xt){var yt;if(xt={...DEFAULT_SPECTOR_PROPS,...xt},!xt.debugSpectorJS)return null;if(!spector&&globalThis.SPECTOR&&!((yt=globalThis.luma)!=null&&yt.spector)){log.probe(LOG_LEVEL$1,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:vt}=globalThis.SPECTOR;spector=new vt,globalThis.luma&&(globalThis.luma.spector=spector)}if(!spector)return null;if(initialized||(initialized=!0,spector.spyCanvases(),spector==null||spector.onCaptureStarted.add(vt=>log.info("Spector capture started:",vt)()),spector==null||spector.onCapture.add(vt=>{log.info("Spector capture complete:",vt)(),spector==null||spector.getResultUI(),spector==null||spector.resultView.display(),spector==null||spector.resultView.addCapture(vt)})),xt.gl){const vt=xt.gl,bt=vt.device;spector==null||spector.startCapture(xt.gl,500),vt.device=bt,new Promise(Tt=>setTimeout(Tt,2e3)).then(Tt=>{log.info("Spector capture stopped after 2 seconds")(),spector==null||spector.stopCapture()})}return spector}const WEBGL_DEBUG_CDN_URL="https://unpkg.com/webgl-debug@2.0.1/index.js";function getWebGLContextData(xt){return xt.luma=xt.luma||{},xt.luma}async function loadWebGLDeveloperTools(){isBrowser$1()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await loadScript(WEBGL_DEBUG_CDN_URL))}function makeDebugContext(xt,yt={}){return yt.debugWebGL||yt.traceWebGL?getDebugContext(xt,yt):getRealContext(xt)}function getRealContext(xt){const yt=getWebGLContextData(xt);return yt.realContext?yt.realContext:xt}function getDebugContext(xt,yt){if(!globalThis.WebGLDebugUtils)return log.warn("webgl-debug not loaded")(),xt;const vt=getWebGLContextData(xt);if(vt.debugContext)return vt.debugContext;globalThis.WebGLDebugUtils.init({...GLEnum,...xt});const bt=globalThis.WebGLDebugUtils.makeDebugContext(xt,onGLError.bind(null,yt),onValidateGLFunc.bind(null,yt));for(const wt in GLEnum)!(wt in bt)&&typeof GLEnum[wt]=="number"&&(bt[wt]=GLEnum[wt]);class Tt{}Object.setPrototypeOf(bt,Object.getPrototypeOf(xt)),Object.setPrototypeOf(Tt,bt);const Et=Object.create(Tt);return vt.realContext=xt,vt.debugContext=Et,Et.debug=!0,Et}function getFunctionString(xt,yt){yt=Array.from(yt).map(bt=>bt===void 0?"undefined":bt);let vt=globalThis.WebGLDebugUtils.glFunctionArgsToString(xt,yt);return vt=`${vt.slice(0,100)}${vt.length>100?"...":""}`,`gl.${xt}(${vt})`}function onGLError(xt,yt,vt,bt){bt=Array.from(bt).map(St=>St===void 0?"undefined":St);const Tt=globalThis.WebGLDebugUtils.glEnumToString(yt),Et=globalThis.WebGLDebugUtils.glFunctionArgsToString(vt,bt),wt=`${Tt} in gl.${vt}(${Et})`;log.error(wt)();debugger}function onValidateGLFunc(xt,yt,vt){let bt="";log.level>=1&&(bt=getFunctionString(yt,vt),xt.traceWebGL&&log.log(1,bt)());for(const Tt of vt)if(Tt===void 0){bt=bt||getFunctionString(yt,vt);debugger}}const uidCounters={};function uid(xt="id"){uidCounters[xt]=uidCounters[xt]||1;const yt=uidCounters[xt]++;return`${xt}-${yt}`}class WEBGLBuffer extends Buffer{constructor(vt,bt={}){super(vt,bt);Bt(this,"device");Bt(this,"gl");Bt(this,"handle");Bt(this,"glTarget");Bt(this,"glUsage");Bt(this,"glIndexType",5123);Bt(this,"byteLength");Bt(this,"bytesUsed");this.device=vt,this.gl=this.device.gl;const Tt=typeof bt=="object"?bt.handle:void 0;this.handle=Tt||this.gl.createBuffer(),vt.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=getWebGLTarget(this.props.usage),this.glUsage=getWebGLUsage(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,bt.data?this._initWithData(bt.data,bt.byteOffset,bt.byteLength):this._initWithByteLength(bt.byteLength||0)}_initWithData(vt,bt=0,Tt=vt.byteLength+bt){const Et=this.glTarget;this.gl.bindBuffer(Et,this.handle),this.gl.bufferData(Et,Tt,this.glUsage),this.gl.bufferSubData(Et,bt,vt),this.gl.bindBuffer(Et,null),this.bytesUsed=Tt,this.byteLength=Tt,this._setDebugData(vt,bt,Tt),this.trackAllocatedMemory(Tt)}_initWithByteLength(vt){let bt=vt;vt===0&&(bt=new Float32Array(0));const Tt=this.glTarget;return this.gl.bindBuffer(Tt,this.handle),this.gl.bufferData(Tt,bt,this.glUsage),this.gl.bindBuffer(Tt,null),this.bytesUsed=vt,this.byteLength=vt,this._setDebugData(null,0,vt),this.trackAllocatedMemory(vt),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(vt,bt=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,bt,vt),this.gl.bindBuffer(36663,null),this._setDebugData(vt,bt,vt.byteLength)}async readAsync(vt=0,bt){return this.readSyncWebGL(vt,bt)}readSyncWebGL(vt=0,bt){bt=bt??this.byteLength-vt;const Tt=new Uint8Array(bt),Et=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,vt,Tt,Et,bt),this.gl.bindBuffer(36662,null),this._setDebugData(Tt,vt,bt),Tt}}function getWebGLTarget(xt){return xt&Buffer.INDEX?34963:xt&Buffer.VERTEX?34962:xt&Buffer.UNIFORM?35345:34962}function getWebGLUsage(xt){return xt&Buffer.INDEX||xt&Buffer.VERTEX?35044:xt&Buffer.UNIFORM?35048:35044}function parseShaderCompilerLog(xt){const yt=xt.split(/\r?\n/),vt=[];for(const bt of yt){if(bt.length<=1)continue;const Tt=bt.split(":");if(Tt.length===2){const[Ct,It]=Tt;vt.push({message:It.trim(),type:getMessageType(Ct),lineNum:0,linePos:0});continue}const[Et,wt,St,...At]=Tt;let Rt=parseInt(St,10);isNaN(Rt)&&(Rt=0);let Pt=parseInt(wt,10);isNaN(Pt)&&(Pt=0),vt.push({message:At.join(":").trim(),type:getMessageType(Et),lineNum:Rt,linePos:Pt})}return vt}function getMessageType(xt){const yt=["warning","error","info"],vt=xt.toLowerCase();return yt.includes(vt)?vt:"info"}class WEBGLShader extends Shader{constructor(vt,bt){super(vt,bt);Bt(this,"device");Bt(this,"handle");switch(this.device=vt,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const vt=this.device.gl.getShaderInfoLog(this.handle);return vt?parseShaderCompilerLog(vt):[]}getTranslatedSource(){const bt=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(bt==null?void 0:bt.getTranslatedShaderSource(this.handle))||null}async _compile(vt){vt=vt.startsWith("#version ")?vt:`#version 300 es
${vt}`;const{gl:bt}=this.device;if(bt.shaderSource(this.handle,vt),bt.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}log.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),log.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const vt=async Et=>await new Promise(wt=>setTimeout(wt,Et));if(!this.device.features.has("compilation-status-async-webgl")){await vt(10);return}const{gl:Tt}=this.device;for(;;){if(Tt.getShaderParameter(this.handle,37297))return;await vt(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function withDeviceAndGLParameters(xt,yt,vt,bt){if(isObjectEmpty$1(yt))return bt(xt);const Tt=xt;Tt.pushState();try{return setDeviceParameters(xt,yt),setGLParameters(Tt.gl,vt),bt(xt)}finally{Tt.popState()}}function setDeviceParameters(xt,yt){const vt=xt,{gl:bt}=vt;if(yt.cullMode)switch(yt.cullMode){case"none":bt.disable(2884);break;case"front":bt.enable(2884),bt.cullFace(1028);break;case"back":bt.enable(2884),bt.cullFace(1029);break}if(yt.frontFace&&bt.frontFace(map("frontFace",yt.frontFace,{ccw:2305,cw:2304})),yt.unclippedDepth&&xt.features.has("depth-clip-control")&&bt.enable(34383),yt.depthBias!==void 0&&(bt.enable(32823),bt.polygonOffset(yt.depthBias,yt.depthBiasSlopeScale||0)),yt.provokingVertex&&xt.features.has("provoking-vertex-webgl")){const Et=vt.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,wt=map("provokingVertex",yt.provokingVertex,{first:36429,last:36430});Et==null||Et.provokingVertexWEBGL(wt)}if((yt.polygonMode||yt.polygonOffsetLine)&&xt.features.has("polygon-mode-webgl")){if(yt.polygonMode){const Et=vt.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,wt=map("polygonMode",yt.polygonMode,{fill:6914,line:6913});Et==null||Et.polygonModeWEBGL(1028,wt),Et==null||Et.polygonModeWEBGL(1029,wt)}yt.polygonOffsetLine&&bt.enable(10754)}if(xt.features.has("shader-clip-cull-distance-webgl")&&(yt.clipDistance0&&bt.enable(12288),yt.clipDistance1&&bt.enable(12289),yt.clipDistance2&&bt.enable(12290),yt.clipDistance3&&bt.enable(12291),yt.clipDistance4&&bt.enable(12292),yt.clipDistance5&&bt.enable(12293),yt.clipDistance6&&bt.enable(12294),yt.clipDistance7&&bt.enable(12295)),yt.depthWriteEnabled!==void 0&&bt.depthMask(mapBoolean("depthWriteEnabled",yt.depthWriteEnabled)),yt.depthCompare&&(yt.depthCompare!=="always"?bt.enable(2929):bt.disable(2929),bt.depthFunc(convertCompareFunction("depthCompare",yt.depthCompare))),yt.stencilWriteMask){const Tt=yt.stencilWriteMask;bt.stencilMaskSeparate(1028,Tt),bt.stencilMaskSeparate(1029,Tt)}if(yt.stencilReadMask&&log.warn("stencilReadMask not supported under WebGL"),yt.stencilCompare){const Tt=yt.stencilReadMask||4294967295,Et=convertCompareFunction("depthCompare",yt.stencilCompare);yt.stencilCompare!=="always"?bt.enable(2960):bt.disable(2960),bt.stencilFuncSeparate(1028,Et,0,Tt),bt.stencilFuncSeparate(1029,Et,0,Tt)}if(yt.stencilPassOperation&&yt.stencilFailOperation&&yt.stencilDepthFailOperation){const Tt=convertStencilOperation("stencilPassOperation",yt.stencilPassOperation),Et=convertStencilOperation("stencilFailOperation",yt.stencilFailOperation),wt=convertStencilOperation("stencilDepthFailOperation",yt.stencilDepthFailOperation);bt.stencilOpSeparate(1028,Et,wt,Tt),bt.stencilOpSeparate(1029,Et,wt,Tt)}switch(yt.blend){case!0:bt.enable(3042);break;case!1:bt.disable(3042);break}if(yt.blendColorOperation||yt.blendAlphaOperation){const Tt=convertBlendOperationToEquation("blendColorOperation",yt.blendColorOperation||"add"),Et=convertBlendOperationToEquation("blendAlphaOperation",yt.blendAlphaOperation||"add");bt.blendEquationSeparate(Tt,Et);const wt=convertBlendFactorToFunction("blendColorSrcFactor",yt.blendColorSrcFactor||"one"),St=convertBlendFactorToFunction("blendColorDstFactor",yt.blendColorDstFactor||"zero"),At=convertBlendFactorToFunction("blendAlphaSrcFactor",yt.blendAlphaSrcFactor||"one"),Rt=convertBlendFactorToFunction("blendAlphaDstFactor",yt.blendAlphaDstFactor||"zero");bt.blendFuncSeparate(wt,St,At,Rt)}}function convertCompareFunction(xt,yt){return map(xt,yt,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function convertStencilOperation(xt,yt){return map(xt,yt,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function convertBlendOperationToEquation(xt,yt){return map(xt,yt,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function convertBlendFactorToFunction(xt,yt){return map(xt,yt,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function message(xt,yt){return`Illegal parameter ${yt} for ${xt}`}function map(xt,yt,vt){if(!(yt in vt))throw new Error(message(xt,yt));return vt[yt]}function mapBoolean(xt,yt){return yt}function isObjectEmpty$1(xt){let yt=!0;for(const vt in xt){yt=!1;break}return yt}function convertSamplerParametersToWebGL(xt){const yt={};return xt.addressModeU&&(yt[10242]=convertAddressMode(xt.addressModeU)),xt.addressModeV&&(yt[10243]=convertAddressMode(xt.addressModeV)),xt.addressModeW&&(yt[32882]=convertAddressMode(xt.addressModeW)),xt.magFilter&&(yt[10240]=convertMaxFilterMode(xt.magFilter)),(xt.minFilter||xt.mipmapFilter)&&(yt[10241]=convertMinFilterMode(xt.minFilter||"linear",xt.mipmapFilter)),xt.lodMinClamp!==void 0&&(yt[33082]=xt.lodMinClamp),xt.lodMaxClamp!==void 0&&(yt[33083]=xt.lodMaxClamp),xt.type==="comparison-sampler"&&(yt[34892]=34894),xt.compare&&(yt[34893]=convertCompareFunction("compare",xt.compare)),xt.maxAnisotropy&&(yt[34046]=xt.maxAnisotropy),yt}function convertAddressMode(xt){switch(xt){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function convertMaxFilterMode(xt){switch(xt){case"nearest":return 9728;case"linear":return 9729}}function convertMinFilterMode(xt,yt="none"){if(!yt)return convertMaxFilterMode(xt);switch(yt){case"none":return convertMaxFilterMode(xt);case"nearest":return xt==="nearest"?9984:9986;case"linear":return xt==="nearest"?9985:9987}}class WEBGLSampler extends Sampler{constructor(vt,bt){super(vt,bt);Bt(this,"device");Bt(this,"handle");Bt(this,"parameters");this.device=vt,this.parameters=convertSamplerParametersToWebGL(bt),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(vt){for(const[bt,Tt]of Object.entries(vt)){const Et=Number(bt);switch(Et){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,Et,Tt);break;default:this.device.gl.samplerParameteri(this.handle,Et,Tt);break}}}}class WEBGLTextureView extends TextureView{constructor(vt,bt){super(vt,{...Texture.defaultProps,...bt});Bt(this,"device");Bt(this,"gl");Bt(this,"handle");Bt(this,"texture");this.device=vt,this.gl=this.device.gl,this.handle=null,this.texture=bt.texture}}const ERR_TYPE_DEDUCTION="Failed to deduce GL constant from typed array";function getGLTypeFromTypedArray(xt){switch(ArrayBuffer.isView(xt)?xt.constructor:xt){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(ERR_TYPE_DEDUCTION)}}function getTypedArrayFromGLType(xt,yt){const{clamped:vt=!0}=yt||{};switch(xt){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return vt?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function glFormatToComponents(xt){switch(xt){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function glTypeToBytes(xt){switch(xt){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function withGLParameters(xt,yt,vt){if(isObjectEmpty(yt))return vt(xt);const{nocatch:bt=!0}=yt,Tt=WebGLStateTracker.get(xt);Tt.push(),setGLParameters(xt,yt);let Et;if(bt)Et=vt(xt),Tt.pop();else try{Et=vt(xt)}finally{Tt.pop()}return Et}function isObjectEmpty(xt){for(const yt in xt)return!1;return!0}function initializeTextureStorage(xt,yt,vt){const{dimension:bt,width:Tt,height:Et,depth:wt=0}=vt,{glInternalFormat:St}=vt,At=vt.glTarget;switch(bt){case"2d-array":case"3d":xt.texStorage3D(At,yt,St,Tt,Et,wt);break;default:xt.texStorage2D(At,yt,St,Tt,Et)}}function copyExternalImageToMipLevel(xt,yt,vt,bt){const{width:Tt,height:Et}=bt,{dimension:wt,depth:St=0,mipLevel:At=0}=bt,{x:Rt=0,y:Pt=0,z:Ct=0}=bt,{glFormat:It,glType:Mt}=bt,Ot=getWebGLCubeFaceTarget(bt.glTarget,wt,St),kt=bt.flipY?{37440:!0}:{};withGLParameters(xt,kt,()=>{switch(wt){case"2d-array":case"3d":xt.bindTexture(Ot,yt),xt.texSubImage3D(Ot,At,Rt,Pt,Ct,Tt,Et,St,It,Mt,vt),xt.bindTexture(Ot,null);break;case"2d":case"cube":xt.bindTexture(Ot,yt),xt.texSubImage2D(Ot,At,Rt,Pt,Tt,Et,It,Mt,vt),xt.bindTexture(Ot,null);break;default:throw new Error(wt)}})}function copyCPUDataToMipLevel(xt,yt,vt){const{dimension:bt,width:Tt,height:Et,depth:wt=0,mipLevel:St=0,byteOffset:At=0}=vt,{x:Rt=0,y:Pt=0,z:Ct=0}=vt,{glFormat:It,glType:Mt,compressed:Ot}=vt,kt=getWebGLCubeFaceTarget(vt.glTarget,bt,wt);switch(bt){case"2d-array":case"3d":Ot?xt.compressedTexSubImage3D(kt,St,Rt,Pt,Ct,Tt,Et,wt,It,yt,At):xt.texSubImage3D(kt,St,Rt,Pt,Ct,Tt,Et,wt,It,Mt,yt,At);break;case"2d":case"cube":Ot?xt.compressedTexSubImage2D(kt,St,Rt,Pt,Tt,Et,It,yt,At):xt.texSubImage2D(kt,St,Rt,Pt,Tt,Et,It,Mt,yt,At);break;default:throw new Error(bt)}}function getWebGLTextureTarget(xt){switch(xt){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(xt)}function getWebGLCubeFaceTarget(xt,yt,vt){return yt==="cube"?34069+vt:xt}function readPixelsToArray(xt,yt){var Nt;const{sourceX:vt=0,sourceY:bt=0,sourceAttachment:Tt=0}=yt||{};let{target:Et=null,sourceWidth:wt,sourceHeight:St,sourceDepth:At,sourceFormat:Rt,sourceType:Pt}=yt||{};const{framebuffer:Ct,deleteFramebuffer:It}=getFramebuffer$2(xt),{gl:Mt,handle:Ot}=Ct;wt||(wt=Ct.width),St||(St=Ct.height);const kt=(Nt=Ct.colorAttachments[Tt])==null?void 0:Nt.texture;if(!kt)throw new Error(`Invalid framebuffer attachment ${Tt}`);At=(kt==null?void 0:kt.depth)||1,Rt||(Rt=(kt==null?void 0:kt.glFormat)||6408),Pt||(Pt=(kt==null?void 0:kt.glType)||5121),Et=getPixelArray(Et,Pt,Rt,wt,St),Pt=Pt||getGLTypeFromTypedArray(Et);const Ft=Mt.bindFramebuffer(36160,Ot);return Mt.readBuffer(36064+Tt),Mt.readPixels(vt,bt,wt,St,Rt,Pt,Et),Mt.readBuffer(36064),Mt.bindFramebuffer(36160,Ft||null),It&&Ct.destroy(),Et}function readPixelsToBuffer(xt,yt){const{target:vt,sourceX:bt=0,sourceY:Tt=0,sourceFormat:Et=6408,targetByteOffset:wt=0}=yt||{};let{sourceWidth:St,sourceHeight:At,sourceType:Rt}=yt||{};const{framebuffer:Pt,deleteFramebuffer:Ct}=getFramebuffer$2(xt);St=St||Pt.width,At=At||Pt.height;const It=Pt;Rt=Rt||5121;let Mt=vt;if(!Mt){const kt=glFormatToComponents(Et),Ft=glTypeToBytes(Rt),Nt=wt+St*At*kt*Ft;Mt=It.device.createBuffer({byteLength:Nt})}const Ot=xt.device.createCommandEncoder();return Ot.copyTextureToBuffer({sourceTexture:xt,width:St,height:At,origin:[bt,Tt],destinationBuffer:Mt,byteOffset:wt}),Ot.destroy(),Ct&&Pt.destroy(),Mt}function getFramebuffer$2(xt){return xt instanceof Framebuffer?{framebuffer:xt,deleteFramebuffer:!1}:{framebuffer:toFramebuffer(xt),deleteFramebuffer:!0}}function toFramebuffer(xt,yt){const{device:vt,width:bt,height:Tt,id:Et}=xt;return vt.createFramebuffer({...yt,id:`framebuffer-for-${Et}`,width:bt,height:Tt,colorAttachments:[xt]})}function getPixelArray(xt,yt,vt,bt,Tt,Et){if(xt)return xt;yt||(yt=5121);const wt=getTypedArrayFromGLType(yt,{clamped:!1}),St=glFormatToComponents(vt);return new wt(bt*Tt*St)}class WEBGLTexture extends Texture{constructor(vt,bt){super(vt,bt);Bt(this,"device");Bt(this,"gl");Bt(this,"handle");Bt(this,"sampler");Bt(this,"view");Bt(this,"mipmaps");Bt(this,"compressed");Bt(this,"glTarget");Bt(this,"glFormat");Bt(this,"glType");Bt(this,"glInternalFormat");Bt(this,"textureUnit",0);const Tt={...this.props};Tt.data=bt.data,this.device=vt,this.gl=this.device.gl,this.glTarget=getWebGLTextureTarget(this.props.dimension);const Et=getTextureFormatWebGL(this.props.format);this.glInternalFormat=Et.internalFormat,this.glFormat=Et.format,this.glType=Et.type,this.compressed=Et.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(Tt),Object.seal(this)}_initialize(vt){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:vt.data});let{width:bt,height:Tt}=vt;if(!bt||!Tt){const Et=Texture.getTextureDataSize(vt.data);bt=(Et==null?void 0:Et.width)||1,Tt=(Et==null?void 0:Et.height)||1}if(this.width=bt,this.height=Tt,this.depth=vt.depth,this.setSampler(vt.sampler),this.view=new WEBGLTextureView(this.device,{...this.props,texture:this}),this.bind(),initializeTextureStorage(this.gl,this.mipLevels,this),vt.data)switch(vt.dimension){case"1d":this.setTexture1DData(vt.data);break;case"2d":this.setTexture2DData(vt.data);break;case"3d":this.setTexture3DData(vt.data);break;case"cube":this.setTextureCubeData(vt.data);break;case"2d-array":this.setTextureArrayData(vt.data);break;case"cube-array":this.setTextureCubeArrayData(vt.data);break;default:throw new Error(vt.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(vt){return new WEBGLTextureView(this.device,{...vt,texture:this})}setSampler(vt={}){let bt;vt instanceof WEBGLSampler?(this.sampler=vt,bt=vt.props):(this.sampler=new WEBGLSampler(this.device,vt),bt=vt);const Tt=convertSamplerParametersToWebGL(bt);this._setSamplerParameters(Tt)}generateMipmap(vt){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(log.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(vt!=null&&vt.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(Tt){log.warn(`Error generating mipmap for ${this}: ${Tt.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(vt){const bt=Texture.getExternalImageSize(vt.image),Tt={...Texture.defaultCopyExternalImageOptions,...bt,...vt},{image:Et,depth:wt,mipLevel:St,x:At,y:Rt,z:Pt,flipY:Ct}=Tt;let{width:It,height:Mt}=Tt;const{dimension:Ot,glTarget:kt,glFormat:Ft,glInternalFormat:Nt,glType:Lt}=this;if(It=Math.min(It,this.width-At),Mt=Math.min(Mt,this.height-Rt),vt.sourceX||vt.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return copyExternalImageToMipLevel(this.device.gl,this.handle,Et,{dimension:Ot,mipLevel:St,x:At,y:Rt,z:Pt,width:It,height:Mt,depth:wt,glFormat:Ft,glType:Lt,glTarget:kt,flipY:Ct}),{width:Tt.width,height:Tt.height}}setTexture1DData(vt){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(vt,bt=0){this.bind();const Tt=Texture.normalizeTextureData(vt,this);Tt.length>1&&this.props.mipmaps!==!1&&log.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let Et=0;Et<Tt.length;Et++){const wt=Tt[Et];this._setMipLevel(bt,Et,wt)}this.unbind()}setTexture3DData(vt){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(vt)&&(this.bind(),copyCPUDataToMipLevel(this.device.gl,vt,this),this.unbind())}setTextureCubeData(vt,bt=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const Tt of Texture.CubeFaces)this.setTextureCubeFaceData(vt[Tt],Tt)}setTextureArrayData(vt){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(vt){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(vt,bt,Tt=0){Array.isArray(vt)&&vt.length>1&&this.props.mipmaps!==!1&&log.warn(`${this.id} has mipmap and multiple LODs.`)();const Et=Texture.CubeFaces.indexOf(bt);this.setTexture2DData(vt,Et)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(vt){const{face:bt,width:Tt,height:Et,pixels:wt,data:St,format:At=6408,type:Rt=5121}=vt,{gl:Pt}=this,Ct=wt||St;this.bind(),Ct instanceof Promise?Ct.then(It=>this.setImageDataForFace(Object.assign({},vt,{face:bt,data:It,pixels:It}))):this.width||this.height?Pt.texImage2D(bt,0,At,Tt,Et,0,At,Rt,Ct):Pt.texImage2D(bt,0,At,At,Rt,Ct)}_getImageDataMap(vt){for(let bt=0;bt<Texture.CubeFaces.length;++bt){const Tt=Texture.CubeFaces[bt];vt[Tt]&&(vt[34069+bt]=vt[Tt],delete vt[Tt])}return vt}_setSamplerParameters(vt){log.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(vt))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[bt,Tt]of Object.entries(vt)){const Et=Number(bt),wt=Tt;switch(Et){case 33082:case 33083:this.gl.texParameterf(this.glTarget,Et,wt);break;case 10241:this.gl.texParameteri(this.glTarget,Et,wt);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,Et,wt);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,Et,wt);break;default:this.gl.texParameteri(this.glTarget,Et,wt);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(vt,bt,Tt,Et=this.glTarget){if(Texture.isExternalImage(Tt)){copyExternalImageToMipLevel(this.device.gl,this.handle,Tt,{...this,depth:vt,mipLevel:bt,glTarget:Et,flipY:this.props.flipY});return}if(Texture.isTextureLevelData(Tt)){copyCPUDataToMipLevel(this.device.gl,Tt.data,{...this,depth:vt,mipLevel:bt,glTarget:Et});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(vt){const{gl:bt}=this;return vt!==void 0&&(this.textureUnit=vt,bt.activeTexture(33984+vt)),bt.bindTexture(this.glTarget,this.handle),vt}unbind(vt){const{gl:bt}=this;return vt!==void 0&&(this.textureUnit=vt,bt.activeTexture(33984+vt)),bt.bindTexture(this.glTarget,null),vt}}const COLOR_CHANNELS=[1,2,4,8];class WEBGLRenderPass extends RenderPass{constructor(vt,bt){var wt;super(vt,bt);Bt(this,"device");Bt(this,"glParameters");this.device=vt;let Tt;if(!((wt=bt==null?void 0:bt.parameters)!=null&&wt.viewport))if(bt!=null&&bt.framebuffer){const{width:St,height:At}=bt.framebuffer;Tt=[0,0,St,At]}else{const[St,At]=vt.getCanvasContext().getDrawingBufferSize();Tt=[0,0,St,At]}this.device.pushState(),this.setParameters({viewport:Tt,...this.props.parameters});const Et=this.props.framebuffer;if(Et!=null&&Et.handle)if(this.props.framebuffer){const St=this.props.framebuffer.colorAttachments.map((At,Rt)=>36064+Rt);this.device.gl.drawBuffers(St)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(vt){}popDebugGroup(){}insertDebugMarker(vt){}setParameters(vt={}){const bt={...this.glParameters};bt.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(bt.depthMask=!this.props.depthReadOnly),bt.stencilMask=this.props.stencilReadOnly?0:1,bt[35977]=this.props.discard,vt.viewport&&(vt.viewport.length>=6?(bt.viewport=vt.viewport.slice(0,4),bt.depthRange=[vt.viewport[4],vt.viewport[5]]):bt.viewport=vt.viewport),vt.scissorRect&&(bt.scissorTest=!0,bt.scissor=vt.scissorRect),vt.blendConstant&&(bt.blendColor=vt.blendConstant),vt.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),vt[2967]=vt.stencilReference),vt.colorMask&&(bt.colorMask=COLOR_CHANNELS.map(Tt=>!!(Tt&vt.colorMask))),this.glParameters=bt,setGLParameters(this.device.gl,bt)}beginOcclusionQuery(vt){const bt=this.props.occlusionQuerySet;bt==null||bt.beginOcclusionQuery()}endOcclusionQuery(){const vt=this.props.occlusionQuerySet;vt==null||vt.endOcclusionQuery()}clear(){const vt={...this.glParameters};let bt=0;this.props.clearColors&&this.props.clearColors.forEach((Tt,Et)=>{Tt&&this.clearColorBuffer(Et,Tt)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(bt|=16384,vt.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(bt|=256,vt.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(bt|=1024,vt.clearStencil=this.props.clearStencil),bt!==0&&withGLParameters(this.device.gl,vt,()=>{this.device.gl.clear(bt)})}clearColorBuffer(vt=0,bt=[0,0,0,0]){withGLParameters(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(bt.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,vt,bt);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,vt,bt);break;case Float32Array:this.device.gl.clearBufferfv(6144,vt,bt);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function isSamplerUniform(xt){return SAMPLER_TYPES.includes(xt)}const SAMPLER_TYPES=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],COMPOSITE_GL_TYPES={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function decodeGLUniformType(xt){const yt=COMPOSITE_GL_TYPES[xt];if(!yt)throw new Error("uniform");const[vt,bt,,Tt]=yt;return{format:Tt,components:bt,glType:vt}}function decodeGLAttributeType(xt){const yt=COMPOSITE_GL_TYPES[xt];if(!yt)throw new Error("attribute");const[,vt,,bt,Tt]=yt;return{attributeType:bt,vertexFormat:Tt,components:vt}}function getShaderLayoutFromGLSL(xt,yt){const vt={attributes:[],bindings:[]};vt.attributes=readAttributeDeclarations(xt,yt);const bt=readUniformBlocks(xt,yt);for(const St of bt){const At=St.uniforms.map(Rt=>({name:Rt.name,format:Rt.format,byteOffset:Rt.byteOffset,byteStride:Rt.byteStride,arrayLength:Rt.arrayLength}));vt.bindings.push({type:"uniform",name:St.name,group:0,location:St.location,visibility:(St.vertex?1:0)&(St.fragment?2:0),minBindingSize:St.byteLength,uniforms:At})}const Tt=readUniformBindings(xt,yt);let Et=0;for(const St of Tt)if(isSamplerUniform(St.type)){const{viewDimension:At,sampleType:Rt}=getSamplerInfo(St.type);vt.bindings.push({type:"texture",name:St.name,group:0,location:Et,viewDimension:At,sampleType:Rt}),St.textureUnit=Et,Et+=1}Tt.length&&(vt.uniforms=Tt);const wt=readVaryings(xt,yt);return wt!=null&&wt.length&&(vt.varyings=wt),vt}function readAttributeDeclarations(xt,yt){const vt=[],bt=xt.getProgramParameter(yt,35721);for(let Tt=0;Tt<bt;Tt++){const Et=xt.getActiveAttrib(yt,Tt);if(!Et)throw new Error("activeInfo");const{name:wt,type:St}=Et,At=xt.getAttribLocation(yt,wt);if(At>=0){const{attributeType:Rt}=decodeGLAttributeType(St),Pt=/instance/i.test(wt)?"instance":"vertex";vt.push({name:wt,location:At,stepMode:Pt,type:Rt})}}return vt.sort((Tt,Et)=>Tt.location-Et.location),vt}function readVaryings(xt,yt){const vt=[],bt=xt.getProgramParameter(yt,35971);for(let Tt=0;Tt<bt;Tt++){const Et=xt.getTransformFeedbackVarying(yt,Tt);if(!Et)throw new Error("activeInfo");const{name:wt,type:St,size:At}=Et,{glType:Rt,components:Pt}=decodeGLUniformType(St),Ct={location:Tt,name:wt,type:Rt,size:At*Pt};vt.push(Ct)}return vt.sort((Tt,Et)=>Tt.location-Et.location),vt}function readUniformBindings(xt,yt){const vt=[],bt=xt.getProgramParameter(yt,35718);for(let Tt=0;Tt<bt;Tt++){const Et=xt.getActiveUniform(yt,Tt);if(!Et)throw new Error("activeInfo");const{name:wt,size:St,type:At}=Et,{name:Rt,isArray:Pt}=parseUniformName(wt);let Ct=xt.getUniformLocation(yt,Rt);const It={location:Ct,name:Rt,size:St,type:At,isArray:Pt};if(vt.push(It),It.size>1)for(let Mt=0;Mt<It.size;Mt++){const Ot=`${Rt}[${Mt}]`;Ct=xt.getUniformLocation(yt,Ot);const kt={...It,name:Ot,location:Ct};vt.push(kt)}}return vt}function readUniformBlocks(xt,yt){const vt=(Et,wt)=>xt.getActiveUniformBlockParameter(yt,Et,wt),bt=[],Tt=xt.getProgramParameter(yt,35382);for(let Et=0;Et<Tt;Et++){const wt={name:xt.getActiveUniformBlockName(yt,Et)||"",location:vt(Et,35391),byteLength:vt(Et,35392),vertex:vt(Et,35396),fragment:vt(Et,35398),uniformCount:vt(Et,35394),uniforms:[]},St=vt(Et,35395)||[],At=xt.getActiveUniforms(yt,St,35383),Rt=xt.getActiveUniforms(yt,St,35384),Pt=xt.getActiveUniforms(yt,St,35387),Ct=xt.getActiveUniforms(yt,St,35388);for(let It=0;It<wt.uniformCount;++It){const Mt=xt.getActiveUniform(yt,St[It]);if(!Mt)throw new Error("activeInfo");wt.uniforms.push({name:Mt.name,format:decodeGLUniformType(At[It]).format,type:At[It],arrayLength:Rt[It],byteOffset:Pt[It],byteStride:Ct[It]})}bt.push(wt)}return bt.sort((Et,wt)=>Et.location-wt.location),bt}const SAMPLER_UNIFORMS_GL_TO_GPU={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function getSamplerInfo(xt){const yt=SAMPLER_UNIFORMS_GL_TO_GPU[xt];if(!yt)throw new Error("sampler");const[vt,bt]=yt;return{viewDimension:vt,sampleType:bt}}function parseUniformName(xt){if(xt[xt.length-1]!=="]")return{name:xt,length:1,isArray:!1};const vt=/([^[]*)(\[[0-9]+\])?/.exec(xt);if(!vt||vt.length<2)throw new Error(`Failed to parse GLSL uniform name ${xt}`);return{name:vt[1],length:vt[2]?1:0,isArray:!!vt[2]}}function setUniform(xt,yt,vt,bt){const Tt=xt;let Et=bt;Et===!0&&(Et=1),Et===!1&&(Et=0);const wt=typeof Et=="number"?[Et]:Et;switch(vt){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof bt!="number")throw new Error("samplers must be set to integers");return xt.uniform1i(yt,bt);case 5126:return xt.uniform1fv(yt,wt);case 35664:return xt.uniform2fv(yt,wt);case 35665:return xt.uniform3fv(yt,wt);case 35666:return xt.uniform4fv(yt,wt);case 5124:return xt.uniform1iv(yt,wt);case 35667:return xt.uniform2iv(yt,wt);case 35668:return xt.uniform3iv(yt,wt);case 35669:return xt.uniform4iv(yt,wt);case 35670:return xt.uniform1iv(yt,wt);case 35671:return xt.uniform2iv(yt,wt);case 35672:return xt.uniform3iv(yt,wt);case 35673:return xt.uniform4iv(yt,wt);case 5125:return Tt.uniform1uiv(yt,wt,1);case 36294:return Tt.uniform2uiv(yt,wt,2);case 36295:return Tt.uniform3uiv(yt,wt,3);case 36296:return Tt.uniform4uiv(yt,wt,4);case 35674:return xt.uniformMatrix2fv(yt,!1,wt);case 35675:return xt.uniformMatrix3fv(yt,!1,wt);case 35676:return xt.uniformMatrix4fv(yt,!1,wt);case 35685:return Tt.uniformMatrix2x3fv(yt,!1,wt);case 35686:return Tt.uniformMatrix2x4fv(yt,!1,wt);case 35687:return Tt.uniformMatrix3x2fv(yt,!1,wt);case 35688:return Tt.uniformMatrix3x4fv(yt,!1,wt);case 35689:return Tt.uniformMatrix4x2fv(yt,!1,wt);case 35690:return Tt.uniformMatrix4x3fv(yt,!1,wt)}throw new Error("Illegal uniform")}function isUniformValue(xt){return isNumericArray(xt)!==null||typeof xt=="number"||typeof xt=="boolean"}function splitUniformsAndBindings(xt){const yt={bindings:{},uniforms:{}};return Object.keys(xt).forEach(vt=>{const bt=xt[vt];isUniformValue(bt)?yt.uniforms[vt]=bt:yt.bindings[vt]=bt}),yt}function getGLDrawMode(xt){switch(xt){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(xt)}}function getGLPrimitive(xt){switch(xt){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(xt)}}const LOG_PROGRAM_PERF_PRIORITY=4;class WEBGLRenderPipeline extends RenderPipeline{constructor(vt,bt){super(vt,bt);Bt(this,"device");Bt(this,"handle");Bt(this,"vs");Bt(this,"fs");Bt(this,"introspectedLayout");Bt(this,"uniforms",{});Bt(this,"bindings",{});Bt(this,"varyings",null);Bt(this,"_uniformCount",0);Bt(this,"_uniformSetters",{});this.device=vt,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=bt.vs,this.fs=bt.fs;const{varyings:Tt,bufferMode:Et=35981}=bt;Tt&&Tt.length>0&&(this.varyings=Tt,this.device.gl.transformFeedbackVaryings(this.handle,Tt,Et)),this._linkShaders(),log.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=getShaderLayoutFromGLSL(this.device.gl,this.handle),log.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=mergeShaderLayout(this.introspectedLayout,bt.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(vt,bt){for(const[Tt,Et]of Object.entries(vt)){const wt=this.shaderLayout.bindings.find(St=>St.name===Tt)||this.shaderLayout.bindings.find(St=>St.name===`${Tt}Uniforms`);if(!wt){const St=this.shaderLayout.bindings.map(At=>`"${At.name}"`).join(", ");bt!=null&&bt.disableWarnings||log.warn(`No binding "${Tt}" in render pipeline "${this.id}", expected one of ${St}`,Et)();continue}switch(Et||log.warn(`Unsetting binding "${Tt}" in render pipeline "${this.id}"`)(),wt.type){case"uniform":if(!(Et instanceof WEBGLBuffer)&&!(Et.buffer instanceof WEBGLBuffer))throw new Error("buffer value");break;case"texture":if(!(Et instanceof WEBGLTextureView||Et instanceof WEBGLTexture||Et instanceof WEBGLFramebuffer))throw new Error("texture value");break;case"sampler":log.warn(`Ignoring sampler ${Tt}`)();break;default:throw new Error(wt.type)}this.bindings[Tt]=Et}}draw(vt){var Ft;const{renderPass:bt,parameters:Tt=this.props.parameters,topology:Et=this.props.topology,vertexArray:wt,vertexCount:St,instanceCount:At,isInstanced:Rt=!1,firstVertex:Pt=0,transformFeedback:Ct}=vt,It=getGLDrawMode(Et),Mt=!!wt.indexBuffer,Ot=(Ft=wt.indexBuffer)==null?void 0:Ft.glIndexType;if(this.linkStatus!=="success")return log.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return log.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),wt.bindBeforeRender(bt),Ct&&Ct.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const kt=bt;return withDeviceAndGLParameters(this.device,Tt,kt.glParameters,()=>{Mt&&Rt?this.device.gl.drawElementsInstanced(It,St||0,Ot,Pt,At||0):Mt?this.device.gl.drawElements(It,St||0,Ot,Pt):Rt?this.device.gl.drawArraysInstanced(It,Pt,St||0,At||0):this.device.gl.drawArrays(It,Pt,St||0),Ct&&Ct.end()}),wt.unbindAfterRender(bt),!0}setUniformsWebGL(vt){const{bindings:bt}=splitUniformsAndBindings(vt);Object.keys(bt).forEach(Tt=>{log.warn(`Unsupported value "${JSON.stringify(bt[Tt])}" used in setUniforms() for key ${Tt}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,vt)}async _linkShaders(){const{gl:vt}=this.device;if(vt.attachShader(this.handle,this.vs.handle),vt.attachShader(this.handle,this.fs.handle),log.time(LOG_PROGRAM_PERF_PRIORITY,`linkProgram for ${this.id}`)(),vt.linkProgram(this.handle),log.timeEnd(LOG_PROGRAM_PERF_PRIORITY,`linkProgram for ${this.id}`)(),log.level,!this.device.features.has("compilation-status-async-webgl")){const Tt=this._getLinkStatus();this._reportLinkStatus(Tt);return}log.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),log.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const bt=this._getLinkStatus();this._reportLinkStatus(bt)}async _reportLinkStatus(vt){var bt;switch(vt){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((bt=this.fs)==null?void 0:bt.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const Tt=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${vt}: ${Tt}`)}}_getLinkStatus(){const{gl:vt}=this.device;return vt.getProgramParameter(this.handle,35714)?(vt.validateProgram(this.handle),vt.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const vt=async Et=>await new Promise(wt=>setTimeout(wt,Et));if(!this.device.features.has("compilation-status-async-webgl")){await vt(10);return}const{gl:Tt}=this.device;for(;;){if(Tt.getProgramParameter(this.handle,37297))return;await vt(10)}}_areTexturesRenderable(){let vt=!0;for(const bt of this.shaderLayout.bindings)!this.bindings[bt.name]&&!this.bindings[bt.name.replace(/Uniforms$/,"")]&&(log.warn(`Binding ${bt.name} not found in ${this.id}`)(),vt=!1);return vt}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:vt}=this.device;vt.useProgram(this.handle);let bt=0,Tt=0;for(const Et of this.shaderLayout.bindings){const wt=this.bindings[Et.name]||this.bindings[Et.name.replace(/Uniforms$/,"")];if(!wt)throw new Error(`No value for binding ${Et.name} in ${this.id}`);switch(Et.type){case"uniform":const{name:St}=Et,At=vt.getUniformBlockIndex(this.handle,St);if(At===4294967295)throw new Error(`Invalid uniform block name ${St}`);vt.uniformBlockBinding(this.handle,Tt,At),wt instanceof WEBGLBuffer?vt.bindBufferBase(35345,Tt,wt.handle):vt.bindBufferRange(35345,Tt,wt.buffer.handle,wt.offset||0,wt.size||wt.buffer.byteLength-wt.offset),Tt+=1;break;case"texture":if(!(wt instanceof WEBGLTextureView||wt instanceof WEBGLTexture||wt instanceof WEBGLFramebuffer))throw new Error("texture");let Rt;if(wt instanceof WEBGLTextureView)Rt=wt.texture;else if(wt instanceof WEBGLTexture)Rt=wt;else if(wt instanceof WEBGLFramebuffer&&wt.colorAttachments[0]instanceof WEBGLTextureView)log.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),Rt=wt.colorAttachments[0].texture;else throw new Error("No texture");vt.activeTexture(33984+bt),vt.bindTexture(Rt.glTarget,Rt.handle),bt+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${Et.type}' not supported in WebGL`)}}}_applyUniforms(){for(const vt of this.shaderLayout.uniforms||[]){const{name:bt,location:Tt,type:Et,textureUnit:wt}=vt,St=this.uniforms[bt]??wt;St!==void 0&&setUniform(this.device.gl,Tt,Et,St)}}}function mergeShaderLayout(xt,yt){const vt={...xt,attributes:xt.attributes.map(bt=>({...bt}))};for(const bt of(yt==null?void 0:yt.attributes)||[]){const Tt=vt.attributes.find(Et=>Et.name===bt.name);Tt?(Tt.type=bt.type||Tt.type,Tt.stepMode=bt.stepMode||Tt.stepMode):log.warn(`shader layout attribute ${bt.name} not present in shader`)}return vt}class WEBGLCommandBuffer extends CommandBuffer{constructor(vt){super(vt,{});Bt(this,"device");Bt(this,"commands",[]);this.device=vt}submitCommands(vt=this.commands){for(const bt of vt)switch(bt.name){case"copy-buffer-to-buffer":_copyBufferToBuffer(this.device,bt.options);break;case"copy-buffer-to-texture":_copyBufferToTexture(this.device,bt.options);break;case"copy-texture-to-buffer":_copyTextureToBuffer(this.device,bt.options);break;case"copy-texture-to-texture":_copyTextureToTexture(this.device,bt.options);break;default:throw new Error(bt.name)}}}function _copyBufferToBuffer(xt,yt){const vt=yt.sourceBuffer,bt=yt.destinationBuffer;xt.gl.bindBuffer(36662,vt.handle),xt.gl.bindBuffer(36663,bt.handle),xt.gl.copyBufferSubData(36662,36663,yt.sourceOffset??0,yt.destinationOffset??0,yt.size),xt.gl.bindBuffer(36662,null),xt.gl.bindBuffer(36663,null)}function _copyBufferToTexture(xt,yt){throw new Error("Not implemented")}function _copyTextureToBuffer(xt,yt){const{sourceTexture:vt,mipLevel:bt=0,aspect:Tt="all",width:Et=yt.sourceTexture.width,height:wt=yt.sourceTexture.height,depthOrArrayLayers:St=0,origin:At=[0,0],destinationBuffer:Rt,byteOffset:Pt=0,bytesPerRow:Ct,rowsPerImage:It}=yt;if(Tt!=="all")throw new Error("aspect not supported in WebGL");if(bt!==0||St!==0||Ct||It)throw new Error("not implemented");const{framebuffer:Mt,destroyFramebuffer:Ot}=getFramebuffer$1(vt);let kt;try{const Ft=Rt,Nt=Et||Mt.width,Lt=wt||Mt.height,Dt=getTextureFormatWebGL(Mt.colorAttachments[0].texture.props.format),$t=Dt.format,zt=Dt.type;xt.gl.bindBuffer(35051,Ft.handle),kt=xt.gl.bindFramebuffer(36160,Mt.handle),xt.gl.readPixels(At[0],At[1],Nt,Lt,$t,zt,Pt)}finally{xt.gl.bindBuffer(35051,null),kt!==void 0&&xt.gl.bindFramebuffer(36160,kt),Ot&&Mt.destroy()}}function _copyTextureToTexture(xt,yt){const{sourceTexture:vt,destinationMipLevel:bt=0,origin:Tt=[0,0],destinationOrigin:Et=[0,0],destinationTexture:wt}=yt;let{width:St=yt.destinationTexture.width,height:At=yt.destinationTexture.height}=yt;const{framebuffer:Rt,destroyFramebuffer:Pt}=getFramebuffer$1(vt),[Ct,It]=Tt,[Mt,Ot,kt]=Et,Ft=xt.gl.bindFramebuffer(36160,Rt.handle);let Nt=null,Lt;if(wt instanceof WEBGLTexture)Nt=wt,St=Number.isFinite(St)?St:Nt.width,At=Number.isFinite(At)?At:Nt.height,Nt.bind(0),Lt=Nt.glTarget;else throw new Error("invalid destination");switch(Lt){case 3553:case 34067:xt.gl.copyTexSubImage2D(Lt,bt,Mt,Ot,Ct,It,St,At);break;case 35866:case 32879:xt.gl.copyTexSubImage3D(Lt,bt,Mt,Ot,kt,Ct,It,St,At);break}Nt&&Nt.unbind(),xt.gl.bindFramebuffer(36160,Ft),Pt&&Rt.destroy()}function getFramebuffer$1(xt){if(xt instanceof Texture){const{width:yt,height:vt,id:bt}=xt;return{framebuffer:xt.device.createFramebuffer({id:`framebuffer-for-${bt}`,width:yt,height:vt,colorAttachments:[xt]}),destroyFramebuffer:!0}}return{framebuffer:xt,destroyFramebuffer:!1}}class WEBGLCommandEncoder extends CommandEncoder{constructor(vt,bt){super(vt,bt);Bt(this,"device");Bt(this,"commandBuffer");this.device=vt,this.commandBuffer=new WEBGLCommandBuffer(vt)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(vt){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:vt})}copyBufferToTexture(vt){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:vt})}copyTextureToBuffer(vt){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:vt})}copyTextureToTexture(vt){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:vt})}pushDebugGroup(vt){}popDebugGroup(){}insertDebugMarker(vt){}resolveQuerySet(vt,bt,Tt){}}function fillArray(xt){const{target:yt,source:vt,start:bt=0,count:Tt=1}=xt,Et=vt.length,wt=Tt*Et;let St=0;for(let At=bt;St<Et;St++)yt[At++]=vt[St];for(;St<wt;)St<wt-St?(yt.copyWithin(bt+St,bt,bt+St),St*=2):(yt.copyWithin(bt+St,bt,bt+wt-St),St=wt);return xt.target}class WEBGLVertexArray extends VertexArray{constructor(vt,bt){super(vt,bt);Bt(this,"device");Bt(this,"handle");Bt(this,"buffer",null);Bt(this,"bufferValue",null);this.device=vt,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(vt){return getBrowser()==="Chrome"}destroy(){var vt;super.destroy(),this.buffer&&((vt=this.buffer)==null||vt.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(vt){const bt=vt;if(bt&&bt.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,bt?bt.handle:null),this.indexBuffer=bt,this.device.gl.bindVertexArray(null)}setBuffer(vt,bt){const Tt=bt;if(Tt.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:Et,type:wt,stride:St,offset:At,normalized:Rt,integer:Pt,divisor:Ct}=this._getAccessor(vt);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,Tt.handle),Pt?this.device.gl.vertexAttribIPointer(vt,Et,wt,St,At):this.device.gl.vertexAttribPointer(vt,Et,wt,Rt,St,At),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(vt),this.device.gl.vertexAttribDivisor(vt,Ct||0),this.attributes[vt]=Tt,this.device.gl.bindVertexArray(null)}setConstantWebGL(vt,bt){this._enable(vt,!1),this.attributes[vt]=bt}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let vt=0;vt<this.maxVertexAttributes;++vt){const bt=this.attributes[vt];ArrayBuffer.isView(bt)&&this.device.setConstantAttributeWebGL(vt,bt)}}_getAccessor(vt){const bt=this.attributeInfos[vt];if(!bt)throw new Error(`Unknown attribute location ${vt}`);const Tt=getGLFromVertexType(bt.bufferDataType);return{size:bt.bufferComponents,type:Tt,stride:bt.byteStride,offset:bt.byteOffset,normalized:bt.normalized,integer:bt.integer,divisor:bt.stepMode==="instance"?1:0}}_enable(vt,bt=!0){const Et=WEBGLVertexArray.isConstantAttributeZeroSupported(this.device)||vt!==0;(bt||Et)&&(vt=Number(vt),this.device.gl.bindVertexArray(this.handle),bt?this.device.gl.enableVertexAttribArray(vt):this.device.gl.disableVertexAttribArray(vt),this.device.gl.bindVertexArray(null))}getConstantBuffer(vt,bt){const Tt=normalizeConstantArrayValue(bt),Et=Tt.byteLength*vt,wt=Tt.length*vt;if(this.buffer&&Et!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${Et} !== ${this.buffer.byteLength}.`);let St=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:Et}),St=St||!compareConstantArrayValues$1(Tt,this.bufferValue),St){const At=getScratchArray(bt.constructor,wt);fillArray({target:At,source:Tt,start:0,count:wt}),this.buffer.write(At),this.bufferValue=bt}return this.buffer}}function normalizeConstantArrayValue(xt){return Array.isArray(xt)?new Float32Array(xt):xt}function compareConstantArrayValues$1(xt,yt){if(!xt||!yt||xt.length!==yt.length||xt.constructor!==yt.constructor)return!1;for(let vt=0;vt<xt.length;++vt)if(xt[vt]!==yt[vt])return!1;return!0}class WEBGLTransformFeedback extends TransformFeedback{constructor(vt,bt){super(vt,bt);Bt(this,"device");Bt(this,"gl");Bt(this,"handle");Bt(this,"layout");Bt(this,"buffers",{});Bt(this,"unusedBuffers",{});Bt(this,"bindOnUse",!0);Bt(this,"_bound",!1);this.device=vt,this.gl=vt.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,bt.buffers&&this.setBuffers(bt.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(vt="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(getGLPrimitive(vt))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(vt){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const bt in vt)this.setBuffer(bt,vt[bt])})}setBuffer(vt,bt){const Tt=this._getVaryingIndex(vt),{buffer:Et,byteLength:wt,byteOffset:St}=this._getBufferRange(bt);if(Tt<0){this.unusedBuffers[vt]=Et,log.warn(`${this.id} unusedBuffers varying buffer ${vt}`)();return}this.buffers[Tt]={buffer:Et,byteLength:wt,byteOffset:St},this.bindOnUse||this._bindBuffer(Tt,Et,St,wt)}getBuffer(vt){if(isIndex(vt))return this.buffers[vt]||null;const bt=this._getVaryingIndex(vt);return bt>=0?this.buffers[bt]:null}bind(vt=this.handle){if(typeof vt!="function")return this.gl.bindTransformFeedback(36386,vt),this;let bt;return this._bound?bt=vt():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,bt=vt(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),bt}unbind(){this.bind(null)}_getBufferRange(vt){if(vt instanceof WEBGLBuffer)return{buffer:vt,byteOffset:0,byteLength:vt.byteLength};const{buffer:bt,byteOffset:Tt=0,byteLength:Et=vt.buffer.byteLength}=vt;return{buffer:bt,byteOffset:Tt,byteLength:Et}}_getVaryingIndex(vt){if(isIndex(vt))return Number(vt);for(const bt of this.layout.varyings)if(vt===bt.name)return bt.location;return-1}_bindBuffers(){for(const vt in this.buffers){const{buffer:bt,byteLength:Tt,byteOffset:Et}=this._getBufferRange(this.buffers[vt]);this._bindBuffer(Number(vt),bt,Et,Tt)}}_unbindBuffers(){for(const vt in this.buffers)this.gl.bindBufferBase(35982,Number(vt),null)}_bindBuffer(vt,bt,Tt=0,Et){const wt=bt&&bt.handle;!wt||Et===void 0?this.gl.bindBufferBase(35982,vt,wt):this.gl.bindBufferRange(35982,vt,wt,Tt,Et)}}function isIndex(xt){return typeof xt=="number"?Number.isInteger(xt):/^\d+$/.test(xt)}class WEBGLQuerySet extends QuerySet{constructor(vt,bt){super(vt,bt);Bt(this,"device");Bt(this,"handle");Bt(this,"target",null);Bt(this,"_queryPending",!1);Bt(this,"_pollingPromise",null);if(this.device=vt,bt.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(vt){return this._begin(vt!=null&&vt.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(vt){this._queryPending||(this.target=vt,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const vt=this.device.gl.getQueryParameter(this.handle,34919);return vt&&(this._queryPending=!1),vt}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(vt=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let bt=0;return this._pollingPromise=new Promise((Tt,Et)=>{const wt=()=>{this.isResultAvailable()?(Tt(this.getResult()),this._pollingPromise=null):bt++>vt?(Et("Timed out"),this._pollingPromise=null):requestAnimationFrame(wt)};requestAnimationFrame(wt)}),this._pollingPromise}}class WebGLDevice extends Device{constructor(vt){var Ct,It;super({...vt,id:vt.id||uid("webgl-device")});Bt(this,"type","webgl");Bt(this,"handle");Bt(this,"features");Bt(this,"limits");Bt(this,"info");Bt(this,"canvasContext");Bt(this,"lost");Bt(this,"_resolveContextLost");Bt(this,"gl");Bt(this,"debug",!1);Bt(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});Bt(this,"_extensions",{});Bt(this,"_polyfilled",!1);Bt(this,"spectorJS");Bt(this,"renderPass",null);Bt(this,"_constants");const bt=Device._getCanvasContextProps(vt);if(!bt)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let Tt=(It=(Ct=bt.canvas)==null?void 0:Ct.gl)==null?void 0:It.device;if(Tt)throw new Error(`WebGL context already attached to device ${Tt.id}`);this.canvasContext=new WebGLCanvasContext(this,bt),this.lost=new Promise(Mt=>{this._resolveContextLost=Mt});const Et={...vt.webgl};bt.alphaMode==="premultiplied"&&(Et.premultipliedAlpha=!0),vt.powerPreference!==void 0&&(Et.powerPreference=vt.powerPreference);const St=this.props._handle||createBrowserContext(this.canvasContext.canvas,{onContextLost:Mt=>{var Ot;return(Ot=this._resolveContextLost)==null?void 0:Ot.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:Mt=>console.log("WebGL context restored")},Et);if(!St)throw new Error("WebGL context creation failed");if(Tt=St.device,Tt){if(vt._reuseDevices)return log.log(1,`Not creating a new Device, instead returning a reference to Device ${Tt.id} already attached to WebGL context`,Tt)(),Tt._reused=!0,Tt;throw new Error(`WebGL context already attached to device ${Tt.id}`)}this.handle=St,this.gl=St,this.spectorJS=initializeSpectorJS({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=getDeviceInfo(this.gl,this._extensions),this.limits=new WebGLDeviceLimits(this.gl),this.features=new WebGLDeviceFeatures(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),bt.autoResize!==!1&&this.canvasContext.resize(),new WebGLStateTracker(this.gl,{log:(...Mt)=>log.log(1,...Mt)()}).trackState(this.gl,{copyState:!1});const Rt=vt.debugWebGL||vt.debug,Pt=vt.debugWebGL;Rt&&(this.gl=makeDebugContext(this.gl,{debugWebGL:Rt,traceWebGL:Pt}),log.warn("WebGL debug mode activated. Performance reduced.")(),vt.debugWebGL&&(log.level=Math.max(log.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(vt){throw new Error("WebGL only supports a single canvas")}createBuffer(vt){const bt=this._normalizeBufferProps(vt);return new WEBGLBuffer(this,bt)}createTexture(vt){return new WEBGLTexture(this,vt)}createExternalTexture(vt){throw new Error("createExternalTexture() not implemented")}createSampler(vt){return new WEBGLSampler(this,vt)}createShader(vt){return new WEBGLShader(this,vt)}createFramebuffer(vt){return new WEBGLFramebuffer(this,vt)}createVertexArray(vt){return new WEBGLVertexArray(this,vt)}createTransformFeedback(vt){return new WEBGLTransformFeedback(this,vt)}createQuerySet(vt){return new WEBGLQuerySet(this,vt)}createRenderPipeline(vt){return new WEBGLRenderPipeline(this,vt)}beginRenderPass(vt){return new WEBGLRenderPass(this,vt)}createComputePipeline(vt){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(vt){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(vt={}){return new WEBGLCommandEncoder(this,vt)}submit(){var vt;(vt=this.renderPass)==null||vt.end(),this.renderPass=null}readPixelsToArrayWebGL(vt,bt){return readPixelsToArray(vt,bt)}readPixelsToBufferWebGL(vt,bt){return readPixelsToBuffer(vt,bt)}setParametersWebGL(vt){setGLParameters(this.gl,vt)}getParametersWebGL(vt){return getGLParameters(this.gl,vt)}withParametersWebGL(vt,bt){return withGLParameters(this.gl,vt,bt)}resetWebGL(){log.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),resetGLParameters(this.gl)}_getDeviceSpecificTextureFormatCapabilities(vt){return getTextureFormatCapabilitiesWebGL(this.gl,vt,this._extensions)}loseDevice(){var Et;let vt=!1;const Tt=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return Tt&&(vt=!0,Tt.loseContext()),(Et=this._resolveContextLost)==null||Et.call(this,{reason:"destroyed",message:"Application triggered context loss"}),vt}pushState(){WebGLStateTracker.get(this.gl).push()}popState(){WebGLStateTracker.get(this.gl).pop()}setSpectorMetadata(vt,bt){vt.__SPECTOR_Metadata=bt}getGLKey(vt,bt){const Tt=Number(vt);for(const Et in this.gl)if(this.gl[Et]===Tt)return`GL.${Et}`;return bt!=null&&bt.emptyIfUnknown?"":String(vt)}getGLKeys(vt){const bt={emptyIfUnknown:!0};return Object.entries(vt).reduce((Tt,[Et,wt])=>(Tt[`${Et}:${this.getGLKey(Et,bt)}`]=`${wt}:${this.getGLKey(wt,bt)}`,Tt),{})}setConstantAttributeWebGL(vt,bt){const Tt=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(Tt).fill(null);const Et=this._constants[vt];switch(Et&&compareConstantArrayValues(Et,bt)&&log.info(1,`setConstantAttributeWebGL(${vt}) could have been skipped, value unchanged`)(),this._constants[vt]=bt,bt.constructor){case Float32Array:setConstantFloatArray(this,vt,bt);break;case Int32Array:setConstantIntArray(this,vt,bt);break;case Uint32Array:setConstantUintArray(this,vt,bt);break;default:throw new Error("constant")}}getExtension(vt){return getWebGLExtension(this.gl,vt,this._extensions),this._extensions}}function setConstantFloatArray(xt,yt,vt){switch(vt.length){case 1:xt.gl.vertexAttrib1fv(yt,vt);break;case 2:xt.gl.vertexAttrib2fv(yt,vt);break;case 3:xt.gl.vertexAttrib3fv(yt,vt);break;case 4:xt.gl.vertexAttrib4fv(yt,vt);break}}function setConstantIntArray(xt,yt,vt){xt.gl.vertexAttribI4iv(yt,vt)}function setConstantUintArray(xt,yt,vt){xt.gl.vertexAttribI4uiv(yt,vt)}function compareConstantArrayValues(xt,yt){if(!xt||!yt||xt.length!==yt.length||xt.constructor!==yt.constructor)return!1;for(let vt=0;vt<xt.length;++vt)if(xt[vt]!==yt[vt])return!1;return!0}const WEBGL1_STATIC_EXTENSIONS={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},getWEBGL_draw_buffers=xt=>({drawBuffersWEBGL(yt){return xt.drawBuffers(yt)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),getOES_vertex_array_object=xt=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return xt.createVertexArray()},deleteVertexArrayOES(yt){return xt.deleteVertexArray(yt)},isVertexArrayOES(yt){return xt.isVertexArray(yt)},bindVertexArrayOES(yt){return xt.bindVertexArray(yt)}}),getANGLE_instanced_arrays=xt=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...yt){return xt.drawArraysInstanced(...yt)},drawElementsInstancedANGLE(...yt){return xt.drawElementsInstanced(...yt)},vertexAttribDivisorANGLE(...yt){return xt.vertexAttribDivisor(...yt)}});function enforceWebGL2(xt=!0){const yt=HTMLCanvasElement.prototype;if(!xt&&yt.originalGetContext){yt.getContext=yt.originalGetContext,yt.originalGetContext=void 0;return}yt.originalGetContext=yt.getContext,yt.getContext=function(vt,bt){if(vt==="webgl"||vt==="experimental-webgl"){const Tt=this.originalGetContext("webgl2",bt);return Tt instanceof HTMLElement&&polyfillWebGL1Extensions(Tt),Tt}return this.originalGetContext(vt,bt)}}function polyfillWebGL1Extensions(xt){xt.getExtension("EXT_color_buffer_float");const yt={...WEBGL1_STATIC_EXTENSIONS,WEBGL_disjoint_timer_query:xt.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:getWEBGL_draw_buffers(xt),OES_vertex_array_object:getOES_vertex_array_object(xt),ANGLE_instanced_arrays:getANGLE_instanced_arrays(xt)},vt=xt.getExtension;xt.getExtension=function(Tt){const Et=vt.call(xt,Tt);return Et||(Tt in yt?yt[Tt]:null)};const bt=xt.getSupportedExtensions;xt.getSupportedExtensions=function(){const Tt=bt.apply(xt)||[];return Tt==null?void 0:Tt.concat(Object.keys(yt))}}const LOG_LEVEL=1;class WebGLAdapter extends Adapter{constructor(){super();Bt(this,"type","webgl");Device.defaultProps={...Device.defaultProps,...DEFAULT_SPECTOR_PROPS},WebGLDevice.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(vt){enforceWebGL2(vt)}async attach(vt){if(vt instanceof WebGLDevice)return vt;if((vt==null?void 0:vt.device)instanceof Device)return vt.device;if(!isWebGL(vt))throw new Error("Invalid WebGL2RenderingContext");return new WebGLDevice({_handle:vt,createCanvasContext:{canvas:vt.canvas,autoResize:!1}})}async create(vt={}){log.groupCollapsed(LOG_LEVEL,"WebGLDevice created")();const bt=[];(vt.debugWebGL||vt.debug)&&bt.push(loadWebGLDeveloperTools()),vt.debugSpectorJS&&bt.push(loadSpectorJS(vt));const Tt=await Promise.allSettled(bt);for(const St of Tt)St.status==="rejected"&&log.error(`Failed to initialize debug libraries ${St.reason}`)();const Et=new WebGLDevice(vt),wt=`${Et._reused?"Reusing":"Created"} device with WebGL2 ${Et.debug?"debug ":""}context: ${Et.info.vendor}, ${Et.info.renderer} for canvas: ${Et.canvasContext.id}`;return log.probe(LOG_LEVEL,wt)(),log.table(LOG_LEVEL,Et.info)(),log.groupEnd(LOG_LEVEL)(),Et}}function isWebGL(xt){return typeof WebGL2RenderingContext<"u"&&xt instanceof WebGL2RenderingContext?!0:!!(xt&&Number.isFinite(xt._version))}const webgl2Adapter=new WebGLAdapter;function noop$1(){}const getCursor=({isDragging:xt})=>xt?"grabbing":"grab",defaultProps$9={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:noop$1,onWebGLInitialized:noop$1,onResize:noop$1,onViewStateChange:noop$1,onInteractionStateChange:noop$1,onBeforeRender:noop$1,onAfterRender:noop$1,onLoad:noop$1,onError:xt=>defaultLogger.error(xt.message,xt.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor,getTooltip:null,debug:!1,drawPickingColors:!1};class Deck{constructor(yt){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Stats({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=bt=>{const{_pickRequest:Tt}=this;if(bt.type==="pointerleave")Tt.x=-1,Tt.y=-1,Tt.radius=0;else{if(bt.leftButton||bt.rightButton)return;{const Et=bt.offsetCenter;if(!Et)return;Tt.x=Et.x,Tt.y=Et.y,Tt.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:Tt.x,y:Tt.y}),Tt.event=bt},this._onEvent=bt=>{const Tt=EVENT_HANDLERS[bt.type],Et=bt.offsetCenter;if(!Tt||!Et||!this.layerManager)return;const wt=this.layerManager.getLayers(),St=this.deckPicker.getLastPickedObject({x:Et.x,y:Et.y,layers:wt,viewports:this.getViewports(Et)},this._lastPointerDownInfo),{layer:At}=St,Rt=At&&(At[Tt]||At.props[Tt]),Pt=this.props[Tt];let Ct=!1;Rt&&(Ct=Rt.call(At,St,bt)),Ct||(Pt==null||Pt(St,bt),this.widgetManager.onEvent(St,bt))},this._onPointerDown=bt=>{var wt;if(((wt=this.device)==null?void 0:wt.type)==="webgpu")return;const Tt=bt.offsetCenter,Et=this._pick("pickObject","pickObject Time",{x:Tt.x,y:Tt.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=Et.result[0]||Et.emptyInfo},this.props={...defaultProps$9,...yt},yt=this.props,yt.viewState&&yt.initialViewState&&defaultLogger.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,yt.device&&(this.device=yt.device);let vt=this.device;!vt&&yt.gl&&(yt.gl instanceof WebGLRenderingContext&&defaultLogger.error("WebGL1 context not supported.")(),vt=webgl2Adapter.attach(yt.gl)),vt||(vt=luma.createDevice({type:"best-available",_reuseDevices:!0,adapters:[webgl2Adapter],...yt.deviceProps,createCanvasContext:{canvas:this._createCanvas(yt),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(vt,yt),this.setProps(yt),yt._typedArrayManagerProps&&defaultTypedArrayManager.setOptions(yt._typedArrayManagerProps),this.animationLoop.start()}finalize(){var yt,vt,bt,Tt,Et,wt,St,At,Rt,Pt;(yt=this.animationLoop)==null||yt.stop(),(vt=this.animationLoop)==null||vt.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(bt=this.layerManager)==null||bt.finalize(),this.layerManager=null,(Tt=this.viewManager)==null||Tt.finalize(),this.viewManager=null,(Et=this.effectManager)==null||Et.finalize(),this.effectManager=null,(wt=this.deckRenderer)==null||wt.finalize(),this.deckRenderer=null,(St=this.deckPicker)==null||St.finalize(),this.deckPicker=null,(At=this.eventManager)==null||At.destroy(),this.eventManager=null,(Rt=this.widgetManager)==null||Rt.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((Pt=this.canvas.parentElement)==null||Pt.removeChild(this.canvas),this.canvas=null)}setProps(yt){var bt;this.stats.get("setProps Time").timeStart(),"onLayerHover"in yt&&defaultLogger.removed("onLayerHover","onHover")(),"onLayerClick"in yt&&defaultLogger.removed("onLayerClick","onClick")(),yt.initialViewState&&!deepEqual(this.props.initialViewState,yt.initialViewState,3)&&(this.viewState=yt.initialViewState),Object.assign(this.props,yt),this._setCanvasSize(this.props);const vt=Object.create(this.props);Object.assign(vt,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(bt=this.animationLoop)==null||bt.setProps(vt),this.layerManager&&(this.viewManager.setProps(vt),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(vt),this.effectManager.setProps(vt),this.deckRenderer.setProps(vt),this.deckPicker.setProps(vt),this.widgetManager.setProps(vt)),this.stats.get("setProps Time").timeEnd()}needsRedraw(yt={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let vt=this._needsRedraw;yt.clearRedrawFlags&&(this._needsRedraw=!1);const bt=this.viewManager.needsRedraw(yt),Tt=this.layerManager.needsRedraw(yt),Et=this.effectManager.needsRedraw(yt),wt=this.deckRenderer.needsRedraw(yt);return vt=vt||bt||Tt||Et||wt,vt}redraw(yt){if(!this.layerManager)return;let vt=this.needsRedraw({clearRedrawFlags:!0});vt=yt||vt,vt&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(vt):this._drawLayers(vt))}get isInitialized(){return this.viewManager!==null}getViews(){return assert(this.viewManager),this.viewManager.views}getViewports(yt){return assert(this.viewManager),this.viewManager.getViewports(yt)}getCanvas(){return this.canvas}pickObject(yt){const vt=this._pick("pickObject","pickObject Time",yt).result;return vt.length?vt[0]:null}pickMultipleObjects(yt){return yt.depth=yt.depth||10,this._pick("pickObject","pickMultipleObjects Time",yt).result}pickObjects(yt){return this._pick("pickObjects","pickObjects Time",yt)}_addResources(yt,vt=!1){for(const bt in yt)this.layerManager.resourceManager.add({resourceId:bt,data:yt[bt],forceUpdate:vt})}_removeResources(yt){for(const vt of yt)this.layerManager.resourceManager.remove(vt)}_addDefaultEffect(yt){this.effectManager.addDefaultEffect(yt)}_addDefaultShaderModule(yt){this.layerManager.addDefaultShaderModule(yt)}_removeDefaultShaderModule(yt){var vt;(vt=this.layerManager)==null||vt.removeDefaultShaderModule(yt)}_pick(yt,vt,bt){assert(this.deckPicker);const{stats:Tt}=this;Tt.get("Pick Count").incrementCount(),Tt.get(vt).timeStart();const Et=this.deckPicker[yt]({layers:this.layerManager.getLayers(bt),views:this.viewManager.getViews(),viewports:this.getViewports(bt),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...bt});return Tt.get(vt).timeEnd(),Et}_createCanvas(yt){let vt=yt.canvas;return typeof vt=="string"&&(vt=document.getElementById(vt),assert(vt)),vt||(vt=document.createElement("canvas"),vt.id=yt.id||"deckgl-overlay",(yt.parent||document.body).appendChild(vt)),Object.assign(vt.style,yt.style),vt}_setCanvasSize(yt){var Tt;if(!this.canvas)return;const{width:vt,height:bt}=yt;if(vt||vt===0){const Et=Number.isFinite(vt)?`${vt}px`:vt;this.canvas.style.width=Et}if(bt||bt===0){const Et=Number.isFinite(bt)?`${bt}px`:bt;this.canvas.style.position=((Tt=yt.style)==null?void 0:Tt.position)||"absolute",this.canvas.style.height=Et}}_updateCanvasSize(){var Tt,Et;const{canvas:yt}=this;if(!yt)return;const vt=yt.clientWidth??yt.width,bt=yt.clientHeight??yt.height;(vt!==this.width||bt!==this.height)&&(this.width=vt,this.height=bt,(Tt=this.viewManager)==null||Tt.setProps({width:vt,height:bt}),(Et=this.layerManager)==null||Et.activateViewport(this.getViewports()[0]),this.props.onResize({width:vt,height:bt}))}_createAnimationLoop(yt,vt){const{gl:bt,onError:Tt,useDevicePixels:Et}=vt;return new AnimationLoop({device:yt,useDevicePixels:Et,autoResizeDrawingBuffer:!bt,autoResizeViewport:!1,onInitialize:wt=>this._setDevice(wt.device),onRender:this._onRenderFrame.bind(this),onError:Tt})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:yt}=this.props,vt=Array.isArray(yt)?yt:yt?[yt]:[new MapView({id:"default-view"})];return vt.length&&this.props.controller&&(vt[0].props.controller=this.props.controller),vt}_onContextLost(){const{onError:yt}=this.props;this.animationLoop&&yt&&yt(new Error("WebGL context is lost"))}_pickAndCallback(){var vt,bt,Tt,Et;if(((vt=this.device)==null?void 0:vt.type)==="webgpu")return;const{_pickRequest:yt}=this;if(yt.event){const{result:wt,emptyInfo:St}=this._pick("pickObject","pickObject Time",yt);this.cursorState.isHovering=wt.length>0;let At=St,Rt=!1;for(const Pt of wt)At=Pt,Rt=((bt=Pt.layer)==null?void 0:bt.onHover(Pt,yt.event))||Rt;Rt||((Et=(Tt=this.props).onHover)==null||Et.call(Tt,At,yt.event),this.widgetManager.onHover(At,yt.event)),yt.event=null}}_updateCursor(){const yt=this.props.parent||this.canvas;yt&&(yt.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(yt){var Tt,Et;if(this.device=yt,!this.animationLoop)return;this.canvas||(this.canvas=(Tt=this.device.canvasContext)==null?void 0:Tt.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const vt=new Timeline;vt.play(),this.animationLoop.attachTimeline(vt),this.eventManager=new EventManager(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(RECOGNIZERS).map(wt=>{var Mt;const[St,At,Rt,Pt]=RECOGNIZERS[wt],Ct=(Mt=this.props.eventRecognizerOptions)==null?void 0:Mt[wt],It={...At,...Ct,event:wt};return{recognizer:new St(It),recognizeWith:Rt,requestFailure:Pt}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const wt in EVENT_HANDLERS)this.eventManager.on(wt,this._onEvent);this.viewManager=new ViewManager({timeline:vt,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const bt=this.viewManager.getViewports()[0];this.layerManager=new LayerManager(this.device,{deck:this,stats:this.stats,viewport:bt,timeline:vt}),this.effectManager=new EffectManager({deck:this,device:this.device}),this.deckRenderer=new DeckRenderer(this.device),this.deckPicker=new DeckPicker(this.device),this.widgetManager=new WidgetManager({deck:this,parentElement:(Et=this.canvas)==null?void 0:Et.parentElement}),this.widgetManager.addDefault(new Tooltip),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(yt,vt){var wt;const{device:bt,gl:Tt}=this.layerManager.context;this.props.onBeforeRender({device:bt,gl:Tt});const Et={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...vt};(wt=this.deckRenderer)==null||wt.renderLayers(Et),Et.pass==="screen"&&this.widgetManager.onRedraw({viewports:Et.viewports,layers:Et.layers}),this.props.onAfterRender({device:bt,gl:Tt})}_onRenderFrame(){var yt;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),defaultLogger.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((yt=this.device)==null?void 0:yt.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(yt){const vt=this.props.onViewStateChange(yt)||yt.viewState;this.viewState&&(this.viewState={...this.viewState,[yt.viewId]:vt},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(yt){this.cursorState.isDragging=yt.isDragging||!1,this.props.onInteractionStateChange(yt)}_getFrameStats(){const{stats:yt}=this;yt.get("frameRate").timeEnd(),yt.get("frameRate").timeStart();const vt=this.animationLoop.stats;yt.get("GPU Time").addTime(vt.get("GPU Time").lastTiming),yt.get("CPU Time").addTime(vt.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:yt,stats:vt}=this;yt.fps=vt.get("frameRate").getHz(),yt.setPropsTime=vt.get("setProps Time").time,yt.updateAttributesTime=vt.get("Update Attributes").time,yt.framesRedrawn=vt.get("Redraw Count").count,yt.pickTime=vt.get("pickObject Time").time+vt.get("pickMultipleObjects Time").time+vt.get("pickObjects Time").time,yt.pickCount=vt.get("Pick Count").count,yt.gpuTime=vt.get("GPU Time").time,yt.cpuTime=vt.get("CPU Time").time,yt.gpuTimePerFrame=vt.get("GPU Time").getAverageTime(),yt.cpuTimePerFrame=vt.get("CPU Time").getAverageTime();const bt=luma.stats.get("Memory Usage");yt.bufferMemory=bt.get("Buffer Memory").count,yt.textureMemory=bt.get("Texture Memory").count,yt.renderbufferMemory=bt.get("Renderbuffer Memory").count,yt.gpuMemory=bt.get("GPU Memory").count}}Deck.defaultProps=defaultProps$9;Deck.VERSION=VERSION;function typedArrayFromDataType(xt){switch(xt){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return getTypedArrayFromDataType(xt)}}const dataTypeFromTypedArray=getDataTypeFromTypedArray;function getBufferAttributeLayout(xt,yt,vt){const bt=vt==="webgpu"&&yt.type==="uint8"?"unorm8":yt.type;return{attribute:xt,format:yt.size>1?`${bt}x${yt.size}`:yt.type,byteOffset:yt.offset||0}}function getStride(xt){return xt.stride||xt.size*xt.bytesPerElement}function bufferLayoutEqual(xt,yt){return xt.type===yt.type&&xt.size===yt.size&&getStride(xt)===getStride(yt)&&(xt.offset||0)===(yt.offset||0)}function resolveShaderAttribute(xt,yt){yt.offset&&defaultLogger.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const vt=getStride(xt),bt=yt.vertexOffset!==void 0?yt.vertexOffset:xt.vertexOffset||0,Tt=yt.elementOffset||0,Et=bt*vt+Tt*xt.bytesPerElement+(xt.offset||0);return{...yt,offset:Et,stride:vt}}function resolveDoublePrecisionShaderAttributes(xt,yt){const vt=resolveShaderAttribute(xt,yt);return{high:vt,low:{...vt,offset:vt.offset+xt.size*4}}}class DataColumn{constructor(yt,vt,bt){this._buffer=null,this.device=yt,this.id=vt.id||"",this.size=vt.size||1;const Tt=vt.logicalType||vt.type,Et=Tt==="float64";let{defaultValue:wt}=vt;wt=Number.isFinite(wt)?[wt]:wt||new Array(this.size).fill(0);let St;Et?St="float32":!Tt&&vt.isIndexed?St="uint32":St=Tt||"float32";let At=typedArrayFromDataType(Tt||St);this.doublePrecision=Et,Et&&vt.fp64===!1&&(At=Float32Array),this.value=null,this.settings={...vt,defaultType:At,defaultValue:wt,logicalType:Tt,type:St,normalized:St.includes("norm"),size:this.size,bytesPerElement:At.BYTES_PER_ELEMENT},this.state={...bt,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const yt=this.getAccessor();return yt.vertexOffset?yt.vertexOffset*getStride(yt):0}get numInstances(){return this.state.numInstances}set numInstances(yt){this.state.numInstances=yt}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),defaultTypedArrayManager.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(yt=this.id,vt=null){const bt={};if(this.state.constant){const Tt=this.value;if(vt){const Et=resolveShaderAttribute(this.getAccessor(),vt),wt=Et.offset/Tt.BYTES_PER_ELEMENT,St=Et.size||this.size;bt[yt]=Tt.subarray(wt,wt+St)}else bt[yt]=Tt}else bt[yt]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?bt[`${yt}64Low`]=bt[yt]:bt[`${yt}64Low`]=new Float32Array(this.size)),bt}_getBufferLayout(yt=this.id,vt=null){const bt=this.getAccessor(),Tt=[],Et={name:this.id,byteStride:getStride(bt),attributes:Tt};if(this.doublePrecision){const wt=resolveDoublePrecisionShaderAttributes(bt,vt||{});Tt.push(getBufferAttributeLayout(yt,{...bt,...wt.high},this.device.type),getBufferAttributeLayout(`${yt}64Low`,{...bt,...wt.low},this.device.type))}else if(vt){const wt=resolveShaderAttribute(bt,vt);Tt.push(getBufferAttributeLayout(yt,{...bt,...wt},this.device.type))}else Tt.push(getBufferAttributeLayout(yt,bt,this.device.type));return Et}setAccessor(yt){this.state.bufferAccessor=yt}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let yt=null;if(this.state.constant&&this.value){const vt=Array.from(this.value);yt=[vt,vt]}else{const{value:vt,numInstances:bt,size:Tt}=this,Et=bt*Tt;if(vt&&Et&&vt.length>=Et){const wt=new Array(Tt).fill(1/0),St=new Array(Tt).fill(-1/0);for(let At=0;At<Et;)for(let Rt=0;Rt<Tt;Rt++){const Pt=vt[At++];Pt<wt[Rt]&&(wt[Rt]=Pt),Pt>St[Rt]&&(St[Rt]=Pt)}yt=[wt,St]}}return this.state.bounds=yt,yt}setData(yt){const{state:vt}=this;let bt;ArrayBuffer.isView(yt)?bt={value:yt}:yt instanceof Buffer?bt={buffer:yt}:bt=yt;const Tt={...this.settings,...bt};if(ArrayBuffer.isView(bt.value)){if(!bt.type)if(this.doublePrecision&&bt.value instanceof Float64Array)Tt.type="float32";else{const wt=dataTypeFromTypedArray(bt.value);Tt.type=Tt.normalized?wt.replace("int","norm"):wt}Tt.bytesPerElement=bt.value.BYTES_PER_ELEMENT,Tt.stride=getStride(Tt)}if(vt.bounds=null,bt.constant){let Et=bt.value;if(Et=this._normalizeValue(Et,[],0),this.settings.normalized&&(Et=this.normalizeConstant(Et)),!(!vt.constant||!this._areValuesEqual(Et,this.value)))return!1;vt.externalBuffer=null,vt.constant=!0,this.value=ArrayBuffer.isView(Et)?Et:new Float32Array(Et)}else if(bt.buffer){const Et=bt.buffer;vt.externalBuffer=Et,vt.constant=!1,this.value=bt.value||null}else if(bt.value){this._checkExternalBuffer(bt);let Et=bt.value;vt.externalBuffer=null,vt.constant=!1,this.value=Et;let{buffer:wt}=this;const St=getStride(Tt),At=(Tt.vertexOffset||0)*St;if(this.doublePrecision&&Et instanceof Float64Array&&(Et=toDoublePrecisionArray(Et,Tt)),this.settings.isIndexed){const Pt=this.settings.defaultType;Et.constructor!==Pt&&(Et=new Pt(Et))}const Rt=Et.byteLength+At+St*2;(!wt||wt.byteLength<Rt)&&(wt=this._createBuffer(Rt)),wt.write(Et,At)}return this.setAccessor(Tt),!0}updateSubBuffer(yt={}){this.state.bounds=null;const vt=this.value,{startOffset:bt=0,endOffset:Tt}=yt;this.buffer.write(this.doublePrecision&&vt instanceof Float64Array?toDoublePrecisionArray(vt,{size:this.size,startIndex:bt,endIndex:Tt}):vt.subarray(bt,Tt),bt*vt.BYTES_PER_ELEMENT+this.byteOffset)}allocate(yt,vt=!1){const{state:bt}=this,Tt=bt.allocatedValue,Et=defaultTypedArrayManager.allocate(Tt,yt+1,{size:this.size,type:this.settings.defaultType,copy:vt});this.value=Et;const{byteOffset:wt}=this;let{buffer:St}=this;return(!St||St.byteLength<Et.byteLength+wt)&&(St=this._createBuffer(Et.byteLength+wt),vt&&Tt&&St.write(Tt instanceof Float64Array?toDoublePrecisionArray(Tt,this):Tt,wt)),bt.allocatedValue=Et,bt.constant=!1,bt.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(yt){const{value:vt}=yt;if(!ArrayBuffer.isView(vt))throw new Error(`Attribute ${this.id} value is not TypedArray`);const bt=this.settings.defaultType;let Tt=!1;if(this.doublePrecision&&(Tt=vt.BYTES_PER_ELEMENT<4),Tt)throw new Error(`Attribute ${this.id} does not support ${vt.constructor.name}`);!(vt instanceof bt)&&this.settings.normalized&&!("normalized"in yt)&&defaultLogger.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(yt){switch(this.settings.type){case"snorm8":return new Float32Array(yt).map(vt=>(vt+128)/255*2-1);case"snorm16":return new Float32Array(yt).map(vt=>(vt+32768)/65535*2-1);case"unorm8":return new Float32Array(yt).map(vt=>vt/255);case"unorm16":return new Float32Array(yt).map(vt=>vt/65535);default:return yt}}_normalizeValue(yt,vt,bt){const{defaultValue:Tt,size:Et}=this.settings;if(Number.isFinite(yt))return vt[bt]=yt,vt;if(!yt){let wt=Et;for(;--wt>=0;)vt[bt+wt]=Tt[wt];return vt}switch(Et){case 4:vt[bt+3]=Number.isFinite(yt[3])?yt[3]:Tt[3];case 3:vt[bt+2]=Number.isFinite(yt[2])?yt[2]:Tt[2];case 2:vt[bt+1]=Number.isFinite(yt[1])?yt[1]:Tt[1];case 1:vt[bt+0]=Number.isFinite(yt[0])?yt[0]:Tt[0];break;default:let wt=Et;for(;--wt>=0;)vt[bt+wt]=Number.isFinite(yt[wt])?yt[wt]:Tt[wt]}return vt}_areValuesEqual(yt,vt){if(!yt||!vt)return!1;const{size:bt}=this;for(let Tt=0;Tt<bt;Tt++)if(yt[Tt]!==vt[Tt])return!1;return!0}_createBuffer(yt){var Tt;this._buffer&&this._buffer.destroy();const{isIndexed:vt,type:bt}=this.settings;return this._buffer=this.device.createBuffer({...(Tt=this._buffer)==null?void 0:Tt.props,id:this.id,usage:(vt?Buffer.INDEX:Buffer.VERTEX)|Buffer.COPY_DST,indexType:vt?bt:void 0,byteLength:yt}),this._buffer}}const EMPTY_ARRAY$2=[],placeholderArray=[];function createIterable(xt,yt=0,vt=1/0){let bt=EMPTY_ARRAY$2;const Tt={index:-1,data:xt,target:[]};return xt?typeof xt[Symbol.iterator]=="function"?bt=xt:xt.length>0&&(placeholderArray.length=xt.length,bt=placeholderArray):bt=EMPTY_ARRAY$2,(yt>0||Number.isFinite(vt))&&(bt=(Array.isArray(bt)?bt:Array.from(bt)).slice(yt,vt),Tt.index=yt-1),{iterable:bt,objectInfo:Tt}}function isAsyncIterable(xt){return xt&&xt[Symbol.asyncIterator]}function getAccessorFromBuffer(xt,yt){const{size:vt,stride:bt,offset:Tt,startIndices:Et,nested:wt}=yt,St=xt.BYTES_PER_ELEMENT,At=bt?bt/St:vt,Rt=Tt?Tt/St:0,Pt=Math.floor((xt.length-Rt)/At);return(Ct,{index:It,target:Mt})=>{if(!Et){const Nt=It*At+Rt;for(let Lt=0;Lt<vt;Lt++)Mt[Lt]=xt[Nt+Lt];return Mt}const Ot=Et[It],kt=Et[It+1]||Pt;let Ft;if(wt){Ft=new Array(kt-Ot);for(let Nt=Ot;Nt<kt;Nt++){const Lt=Nt*At+Rt;Mt=new Array(vt);for(let Dt=0;Dt<vt;Dt++)Mt[Dt]=xt[Lt+Dt];Ft[Nt-Ot]=Mt}}else if(At===vt)Ft=xt.subarray(Ot*vt+Rt,kt*vt+Rt);else{Ft=new xt.constructor((kt-Ot)*vt);let Nt=0;for(let Lt=Ot;Lt<kt;Lt++){const Dt=Lt*At+Rt;for(let $t=0;$t<vt;$t++)Ft[Nt++]=xt[Dt+$t]}}return Ft}}const EMPTY=[],FULL=[[0,1/0]];function add(xt,yt){if(xt===FULL||(yt[0]<0&&(yt[0]=0),yt[0]>=yt[1]))return xt;const vt=[],bt=xt.length;let Tt=0;for(let Et=0;Et<bt;Et++){const wt=xt[Et];wt[1]<yt[0]?(vt.push(wt),Tt=Et+1):wt[0]>yt[1]?vt.push(wt):yt=[Math.min(wt[0],yt[0]),Math.max(wt[1],yt[1])]}return vt.splice(Tt,0,yt),vt}const DEFAULT_TRANSITION_SETTINGS={interpolation:{duration:0,easing:xt=>xt},spring:{stiffness:.05,damping:.5}};function normalizeTransitionSettings(xt,yt){if(!xt)return null;Number.isFinite(xt)&&(xt={type:"interpolation",duration:xt});const vt=xt.type||"interpolation";return{...DEFAULT_TRANSITION_SETTINGS[vt],...yt,...xt,type:vt}}class Attribute extends DataColumn{constructor(yt,vt){super(yt,vt,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:FULL}),this.constant=!1,this.settings.update=vt.update||(vt.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(yt){this.state.startIndices=yt}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:yt=!1}={}){const vt=this.state.needsRedraw;return this.state.needsRedraw=vt&&!yt,vt}layoutChanged(){return this.state.layoutChanged}setAccessor(yt){var vt;(vt=this.state).layoutChanged||(vt.layoutChanged=!bufferLayoutEqual(yt,this.getAccessor())),super.setAccessor(yt)}getUpdateTriggers(){const{accessor:yt}=this.settings;return[this.id].concat(typeof yt!="function"&&yt||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(yt){if(!yt||!this.supportsTransition())return null;const{accessor:vt}=this.settings,bt=this.settings.transition,Tt=Array.isArray(vt)?yt[vt.find(Et=>yt[Et])]:yt[vt];return normalizeTransitionSettings(Tt,bt)}setNeedsUpdate(yt=this.id,vt){if(this.state.needsUpdate=this.state.needsUpdate||yt,this.setNeedsRedraw(yt),vt){const{startRow:bt=0,endRow:Tt=1/0}=vt;this.state.updateRanges=add(this.state.updateRanges,[bt,Tt])}else this.state.updateRanges=FULL}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=EMPTY}setNeedsRedraw(yt=this.id){this.state.needsRedraw=this.state.needsRedraw||yt}allocate(yt){const{state:vt,settings:bt}=this;return bt.noAlloc?!1:bt.update?(super.allocate(yt,vt.updateRanges!==FULL),!0):!1}updateBuffer({numInstances:yt,data:vt,props:bt,context:Tt}){if(!this.needsUpdate())return!1;const{state:{updateRanges:Et},settings:{update:wt,noAlloc:St}}=this;let At=!0;if(wt){for(const[Rt,Pt]of Et)wt.call(Tt,this,{data:vt,startRow:Rt,endRow:Pt,props:bt,numInstances:yt});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[Rt,Pt]of Et){const Ct=Number.isFinite(Rt)?this.getVertexOffset(Rt):0,It=Number.isFinite(Pt)?this.getVertexOffset(Pt):St||!Number.isFinite(yt)?this.value.length:yt*this.size;super.updateSubBuffer({startOffset:Ct,endOffset:It})}this._checkAttributeArray()}else At=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),At}setConstantValue(yt){return this.device.type==="webgpu"||yt===void 0||typeof yt=="function"?!1:(this.setData({constant:!0,value:yt})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(yt){const{state:vt}=this;return yt?(this.clearNeedsUpdate(),vt.lastExternalBuffer===yt||(vt.lastExternalBuffer=yt,this.setNeedsRedraw(),this.setData(yt)),!0):(vt.lastExternalBuffer=null,!1)}setBinaryValue(yt,vt=null){const{state:bt,settings:Tt}=this;if(!yt)return bt.binaryValue=null,bt.binaryAccessor=null,!1;if(Tt.noAlloc)return!1;if(bt.binaryValue===yt)return this.clearNeedsUpdate(),!0;if(bt.binaryValue=yt,this.setNeedsRedraw(),Tt.transform||vt!==this.startIndices){ArrayBuffer.isView(yt)&&(yt={value:yt});const wt=yt;assert(ArrayBuffer.isView(wt.value),`invalid ${Tt.accessor}`);const St=!!wt.size&&wt.size!==this.size;return bt.binaryAccessor=getAccessorFromBuffer(wt.value,{size:wt.size||this.size,stride:wt.stride,offset:wt.offset,startIndices:vt,nested:St}),!1}return this.clearNeedsUpdate(),this.setData(yt),!0}getVertexOffset(yt){const{startIndices:vt}=this;return(vt?yt<vt.length?vt[yt]:this.numInstances:yt)*this.size}getValue(){const yt=this.settings.shaderAttributes,vt=super.getValue();if(!yt)return vt;for(const bt in yt)Object.assign(vt,super.getValue(bt,yt[bt]));return vt}getBufferLayout(yt){this.state.layoutChanged=!1;const vt=this.settings.shaderAttributes,bt=super._getBufferLayout(),{stepMode:Tt}=this.settings;if(Tt==="dynamic"?bt.stepMode=yt?yt.isInstanced?"instance":"vertex":"instance":bt.stepMode=Tt??"vertex",!vt)return bt;for(const Et in vt){const wt=super._getBufferLayout(Et,vt[Et]);bt.attributes.push(...wt.attributes)}return bt}_autoUpdater(yt,{data:vt,startRow:bt,endRow:Tt,props:Et,numInstances:wt}){if(yt.constant&&this.context.device.type!=="webgpu")return;const{settings:St,state:At,value:Rt,size:Pt,startIndices:Ct}=yt,{accessor:It,transform:Mt}=St;let Ot=At.binaryAccessor||(typeof It=="function"?It:Et[It]);typeof Ot!="function"&&(Ot=()=>Ot),assert(typeof Ot=="function",`accessor "${It}" is not a function`);let kt=yt.getVertexOffset(bt);const{iterable:Ft,objectInfo:Nt}=createIterable(vt,bt,Tt);for(const Lt of Ft){Nt.index++;let Dt=Ot(Lt,Nt);if(Mt&&(Dt=Mt.call(this,Dt)),Ct){const $t=(Nt.index<Ct.length-1?Ct[Nt.index+1]:wt)-Ct[Nt.index];if(Dt&&Array.isArray(Dt[0])){let zt=kt;for(const Ut of Dt)yt._normalizeValue(Ut,Rt,zt),zt+=Pt}else Dt&&Dt.length>Pt?Rt.set(Dt,kt):(yt._normalizeValue(Dt,Nt.target,0),fillArray$1({target:Rt,source:Nt.target,start:kt,count:$t}));kt+=$t*Pt}else yt._normalizeValue(Dt,Rt,kt),kt+=Pt}}_validateAttributeUpdaters(){const{settings:yt}=this;if(!(yt.noAlloc||typeof yt.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:yt}=this,vt=Math.min(4,this.size);if(yt&&yt.length>=vt){let bt=!0;switch(vt){case 4:bt=bt&&Number.isFinite(yt[3]);case 3:bt=bt&&Number.isFinite(yt[2]);case 2:bt=bt&&Number.isFinite(yt[1]);case 1:bt=bt&&Number.isFinite(yt[0]);break;default:bt=!1}if(!bt)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function padArrayChunk(xt){const{source:yt,target:vt,start:bt=0,size:Tt,getData:Et}=xt,wt=xt.end||vt.length,St=yt.length,At=wt-bt;if(St>At){vt.set(yt.subarray(0,At),bt);return}if(vt.set(yt,bt),!Et)return;let Rt=St;for(;Rt<At;){const Pt=Et(Rt,yt);for(let Ct=0;Ct<Tt;Ct++)vt[bt+Rt]=Pt[Ct]||0,Rt++}}function padArray({source:xt,target:yt,size:vt,getData:bt,sourceStartIndices:Tt,targetStartIndices:Et}){if(!Tt||!Et)return padArrayChunk({source:xt,target:yt,size:vt,getData:bt}),yt;let wt=0,St=0;const At=bt&&((Pt,Ct)=>bt(Pt+St,Ct)),Rt=Math.min(Tt.length,Et.length);for(let Pt=1;Pt<Rt;Pt++){const Ct=Tt[Pt]*vt,It=Et[Pt]*vt;padArrayChunk({source:xt.subarray(wt,Ct),target:yt,start:St,end:It,size:vt,getData:At}),wt=Ct,St=It}return St<yt.length&&padArrayChunk({source:[],target:yt,start:St,size:vt,getData:At}),yt}function cloneAttribute(xt){const{device:yt,settings:vt,value:bt}=xt,Tt=new Attribute(yt,vt);return Tt.setData({value:bt instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:vt.normalized}),Tt}function getAttributeTypeFromSize(xt){switch(xt){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${xt}"`)}}function getFloat32VertexFormat(xt){switch(xt){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function cycleBuffers(xt){xt.push(xt.shift())}function getAttributeBufferLength(xt,yt){const{doublePrecision:vt,settings:bt,value:Tt,size:Et}=xt,wt=vt&&Tt instanceof Float64Array?2:1;let St=0;const{shaderAttributes:At}=xt.settings;if(At)for(const Rt of Object.values(At))St=Math.max(St,Rt.vertexOffset??0);return(bt.noAlloc?Tt.length:(yt+St)*Et)*wt}function matchBuffer({device:xt,source:yt,target:vt}){return(!vt||vt.byteLength<yt.byteLength)&&(vt==null||vt.destroy(),vt=xt.createBuffer({byteLength:yt.byteLength,usage:yt.usage})),vt}function padBuffer({device:xt,buffer:yt,attribute:vt,fromLength:bt,toLength:Tt,fromStartIndices:Et,getData:wt=St=>St}){const St=vt.doublePrecision&&vt.value instanceof Float64Array?2:1,At=vt.size*St,Rt=vt.byteOffset,Pt=vt.settings.bytesPerElement<4?Rt/vt.settings.bytesPerElement*4:Rt,Ct=vt.startIndices,It=Et&&Ct,Mt=vt.isConstant;if(!It&&yt&&bt>=Tt)return yt;const Ot=vt.value instanceof Float64Array?Float32Array:vt.value.constructor,kt=Mt?vt.value:new Ot(vt.getBuffer().readSyncWebGL(Rt,Tt*Ot.BYTES_PER_ELEMENT).buffer);if(vt.settings.normalized&&!Mt){const Dt=wt;wt=($t,zt)=>vt.normalizeConstant(Dt($t,zt))}const Ft=Mt?(Dt,$t)=>wt(kt,$t):(Dt,$t)=>wt(kt.subarray(Dt+Rt,Dt+Rt+At),$t),Nt=yt?new Float32Array(yt.readSyncWebGL(Pt,bt*4).buffer):new Float32Array(0),Lt=new Float32Array(Tt);return padArray({source:Nt,target:Lt,sourceStartIndices:Et,targetStartIndices:Ct,size:At,getData:Ft}),(!yt||yt.byteLength<Lt.byteLength+Pt)&&(yt==null||yt.destroy(),yt=xt.createBuffer({byteLength:Lt.byteLength+Pt,usage:35050})),yt.write(Lt,Pt),yt}class GPUTransitionBase{constructor({device:yt,attribute:vt,timeline:bt}){this.buffers=[],this.currentLength=0,this.device=yt,this.transition=new Transition(bt),this.attribute=vt,this.attributeInTransition=cloneAttribute(vt),this.currentStartIndices=vt.startIndices}get inProgress(){return this.transition.inProgress}start(yt,vt,bt=1/0){this.settings=yt,this.currentStartIndices=this.attribute.startIndices,this.currentLength=getAttributeBufferLength(this.attribute,vt),this.transition.start({...yt,duration:bt})}update(){const yt=this.transition.update();return yt&&this.onUpdate(),yt}setBuffer(yt){this.attributeInTransition.setData({buffer:yt,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const yt of this.buffers)yt.destroy();this.buffers.length=0}}class GPUInterpolationTransition extends GPUTransitionBase{constructor({device:yt,attribute:vt,timeline:bt}){super({device:yt,attribute:vt,timeline:bt}),this.type="interpolation",this.transform=getTransform$1(yt,vt)}start(yt,vt){const bt=this.currentLength,Tt=this.currentStartIndices;if(super.start(yt,vt,yt.duration),yt.duration<=0){this.transition.cancel();return}const{buffers:Et,attribute:wt}=this;cycleBuffers(Et),Et[0]=padBuffer({device:this.device,buffer:Et[0],attribute:wt,fromLength:bt,toLength:this.currentLength,fromStartIndices:Tt,getData:yt.enter}),Et[1]=matchBuffer({device:this.device,source:Et[0],target:Et[1]}),this.setBuffer(Et[1]);const{transform:St}=this,At=St.model;let Rt=Math.floor(this.currentLength/wt.size);useFp64(wt)&&(Rt/=2),At.setVertexCount(Rt),wt.isConstant?(At.setAttributes({aFrom:Et[0]}),At.setConstantAttributes({aTo:wt.value})):At.setAttributes({aFrom:Et[0],aTo:wt.getBuffer()}),St.transformFeedback.setBuffers({vCurrent:Et[1]})}onUpdate(){const{duration:yt,easing:vt}=this.settings,{time:bt}=this.transition;let Tt=bt/yt;vt&&(Tt=vt(Tt));const{model:Et}=this.transform,wt={time:Tt};Et.shaderInputs.setProps({interpolation:wt}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const uniformBlock$6=`uniform interpolationUniforms {
  float time;
} interpolation;
`,interpolationUniforms={name:"interpolation",vs:uniformBlock$6,uniformTypes:{time:"f32"}},vs$5=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,vs64=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function useFp64(xt){return xt.doublePrecision&&xt.value instanceof Float64Array}function getTransform$1(xt,yt){const vt=yt.size,bt=getAttributeTypeFromSize(vt),Tt=getFloat32VertexFormat(vt),Et=yt.getBufferLayout();return useFp64(yt)?new BufferTransform(xt,{vs:vs64,bufferLayout:[{name:"aFrom",byteStride:8*vt,attributes:[{attribute:"aFrom",format:Tt,byteOffset:0},{attribute:"aFrom64Low",format:Tt,byteOffset:4*vt}]},{name:"aTo",byteStride:8*vt,attributes:[{attribute:"aTo",format:Tt,byteOffset:0},{attribute:"aTo64Low",format:Tt,byteOffset:4*vt}]}],modules:[fp64arithmetic,interpolationUniforms],defines:{ATTRIBUTE_TYPE:bt,ATTRIBUTE_SIZE:vt},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new BufferTransform(xt,{vs:vs$5,bufferLayout:[{name:"aFrom",format:Tt},{name:"aTo",format:Et.attributes[0].format}],modules:[interpolationUniforms],defines:{ATTRIBUTE_TYPE:bt},varyings:["vCurrent"],disableWarnings:!0})}class GPUSpringTransition extends GPUTransitionBase{constructor({device:yt,attribute:vt,timeline:bt}){super({device:yt,attribute:vt,timeline:bt}),this.type="spring",this.texture=getTexture(yt),this.framebuffer=getFramebuffer(yt,this.texture),this.transform=getTransform(yt,vt)}start(yt,vt){const bt=this.currentLength,Tt=this.currentStartIndices;super.start(yt,vt);const{buffers:Et,attribute:wt}=this;for(let At=0;At<2;At++)Et[At]=padBuffer({device:this.device,buffer:Et[At],attribute:wt,fromLength:bt,toLength:this.currentLength,fromStartIndices:Tt,getData:yt.enter});Et[2]=matchBuffer({device:this.device,source:Et[0],target:Et[2]}),this.setBuffer(Et[1]);const{model:St}=this.transform;St.setVertexCount(Math.floor(this.currentLength/wt.size)),wt.isConstant?St.setConstantAttributes({aTo:wt.value}):St.setAttributes({aTo:wt.getBuffer()})}onUpdate(){const{buffers:yt,transform:vt,framebuffer:bt,transition:Tt}=this,Et=this.settings;vt.model.setAttributes({aPrev:yt[0],aCur:yt[1]}),vt.transformFeedback.setBuffers({vNext:yt[2]});const wt={stiffness:Et.stiffness,damping:Et.damping};vt.model.shaderInputs.setProps({spring:wt}),vt.run({framebuffer:bt,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),cycleBuffers(yt),this.setBuffer(yt[1]),this.device.readPixelsToArrayWebGL(bt)[0]>0||Tt.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const uniformBlock$5=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,springUniforms={name:"spring",vs:uniformBlock$5,uniformTypes:{damping:"f32",stiffness:"f32"}},vs$4=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs$6=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function getTransform(xt,yt){const vt=getAttributeTypeFromSize(yt.size),bt=getFloat32VertexFormat(yt.size);return new BufferTransform(xt,{vs:vs$4,fs:fs$6,bufferLayout:[{name:"aPrev",format:bt},{name:"aCur",format:bt},{name:"aTo",format:yt.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[springUniforms],defines:{ATTRIBUTE_TYPE:vt},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function getTexture(xt){return xt.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function getFramebuffer(xt,yt){return xt.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[yt]})}const TRANSITION_TYPES$1={interpolation:GPUInterpolationTransition,spring:GPUSpringTransition};class AttributeTransitionManager{constructor(yt,{id:vt,timeline:bt}){if(!yt)throw new Error("AttributeTransitionManager is constructed without device");this.id=vt,this.device=yt,this.timeline=bt,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const yt in this.transitions)this._removeTransition(yt)}update({attributes:yt,transitions:vt,numInstances:bt}){this.numInstances=bt||1;for(const Tt in yt){const Et=yt[Tt],wt=Et.getTransitionSetting(vt);wt&&this._updateAttribute(Tt,Et,wt)}for(const Tt in this.transitions){const Et=yt[Tt];(!Et||!Et.getTransitionSetting(vt))&&this._removeTransition(Tt)}}hasAttribute(yt){const vt=this.transitions[yt];return vt&&vt.inProgress}getAttributes(){const yt={};for(const vt in this.transitions){const bt=this.transitions[vt];bt.inProgress&&(yt[vt]=bt.attributeInTransition)}return yt}run(){if(this.numInstances===0)return!1;for(const vt in this.transitions)this.transitions[vt].update()&&(this.needsRedraw=!0);const yt=this.needsRedraw;return this.needsRedraw=!1,yt}_removeTransition(yt){this.transitions[yt].delete(),delete this.transitions[yt]}_updateAttribute(yt,vt,bt){const Tt=this.transitions[yt];let Et=!Tt||Tt.type!==bt.type;if(Et){Tt&&this._removeTransition(yt);const wt=TRANSITION_TYPES$1[bt.type];wt?this.transitions[yt]=new wt({attribute:vt,timeline:this.timeline,device:this.device}):(defaultLogger.error(`unsupported transition type '${bt.type}'`)(),Et=!1)}(Et||vt.needsRedraw())&&(this.needsRedraw=!0,this.transitions[yt].start(bt,this.numInstances))}}const TRACE_INVALIDATE="attributeManager.invalidate",TRACE_UPDATE_START="attributeManager.updateStart",TRACE_UPDATE_END="attributeManager.updateEnd",TRACE_ATTRIBUTE_UPDATE_START="attribute.updateStart",TRACE_ATTRIBUTE_ALLOCATE="attribute.allocate",TRACE_ATTRIBUTE_UPDATE_END="attribute.updateEnd";class AttributeManager{constructor(yt,{id:vt="attribute-manager",stats:bt,timeline:Tt}={}){this.mergeBoundsMemoized=memoize(mergeBounds),this.id=vt,this.device=yt,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=bt,this.attributeTransitionManager=new AttributeTransitionManager(yt,{id:`${vt}-transitions`,timeline:Tt}),Object.seal(this)}finalize(){for(const yt in this.attributes)this.attributes[yt].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(yt={clearRedrawFlags:!1}){const vt=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!yt.clearRedrawFlags,vt&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(yt){this._add(yt)}addInstanced(yt){this._add(yt,{stepMode:"instance"})}remove(yt){for(const vt of yt)this.attributes[vt]!==void 0&&(this.attributes[vt].delete(),delete this.attributes[vt])}invalidate(yt,vt){const bt=this._invalidateTrigger(yt,vt);debug(TRACE_INVALIDATE,this,yt,bt)}invalidateAll(yt){for(const vt in this.attributes)this.attributes[vt].setNeedsUpdate(vt,yt);debug(TRACE_INVALIDATE,this,"all")}update({data:yt,numInstances:vt,startIndices:bt=null,transitions:Tt,props:Et={},buffers:wt={},context:St={}}){let At=!1;debug(TRACE_UPDATE_START,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const Rt in this.attributes){const Pt=this.attributes[Rt],Ct=Pt.settings.accessor;Pt.startIndices=bt,Pt.numInstances=vt,Et[Rt]&&defaultLogger.removed(`props.${Rt}`,`data.attributes.${Rt}`)(),Pt.setExternalBuffer(wt[Rt])||Pt.setBinaryValue(typeof Ct=="string"?wt[Ct]:void 0,yt.startIndices)||typeof Ct=="string"&&!wt[Ct]&&Pt.setConstantValue(Et[Ct])||Pt.needsUpdate()&&(At=!0,this._updateAttribute({attribute:Pt,numInstances:vt,data:yt,props:Et,context:St})),this.needsRedraw=this.needsRedraw||Pt.needsRedraw()}At&&debug(TRACE_UPDATE_END,this,vt),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:vt,transitions:Tt})}updateTransition(){const{attributeTransitionManager:yt}=this,vt=yt.run();return this.needsRedraw=this.needsRedraw||vt,vt}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(yt){const vt=yt.map(bt=>{var Tt;return(Tt=this.attributes[bt])==null?void 0:Tt.getBounds()});return this.mergeBoundsMemoized(vt)}getChangedAttributes(yt={clearChangedFlags:!1}){const{attributes:vt,attributeTransitionManager:bt}=this,Tt={...bt.getAttributes()};for(const Et in vt){const wt=vt[Et];wt.needsRedraw(yt)&&!bt.hasAttribute(Et)&&(Tt[Et]=wt)}return Tt}getBufferLayouts(yt){return Object.values(this.getAttributes()).map(vt=>vt.getBufferLayout(yt))}_add(yt,vt){for(const bt in yt){const Tt=yt[bt],Et={...Tt,id:bt,size:Tt.isIndexed&&1||Tt.size||1,...vt};this.attributes[bt]=new Attribute(this.device,Et)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const yt={};for(const vt in this.attributes)this.attributes[vt].getUpdateTriggers().forEach(Tt=>{yt[Tt]||(yt[Tt]=[]),yt[Tt].push(vt)});this.updateTriggers=yt}_invalidateTrigger(yt,vt){const{attributes:bt,updateTriggers:Tt}=this,Et=Tt[yt];return Et&&Et.forEach(wt=>{const St=bt[wt];St&&St.setNeedsUpdate(St.id,vt)}),Et}_updateAttribute(yt){const{attribute:vt,numInstances:bt}=yt;if(debug(TRACE_ATTRIBUTE_UPDATE_START,vt),vt.constant){vt.setConstantValue(vt.value);return}vt.allocate(bt)&&debug(TRACE_ATTRIBUTE_ALLOCATE,vt,bt),vt.updateBuffer(yt)&&(this.needsRedraw=!0,debug(TRACE_ATTRIBUTE_UPDATE_END,vt,bt))}}class CPUInterpolationTransition extends Transition{get value(){return this._value}_onUpdate(){const{time:yt,settings:{fromValue:vt,toValue:bt,duration:Tt,easing:Et}}=this,wt=Et(yt/Tt);this._value=lerp$1(vt,bt,wt)}}const EPSILON=1e-5;function updateSpringElement(xt,yt,vt,bt,Tt){const Et=yt-xt,St=(vt-yt)*Tt,At=-Et*bt;return St+At+Et+yt}function updateSpring(xt,yt,vt,bt,Tt){if(Array.isArray(vt)){const Et=[];for(let wt=0;wt<vt.length;wt++)Et[wt]=updateSpringElement(xt[wt],yt[wt],vt[wt],bt,Tt);return Et}return updateSpringElement(xt,yt,vt,bt,Tt)}function distance(xt,yt){if(Array.isArray(xt)){let vt=0;for(let bt=0;bt<xt.length;bt++){const Tt=xt[bt]-yt[bt];vt+=Tt*Tt}return Math.sqrt(vt)}return Math.abs(xt-yt)}class CPUSpringTransition extends Transition{get value(){return this._currValue}_onUpdate(){const{fromValue:yt,toValue:vt,damping:bt,stiffness:Tt}=this.settings,{_prevValue:Et=yt,_currValue:wt=yt}=this;let St=updateSpring(Et,wt,vt,bt,Tt);const At=distance(St,vt),Rt=distance(St,wt);At<EPSILON&&Rt<EPSILON&&(St=vt,this.end()),this._prevValue=wt,this._currValue=St}}const TRANSITION_TYPES={interpolation:CPUInterpolationTransition,spring:CPUSpringTransition};class UniformTransitionManager{constructor(yt){this.transitions=new Map,this.timeline=yt}get active(){return this.transitions.size>0}add(yt,vt,bt,Tt){const{transitions:Et}=this;if(Et.has(yt)){const At=Et.get(yt),{value:Rt=At.settings.fromValue}=At;vt=Rt,this.remove(yt)}if(Tt=normalizeTransitionSettings(Tt),!Tt)return;const wt=TRANSITION_TYPES[Tt.type];if(!wt){defaultLogger.error(`unsupported transition type '${Tt.type}'`)();return}const St=new wt(this.timeline);St.start({...Tt,fromValue:vt,toValue:bt}),Et.set(yt,St)}remove(yt){const{transitions:vt}=this;vt.has(yt)&&(vt.get(yt).cancel(),vt.delete(yt))}update(){const yt={};for(const[vt,bt]of this.transitions)bt.update(),yt[vt]=bt.value,bt.inProgress||this.remove(vt);return yt}clear(){for(const yt of this.transitions.keys())this.remove(yt)}}function validateProps(xt){const yt=xt[PROP_TYPES_SYMBOL];for(const vt in yt){const bt=yt[vt],{validate:Tt}=bt;if(Tt&&!Tt(xt[vt],bt))throw new Error(`Invalid prop ${vt}: ${xt[vt]}`)}}function diffProps(xt,yt){const vt=compareProps({newProps:xt,oldProps:yt,propTypes:xt[PROP_TYPES_SYMBOL],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),bt=diffDataProps(xt,yt);let Tt=!1;return bt||(Tt=diffUpdateTriggers(xt,yt)),{dataChanged:bt,propsChanged:vt,updateTriggersChanged:Tt,extensionsChanged:diffExtensions(xt,yt),transitionsChanged:diffTransitions(xt,yt)}}function diffTransitions(xt,yt){if(!xt.transitions)return!1;const vt={},bt=xt[PROP_TYPES_SYMBOL];let Tt=!1;for(const Et in xt.transitions){const wt=bt[Et],St=wt&&wt.type;(St==="number"||St==="color"||St==="array")&&comparePropValues(xt[Et],yt[Et],wt)&&(vt[Et]=!0,Tt=!0)}return Tt?vt:!1}function compareProps({newProps:xt,oldProps:yt,ignoreProps:vt={},propTypes:bt={},triggerName:Tt="props"}){if(yt===xt)return!1;if(typeof xt!="object"||xt===null)return`${Tt} changed shallowly`;if(typeof yt!="object"||yt===null)return`${Tt} changed shallowly`;for(const Et of Object.keys(xt))if(!(Et in vt)){if(!(Et in yt))return`${Tt}.${Et} added`;const wt=comparePropValues(xt[Et],yt[Et],bt[Et]);if(wt)return`${Tt}.${Et} ${wt}`}for(const Et of Object.keys(yt))if(!(Et in vt)){if(!(Et in xt))return`${Tt}.${Et} dropped`;if(!Object.hasOwnProperty.call(xt,Et)){const wt=comparePropValues(xt[Et],yt[Et],bt[Et]);if(wt)return`${Tt}.${Et} ${wt}`}}return!1}function comparePropValues(xt,yt,vt){let bt=vt&&vt.equal;return bt&&!bt(xt,yt,vt)||!bt&&(bt=xt&&yt&&xt.equals,bt&&!bt.call(xt,yt))?"changed deeply":!bt&&yt!==xt?"changed shallowly":null}function diffDataProps(xt,yt){if(yt===null)return"oldProps is null, initial diff";let vt=!1;const{dataComparator:bt,_dataDiff:Tt}=xt;return bt?bt(xt.data,yt.data)||(vt="Data comparator detected a change"):xt.data!==yt.data&&(vt="A new data container was supplied"),vt&&Tt&&(vt=Tt(xt.data,yt.data)||vt),vt}function diffUpdateTriggers(xt,yt){if(yt===null)return{all:!0};if("all"in xt.updateTriggers&&diffUpdateTrigger(xt,yt,"all"))return{all:!0};const vt={};let bt=!1;for(const Tt in xt.updateTriggers)Tt!=="all"&&diffUpdateTrigger(xt,yt,Tt)&&(vt[Tt]=!0,bt=!0);return bt?vt:!1}function diffExtensions(xt,yt){if(yt===null)return!0;const vt=yt.extensions,{extensions:bt}=xt;if(bt===vt)return!1;if(!vt||!bt||bt.length!==vt.length)return!0;for(let Tt=0;Tt<bt.length;Tt++)if(!bt[Tt].equals(vt[Tt]))return!0;return!1}function diffUpdateTrigger(xt,yt,vt){let bt=xt.updateTriggers[vt];bt=bt??{};let Tt=yt.updateTriggers[vt];return Tt=Tt??{},compareProps({oldProps:Tt,newProps:bt,triggerName:vt})}const ERR_NOT_OBJECT="count(): argument not an object",ERR_NOT_CONTAINER="count(): argument not a container";function count(xt){if(!isObject(xt))throw new Error(ERR_NOT_OBJECT);if(typeof xt.count=="function")return xt.count();if(Number.isFinite(xt.size))return xt.size;if(Number.isFinite(xt.length))return xt.length;if(isPlainObject(xt))return Object.keys(xt).length;throw new Error(ERR_NOT_CONTAINER)}function isPlainObject(xt){return xt!==null&&typeof xt=="object"&&xt.constructor===Object}function isObject(xt){return xt!==null&&typeof xt=="object"}function mergeShaders(xt,yt){if(!yt)return xt;const vt={...xt,...yt};if("defines"in yt&&(vt.defines={...xt.defines,...yt.defines}),"modules"in yt&&(vt.modules=(xt.modules||[]).concat(yt.modules),yt.modules.some(bt=>bt.name==="project64"))){const bt=vt.modules.findIndex(Tt=>Tt.name==="project32");bt>=0&&vt.modules.splice(bt,1)}if("inject"in yt)if(!xt.inject)vt.inject=yt.inject;else{const bt={...xt.inject};for(const Tt in yt.inject)bt[Tt]=(bt[Tt]||"")+yt.inject[Tt];vt.inject=bt}return vt}const DEFAULT_TEXTURE_PARAMETERS={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},internalTextures={};function createTexture(xt,yt,vt,bt){if(vt instanceof Texture)return vt;vt.constructor&&vt.constructor.name!=="Object"&&(vt={data:vt});let Tt=null;vt.compressed&&(Tt={minFilter:"linear",mipmapFilter:vt.data.length>1?"nearest":"linear"});const Et=yt.createTexture({...vt,sampler:{...DEFAULT_TEXTURE_PARAMETERS,...Tt,...bt},mipmaps:!0});return internalTextures[Et.id]=xt,Et}function destroyTexture(xt,yt){!yt||!(yt instanceof Texture)||internalTextures[yt.id]===xt&&(yt.delete(),delete internalTextures[yt.id])}const TYPE_DEFINITIONS={boolean:{validate(xt,yt){return!0},equal(xt,yt,vt){return!!xt==!!yt}},number:{validate(xt,yt){return Number.isFinite(xt)&&(!("max"in yt)||xt<=yt.max)&&(!("min"in yt)||xt>=yt.min)}},color:{validate(xt,yt){return yt.optional&&!xt||isArray(xt)&&(xt.length===3||xt.length===4)},equal(xt,yt,vt){return deepEqual(xt,yt,1)}},accessor:{validate(xt,yt){const vt=getTypeOf(xt);return vt==="function"||vt===getTypeOf(yt.value)},equal(xt,yt,vt){return typeof yt=="function"?!0:deepEqual(xt,yt,1)}},array:{validate(xt,yt){return yt.optional&&!xt||isArray(xt)},equal(xt,yt,vt){const{compare:bt}=vt,Tt=Number.isInteger(bt)?bt:bt?1:0;return bt?deepEqual(xt,yt,Tt):xt===yt}},object:{equal(xt,yt,vt){if(vt.ignore)return!0;const{compare:bt}=vt,Tt=Number.isInteger(bt)?bt:bt?1:0;return bt?deepEqual(xt,yt,Tt):xt===yt}},function:{validate(xt,yt){return yt.optional&&!xt||typeof xt=="function"},equal(xt,yt,vt){return!vt.compare&&vt.ignore!==!1||xt===yt}},data:{transform:(xt,yt,vt)=>{if(!xt)return xt;const{dataTransform:bt}=vt.props;return bt?bt(xt):typeof xt.shape=="string"&&xt.shape.endsWith("-table")&&Array.isArray(xt.data)?xt.data:xt}},image:{transform:(xt,yt,vt)=>{const bt=vt.context;return!bt||!bt.device?null:createTexture(vt.id,bt.device,xt,{...yt.parameters,...vt.props.textureParameters})},release:(xt,yt,vt)=>{destroyTexture(vt.id,xt)}}};function parsePropTypes(xt){const yt={},vt={},bt={};for(const[Tt,Et]of Object.entries(xt)){const wt=Et==null?void 0:Et.deprecatedFor;if(wt)bt[Tt]=Array.isArray(wt)?wt:[wt];else{const St=parsePropType(Tt,Et);yt[Tt]=St,vt[Tt]=St.value}}return{propTypes:yt,defaultProps:vt,deprecatedProps:bt}}function parsePropType(xt,yt){switch(getTypeOf(yt)){case"object":return normalizePropDefinition(xt,yt);case"array":return normalizePropDefinition(xt,{type:"array",value:yt,compare:!1});case"boolean":return normalizePropDefinition(xt,{type:"boolean",value:yt});case"number":return normalizePropDefinition(xt,{type:"number",value:yt});case"function":return normalizePropDefinition(xt,{type:"function",value:yt,compare:!0});default:return{name:xt,type:"unknown",value:yt}}}function normalizePropDefinition(xt,yt){return"type"in yt?{name:xt,...TYPE_DEFINITIONS[yt.type],...yt}:"value"in yt?{name:xt,type:getTypeOf(yt.value),...yt}:{name:xt,type:"object",value:yt}}function isArray(xt){return Array.isArray(xt)||ArrayBuffer.isView(xt)}function getTypeOf(xt){return isArray(xt)?"array":xt===null?"null":typeof xt}function createProps(xt,yt){let vt;for(let Et=yt.length-1;Et>=0;Et--){const wt=yt[Et];"extensions"in wt&&(vt=wt.extensions)}const bt=getPropsPrototype(xt.constructor,vt),Tt=Object.create(bt);Tt[COMPONENT_SYMBOL]=xt,Tt[ASYNC_ORIGINAL_SYMBOL]={},Tt[ASYNC_RESOLVED_SYMBOL]={};for(let Et=0;Et<yt.length;++Et){const wt=yt[Et];for(const St in wt)Tt[St]=wt[St]}return Object.freeze(Tt),Tt}const MergedDefaultPropsCacheKey="_mergedDefaultProps";function getPropsPrototype(xt,yt){if(!(xt instanceof Component.constructor))return{};let vt=MergedDefaultPropsCacheKey;if(yt)for(const Tt of yt){const Et=Tt.constructor;Et&&(vt+=`:${Et.extensionName||Et.name}`)}const bt=getOwnProperty(xt,vt);return bt||(xt[vt]=createPropsPrototypeAndTypes(xt,yt||[]))}function createPropsPrototypeAndTypes(xt,yt){if(!xt.prototype)return null;const bt=Object.getPrototypeOf(xt),Tt=getPropsPrototype(bt),Et=getOwnProperty(xt,"defaultProps")||{},wt=parsePropTypes(Et),St=Object.assign(Object.create(null),Tt,wt.defaultProps),At=Object.assign(Object.create(null),Tt==null?void 0:Tt[PROP_TYPES_SYMBOL],wt.propTypes),Rt=Object.assign(Object.create(null),Tt==null?void 0:Tt[DEPRECATED_PROPS_SYMBOL],wt.deprecatedProps);for(const Pt of yt){const Ct=getPropsPrototype(Pt.constructor);Ct&&(Object.assign(St,Ct),Object.assign(At,Ct[PROP_TYPES_SYMBOL]),Object.assign(Rt,Ct[DEPRECATED_PROPS_SYMBOL]))}return createPropsPrototype(St,xt),addAsyncPropsToPropPrototype(St,At),addDeprecatedPropsToPropPrototype(St,Rt),St[PROP_TYPES_SYMBOL]=At,St[DEPRECATED_PROPS_SYMBOL]=Rt,yt.length===0&&!hasOwnProperty(xt,"_propTypes")&&(xt._propTypes=At),St}function createPropsPrototype(xt,yt){const vt=getComponentName(yt);Object.defineProperties(xt,{id:{writable:!0,value:vt}})}function addDeprecatedPropsToPropPrototype(xt,yt){for(const vt in yt)Object.defineProperty(xt,vt,{enumerable:!1,set(bt){const Tt=`${this.id}: ${vt}`;for(const Et of yt[vt])hasOwnProperty(this,Et)||(this[Et]=bt);defaultLogger.deprecated(Tt,yt[vt].join("/"))()}})}function addAsyncPropsToPropPrototype(xt,yt){const vt={},bt={};for(const Tt in yt){const Et=yt[Tt],{name:wt,value:St}=Et;Et.async&&(vt[wt]=St,bt[wt]=getDescriptorForAsyncProp(wt))}xt[ASYNC_DEFAULTS_SYMBOL]=vt,xt[ASYNC_ORIGINAL_SYMBOL]={},Object.defineProperties(xt,bt)}function getDescriptorForAsyncProp(xt){return{enumerable:!0,set(yt){typeof yt=="string"||yt instanceof Promise||isAsyncIterable(yt)?this[ASYNC_ORIGINAL_SYMBOL][xt]=yt:this[ASYNC_RESOLVED_SYMBOL][xt]=yt},get(){if(this[ASYNC_RESOLVED_SYMBOL]){if(xt in this[ASYNC_RESOLVED_SYMBOL])return this[ASYNC_RESOLVED_SYMBOL][xt]||this[ASYNC_DEFAULTS_SYMBOL][xt];if(xt in this[ASYNC_ORIGINAL_SYMBOL]){const yt=this[COMPONENT_SYMBOL]&&this[COMPONENT_SYMBOL].internalState;if(yt&&yt.hasAsyncProp(xt))return yt.getAsyncProp(xt)||this[ASYNC_DEFAULTS_SYMBOL][xt]}}return this[ASYNC_DEFAULTS_SYMBOL][xt]}}}function hasOwnProperty(xt,yt){return Object.prototype.hasOwnProperty.call(xt,yt)}function getOwnProperty(xt,yt){return hasOwnProperty(xt,yt)&&xt[yt]}function getComponentName(xt){const yt=xt.componentName;return yt||defaultLogger.warn(`${xt.name}.componentName not specified`)(),yt||xt.name}let counter=0;class Component{constructor(...yt){this.props=createProps(this,yt),this.id=this.props.id,this.count=counter++}clone(yt){const{props:vt}=this,bt={};for(const Tt in vt[ASYNC_DEFAULTS_SYMBOL])Tt in vt[ASYNC_RESOLVED_SYMBOL]?bt[Tt]=vt[ASYNC_RESOLVED_SYMBOL][Tt]:Tt in vt[ASYNC_ORIGINAL_SYMBOL]&&(bt[Tt]=vt[ASYNC_ORIGINAL_SYMBOL][Tt]);return new this.constructor({...vt,...bt,...yt})}}Component.componentName="Component";Component.defaultProps={};const EMPTY_PROPS=Object.freeze({});class ComponentState{constructor(yt){this.component=yt,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const yt in this.asyncProps){const vt=this.asyncProps[yt];vt&&vt.type&&vt.type.release&&vt.type.release(vt.resolvedValue,vt.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||EMPTY_PROPS}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(yt){return yt in this.asyncProps}getAsyncProp(yt){const vt=this.asyncProps[yt];return vt&&vt.resolvedValue}isAsyncPropLoading(yt){if(yt){const vt=this.asyncProps[yt];return!!(vt&&vt.pendingLoadCount>0&&vt.pendingLoadCount!==vt.resolvedLoadCount)}for(const vt in this.asyncProps)if(this.isAsyncPropLoading(vt))return!0;return!1}reloadAsyncProp(yt,vt){this._watchPromise(yt,Promise.resolve(vt))}setAsyncProps(yt){this.component=yt[COMPONENT_SYMBOL]||this.component;const vt=yt[ASYNC_RESOLVED_SYMBOL]||{},bt=yt[ASYNC_ORIGINAL_SYMBOL]||yt,Tt=yt[ASYNC_DEFAULTS_SYMBOL]||{};for(const Et in vt){const wt=vt[Et];this._createAsyncPropData(Et,Tt[Et]),this._updateAsyncProp(Et,wt),vt[Et]=this.getAsyncProp(Et)}for(const Et in bt){const wt=bt[Et];this._createAsyncPropData(Et,Tt[Et]),this._updateAsyncProp(Et,wt)}}_fetch(yt,vt){return null}_onResolve(yt,vt){}_onError(yt,vt){}_updateAsyncProp(yt,vt){if(this._didAsyncInputValueChange(yt,vt)){if(typeof vt=="string"&&(vt=this._fetch(yt,vt)),vt instanceof Promise){this._watchPromise(yt,vt);return}if(isAsyncIterable(vt)){this._resolveAsyncIterable(yt,vt);return}this._setPropValue(yt,vt)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const yt in this.asyncProps)Object.defineProperty(this.oldAsyncProps,yt,{enumerable:!0,value:this.oldProps[yt]})}}_didAsyncInputValueChange(yt,vt){const bt=this.asyncProps[yt];return vt===bt.resolvedValue||vt===bt.lastValue?!1:(bt.lastValue=vt,!0)}_setPropValue(yt,vt){this._freezeAsyncOldProps();const bt=this.asyncProps[yt];bt&&(vt=this._postProcessValue(bt,vt),bt.resolvedValue=vt,bt.pendingLoadCount++,bt.resolvedLoadCount=bt.pendingLoadCount)}_setAsyncPropValue(yt,vt,bt){const Tt=this.asyncProps[yt];Tt&&bt>=Tt.resolvedLoadCount&&vt!==void 0&&(this._freezeAsyncOldProps(),Tt.resolvedValue=vt,Tt.resolvedLoadCount=bt,this.onAsyncPropUpdated(yt,vt))}_watchPromise(yt,vt){const bt=this.asyncProps[yt];if(bt){bt.pendingLoadCount++;const Tt=bt.pendingLoadCount;vt.then(Et=>{this.component&&(Et=this._postProcessValue(bt,Et),this._setAsyncPropValue(yt,Et,Tt),this._onResolve(yt,Et))}).catch(Et=>{this._onError(yt,Et)})}}async _resolveAsyncIterable(yt,vt){if(yt!=="data"){this._setPropValue(yt,vt);return}const bt=this.asyncProps[yt];if(!bt)return;bt.pendingLoadCount++;const Tt=bt.pendingLoadCount;let Et=[],wt=0;for await(const St of vt){if(!this.component)return;const{dataTransform:At}=this.component.props;At?Et=At(St,Et):Et=Et.concat(St),Object.defineProperty(Et,"__diff",{enumerable:!1,value:[{startRow:wt,endRow:Et.length}]}),wt=Et.length,this._setAsyncPropValue(yt,Et,Tt)}this._onResolve(yt,Et)}_postProcessValue(yt,vt){const bt=yt.type;return bt&&this.component&&(bt.release&&bt.release(yt.resolvedValue,bt,this.component),bt.transform)?bt.transform(vt,bt,this.component):vt}_createAsyncPropData(yt,vt){if(!this.asyncProps[yt]){const Tt=this.component&&this.component.props[PROP_TYPES_SYMBOL];this.asyncProps[yt]={type:Tt&&Tt[yt],lastValue:null,resolvedValue:vt,pendingLoadCount:0,resolvedLoadCount:0}}}}class LayerState extends ComponentState{constructor({attributeManager:yt,layer:vt}){super(vt),this.attributeManager=yt,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(yt,vt){const bt=this.layer,Tt=bt==null?void 0:bt.props.fetch;return Tt?Tt(vt,{propName:yt,layer:bt}):super._fetch(yt,vt)}_onResolve(yt,vt){const bt=this.layer;if(bt){const Tt=bt.props.onDataLoad;yt==="data"&&Tt&&Tt(vt,{propName:yt,layer:bt})}}_onError(yt,vt){const bt=this.layer;bt&&bt.raiseError(vt,`loading ${yt} of ${this.layer}`)}}const TRACE_CHANGE_FLAG="layer.changeFlag",TRACE_INITIALIZE="layer.initialize",TRACE_UPDATE="layer.update",TRACE_FINALIZE="layer.finalize",TRACE_MATCHED="layer.matched",MAX_PICKING_COLOR_CACHE_SIZE=2**24-1,EMPTY_ARRAY$1=Object.freeze([]),areViewportsEqual=memoize(({oldViewport:xt,viewport:yt})=>xt.equals(yt));let pickingColorCache=new Uint8ClampedArray(0);const defaultProps$8={data:{type:"data",value:EMPTY_ARRAY$1,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:xt=>xt&&xt.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(xt,{propName:yt,layer:vt,loaders:bt,loadOptions:Tt,signal:Et})=>{const{resourceManager:wt}=vt.context;Tt=Tt||vt.getLoadOptions(),bt=bt||vt.props.loaders,Et&&(Tt={...Tt,fetch:{...Tt==null?void 0:Tt.fetch,signal:Et}});let St=wt.contains(xt);return!St&&!Tt&&(wt.add({resourceId:xt,data:load(xt,bt),persistent:!1}),St=!0),St?wt.subscribe({resourceId:xt,onChange:At=>{var Rt;return(Rt=vt.internalState)==null?void 0:Rt.reloadAsyncProp(yt,At)},consumerId:vt.id,requestId:yt}):load(xt,bt,Tt)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:COORDINATE_SYSTEM.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:xt})=>[0,-xt*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Layer extends Component{constructor(){super(...arguments),this.internalState=null,this.lifecycle=LIFECYCLE.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let yt=this;for(;yt.parent;)yt=yt.parent;return yt}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(yt){assert(this.internalState);const vt=this.internalState.viewport||this.context.viewport,bt=getWorldPosition(yt,{viewport:vt,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[Tt,Et,wt]=worldToPixels(bt,vt.pixelProjectionMatrix);return yt.length===2?[Tt,Et]:[Tt,Et,wt]}unproject(yt){return assert(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(yt)}projectPosition(yt,vt){assert(this.internalState);const bt=this.internalState.viewport||this.context.viewport;return projectPosition(yt,{viewport:bt,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...vt})}get isComposite(){return!1}get isDrawable(){return!0}setState(yt){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,yt),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const yt=this.state;return yt&&(yt.models||yt.model&&[yt.model])||[]}setShaderModuleProps(...yt){for(const vt of this.getModels())vt.shaderInputs.setProps(...yt)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:yt}=this.props;return yt===COORDINATE_SYSTEM.DEFAULT||yt===COORDINATE_SYSTEM.LNGLAT||yt===COORDINATE_SYSTEM.CARTESIAN}onHover(yt,vt){return this.props.onHover&&this.props.onHover(yt,vt)||!1}onClick(yt,vt){return this.props.onClick&&this.props.onClick(yt,vt)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(yt,vt=[]){return vt[0]=yt+1&255,vt[1]=yt+1>>8&255,vt[2]=yt+1>>8>>8&255,vt}decodePickingColor(yt){assert(yt instanceof Uint8Array);const[vt,bt,Tt]=yt;return vt+bt*256+Tt*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:count(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var yt;return(yt=this.getAttributeManager())==null?void 0:yt.getBounds(["positions","instancePositions"])}getShaders(yt){yt=mergeShaders(yt,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const vt of this.props.extensions)yt=mergeShaders(yt,vt.getShaders.call(this,vt));return yt}shouldUpdateState(yt){return yt.changeFlags.propsOrDataChanged}updateState(yt){const vt=this.getAttributeManager(),{dataChanged:bt}=yt.changeFlags;if(bt&&vt)if(Array.isArray(bt))for(const Tt of bt)vt.invalidateAll(Tt);else vt.invalidateAll();if(vt){const{props:Tt}=yt,Et=this.internalState.hasPickingBuffer,wt=Number.isInteger(Tt.highlightedObjectIndex)||Tt.pickable||Tt.extensions.some(St=>St.getNeedsPickingBuffer.call(this,St));if(Et!==wt){this.internalState.hasPickingBuffer=wt;const{pickingColors:St,instancePickingColors:At}=vt.attributes,Rt=St||At;Rt&&(wt&&Rt.constant&&(Rt.constant=!1,vt.invalidate(Rt.id)),!Rt.value&&!wt&&(Rt.constant=!0,Rt.value=[0,0,0]))}}}finalizeState(yt){for(const bt of this.getModels())bt.destroy();const vt=this.getAttributeManager();vt&&vt.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(yt){for(const vt of this.getModels())vt.draw(yt.renderPass)}getPickingInfo({info:yt,mode:vt,sourceLayer:bt}){const{index:Tt}=yt;return Tt>=0&&Array.isArray(this.props.data)&&(yt.object=this.props.data[Tt]),yt}raiseError(yt,vt){var bt,Tt,Et,wt;vt&&(yt=new Error(`${vt}: ${yt.message}`,{cause:yt})),(Tt=(bt=this.props).onError)!=null&&Tt.call(bt,yt)||(wt=(Et=this.context)==null?void 0:Et.onError)==null||wt.call(Et,yt,this)}getNeedsRedraw(yt={clearRedrawFlags:!1}){return this._getNeedsRedraw(yt)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var yt;return((yt=this.internalState)==null?void 0:yt.uniformTransitions.active)||!1}activateViewport(yt){if(!this.internalState)return;const vt=this.internalState.viewport;this.internalState.viewport=yt,(!vt||!areViewportsEqual({oldViewport:vt,viewport:yt}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(yt="all"){const vt=this.getAttributeManager();vt&&(yt==="all"?vt.invalidateAll():vt.invalidate(yt))}updateAttributes(yt){let vt=!1;for(const bt in yt)yt[bt].layoutChanged()&&(vt=!0);for(const bt of this.getModels())this._setModelAttributes(bt,yt,vt)}_updateAttributes(){const yt=this.getAttributeManager();if(!yt)return;const vt=this.props,bt=this.getNumInstances(),Tt=this.getStartIndices();yt.update({data:vt.data,numInstances:bt,startIndices:Tt,props:vt,transitions:vt.transitions,buffers:vt.data.attributes,context:this});const Et=yt.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(Et)}_updateAttributeTransition(){const yt=this.getAttributeManager();yt&&yt.updateTransition()}_updateUniformTransition(){const{uniformTransitions:yt}=this.internalState;if(yt.active){const vt=yt.update(),bt=Object.create(this.props);for(const Tt in vt)Object.defineProperty(bt,Tt,{value:vt[Tt]});return bt}return this.props}calculateInstancePickingColors(yt,{numInstances:vt}){if(yt.constant)return;const bt=Math.floor(pickingColorCache.length/4);if(this.internalState.usesPickingColorCache=!0,bt<vt){vt>MAX_PICKING_COLOR_CACHE_SIZE&&defaultLogger.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),pickingColorCache=defaultTypedArrayManager.allocate(pickingColorCache,vt,{size:4,copy:!0,maxCount:Math.max(vt,MAX_PICKING_COLOR_CACHE_SIZE)});const Tt=Math.floor(pickingColorCache.length/4),Et=[0,0,0];for(let wt=bt;wt<Tt;wt++)this.encodePickingColor(wt,Et),pickingColorCache[wt*4+0]=Et[0],pickingColorCache[wt*4+1]=Et[1],pickingColorCache[wt*4+2]=Et[2],pickingColorCache[wt*4+3]=0}yt.value=pickingColorCache.subarray(0,vt*4)}_setModelAttributes(yt,vt,bt=!1){var St;if(!Object.keys(vt).length)return;if(bt){const At=this.getAttributeManager();yt.setBufferLayout(At.getBufferLayouts(yt)),vt=At.getAttributes()}const Tt=((St=yt.userData)==null?void 0:St.excludeAttributes)||{},Et={},wt={};for(const At in vt){if(Tt[At])continue;const Rt=vt[At].getValue();for(const Pt in Rt){const Ct=Rt[Pt];Ct instanceof Buffer?vt[At].settings.isIndexed?yt.setIndexBuffer(Ct):Et[Pt]=Ct:Ct&&(wt[Pt]=Ct)}}yt.setAttributes(Et),yt.setConstantAttributes(wt)}disablePickingIndex(yt){const vt=this.props.data;if(!("attributes"in vt)){this._disablePickingIndex(yt);return}const{pickingColors:bt,instancePickingColors:Tt}=this.getAttributeManager().attributes,Et=bt||Tt,wt=Et&&vt.attributes&&vt.attributes[Et.id];if(wt&&wt.value){const St=wt.value,At=this.encodePickingColor(yt);for(let Rt=0;Rt<vt.length;Rt++){const Pt=Et.getVertexOffset(Rt);St[Pt]===At[0]&&St[Pt+1]===At[1]&&St[Pt+2]===At[2]&&this._disablePickingIndex(Rt)}}else this._disablePickingIndex(yt)}_disablePickingIndex(yt){const{pickingColors:vt,instancePickingColors:bt}=this.getAttributeManager().attributes,Tt=vt||bt;if(!Tt)return;const Et=Tt.getVertexOffset(yt),wt=Tt.getVertexOffset(yt+1);Tt.buffer.write(new Uint8Array(wt-Et),Et)}restorePickingColors(){const{pickingColors:yt,instancePickingColors:vt}=this.getAttributeManager().attributes,bt=yt||vt;bt&&(this.internalState.usesPickingColorCache&&bt.value.buffer!==pickingColorCache.buffer&&(bt.value=pickingColorCache.subarray(0,bt.value.length)),bt.updateSubBuffer({startOffset:0}))}_initialize(){assert(!this.internalState),assert(Number.isFinite(this.props.coordinateSystem)),debug(TRACE_INITIALIZE,this);const yt=this._getAttributeManager();yt&&yt.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new LayerState({attributeManager:yt,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(defaultLogger.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),yt)}),this.internalState.uniformTransitions=new UniformTransitionManager(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const vt of this.props.extensions)vt.initializeState.call(this,this.context,vt);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(yt){debug(TRACE_MATCHED,this,this===yt);const{state:vt,internalState:bt}=yt;this!==yt&&(this.internalState=bt,this.state=vt,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const yt=this.needsUpdate();if(debug(TRACE_UPDATE,this,yt),!yt)return;const vt=this.props,bt=this.context,Tt=this.internalState,Et=bt.viewport,wt=this._updateUniformTransition();Tt.propsInTransition=wt,bt.viewport=Tt.viewport||Et,this.props=wt;try{const St=this._getUpdateParams(),At=this.getModels();if(bt.device)this.updateState(St);else try{this.updateState(St)}catch{}for(const Pt of this.props.extensions)Pt.updateState.call(this,St,Pt);this.setNeedsRedraw(),this._updateAttributes();const Rt=this.getModels()[0]!==At[0];this._postUpdate(St,Rt)}finally{bt.viewport=Et,this.props=vt,this._clearChangeFlags(),Tt.needsUpdate=!1,Tt.resetOldProps()}}_finalize(){debug(TRACE_FINALIZE,this),this.finalizeState(this.context);for(const yt of this.props.extensions)yt.finalizeState.call(this,this.context,yt)}_drawLayer({renderPass:yt,shaderModuleProps:vt=null,uniforms:bt={},parameters:Tt={}}){this._updateAttributeTransition();const Et=this.props,wt=this.context;this.props=this.internalState.propsInTransition||Et;try{vt&&this.setShaderModuleProps(vt);const{getPolygonOffset:St}=this.props,At=St&&St(bt)||[0,0];wt.device instanceof WebGLDevice&&wt.device.setParametersWebGL({polygonOffset:At});for(const Rt of this.getModels())Rt.device.type==="webgpu"?Rt.setParameters({...Rt.parameters,...Tt}):Rt.setParameters(Tt);if(wt.device instanceof WebGLDevice)wt.device.withParametersWebGL(Tt,()=>{const Rt={renderPass:yt,shaderModuleProps:vt,uniforms:bt,parameters:Tt,context:wt};for(const Pt of this.props.extensions)Pt.draw.call(this,Rt,Pt);this.draw(Rt)});else{const Rt={renderPass:yt,shaderModuleProps:vt,uniforms:bt,parameters:Tt,context:wt};for(const Pt of this.props.extensions)Pt.draw.call(this,Rt,Pt);this.draw(Rt)}}finally{this.props=Et}}getChangeFlags(){var yt;return(yt=this.internalState)==null?void 0:yt.changeFlags}setChangeFlags(yt){if(!this.internalState)return;const{changeFlags:vt}=this.internalState;for(const Tt in yt)if(yt[Tt]){let Et=!1;switch(Tt){case"dataChanged":const wt=yt[Tt],St=vt[Tt];wt&&Array.isArray(St)&&(vt.dataChanged=Array.isArray(wt)?St.concat(wt):wt,Et=!0);default:vt[Tt]||(vt[Tt]=yt[Tt],Et=!0)}Et&&debug(TRACE_CHANGE_FLAG,this,Tt,yt)}const bt=!!(vt.dataChanged||vt.updateTriggersChanged||vt.propsChanged||vt.extensionsChanged);vt.propsOrDataChanged=bt,vt.somethingChanged=bt||vt.viewportChanged||vt.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(yt,vt){var Tt;const bt=diffProps(yt,vt);if(bt.updateTriggersChanged)for(const Et in bt.updateTriggersChanged)bt.updateTriggersChanged[Et]&&this.invalidateAttribute(Et);if(bt.transitionsChanged)for(const Et in bt.transitionsChanged)this.internalState.uniformTransitions.add(Et,vt[Et],yt[Et],(Tt=yt.transitions)==null?void 0:Tt[Et]);return this.setChangeFlags(bt)}validateProps(){validateProps(this.props)}updateAutoHighlight(yt){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(yt)}_updateAutoHighlight(yt){const vt={highlightedObjectColor:yt.picked?yt.color:null},{highlightColor:bt}=this.props;yt.picked&&typeof bt=="function"&&(vt.highlightColor=bt(yt)),this.setShaderModuleProps({picking:vt}),this.setNeedsRedraw()}_getAttributeManager(){const yt=this.context;return new AttributeManager(yt.device,{id:this.props.id,stats:yt.stats,timeline:yt.timeline})}_postUpdate(yt,vt){const{props:bt,oldProps:Tt}=yt,Et=this.state.model;Et!=null&&Et.isInstanced&&Et.setInstanceCount(this.getNumInstances());const{autoHighlight:wt,highlightedObjectIndex:St,highlightColor:At}=bt;if(vt||Tt.autoHighlight!==wt||Tt.highlightedObjectIndex!==St||Tt.highlightColor!==At){const Rt={};Array.isArray(At)&&(Rt.highlightColor=At),(vt||Tt.autoHighlight!==wt||St!==Tt.highlightedObjectIndex)&&(Rt.highlightedObjectColor=Number.isFinite(St)&&St>=0?this.encodePickingColor(St):null),this.setShaderModuleProps({picking:Rt})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(yt){if(!this.internalState)return!1;let vt=!1;vt=vt||this.internalState.needsRedraw&&this.id;const bt=this.getAttributeManager(),Tt=bt?bt.getNeedsRedraw(yt):!1;if(vt=vt||Tt,vt)for(const Et of this.props.extensions)Et.onNeedsRedraw.call(this,Et);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!yt.clearRedrawFlags,vt}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Layer.defaultProps=defaultProps$8;Layer.layerName="Layer";const TRACE_RENDER_LAYERS="compositeLayer.renderLayers";class CompositeLayer extends Layer{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(yt=>yt.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(yt){}setState(yt){super.setState(yt),this.setNeedsUpdate()}getPickingInfo({info:yt}){const{object:vt}=yt;return vt&&vt.__source&&vt.__source.parent&&vt.__source.parent.id===this.id&&(yt.object=vt.__source.object,yt.index=vt.__source.index),yt}filterSubLayer(yt){return!0}shouldRenderSubLayer(yt,vt){return vt&&vt.length}getSubLayerClass(yt,vt){const{_subLayerProps:bt}=this.props;return bt&&bt[yt]&&bt[yt].type||vt}getSubLayerRow(yt,vt,bt){return yt.__source={parent:this,object:vt,index:bt},yt}getSubLayerAccessor(yt){if(typeof yt=="function"){const vt={index:-1,data:this.props.data,target:[]};return(bt,Tt)=>bt&&bt.__source?(vt.index=bt.__source.index,yt(bt.__source.object,vt)):yt(bt,Tt)}return yt}getSubLayerProps(yt={}){var jt;const{opacity:vt,pickable:bt,visible:Tt,parameters:Et,getPolygonOffset:wt,highlightedObjectIndex:St,autoHighlight:At,highlightColor:Rt,coordinateSystem:Pt,coordinateOrigin:Ct,wrapLongitude:It,positionFormat:Mt,modelMatrix:Ot,extensions:kt,fetch:Ft,operation:Nt,_subLayerProps:Lt}=this.props,Dt={id:"",updateTriggers:{},opacity:vt,pickable:bt,visible:Tt,parameters:Et,getPolygonOffset:wt,highlightedObjectIndex:St,autoHighlight:At,highlightColor:Rt,coordinateSystem:Pt,coordinateOrigin:Ct,wrapLongitude:It,positionFormat:Mt,modelMatrix:Ot,extensions:kt,fetch:Ft,operation:Nt},$t=Lt&&yt.id&&Lt[yt.id],zt=$t&&$t.updateTriggers,Ut=yt.id||"sublayer";if($t){const Ht=this.props[PROP_TYPES_SYMBOL],Vt=yt.type?yt.type._propTypes:{};for(const Wt in $t){const Yt=Vt[Wt]||Ht[Wt];Yt&&Yt.type==="accessor"&&($t[Wt]=this.getSubLayerAccessor($t[Wt]))}}Object.assign(Dt,yt,$t),Dt.id=`${this.props.id}-${Ut}`,Dt.updateTriggers={all:(jt=this.props.updateTriggers)==null?void 0:jt.all,...yt.updateTriggers,...zt};for(const Ht of kt){const Vt=Ht.getSubLayerProps.call(this,Ht);Vt&&Object.assign(Dt,Vt,{updateTriggers:Object.assign(Dt.updateTriggers,Vt.updateTriggers)})}return Dt}_updateAutoHighlight(yt){for(const vt of this.getSubLayers())vt.updateAutoHighlight(yt)}_getAttributeManager(){return null}_postUpdate(yt,vt){let bt=this.internalState.subLayers;const Tt=!bt||this.needsUpdate();if(Tt){const Et=this.renderLayers();bt=flatten(Et,Boolean),this.internalState.subLayers=bt}debug(TRACE_RENDER_LAYERS,this,Tt,bt);for(const Et of bt)Et.parent=this}}CompositeLayer.layerName="CompositeLayer";class Tesselator{constructor(yt){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:vt={}}=yt;this.typedArrayManager=defaultTypedArrayManager,this.attributes={},this._attributeDefs=vt,this.opts=yt,this.updateGeometry(yt)}updateGeometry(yt){Object.assign(this.opts,yt);const{data:vt,buffers:bt={},getGeometry:Tt,geometryBuffer:Et,positionFormat:wt,dataChanged:St,normalize:At=!0}=this.opts;if(this.data=vt,this.getGeometry=Tt,this.positionSize=Et&&Et.size||(wt==="XY"?2:3),this.buffers=bt,this.normalize=At,Et&&(assert(vt.startIndices),this.getGeometry=this.getGeometryFromBuffer(Et),At||(bt.vertexPositions=Et)),this.geometryBuffer=bt.vertexPositions,Array.isArray(St))for(const Rt of St)this._rebuildGeometry(Rt);else this._rebuildGeometry()}updatePartialGeometry({startRow:yt,endRow:vt}){this._rebuildGeometry({startRow:yt,endRow:vt})}getGeometryFromBuffer(yt){const vt=yt.value||yt;return ArrayBuffer.isView(vt)?getAccessorFromBuffer(vt,{size:this.positionSize,offset:yt.offset,stride:yt.stride,startIndices:this.data.startIndices}):null}_allocate(yt,vt){const{attributes:bt,buffers:Tt,_attributeDefs:Et,typedArrayManager:wt}=this;for(const St in Et)if(St in Tt)wt.release(bt[St]),bt[St]=null;else{const At=Et[St];At.copy=vt,bt[St]=wt.allocate(bt[St],yt,At)}}_forEachGeometry(yt,vt,bt){const{data:Tt,getGeometry:Et}=this,{iterable:wt,objectInfo:St}=createIterable(Tt,vt,bt);for(const At of wt){St.index++;const Rt=Et?Et(At,St):null;yt(Rt,St.index)}}_rebuildGeometry(yt){if(!this.data)return;let{indexStarts:vt,vertexStarts:bt,instanceCount:Tt}=this;const{data:Et,geometryBuffer:wt}=this,{startRow:St=0,endRow:At=1/0}=yt||{},Rt={};if(yt||(vt=[0],bt=[0]),this.normalize||!wt)this._forEachGeometry((Ct,It)=>{const Mt=Ct&&this.normalizeGeometry(Ct);Rt[It]=Mt,bt[It+1]=bt[It]+(Mt?this.getGeometrySize(Mt):0)},St,At),Tt=bt[bt.length-1];else if(bt=Et.startIndices,Tt=bt[Et.length]||0,ArrayBuffer.isView(wt))Tt=Tt||wt.length/this.positionSize;else if(wt instanceof Buffer){const Ct=this.positionSize*4;Tt=Tt||wt.byteLength/Ct}else if(wt.buffer){const Ct=wt.stride||this.positionSize*4;Tt=Tt||wt.buffer.byteLength/Ct}else if(wt.value){const Ct=wt.value,It=wt.stride/Ct.BYTES_PER_ELEMENT||this.positionSize;Tt=Tt||Ct.length/It}this._allocate(Tt,!!yt),this.indexStarts=vt,this.vertexStarts=bt,this.instanceCount=Tt;const Pt={};this._forEachGeometry((Ct,It)=>{const Mt=Rt[It]||Ct;Pt.vertexStart=bt[It],Pt.indexStart=vt[It];const Ot=It<bt.length-1?bt[It+1]:Tt;Pt.geometrySize=Ot-bt[It],Pt.geometryIndex=It,this.updateGeometryAttributes(Mt,Pt)},St,At),this.vertexCount=vt[vt.length-1]}}const useIsomorphicLayoutEffect=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect;function inheritsFrom(xt,yt){for(;xt;){if(xt===yt)return!0;xt=Object.getPrototypeOf(xt)}return!1}const MAP_STYLE={position:"absolute",zIndex:-1};function evaluateChildren(xt,yt){if(typeof xt=="function")return xt(yt);if(Array.isArray(xt))return xt.map(vt=>evaluateChildren(vt,yt));if(isComponent(xt)){if(isReactMap(xt))return yt.style=MAP_STYLE,reactExports.cloneElement(xt,yt);if(needsDeckGLViewProps(xt))return reactExports.cloneElement(xt,yt)}return xt}function isComponent(xt){return xt&&typeof xt=="object"&&"type"in xt||!1}function isReactMap(xt){var yt;return(yt=xt.props)==null?void 0:yt.mapStyle}function needsDeckGLViewProps(xt){const yt=xt.type;return yt&&yt.deckGLViewProps}function wrapInView(xt){if(typeof xt=="function")return reactExports.createElement(View,{},xt);if(Array.isArray(xt))return xt.map(wrapInView);if(isComponent(xt)){if(xt.type===reactExports.Fragment)return wrapInView(xt.props.children);if(inheritsFrom(xt.type,View))return xt}return xt}function extractJSXLayers({children:xt,layers:yt=[],views:vt=null}){const bt=[],Tt=[],Et={};return reactExports.Children.forEach(wrapInView(xt),wt=>{if(isComponent(wt)){const St=wt.type;if(inheritsFrom(St,Layer)){const At=createLayer(St,wt.props);Tt.push(At)}else bt.push(wt);if(inheritsFrom(St,View)&&St!==View&&wt.props.id){const At=new St(wt.props);Et[At.id]=At}}else wt&&bt.push(wt)}),Object.keys(Et).length>0&&(Array.isArray(vt)?vt.forEach(wt=>{Et[wt.id]=wt}):vt&&(Et[vt.id]=vt),vt=Object.values(Et)),yt=Tt.length>0?[...Tt,...yt]:yt,{layers:yt,children:bt,views:vt}}function createLayer(xt,yt){const vt={},bt=xt.defaultProps||{};for(const Tt in yt)bt[Tt]!==yt[Tt]&&(vt[Tt]=yt[Tt]);return new xt(vt)}const DeckGlContext=reactExports.createContext();function positionChildrenUnderViews({children:xt,deck:yt,ContextProvider:vt=DeckGlContext.Provider}){const{viewManager:bt}=yt||{};if(!bt||!bt.views.length)return[];const Tt={},Et=bt.views[0].id;for(const wt of xt){let St=Et,At=wt;isComponent(wt)&&inheritsFrom(wt.type,View)&&(St=wt.props.id||Et,At=wt.props.children);const Rt=bt.getViewport(St),Pt=bt.getViewState(St);if(Rt){Pt.padding=Rt.padding;const{x:Ct,y:It,width:Mt,height:Ot}=Rt;At=evaluateChildren(At,{x:Ct,y:It,width:Mt,height:Ot,viewport:Rt,viewState:Pt}),Tt[St]||(Tt[St]={viewport:Rt,children:[]}),Tt[St].children.push(At)}}return Object.keys(Tt).map(wt=>{const{viewport:St,children:At}=Tt[wt],{x:Rt,y:Pt,width:Ct,height:It}=St,Mt={position:"absolute",left:Rt,top:Pt,width:Ct,height:It},Ot=`view-${wt}`,kt=reactExports.createElement("div",{key:Ot,id:Ot,style:Mt},...At),Ft={deck:yt,viewport:St,container:yt.canvas.offsetParent,eventManager:yt.eventManager,onViewStateChange:Lt=>{Lt.viewId=wt,yt._onViewStateChange(Lt)},widgets:[]},Nt=`view-${wt}-context`;return reactExports.createElement(vt,{key:Nt,value:Ft},kt)})}const CANVAS_ONLY_STYLES={mixBlendMode:null};function extractStyles({width:xt,height:yt,style:vt}){const bt={position:"absolute",zIndex:0,left:0,top:0,width:xt,height:yt},Tt={left:0,top:0};if(vt)for(const Et in vt)Et in CANVAS_ONLY_STYLES?Tt[Et]=vt[Et]:bt[Et]=vt[Et];return{containerStyle:bt,canvasStyle:Tt}}function getRefHandles(xt){return{get deck(){return xt.deck},pickObject:yt=>xt.deck.pickObject(yt),pickMultipleObjects:yt=>xt.deck.pickMultipleObjects(yt),pickObjects:yt=>xt.deck.pickObjects(yt)}}function redrawDeck(xt){xt.redrawReason&&(xt.deck._drawLayers(xt.redrawReason),xt.redrawReason=null)}function createDeckInstance(xt,yt,vt){var Tt,Et,wt;const bt=new yt({...vt,_customRender:((wt=(Et=(Tt=vt.deviceProps)==null?void 0:Tt.adapters)==null?void 0:Et[0])==null?void 0:wt.type)==="webgpu"?void 0:St=>{xt.redrawReason=St;const At=bt.getViewports();xt.lastRenderedViewports!==At?xt.forceUpdate():redrawDeck(xt)}});return bt}function DeckGLWithRef(xt,yt){const[vt,bt]=reactExports.useState(0),Et=reactExports.useRef({control:null,version:vt,forceUpdate:()=>bt(zt=>zt+1)}).current,wt=reactExports.useRef(null),St=reactExports.useRef(null),At=reactExports.useMemo(()=>extractJSXLayers(xt),[xt.layers,xt.views,xt.children]);let Rt=!0;const Pt=zt=>{var Ut;return Rt&&xt.viewState?(Et.viewStateUpdateRequested=zt,null):(Et.viewStateUpdateRequested=null,(Ut=xt.onViewStateChange)==null?void 0:Ut.call(xt,zt))},Ct=zt=>{var Ut;Rt?Et.interactionStateUpdateRequested=zt:(Et.interactionStateUpdateRequested=null,(Ut=xt.onInteractionStateChange)==null||Ut.call(xt,zt))},It=reactExports.useMemo(()=>{const zt={widgets:[],...xt,style:null,width:"100%",height:"100%",parent:wt.current,canvas:St.current,layers:At.layers,views:At.views,onViewStateChange:Pt,onInteractionStateChange:Ct};return delete zt._customRender,Et.deck&&Et.deck.setProps(zt),zt},[xt]);reactExports.useEffect(()=>{const zt=xt.Deck||Deck;return Et.deck=createDeckInstance(Et,zt,{...It,parent:wt.current,canvas:St.current}),()=>{var Ut;return(Ut=Et.deck)==null?void 0:Ut.finalize()}},[]),useIsomorphicLayoutEffect(()=>{redrawDeck(Et);const{viewStateUpdateRequested:zt,interactionStateUpdateRequested:Ut}=Et;zt&&Pt(zt),Ut&&Ct(Ut)}),reactExports.useImperativeHandle(yt,()=>getRefHandles(Et),[]);const Mt=Et.deck&&Et.deck.isInitialized?Et.deck.getViewports():void 0,{ContextProvider:Ot,width:kt="100%",height:Ft="100%",id:Nt,style:Lt}=xt,{containerStyle:Dt,canvasStyle:$t}=reactExports.useMemo(()=>extractStyles({width:kt,height:Ft,style:Lt}),[kt,Ft,Lt]);if(!Et.viewStateUpdateRequested&&Et.lastRenderedViewports===Mt||Et.version!==vt){Et.lastRenderedViewports=Mt,Et.version=vt;const zt=positionChildrenUnderViews({children:At.children,deck:Et.deck,ContextProvider:Ot}),Ut=reactExports.createElement("canvas",{key:"canvas",id:Nt||"deckgl-overlay",ref:St,style:$t});Et.control=reactExports.createElement("div",{id:`${Nt||"deckgl"}-wrapper`,ref:wt,style:Dt},[Ut,zt])}return Rt=!1,Et.control}const DeckGL=reactExports.forwardRef(DeckGLWithRef),uniformBlock$4=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,iconUniforms={name:"icon",vs:uniformBlock$4,fs:uniformBlock$4,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},vs$3=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,fs$5=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,DEFAULT_CANVAS_WIDTH=1024,DEFAULT_BUFFER$1=4,noop=()=>{},DEFAULT_SAMPLER_PARAMETERS={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},MISSING_ICON={x:0,y:0,width:0,height:0};function nextPowOfTwo$1(xt){return Math.pow(2,Math.ceil(Math.log2(xt)))}function resizeImage(xt,yt,vt,bt){const Tt=Math.min(vt/yt.width,bt/yt.height),Et=Math.floor(yt.width*Tt),wt=Math.floor(yt.height*Tt);return Tt===1?{image:yt,width:Et,height:wt}:(xt.canvas.height=wt,xt.canvas.width=Et,xt.clearRect(0,0,Et,wt),xt.drawImage(yt,0,0,yt.width,yt.height,0,0,Et,wt),{image:xt.canvas,width:Et,height:wt})}function getIconId(xt){return xt&&(xt.id||xt.url)}function resizeTexture(xt,yt,vt,bt){const{width:Tt,height:Et,device:wt}=xt,St=wt.createTexture({format:"rgba8unorm",width:yt,height:vt,sampler:bt,mipmaps:!0}),At=wt.createCommandEncoder();return At.copyTextureToTexture({sourceTexture:xt,destinationTexture:St,width:Tt,height:Et}),At.finish(),xt.destroy(),St}function buildRowMapping(xt,yt,vt){for(let bt=0;bt<yt.length;bt++){const{icon:Tt,xOffset:Et}=yt[bt],wt=getIconId(Tt);xt[wt]={...Tt,x:Et,y:vt}}}function buildMapping$1({icons:xt,buffer:yt,mapping:vt={},xOffset:bt=0,yOffset:Tt=0,rowHeight:Et=0,canvasWidth:wt}){let St=[];for(let At=0;At<xt.length;At++){const Rt=xt[At],Pt=getIconId(Rt);if(!vt[Pt]){const{height:Ct,width:It}=Rt;bt+It+yt>wt&&(buildRowMapping(vt,St,Tt),bt=0,Tt=Et+Tt+yt,Et=0,St=[]),St.push({icon:Rt,xOffset:bt}),bt=bt+It+yt,Et=Math.max(Et,Ct)}}return St.length>0&&buildRowMapping(vt,St,Tt),{mapping:vt,rowHeight:Et,xOffset:bt,yOffset:Tt,canvasWidth:wt,canvasHeight:nextPowOfTwo$1(Et+Tt+yt)}}function getDiffIcons(xt,yt,vt){if(!xt||!yt)return null;vt=vt||{};const bt={},{iterable:Tt,objectInfo:Et}=createIterable(xt);for(const wt of Tt){Et.index++;const St=yt(wt,Et),At=getIconId(St);if(!St)throw new Error("Icon is missing.");if(!St.url)throw new Error("Icon url is missing.");!bt[At]&&(!vt[At]||St.url!==vt[At].url)&&(bt[At]={...St,source:wt,sourceIndex:Et.index})}return bt}class IconManager{constructor(yt,{onUpdate:vt=noop,onError:bt=noop}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=DEFAULT_BUFFER$1,this._canvasWidth=DEFAULT_CANVAS_WIDTH,this._canvasHeight=0,this._canvas=null,this.device=yt,this.onUpdate=vt,this.onError=bt}finalize(){var yt;(yt=this._texture)==null||yt.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(yt){const vt=this._autoPacking?getIconId(yt):yt;return this._mapping[vt]||MISSING_ICON}setProps({loadOptions:yt,autoPacking:vt,iconAtlas:bt,iconMapping:Tt,textureParameters:Et}){var wt;yt&&(this._loadOptions=yt),vt!==void 0&&(this._autoPacking=vt),Tt&&(this._mapping=Tt),bt&&((wt=this._texture)==null||wt.delete(),this._texture=null,this._externalTexture=bt),Et&&(this._samplerParameters=Et)}get isLoaded(){return this._pendingCount===0}packIcons(yt,vt){if(!this._autoPacking||typeof document>"u")return;const bt=Object.values(getDiffIcons(yt,vt,this._mapping)||{});if(bt.length>0){const{mapping:Tt,xOffset:Et,yOffset:wt,rowHeight:St,canvasHeight:At}=buildMapping$1({icons:bt,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=St,this._mapping=Tt,this._xOffset=Et,this._yOffset=wt,this._canvasHeight=At,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||DEFAULT_SAMPLER_PARAMETERS,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=resizeTexture(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||DEFAULT_SAMPLER_PARAMETERS)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(bt)}}_loadIcons(yt){const vt=this._canvas.getContext("2d",{willReadFrequently:!0});for(const bt of yt)this._pendingCount++,load(bt.url,this._loadOptions).then(Tt=>{var Ot;const Et=getIconId(bt),wt=this._mapping[Et],{x:St,y:At,width:Rt,height:Pt}=wt,{image:Ct,width:It,height:Mt}=resizeImage(vt,Tt,Rt,Pt);(Ot=this._texture)==null||Ot.copyExternalImage({image:Ct,x:St+(Rt-It)/2,y:At+(Pt-Mt)/2,width:It,height:Mt}),wt.width=It,wt.height=Mt,this._texture.generateMipmap(),this.onUpdate()}).catch(Tt=>{this.onError({url:bt.url,source:bt.source,sourceIndex:bt.sourceIndex,loadOptions:this._loadOptions,error:Tt})}).finally(()=>{this._pendingCount--})}}const DEFAULT_COLOR$4=[0,0,0,255],defaultProps$7={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:xt=>xt.position},getIcon:{type:"accessor",value:xt=>xt.icon},getColor:{type:"accessor",value:DEFAULT_COLOR$4},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class IconLayer extends Layer{getShaders(){return super.getShaders({vs:vs$3,fs:fs$5,modules:[project32,picking,iconUniforms]})}initializeState(){this.state={iconManager:new IconManager(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:DEFAULT_COLOR$4},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(yt){var Mt;super.updateState(yt);const{props:vt,oldProps:bt,changeFlags:Tt}=yt,Et=this.getAttributeManager(),{iconAtlas:wt,iconMapping:St,data:At,getIcon:Rt,textureParameters:Pt}=vt,{iconManager:Ct}=this.state;if(typeof wt=="string")return;const It=wt||this.internalState.isAsyncPropLoading("iconAtlas");Ct.setProps({loadOptions:vt.loadOptions,autoPacking:!It,iconAtlas:wt,iconMapping:It?St:null,textureParameters:Pt}),It?bt.iconMapping!==vt.iconMapping&&Et.invalidate("getIcon"):(Tt.dataChanged||Tt.updateTriggersChanged&&(Tt.updateTriggersChanged.all||Tt.updateTriggersChanged.getIcon))&&Ct.packIcons(At,Rt),Tt.extensionsChanged&&((Mt=this.state.model)==null||Mt.destroy(),this.state.model=this._getModel(),Et.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(yt){super.finalizeState(yt),this.state.iconManager.finalize()}draw({uniforms:yt}){const{sizeScale:vt,sizeMinPixels:bt,sizeMaxPixels:Tt,sizeUnits:Et,billboard:wt,alphaCutoff:St}=this.props,{iconManager:At}=this.state,Rt=At.getTexture();if(Rt){const Pt=this.state.model,Ct={iconsTexture:Rt,iconsTextureDim:[Rt.width,Rt.height],sizeUnits:UNIT[Et],sizeScale:vt,sizeMinPixels:bt,sizeMaxPixels:Tt,billboard:wt,alphaCutoff:St};Pt.shaderInputs.setProps({icon:Ct}),Pt.draw(this.context.renderPass)}}_getModel(){const yt=[-1,-1,1,-1,-1,1,1,1];return new Model(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Geometry({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(yt)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(yt){var bt;const vt=(bt=this.getCurrentLayer())==null?void 0:bt.props.onIconError;vt?vt(yt):defaultLogger.error(yt.error.message)()}getInstanceOffset(yt){const{width:vt,height:bt,anchorX:Tt=vt/2,anchorY:Et=bt/2}=this.state.iconManager.getIconMapping(yt);return[vt/2-Tt,bt/2-Et]}getInstanceColorMode(yt){return this.state.iconManager.getIconMapping(yt).mask?1:0}getInstanceIconFrame(yt){const{x:vt,y:bt,width:Tt,height:Et}=this.state.iconManager.getIconMapping(yt);return[vt,bt,Tt,Et]}}IconLayer.defaultProps=defaultProps$7;IconLayer.layerName="IconLayer";const glslUniformBlock=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,scatterplotUniforms={name:"scatterplot",vs:glslUniformBlock,fs:glslUniformBlock,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},vs$2=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,fs$4=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,source=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,DEFAULT_COLOR$3=[0,0,0,255],defaultProps$6={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:xt=>xt.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:DEFAULT_COLOR$3},getLineColor:{type:"accessor",value:DEFAULT_COLOR$3},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ScatterplotLayer extends Layer{getShaders(){return super.getShaders({vs:vs$2,fs:fs$4,source,modules:[project32,picking,scatterplotUniforms]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(yt){var vt;super.updateState(yt),yt.changeFlags.extensionsChanged&&((vt=this.state.model)==null||vt.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:yt}){const{radiusUnits:vt,radiusScale:bt,radiusMinPixels:Tt,radiusMaxPixels:Et,stroked:wt,filled:St,billboard:At,antialiasing:Rt,lineWidthUnits:Pt,lineWidthScale:Ct,lineWidthMinPixels:It,lineWidthMaxPixels:Mt}=this.props,Ot={stroked:wt,filled:St,billboard:At,antialiasing:Rt,radiusUnits:UNIT[vt],radiusScale:bt,radiusMinPixels:Tt,radiusMaxPixels:Et,lineWidthUnits:UNIT[Pt],lineWidthScale:Ct,lineWidthMinPixels:It,lineWidthMaxPixels:Mt},kt=this.state.model;kt.shaderInputs.setProps({scatterplot:Ot}),kt.draw(this.context.renderPass)}_getModel(){const yt=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Model(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Geometry({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(yt)}}}),isInstanced:!0})}}ScatterplotLayer.defaultProps=defaultProps$6;ScatterplotLayer.layerName="ScatterplotLayer";const WINDING={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function modifyPolygonWindingDirection(xt,yt,vt={}){return getPolygonWindingDirection(xt,vt)!==yt?(reversePolygon(xt,vt),!0):!1}function getPolygonWindingDirection(xt,yt={}){return Math.sign(getPolygonSignedArea(xt,yt))}const DimIndex={x:0,y:1,z:2};function getPolygonSignedArea(xt,yt={}){const{start:vt=0,end:bt=xt.length,plane:Tt="xy"}=yt,Et=yt.size||2;let wt=0;const St=DimIndex[Tt[0]],At=DimIndex[Tt[1]];for(let Rt=vt,Pt=bt-Et;Rt<bt;Rt+=Et)wt+=(xt[Rt+St]-xt[Pt+St])*(xt[Rt+At]+xt[Pt+At]),Pt=Rt;return wt/2}function reversePolygon(xt,yt){const{start:vt=0,end:bt=xt.length,size:Tt=2}=yt,Et=(bt-vt)/Tt,wt=Math.floor(Et/2);for(let St=0;St<wt;++St){const At=vt+St*Tt,Rt=vt+(Et-1-St)*Tt;for(let Pt=0;Pt<Tt;++Pt){const Ct=xt[At+Pt];xt[At+Pt]=xt[Rt+Pt],xt[Rt+Pt]=Ct}}}function push(xt,yt){const vt=yt.length,bt=xt.length;if(bt>0){let Tt=!0;for(let Et=0;Et<vt;Et++)if(xt[bt-vt+Et]!==yt[Et]){Tt=!1;break}if(Tt)return!1}for(let Tt=0;Tt<vt;Tt++)xt[bt+Tt]=yt[Tt];return!0}function copy(xt,yt){const vt=yt.length;for(let bt=0;bt<vt;bt++)xt[bt]=yt[bt]}function getPointAtIndex(xt,yt,vt,bt,Tt=[]){const Et=bt+yt*vt;for(let wt=0;wt<vt;wt++)Tt[wt]=xt[Et+wt];return Tt}function intersect(xt,yt,vt,bt,Tt=[]){let Et,wt;if(vt&8)Et=(bt[3]-xt[1])/(yt[1]-xt[1]),wt=3;else if(vt&4)Et=(bt[1]-xt[1])/(yt[1]-xt[1]),wt=1;else if(vt&2)Et=(bt[2]-xt[0])/(yt[0]-xt[0]),wt=2;else if(vt&1)Et=(bt[0]-xt[0])/(yt[0]-xt[0]),wt=0;else return null;for(let St=0;St<xt.length;St++)Tt[St]=(wt&1)===St?bt[wt]:Et*(yt[St]-xt[St])+xt[St];return Tt}function bitCode(xt,yt){let vt=0;return xt[0]<yt[0]?vt|=1:xt[0]>yt[2]&&(vt|=2),xt[1]<yt[1]?vt|=4:xt[1]>yt[3]&&(vt|=8),vt}function cutPolylineByGrid(xt,yt){const{size:vt=2,broken:bt=!1,gridResolution:Tt=10,gridOffset:Et=[0,0],startIndex:wt=0,endIndex:St=xt.length}=yt||{},At=(St-wt)/vt;let Rt=[];const Pt=[Rt],Ct=getPointAtIndex(xt,0,vt,wt);let It,Mt;const Ot=getGridCell(Ct,Tt,Et,[]),kt=[];push(Rt,Ct);for(let Ft=1;Ft<At;Ft++){for(It=getPointAtIndex(xt,Ft,vt,wt,It),Mt=bitCode(It,Ot);Mt;){intersect(Ct,It,Mt,Ot,kt);const Nt=bitCode(kt,Ot);Nt&&(intersect(Ct,kt,Nt,Ot,kt),Mt=Nt),push(Rt,kt),copy(Ct,kt),moveToNeighborCell(Ot,Tt,Mt),bt&&Rt.length>vt&&(Rt=[],Pt.push(Rt),push(Rt,Ct)),Mt=bitCode(It,Ot)}push(Rt,It),copy(Ct,It)}return bt?Pt:Pt[0]}const TYPE_INSIDE=0,TYPE_BORDER=1;function cutPolygonByGrid(xt,yt=null,vt){if(!xt.length)return[];const{size:bt=2,gridResolution:Tt=10,gridOffset:Et=[0,0],edgeTypes:wt=!1}=vt||{},St=[],At=[{pos:xt,types:wt?new Array(xt.length/bt).fill(TYPE_BORDER):null,holes:yt||[]}],Rt=[[],[]];let Pt=[];for(;At.length;){const{pos:Ct,types:It,holes:Mt}=At.shift();getBoundingBox(Ct,bt,Mt[0]||Ct.length,Rt),Pt=getGridCell(Rt[0],Tt,Et,Pt);const Ot=bitCode(Rt[1],Pt);if(Ot){let kt=bisectPolygon(Ct,It,bt,0,Mt[0]||Ct.length,Pt,Ot);const Ft={pos:kt[0].pos,types:kt[0].types,holes:[]},Nt={pos:kt[1].pos,types:kt[1].types,holes:[]};At.push(Ft,Nt);for(let Lt=0;Lt<Mt.length;Lt++)kt=bisectPolygon(Ct,It,bt,Mt[Lt],Mt[Lt+1]||Ct.length,Pt,Ot),kt[0]&&(Ft.holes.push(Ft.pos.length),Ft.pos=concatInPlace(Ft.pos,kt[0].pos),wt&&(Ft.types=concatInPlace(Ft.types,kt[0].types))),kt[1]&&(Nt.holes.push(Nt.pos.length),Nt.pos=concatInPlace(Nt.pos,kt[1].pos),wt&&(Nt.types=concatInPlace(Nt.types,kt[1].types)))}else{const kt={positions:Ct};wt&&(kt.edgeTypes=It),Mt.length&&(kt.holeIndices=Mt),St.push(kt)}}return St}function bisectPolygon(xt,yt,vt,bt,Tt,Et,wt){const St=(Tt-bt)/vt,At=[],Rt=[],Pt=[],Ct=[],It=[];let Mt,Ot,kt;const Ft=getPointAtIndex(xt,St-1,vt,bt);let Nt=Math.sign(wt&8?Ft[1]-Et[3]:Ft[0]-Et[2]),Lt=yt&&yt[St-1],Dt=0,$t=0;for(let zt=0;zt<St;zt++)Mt=getPointAtIndex(xt,zt,vt,bt,Mt),Ot=Math.sign(wt&8?Mt[1]-Et[3]:Mt[0]-Et[2]),kt=yt&&yt[bt/vt+zt],Ot&&Nt&&Nt!==Ot&&(intersect(Ft,Mt,wt,Et,It),push(At,It)&&Pt.push(Lt),push(Rt,It)&&Ct.push(Lt)),Ot<=0?(push(At,Mt)&&Pt.push(kt),Dt-=Ot):Pt.length&&(Pt[Pt.length-1]=TYPE_INSIDE),Ot>=0?(push(Rt,Mt)&&Ct.push(kt),$t+=Ot):Ct.length&&(Ct[Ct.length-1]=TYPE_INSIDE),copy(Ft,Mt),Nt=Ot,Lt=kt;return[Dt?{pos:At,types:yt&&Pt}:null,$t?{pos:Rt,types:yt&&Ct}:null]}function getGridCell(xt,yt,vt,bt){const Tt=Math.floor((xt[0]-vt[0])/yt)*yt+vt[0],Et=Math.floor((xt[1]-vt[1])/yt)*yt+vt[1];return bt[0]=Tt,bt[1]=Et,bt[2]=Tt+yt,bt[3]=Et+yt,bt}function moveToNeighborCell(xt,yt,vt){vt&8?(xt[1]+=yt,xt[3]+=yt):vt&4?(xt[1]-=yt,xt[3]-=yt):vt&2?(xt[0]+=yt,xt[2]+=yt):vt&1&&(xt[0]-=yt,xt[2]-=yt)}function getBoundingBox(xt,yt,vt,bt){let Tt=1/0,Et=-1/0,wt=1/0,St=-1/0;for(let At=0;At<vt;At+=yt){const Rt=xt[At],Pt=xt[At+1];Tt=Rt<Tt?Rt:Tt,Et=Rt>Et?Rt:Et,wt=Pt<wt?Pt:wt,St=Pt>St?Pt:St}return bt[0][0]=Tt,bt[0][1]=wt,bt[1][0]=Et,bt[1][1]=St,bt}function concatInPlace(xt,yt){for(let vt=0;vt<yt.length;vt++)xt.push(yt[vt]);return xt}const DEFAULT_MAX_LATITUDE=85.051129;function cutPolylineByMercatorBounds(xt,yt){const{size:vt=2,startIndex:bt=0,endIndex:Tt=xt.length,normalize:Et=!0}=yt||{},wt=xt.slice(bt,Tt);wrapLongitudesForShortestPath(wt,vt,0,Tt-bt);const St=cutPolylineByGrid(wt,{size:vt,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(Et)for(const At of St)shiftLongitudesIntoRange(At,vt);return St}function cutPolygonByMercatorBounds(xt,yt=null,vt){const{size:bt=2,normalize:Tt=!0,edgeTypes:Et=!1}=vt||{};yt=yt||[];const wt=[],St=[];let At=0,Rt=0;for(let Ct=0;Ct<=yt.length;Ct++){const It=yt[Ct]||xt.length,Mt=Rt,Ot=findSplitIndex(xt,bt,At,It);for(let kt=Ot;kt<It;kt++)wt[Rt++]=xt[kt];for(let kt=At;kt<Ot;kt++)wt[Rt++]=xt[kt];wrapLongitudesForShortestPath(wt,bt,Mt,Rt),insertPoleVertices(wt,bt,Mt,Rt,vt==null?void 0:vt.maxLatitude),At=It,St[Ct]=Rt}St.pop();const Pt=cutPolygonByGrid(wt,St,{size:bt,gridResolution:360,gridOffset:[-180,-180],edgeTypes:Et});if(Tt)for(const Ct of Pt)shiftLongitudesIntoRange(Ct.positions,bt);return Pt}function findSplitIndex(xt,yt,vt,bt){let Tt=-1,Et=-1;for(let wt=vt+1;wt<bt;wt+=yt){const St=Math.abs(xt[wt]);St>Tt&&(Tt=St,Et=wt-1)}return Et}function insertPoleVertices(xt,yt,vt,bt,Tt=DEFAULT_MAX_LATITUDE){const Et=xt[vt],wt=xt[bt-yt];if(Math.abs(Et-wt)>180){const St=getPointAtIndex(xt,0,yt,vt);St[0]+=Math.round((wt-Et)/360)*360,push(xt,St),St[1]=Math.sign(St[1])*Tt,push(xt,St),St[0]=Et,push(xt,St)}}function wrapLongitudesForShortestPath(xt,yt,vt,bt){let Tt=xt[0],Et;for(let wt=vt;wt<bt;wt+=yt){Et=xt[wt];const St=Et-Tt;(St>180||St<-180)&&(Et-=Math.round(St/360)*360),xt[wt]=Tt=Et}}function shiftLongitudesIntoRange(xt,yt){let vt;const bt=xt.length/yt;for(let Et=0;Et<bt&&(vt=xt[Et*yt],(vt+180)%360===0);Et++);const Tt=-Math.round(vt/360)*360;if(Tt!==0)for(let Et=0;Et<bt;Et++)xt[Et*yt]+=Tt}function normalizePath(xt,yt,vt,bt){let Tt;if(Array.isArray(xt[0])){const Et=xt.length*yt;Tt=new Array(Et);for(let wt=0;wt<xt.length;wt++)for(let St=0;St<yt;St++)Tt[wt*yt+St]=xt[wt][St]||0}else Tt=xt;return vt?cutPolylineByGrid(Tt,{size:yt,gridResolution:vt}):bt?cutPolylineByMercatorBounds(Tt,{size:yt}):Tt}const START_CAP=1,END_CAP=2,INVALID=4;class PathTesselator extends Tesselator{constructor(yt){super({...yt,attributes:{positions:{size:3,padding:18,initialize:!0,type:yt.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(yt){return this.attributes[yt]}getGeometryFromBuffer(yt){return this.normalize?super.getGeometryFromBuffer(yt):null}normalizeGeometry(yt){return this.normalize?normalizePath(yt,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):yt}getGeometrySize(yt){if(isCut$1(yt)){let bt=0;for(const Tt of yt)bt+=this.getGeometrySize(Tt);return bt}const vt=this.getPathLength(yt);return vt<2?0:this.isClosed(yt)?vt<3?0:vt+2:vt}updateGeometryAttributes(yt,vt){if(vt.geometrySize!==0)if(yt&&isCut$1(yt))for(const bt of yt){const Tt=this.getGeometrySize(bt);vt.geometrySize=Tt,this.updateGeometryAttributes(bt,vt),vt.vertexStart+=Tt}else this._updateSegmentTypes(yt,vt),this._updatePositions(yt,vt)}_updateSegmentTypes(yt,vt){const bt=this.attributes.segmentTypes,Tt=yt?this.isClosed(yt):!1,{vertexStart:Et,geometrySize:wt}=vt;bt.fill(0,Et,Et+wt),Tt?(bt[Et]=INVALID,bt[Et+wt-2]=INVALID):(bt[Et]+=START_CAP,bt[Et+wt-2]+=END_CAP),bt[Et+wt-1]=INVALID}_updatePositions(yt,vt){const{positions:bt}=this.attributes;if(!bt||!yt)return;const{vertexStart:Tt,geometrySize:Et}=vt,wt=new Array(3);for(let St=Tt,At=0;At<Et;St++,At++)this.getPointOnPath(yt,At,wt),bt[St*3]=wt[0],bt[St*3+1]=wt[1],bt[St*3+2]=wt[2]}getPathLength(yt){return yt.length/this.positionSize}getPointOnPath(yt,vt,bt=[]){const{positionSize:Tt}=this;vt*Tt>=yt.length&&(vt+=1-yt.length/Tt);const Et=vt*Tt;return bt[0]=yt[Et],bt[1]=yt[Et+1],bt[2]=Tt===3&&yt[Et+2]||0,bt}isClosed(yt){if(!this.normalize)return!!this.opts.loop;const{positionSize:vt}=this,bt=yt.length-vt;return yt[0]===yt[bt]&&yt[1]===yt[bt+1]&&(vt===2||yt[2]===yt[bt+2])}}function isCut$1(xt){return Array.isArray(xt[0])}const uniformBlock$3=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,pathUniforms={name:"path",vs:uniformBlock$3,fs:uniformBlock$3,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},vs$1=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,fs$3=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,DEFAULT_COLOR$2=[0,0,0,255],defaultProps$5={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:xt=>xt.path},getColor:{type:"accessor",value:DEFAULT_COLOR$2},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},ATTRIBUTE_TRANSITION$1={enter:(xt,yt)=>yt.length?yt.subarray(yt.length-xt.length):xt};class PathLayer extends Layer{getShaders(){return super.getShaders({vs:vs$1,fs:fs$3,modules:[project32,picking,pathUniforms]})}get wrapLongitude(){return!1}getBounds(){var yt;return(yt=this.getAttributeManager())==null?void 0:yt.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:ATTRIBUTE_TRANSITION$1,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:ATTRIBUTE_TRANSITION$1,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:ATTRIBUTE_TRANSITION$1,defaultValue:DEFAULT_COLOR$2},instancePickingColors:{size:4,type:"uint8",accessor:(bt,{index:Tt,target:Et})=>this.encodePickingColor(bt&&bt.__source?bt.__source.index:Tt,Et)}}),this.setState({pathTesselator:new PathTesselator({fp64:this.use64bitPositions()})})}updateState(yt){var wt;super.updateState(yt);const{props:vt,changeFlags:bt}=yt,Tt=this.getAttributeManager();if(bt.dataChanged||bt.updateTriggersChanged&&(bt.updateTriggersChanged.all||bt.updateTriggersChanged.getPath)){const{pathTesselator:St}=this.state,At=vt.data.attributes||{};St.updateGeometry({data:vt.data,geometryBuffer:At.getPath,buffers:At,normalize:!vt._pathType,loop:vt._pathType==="loop",getGeometry:vt.getPath,positionFormat:vt.positionFormat,wrapLongitude:vt.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:bt.dataChanged}),this.setState({numInstances:St.instanceCount,startIndices:St.vertexStarts}),bt.dataChanged||Tt.invalidateAll()}bt.extensionsChanged&&((wt=this.state.model)==null||wt.destroy(),this.state.model=this._getModel(),Tt.invalidateAll())}getPickingInfo(yt){const vt=super.getPickingInfo(yt),{index:bt}=vt,Tt=this.props.data;return Tt[0]&&Tt[0].__source&&(vt.object=Tt.find(Et=>Et.__source.index===bt)),vt}disablePickingIndex(yt){const vt=this.props.data;if(vt[0]&&vt[0].__source)for(let bt=0;bt<vt.length;bt++)vt[bt].__source.index===yt&&this._disablePickingIndex(bt);else super.disablePickingIndex(yt)}draw({uniforms:yt}){const{jointRounded:vt,capRounded:bt,billboard:Tt,miterLimit:Et,widthUnits:wt,widthScale:St,widthMinPixels:At,widthMaxPixels:Rt}=this.props,Pt=this.state.model,Ct={jointType:Number(vt),capType:Number(bt),billboard:Tt,widthUnits:UNIT[wt],widthScale:St,miterLimit:Et,widthMinPixels:At,widthMaxPixels:Rt};Pt.shaderInputs.setProps({path:Ct}),Pt.draw(this.context.renderPass)}_getModel(){const yt=[0,1,2,1,4,2,1,3,4,3,5,4],vt=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Model(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Geometry({topology:"triangle-list",attributes:{indices:new Uint16Array(yt),positions:{value:new Float32Array(vt),size:2}}}),isInstanced:!0})}calculatePositions(yt){const{pathTesselator:vt}=this.state;yt.startIndices=vt.vertexStarts,yt.value=vt.get("positions")}calculateSegmentTypes(yt){const{pathTesselator:vt}=this.state;yt.startIndices=vt.vertexStarts,yt.value=vt.get("segmentTypes")}}PathLayer.defaultProps=defaultProps$5;PathLayer.layerName="PathLayer";var earcut$2={exports:{}};earcut$2.exports=earcut;earcut$2.exports.default=earcut;function earcut(xt,yt,vt){vt=vt||2;var bt=yt&&yt.length,Tt=bt?yt[0]*vt:xt.length,Et=linkedList(xt,0,Tt,vt,!0),wt=[];if(!Et||Et.next===Et.prev)return wt;var St,At,Rt,Pt,Ct,It,Mt;if(bt&&(Et=eliminateHoles(xt,yt,Et,vt)),xt.length>80*vt){St=Rt=xt[0],At=Pt=xt[1];for(var Ot=vt;Ot<Tt;Ot+=vt)Ct=xt[Ot],It=xt[Ot+1],Ct<St&&(St=Ct),It<At&&(At=It),Ct>Rt&&(Rt=Ct),It>Pt&&(Pt=It);Mt=Math.max(Rt-St,Pt-At),Mt=Mt!==0?32767/Mt:0}return earcutLinked(Et,wt,vt,St,At,Mt,0),wt}function linkedList(xt,yt,vt,bt,Tt){var Et,wt;if(Tt===signedArea(xt,yt,vt,bt)>0)for(Et=yt;Et<vt;Et+=bt)wt=insertNode(Et,xt[Et],xt[Et+1],wt);else for(Et=vt-bt;Et>=yt;Et-=bt)wt=insertNode(Et,xt[Et],xt[Et+1],wt);return wt&&equals(wt,wt.next)&&(removeNode(wt),wt=wt.next),wt}function filterPoints(xt,yt){if(!xt)return xt;yt||(yt=xt);var vt=xt,bt;do if(bt=!1,!vt.steiner&&(equals(vt,vt.next)||area(vt.prev,vt,vt.next)===0)){if(removeNode(vt),vt=yt=vt.prev,vt===vt.next)break;bt=!0}else vt=vt.next;while(bt||vt!==yt);return yt}function earcutLinked(xt,yt,vt,bt,Tt,Et,wt){if(xt){!wt&&Et&&indexCurve(xt,bt,Tt,Et);for(var St=xt,At,Rt;xt.prev!==xt.next;){if(At=xt.prev,Rt=xt.next,Et?isEarHashed(xt,bt,Tt,Et):isEar(xt)){yt.push(At.i/vt|0),yt.push(xt.i/vt|0),yt.push(Rt.i/vt|0),removeNode(xt),xt=Rt.next,St=Rt.next;continue}if(xt=Rt,xt===St){wt?wt===1?(xt=cureLocalIntersections(filterPoints(xt),yt,vt),earcutLinked(xt,yt,vt,bt,Tt,Et,2)):wt===2&&splitEarcut(xt,yt,vt,bt,Tt,Et):earcutLinked(filterPoints(xt),yt,vt,bt,Tt,Et,1);break}}}}function isEar(xt){var yt=xt.prev,vt=xt,bt=xt.next;if(area(yt,vt,bt)>=0)return!1;for(var Tt=yt.x,Et=vt.x,wt=bt.x,St=yt.y,At=vt.y,Rt=bt.y,Pt=Tt<Et?Tt<wt?Tt:wt:Et<wt?Et:wt,Ct=St<At?St<Rt?St:Rt:At<Rt?At:Rt,It=Tt>Et?Tt>wt?Tt:wt:Et>wt?Et:wt,Mt=St>At?St>Rt?St:Rt:At>Rt?At:Rt,Ot=bt.next;Ot!==yt;){if(Ot.x>=Pt&&Ot.x<=It&&Ot.y>=Ct&&Ot.y<=Mt&&pointInTriangle(Tt,St,Et,At,wt,Rt,Ot.x,Ot.y)&&area(Ot.prev,Ot,Ot.next)>=0)return!1;Ot=Ot.next}return!0}function isEarHashed(xt,yt,vt,bt){var Tt=xt.prev,Et=xt,wt=xt.next;if(area(Tt,Et,wt)>=0)return!1;for(var St=Tt.x,At=Et.x,Rt=wt.x,Pt=Tt.y,Ct=Et.y,It=wt.y,Mt=St<At?St<Rt?St:Rt:At<Rt?At:Rt,Ot=Pt<Ct?Pt<It?Pt:It:Ct<It?Ct:It,kt=St>At?St>Rt?St:Rt:At>Rt?At:Rt,Ft=Pt>Ct?Pt>It?Pt:It:Ct>It?Ct:It,Nt=zOrder(Mt,Ot,yt,vt,bt),Lt=zOrder(kt,Ft,yt,vt,bt),Dt=xt.prevZ,$t=xt.nextZ;Dt&&Dt.z>=Nt&&$t&&$t.z<=Lt;){if(Dt.x>=Mt&&Dt.x<=kt&&Dt.y>=Ot&&Dt.y<=Ft&&Dt!==Tt&&Dt!==wt&&pointInTriangle(St,Pt,At,Ct,Rt,It,Dt.x,Dt.y)&&area(Dt.prev,Dt,Dt.next)>=0||(Dt=Dt.prevZ,$t.x>=Mt&&$t.x<=kt&&$t.y>=Ot&&$t.y<=Ft&&$t!==Tt&&$t!==wt&&pointInTriangle(St,Pt,At,Ct,Rt,It,$t.x,$t.y)&&area($t.prev,$t,$t.next)>=0))return!1;$t=$t.nextZ}for(;Dt&&Dt.z>=Nt;){if(Dt.x>=Mt&&Dt.x<=kt&&Dt.y>=Ot&&Dt.y<=Ft&&Dt!==Tt&&Dt!==wt&&pointInTriangle(St,Pt,At,Ct,Rt,It,Dt.x,Dt.y)&&area(Dt.prev,Dt,Dt.next)>=0)return!1;Dt=Dt.prevZ}for(;$t&&$t.z<=Lt;){if($t.x>=Mt&&$t.x<=kt&&$t.y>=Ot&&$t.y<=Ft&&$t!==Tt&&$t!==wt&&pointInTriangle(St,Pt,At,Ct,Rt,It,$t.x,$t.y)&&area($t.prev,$t,$t.next)>=0)return!1;$t=$t.nextZ}return!0}function cureLocalIntersections(xt,yt,vt){var bt=xt;do{var Tt=bt.prev,Et=bt.next.next;!equals(Tt,Et)&&intersects(Tt,bt,bt.next,Et)&&locallyInside(Tt,Et)&&locallyInside(Et,Tt)&&(yt.push(Tt.i/vt|0),yt.push(bt.i/vt|0),yt.push(Et.i/vt|0),removeNode(bt),removeNode(bt.next),bt=xt=Et),bt=bt.next}while(bt!==xt);return filterPoints(bt)}function splitEarcut(xt,yt,vt,bt,Tt,Et){var wt=xt;do{for(var St=wt.next.next;St!==wt.prev;){if(wt.i!==St.i&&isValidDiagonal(wt,St)){var At=splitPolygon(wt,St);wt=filterPoints(wt,wt.next),At=filterPoints(At,At.next),earcutLinked(wt,yt,vt,bt,Tt,Et,0),earcutLinked(At,yt,vt,bt,Tt,Et,0);return}St=St.next}wt=wt.next}while(wt!==xt)}function eliminateHoles(xt,yt,vt,bt){var Tt=[],Et,wt,St,At,Rt;for(Et=0,wt=yt.length;Et<wt;Et++)St=yt[Et]*bt,At=Et<wt-1?yt[Et+1]*bt:xt.length,Rt=linkedList(xt,St,At,bt,!1),Rt===Rt.next&&(Rt.steiner=!0),Tt.push(getLeftmost(Rt));for(Tt.sort(compareX),Et=0;Et<Tt.length;Et++)vt=eliminateHole(Tt[Et],vt);return vt}function compareX(xt,yt){return xt.x-yt.x}function eliminateHole(xt,yt){var vt=findHoleBridge(xt,yt);if(!vt)return yt;var bt=splitPolygon(vt,xt);return filterPoints(bt,bt.next),filterPoints(vt,vt.next)}function findHoleBridge(xt,yt){var vt=yt,bt=xt.x,Tt=xt.y,Et=-1/0,wt;do{if(Tt<=vt.y&&Tt>=vt.next.y&&vt.next.y!==vt.y){var St=vt.x+(Tt-vt.y)*(vt.next.x-vt.x)/(vt.next.y-vt.y);if(St<=bt&&St>Et&&(Et=St,wt=vt.x<vt.next.x?vt:vt.next,St===bt))return wt}vt=vt.next}while(vt!==yt);if(!wt)return null;var At=wt,Rt=wt.x,Pt=wt.y,Ct=1/0,It;vt=wt;do bt>=vt.x&&vt.x>=Rt&&bt!==vt.x&&pointInTriangle(Tt<Pt?bt:Et,Tt,Rt,Pt,Tt<Pt?Et:bt,Tt,vt.x,vt.y)&&(It=Math.abs(Tt-vt.y)/(bt-vt.x),locallyInside(vt,xt)&&(It<Ct||It===Ct&&(vt.x>wt.x||vt.x===wt.x&&sectorContainsSector(wt,vt)))&&(wt=vt,Ct=It)),vt=vt.next;while(vt!==At);return wt}function sectorContainsSector(xt,yt){return area(xt.prev,xt,yt.prev)<0&&area(yt.next,xt,xt.next)<0}function indexCurve(xt,yt,vt,bt){var Tt=xt;do Tt.z===0&&(Tt.z=zOrder(Tt.x,Tt.y,yt,vt,bt)),Tt.prevZ=Tt.prev,Tt.nextZ=Tt.next,Tt=Tt.next;while(Tt!==xt);Tt.prevZ.nextZ=null,Tt.prevZ=null,sortLinked(Tt)}function sortLinked(xt){var yt,vt,bt,Tt,Et,wt,St,At,Rt=1;do{for(vt=xt,xt=null,Et=null,wt=0;vt;){for(wt++,bt=vt,St=0,yt=0;yt<Rt&&(St++,bt=bt.nextZ,!!bt);yt++);for(At=Rt;St>0||At>0&&bt;)St!==0&&(At===0||!bt||vt.z<=bt.z)?(Tt=vt,vt=vt.nextZ,St--):(Tt=bt,bt=bt.nextZ,At--),Et?Et.nextZ=Tt:xt=Tt,Tt.prevZ=Et,Et=Tt;vt=bt}Et.nextZ=null,Rt*=2}while(wt>1);return xt}function zOrder(xt,yt,vt,bt,Tt){return xt=(xt-vt)*Tt|0,yt=(yt-bt)*Tt|0,xt=(xt|xt<<8)&16711935,xt=(xt|xt<<4)&252645135,xt=(xt|xt<<2)&858993459,xt=(xt|xt<<1)&1431655765,yt=(yt|yt<<8)&16711935,yt=(yt|yt<<4)&252645135,yt=(yt|yt<<2)&858993459,yt=(yt|yt<<1)&1431655765,xt|yt<<1}function getLeftmost(xt){var yt=xt,vt=xt;do(yt.x<vt.x||yt.x===vt.x&&yt.y<vt.y)&&(vt=yt),yt=yt.next;while(yt!==xt);return vt}function pointInTriangle(xt,yt,vt,bt,Tt,Et,wt,St){return(Tt-wt)*(yt-St)>=(xt-wt)*(Et-St)&&(xt-wt)*(bt-St)>=(vt-wt)*(yt-St)&&(vt-wt)*(Et-St)>=(Tt-wt)*(bt-St)}function isValidDiagonal(xt,yt){return xt.next.i!==yt.i&&xt.prev.i!==yt.i&&!intersectsPolygon(xt,yt)&&(locallyInside(xt,yt)&&locallyInside(yt,xt)&&middleInside(xt,yt)&&(area(xt.prev,xt,yt.prev)||area(xt,yt.prev,yt))||equals(xt,yt)&&area(xt.prev,xt,xt.next)>0&&area(yt.prev,yt,yt.next)>0)}function area(xt,yt,vt){return(yt.y-xt.y)*(vt.x-yt.x)-(yt.x-xt.x)*(vt.y-yt.y)}function equals(xt,yt){return xt.x===yt.x&&xt.y===yt.y}function intersects(xt,yt,vt,bt){var Tt=sign(area(xt,yt,vt)),Et=sign(area(xt,yt,bt)),wt=sign(area(vt,bt,xt)),St=sign(area(vt,bt,yt));return!!(Tt!==Et&&wt!==St||Tt===0&&onSegment(xt,vt,yt)||Et===0&&onSegment(xt,bt,yt)||wt===0&&onSegment(vt,xt,bt)||St===0&&onSegment(vt,yt,bt))}function onSegment(xt,yt,vt){return yt.x<=Math.max(xt.x,vt.x)&&yt.x>=Math.min(xt.x,vt.x)&&yt.y<=Math.max(xt.y,vt.y)&&yt.y>=Math.min(xt.y,vt.y)}function sign(xt){return xt>0?1:xt<0?-1:0}function intersectsPolygon(xt,yt){var vt=xt;do{if(vt.i!==xt.i&&vt.next.i!==xt.i&&vt.i!==yt.i&&vt.next.i!==yt.i&&intersects(vt,vt.next,xt,yt))return!0;vt=vt.next}while(vt!==xt);return!1}function locallyInside(xt,yt){return area(xt.prev,xt,xt.next)<0?area(xt,yt,xt.next)>=0&&area(xt,xt.prev,yt)>=0:area(xt,yt,xt.prev)<0||area(xt,xt.next,yt)<0}function middleInside(xt,yt){var vt=xt,bt=!1,Tt=(xt.x+yt.x)/2,Et=(xt.y+yt.y)/2;do vt.y>Et!=vt.next.y>Et&&vt.next.y!==vt.y&&Tt<(vt.next.x-vt.x)*(Et-vt.y)/(vt.next.y-vt.y)+vt.x&&(bt=!bt),vt=vt.next;while(vt!==xt);return bt}function splitPolygon(xt,yt){var vt=new Node(xt.i,xt.x,xt.y),bt=new Node(yt.i,yt.x,yt.y),Tt=xt.next,Et=yt.prev;return xt.next=yt,yt.prev=xt,vt.next=Tt,Tt.prev=vt,bt.next=vt,vt.prev=bt,Et.next=bt,bt.prev=Et,bt}function insertNode(xt,yt,vt,bt){var Tt=new Node(xt,yt,vt);return bt?(Tt.next=bt.next,Tt.prev=bt,bt.next.prev=Tt,bt.next=Tt):(Tt.prev=Tt,Tt.next=Tt),Tt}function removeNode(xt){xt.next.prev=xt.prev,xt.prev.next=xt.next,xt.prevZ&&(xt.prevZ.nextZ=xt.nextZ),xt.nextZ&&(xt.nextZ.prevZ=xt.prevZ)}function Node(xt,yt,vt){this.i=xt,this.x=yt,this.y=vt,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}earcut.deviation=function(xt,yt,vt,bt){var Tt=yt&&yt.length,Et=Tt?yt[0]*vt:xt.length,wt=Math.abs(signedArea(xt,0,Et,vt));if(Tt)for(var St=0,At=yt.length;St<At;St++){var Rt=yt[St]*vt,Pt=St<At-1?yt[St+1]*vt:xt.length;wt-=Math.abs(signedArea(xt,Rt,Pt,vt))}var Ct=0;for(St=0;St<bt.length;St+=3){var It=bt[St]*vt,Mt=bt[St+1]*vt,Ot=bt[St+2]*vt;Ct+=Math.abs((xt[It]-xt[Ot])*(xt[Mt+1]-xt[It+1])-(xt[It]-xt[Mt])*(xt[Ot+1]-xt[It+1]))}return wt===0&&Ct===0?0:Math.abs((Ct-wt)/wt)};function signedArea(xt,yt,vt,bt){for(var Tt=0,Et=yt,wt=vt-bt;Et<vt;Et+=bt)Tt+=(xt[wt]-xt[Et])*(xt[Et+1]+xt[wt+1]),wt=Et;return Tt}earcut.flatten=function(xt){for(var yt=xt[0][0].length,vt={vertices:[],holes:[],dimensions:yt},bt=0,Tt=0;Tt<xt.length;Tt++){for(var Et=0;Et<xt[Tt].length;Et++)for(var wt=0;wt<yt;wt++)vt.vertices.push(xt[Tt][Et][wt]);Tt>0&&(bt+=xt[Tt-1].length,vt.holes.push(bt))}return vt};var earcutExports=earcut$2.exports;const earcut$1=getDefaultExportFromCjs(earcutExports),OUTER_POLYGON_WINDING=WINDING.CLOCKWISE,HOLE_POLYGON_WINDING=WINDING.COUNTER_CLOCKWISE,windingOptions={};function validate(xt){if(xt=xt&&xt.positions||xt,!Array.isArray(xt)&&!ArrayBuffer.isView(xt))throw new Error("invalid polygon")}function getPositions(xt){return"positions"in xt?xt.positions:xt}function getHoleIndices(xt){return"holeIndices"in xt?xt.holeIndices:null}function isNested(xt){return Array.isArray(xt[0])}function isSimple(xt){return xt.length>=1&&xt[0].length>=2&&Number.isFinite(xt[0][0])}function isNestedRingClosed(xt){const yt=xt[0],vt=xt[xt.length-1];return yt[0]===vt[0]&&yt[1]===vt[1]&&yt[2]===vt[2]}function isFlatRingClosed(xt,yt,vt,bt){for(let Tt=0;Tt<yt;Tt++)if(xt[vt+Tt]!==xt[bt-yt+Tt])return!1;return!0}function copyNestedRing(xt,yt,vt,bt,Tt){let Et=yt;const wt=vt.length;for(let St=0;St<wt;St++)for(let At=0;At<bt;At++)xt[Et++]=vt[St][At]||0;if(!isNestedRingClosed(vt))for(let St=0;St<bt;St++)xt[Et++]=vt[0][St]||0;return windingOptions.start=yt,windingOptions.end=Et,windingOptions.size=bt,modifyPolygonWindingDirection(xt,Tt,windingOptions),Et}function copyFlatRing(xt,yt,vt,bt,Tt=0,Et,wt){Et=Et||vt.length;const St=Et-Tt;if(St<=0)return yt;let At=yt;for(let Rt=0;Rt<St;Rt++)xt[At++]=vt[Tt+Rt];if(!isFlatRingClosed(vt,bt,Tt,Et))for(let Rt=0;Rt<bt;Rt++)xt[At++]=vt[Tt+Rt];return windingOptions.start=yt,windingOptions.end=At,windingOptions.size=bt,modifyPolygonWindingDirection(xt,wt,windingOptions),At}function normalize(xt,yt){validate(xt);const vt=[],bt=[];if("positions"in xt){const{positions:Tt,holeIndices:Et}=xt;if(Et){let wt=0;for(let St=0;St<=Et.length;St++)wt=copyFlatRing(vt,wt,Tt,yt,Et[St-1],Et[St],St===0?OUTER_POLYGON_WINDING:HOLE_POLYGON_WINDING),bt.push(wt);return bt.pop(),{positions:vt,holeIndices:bt}}xt=Tt}if(!isNested(xt))return copyFlatRing(vt,0,xt,yt,0,vt.length,OUTER_POLYGON_WINDING),vt;if(!isSimple(xt)){let Tt=0;for(const[Et,wt]of xt.entries())Tt=copyNestedRing(vt,Tt,wt,yt,Et===0?OUTER_POLYGON_WINDING:HOLE_POLYGON_WINDING),bt.push(Tt);return bt.pop(),{positions:vt,holeIndices:bt}}return copyNestedRing(vt,0,xt,yt,OUTER_POLYGON_WINDING),vt}function getPlaneArea(xt,yt,vt){const bt=xt.length/3;let Tt=0;for(let Et=0;Et<bt;Et++){const wt=(Et+1)%bt;Tt+=xt[Et*3+yt]*xt[wt*3+vt],Tt-=xt[wt*3+yt]*xt[Et*3+vt]}return Math.abs(Tt/2)}function permutePositions(xt,yt,vt,bt){const Tt=xt.length/3;for(let Et=0;Et<Tt;Et++){const wt=Et*3,St=xt[wt+0],At=xt[wt+1],Rt=xt[wt+2];xt[wt+yt]=St,xt[wt+vt]=At,xt[wt+bt]=Rt}}function getSurfaceIndices(xt,yt,vt,bt){let Tt=getHoleIndices(xt);Tt&&(Tt=Tt.map(St=>St/yt));let Et=getPositions(xt);const wt=bt&&yt===3;if(vt){const St=Et.length;Et=Et.slice();const At=[];for(let Rt=0;Rt<St;Rt+=yt){At[0]=Et[Rt],At[1]=Et[Rt+1],wt&&(At[2]=Et[Rt+2]);const Pt=vt(At);Et[Rt]=Pt[0],Et[Rt+1]=Pt[1],wt&&(Et[Rt+2]=Pt[2])}}if(wt){const St=getPlaneArea(Et,0,1),At=getPlaneArea(Et,0,2),Rt=getPlaneArea(Et,1,2);if(!St&&!At&&!Rt)return[];St>At&&St>Rt||(At>Rt?(vt||(Et=Et.slice()),permutePositions(Et,0,2,1)):(vt||(Et=Et.slice()),permutePositions(Et,2,0,1)))}return earcut$1(Et,Tt,yt)}class PolygonTesselator extends Tesselator{constructor(yt){const{fp64:vt,IndexType:bt=Uint32Array}=yt;super({...yt,attributes:{positions:{size:3,type:vt?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:bt,size:1}}})}get(yt){const{attributes:vt}=this;return yt==="indices"?vt.indices&&vt.indices.subarray(0,this.vertexCount):vt[yt]}updateGeometry(yt){super.updateGeometry(yt);const vt=this.buffers.indices;if(vt)this.vertexCount=(vt.value||vt).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(yt){if(this.normalize){const vt=normalize(yt,this.positionSize);return this.opts.resolution?cutPolygonByGrid(getPositions(vt),getHoleIndices(vt),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?cutPolygonByMercatorBounds(getPositions(vt),getHoleIndices(vt),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):vt}return yt}getGeometrySize(yt){if(isCut(yt)){let vt=0;for(const bt of yt)vt+=this.getGeometrySize(bt);return vt}return getPositions(yt).length/this.positionSize}getGeometryFromBuffer(yt){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(yt):null}updateGeometryAttributes(yt,vt){if(yt&&isCut(yt))for(const bt of yt){const Tt=this.getGeometrySize(bt);vt.geometrySize=Tt,this.updateGeometryAttributes(bt,vt),vt.vertexStart+=Tt,vt.indexStart=this.indexStarts[vt.geometryIndex+1]}else{const bt=yt;this._updateIndices(bt,vt),this._updatePositions(bt,vt),this._updateVertexValid(bt,vt)}}_updateIndices(yt,{geometryIndex:vt,vertexStart:bt,indexStart:Tt}){const{attributes:Et,indexStarts:wt,typedArrayManager:St}=this;let At=Et.indices;if(!At||!yt)return;let Rt=Tt;const Pt=getSurfaceIndices(yt,this.positionSize,this.opts.preproject,this.opts.full3d);At=St.allocate(At,Tt+Pt.length,{copy:!0});for(let Ct=0;Ct<Pt.length;Ct++)At[Rt++]=Pt[Ct]+bt;wt[vt+1]=Tt+Pt.length,Et.indices=At}_updatePositions(yt,{vertexStart:vt,geometrySize:bt}){const{attributes:{positions:Tt},positionSize:Et}=this;if(!Tt||!yt)return;const wt=getPositions(yt);for(let St=vt,At=0;At<bt;St++,At++){const Rt=wt[At*Et],Pt=wt[At*Et+1],Ct=Et>2?wt[At*Et+2]:0;Tt[St*3]=Rt,Tt[St*3+1]=Pt,Tt[St*3+2]=Ct}}_updateVertexValid(yt,{vertexStart:vt,geometrySize:bt}){const{positionSize:Tt}=this,Et=this.attributes.vertexValid,wt=yt&&getHoleIndices(yt);if(yt&&yt.edgeTypes?Et.set(yt.edgeTypes,vt):Et.fill(1,vt,vt+bt),wt)for(let St=0;St<wt.length;St++)Et[vt+wt[St]/Tt-1]=0;Et[vt+bt-1]=0}}function isCut(xt){return Array.isArray(xt)&&xt.length>0&&!Number.isFinite(xt[0])}const uniformBlock$2=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,solidPolygonUniforms={name:"solidPolygon",vs:uniformBlock$2,fs:uniformBlock$2,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},main=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,vsTop=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${main}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,vsSide=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${main}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,fs$2=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,DEFAULT_COLOR$1=[0,0,0,255],defaultProps$4={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:xt=>xt.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:DEFAULT_COLOR$1},getLineColor:{type:"accessor",value:DEFAULT_COLOR$1},material:!0},ATTRIBUTE_TRANSITION={enter:(xt,yt)=>yt.length?yt.subarray(yt.length-xt.length):xt};class SolidPolygonLayer extends Layer{getShaders(yt){return super.getShaders({vs:yt==="top"?vsTop:vsSide,fs:fs$2,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[project32,gouraudMaterial,picking,solidPolygonUniforms]})}get wrapLongitude(){return!1}getBounds(){var yt;return(yt=this.getAttributeManager())==null?void 0:yt.getBounds(["vertexPositions"])}initializeState(){const{viewport:yt}=this.context;let{coordinateSystem:vt}=this.props;const{_full3d:bt}=this.props;yt.isGeospatial&&vt===COORDINATE_SYSTEM.DEFAULT&&(vt=COORDINATE_SYSTEM.LNGLAT);let Tt;vt===COORDINATE_SYSTEM.LNGLAT&&(bt?Tt=yt.projectPosition.bind(yt):Tt=yt.projectFlat.bind(yt)),this.setState({numInstances:0,polygonTesselator:new PolygonTesselator({preproject:Tt,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const Et=this.getAttributeManager(),wt=!0;Et.remove(["instancePickingColors"]),Et.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:wt},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:ATTRIBUTE_TRANSITION,accessor:"getPolygon",update:this.calculatePositions,noAlloc:wt,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:wt},elevations:{size:1,stepMode:"dynamic",transition:ATTRIBUTE_TRANSITION,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:ATTRIBUTE_TRANSITION,accessor:"getFillColor",defaultValue:DEFAULT_COLOR$1},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:ATTRIBUTE_TRANSITION,accessor:"getLineColor",defaultValue:DEFAULT_COLOR$1},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(St,{index:At,target:Rt})=>this.encodePickingColor(St&&St.__source?St.__source.index:At,Rt)}})}getPickingInfo(yt){const vt=super.getPickingInfo(yt),{index:bt}=vt,Tt=this.props.data;return Tt[0]&&Tt[0].__source&&(vt.object=Tt.find(Et=>Et.__source.index===bt)),vt}disablePickingIndex(yt){const vt=this.props.data;if(vt[0]&&vt[0].__source)for(let bt=0;bt<vt.length;bt++)vt[bt].__source.index===yt&&this._disablePickingIndex(bt);else super.disablePickingIndex(yt)}draw({uniforms:yt}){const{extruded:vt,filled:bt,wireframe:Tt,elevationScale:Et}=this.props,{topModel:wt,sideModel:St,wireframeModel:At,polygonTesselator:Rt}=this.state,Pt={extruded:!!vt,elevationScale:Et,isWireframe:!1};At&&Tt&&(At.setInstanceCount(Rt.instanceCount-1),At.shaderInputs.setProps({solidPolygon:{...Pt,isWireframe:!0}}),At.draw(this.context.renderPass)),St&&bt&&(St.setInstanceCount(Rt.instanceCount-1),St.shaderInputs.setProps({solidPolygon:Pt}),St.draw(this.context.renderPass)),wt&&bt&&(wt.setVertexCount(Rt.vertexCount),wt.shaderInputs.setProps({solidPolygon:Pt}),wt.draw(this.context.renderPass))}updateState(yt){var St;super.updateState(yt),this.updateGeometry(yt);const{props:vt,oldProps:bt,changeFlags:Tt}=yt,Et=this.getAttributeManager();(Tt.extensionsChanged||vt.filled!==bt.filled||vt.extruded!==bt.extruded)&&((St=this.state.models)==null||St.forEach(At=>At.destroy()),this.setState(this._getModels()),Et.invalidateAll())}updateGeometry({props:yt,oldProps:vt,changeFlags:bt}){if(bt.dataChanged||bt.updateTriggersChanged&&(bt.updateTriggersChanged.all||bt.updateTriggersChanged.getPolygon)){const{polygonTesselator:Et}=this.state,wt=yt.data.attributes||{};Et.updateGeometry({data:yt.data,normalize:yt._normalize,geometryBuffer:wt.getPolygon,buffers:wt,getGeometry:yt.getPolygon,positionFormat:yt.positionFormat,wrapLongitude:yt.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:bt.dataChanged,full3d:yt._full3d}),this.setState({numInstances:Et.instanceCount,startIndices:Et.vertexStarts}),bt.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:yt,filled:vt,extruded:bt}=this.props;let Tt,Et,wt;if(vt){const St=this.getShaders("top");St.defines.NON_INSTANCED_MODEL=1;const At=this.getAttributeManager().getBufferLayouts({isInstanced:!1});Tt=new Model(this.context.device,{...St,id:`${yt}-top`,topology:"triangle-list",bufferLayout:At,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(bt){const St=this.getAttributeManager().getBufferLayouts({isInstanced:!0});Et=new Model(this.context.device,{...this.getShaders("side"),id:`${yt}-side`,bufferLayout:St,geometry:new Geometry({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),wt=new Model(this.context.device,{...this.getShaders("side"),id:`${yt}-wireframe`,bufferLayout:St,geometry:new Geometry({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[Et,wt,Tt].filter(Boolean),topModel:Tt,sideModel:Et,wireframeModel:wt}}calculateIndices(yt){const{polygonTesselator:vt}=this.state;yt.startIndices=vt.indexStarts,yt.value=vt.get("indices")}calculatePositions(yt){const{polygonTesselator:vt}=this.state;yt.startIndices=vt.vertexStarts,yt.value=vt.get("positions")}calculateVertexValid(yt){yt.value=this.state.polygonTesselator.get("vertexValid")}}SolidPolygonLayer.defaultProps=defaultProps$4;SolidPolygonLayer.layerName="SolidPolygonLayer";function replaceInRange({data:xt,getIndex:yt,dataRange:vt,replace:bt}){const{startRow:Tt=0,endRow:Et=1/0}=vt,wt=xt.length;let St=wt,At=wt;for(let It=0;It<wt;It++){const Mt=yt(xt[It]);if(St>It&&Mt>=Tt&&(St=It),Mt>=Et){At=It;break}}let Rt=St;const Ct=At-St!==bt.length?xt.slice(At):void 0;for(let It=0;It<bt.length;It++)xt[Rt++]=bt[It];if(Ct){for(let It=0;It<Ct.length;It++)xt[Rt++]=Ct[It];xt.length=Rt}return{startRow:St,endRow:St+bt.length}}const defaultLineColor=[0,0,0,255],defaultFillColor=[0,0,0,255],defaultProps$3={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:xt=>xt.polygon},getFillColor:{type:"accessor",value:defaultFillColor},getLineColor:{type:"accessor",value:defaultLineColor},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class PolygonLayer extends CompositeLayer{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&defaultLogger.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:yt}){const vt=yt.dataChanged||yt.updateTriggersChanged&&(yt.updateTriggersChanged.all||yt.updateTriggersChanged.getPolygon);if(vt&&Array.isArray(yt.dataChanged)){const bt=this.state.paths.slice(),Tt=yt.dataChanged.map(Et=>replaceInRange({data:bt,getIndex:wt=>wt.__source.index,dataRange:Et,replace:this._getPaths(Et)}));this.setState({paths:bt,pathsDiff:Tt})}else vt&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(yt={}){const{data:vt,getPolygon:bt,positionFormat:Tt,_normalize:Et}=this.props,wt=[],St=Tt==="XY"?2:3,{startRow:At,endRow:Rt}=yt,{iterable:Pt,objectInfo:Ct}=createIterable(vt,At,Rt);for(const It of Pt){Ct.index++;let Mt=bt(It,Ct);Et&&(Mt=normalize(Mt,St));const{holeIndices:Ot}=Mt,kt=Mt.positions||Mt;if(Ot)for(let Ft=0;Ft<=Ot.length;Ft++){const Nt=kt.slice(Ot[Ft-1]||0,Ot[Ft]||kt.length);wt.push(this.getSubLayerRow({path:Nt},It,Ct.index))}else wt.push(this.getSubLayerRow({path:kt},It,Ct.index))}return wt}renderLayers(){const{data:yt,_dataDiff:vt,stroked:bt,filled:Tt,extruded:Et,wireframe:wt,_normalize:St,_windingOrder:At,elevationScale:Rt,transitions:Pt,positionFormat:Ct}=this.props,{lineWidthUnits:It,lineWidthScale:Mt,lineWidthMinPixels:Ot,lineWidthMaxPixels:kt,lineJointRounded:Ft,lineMiterLimit:Nt,lineDashJustified:Lt}=this.props,{getFillColor:Dt,getLineColor:$t,getLineWidth:zt,getLineDashArray:Ut,getElevation:jt,getPolygon:Ht,updateTriggers:Vt,material:Wt}=this.props,{paths:Yt,pathsDiff:Kt}=this.state,Zt=this.getSubLayerClass("fill",SolidPolygonLayer),Xt=this.getSubLayerClass("stroke",PathLayer),en=this.shouldRenderSubLayer("fill",Yt)&&new Zt({_dataDiff:vt,extruded:Et,elevationScale:Rt,filled:Tt,wireframe:wt,_normalize:St,_windingOrder:At,getElevation:jt,getFillColor:Dt,getLineColor:Et&&wt?$t:defaultLineColor,material:Wt,transitions:Pt},this.getSubLayerProps({id:"fill",updateTriggers:Vt&&{getPolygon:Vt.getPolygon,getElevation:Vt.getElevation,getFillColor:Vt.getFillColor,lineColors:Et&&wt,getLineColor:Vt.getLineColor}}),{data:yt,positionFormat:Ct,getPolygon:Ht}),nn=!Et&&bt&&this.shouldRenderSubLayer("stroke",Yt)&&new Xt({_dataDiff:Kt&&(()=>Kt),widthUnits:It,widthScale:Mt,widthMinPixels:Ot,widthMaxPixels:kt,jointRounded:Ft,miterLimit:Nt,dashJustified:Lt,_pathType:"loop",transitions:Pt&&{getWidth:Pt.getLineWidth,getColor:Pt.getLineColor,getPath:Pt.getPolygon},getColor:this.getSubLayerAccessor($t),getWidth:this.getSubLayerAccessor(zt),getDashArray:this.getSubLayerAccessor(Ut)},this.getSubLayerProps({id:"stroke",updateTriggers:Vt&&{getWidth:Vt.getLineWidth,getColor:Vt.getLineColor,getDashArray:Vt.getLineDashArray}}),{data:Yt,positionFormat:Ct,getPath:rn=>rn.path});return[!Et&&en,nn,Et&&en]}}PolygonLayer.layerName="PolygonLayer";PolygonLayer.defaultProps=defaultProps$3;const uniformBlock$1=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,sdfUniforms={name:"sdf",vs:uniformBlock$1,fs:uniformBlock$1,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},fs$1=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,DEFAULT_BUFFER=192/256,EMPTY_ARRAY=[],defaultProps$2={getIconOffsets:{type:"accessor",value:xt=>xt.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class MultiIconLayer extends IconLayer{getShaders(){const yt=super.getShaders();return{...yt,modules:[...yt.modules,sdfUniforms],fs:fs$1}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(vt,{index:bt,target:Tt})=>this.encodePickingColor(bt,Tt)}})}updateState(yt){super.updateState(yt);const{props:vt,oldProps:bt}=yt;let{outlineColor:Tt}=vt;Tt!==bt.outlineColor&&(Tt=Tt.map(Et=>Et/255),Tt[3]=Number.isFinite(Tt[3])?Tt[3]:1,this.setState({outlineColor:Tt})),!vt.sdf&&vt.outlineWidth&&defaultLogger.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(yt){const{sdf:vt,smoothing:bt,outlineWidth:Tt}=this.props,{outlineColor:Et}=this.state,wt=Tt?Math.max(bt,DEFAULT_BUFFER*(1-Tt)):-1,St=this.state.model,At={buffer:DEFAULT_BUFFER,outlineBuffer:wt,gamma:bt,enabled:!!vt,outlineColor:Et};if(St.shaderInputs.setProps({sdf:At}),super.draw(yt),vt&&Tt){const{iconManager:Rt}=this.state;Rt.getTexture()&&(St.shaderInputs.setProps({sdf:{...At,outlineBuffer:DEFAULT_BUFFER}}),St.draw(this.context.renderPass))}}getInstanceOffset(yt){return yt?Array.from(yt).flatMap(vt=>super.getInstanceOffset(vt)):EMPTY_ARRAY}getInstanceColorMode(yt){return 1}getInstanceIconFrame(yt){return yt?Array.from(yt).flatMap(vt=>super.getInstanceIconFrame(vt)):EMPTY_ARRAY}}MultiIconLayer.defaultProps=defaultProps$2;MultiIconLayer.layerName="MultiIconLayer";const INF=1e20;class TinySDF{constructor({fontSize:yt=24,buffer:vt=3,radius:bt=8,cutoff:Tt=.25,fontFamily:Et="sans-serif",fontWeight:wt="normal",fontStyle:St="normal",lang:At=null}={}){this.buffer=vt,this.cutoff=Tt,this.radius=bt,this.lang=At;const Rt=this.size=yt+vt*4,Pt=this._createCanvas(Rt),Ct=this.ctx=Pt.getContext("2d",{willReadFrequently:!0});Ct.font=`${St} ${wt} ${yt}px ${Et}`,Ct.textBaseline="alphabetic",Ct.textAlign="left",Ct.fillStyle="black",this.gridOuter=new Float64Array(Rt*Rt),this.gridInner=new Float64Array(Rt*Rt),this.f=new Float64Array(Rt),this.z=new Float64Array(Rt+1),this.v=new Uint16Array(Rt)}_createCanvas(yt){const vt=document.createElement("canvas");return vt.width=vt.height=yt,vt}draw(yt){const{width:vt,actualBoundingBoxAscent:bt,actualBoundingBoxDescent:Tt,actualBoundingBoxLeft:Et,actualBoundingBoxRight:wt}=this.ctx.measureText(yt),St=Math.ceil(bt),At=0,Rt=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(wt-Et))),Pt=Math.min(this.size-this.buffer,St+Math.ceil(Tt)),Ct=Rt+2*this.buffer,It=Pt+2*this.buffer,Mt=Math.max(Ct*It,0),Ot=new Uint8ClampedArray(Mt),kt={data:Ot,width:Ct,height:It,glyphWidth:Rt,glyphHeight:Pt,glyphTop:St,glyphLeft:At,glyphAdvance:vt};if(Rt===0||Pt===0)return kt;const{ctx:Ft,buffer:Nt,gridInner:Lt,gridOuter:Dt}=this;this.lang&&(Ft.lang=this.lang),Ft.clearRect(Nt,Nt,Rt,Pt),Ft.fillText(yt,Nt,Nt+St);const $t=Ft.getImageData(Nt,Nt,Rt,Pt);Dt.fill(INF,0,Mt),Lt.fill(0,0,Mt);for(let zt=0;zt<Pt;zt++)for(let Ut=0;Ut<Rt;Ut++){const jt=$t.data[4*(zt*Rt+Ut)+3]/255;if(jt===0)continue;const Ht=(zt+Nt)*Ct+Ut+Nt;if(jt===1)Dt[Ht]=0,Lt[Ht]=INF;else{const Vt=.5-jt;Dt[Ht]=Vt>0?Vt*Vt:0,Lt[Ht]=Vt<0?Vt*Vt:0}}edt(Dt,0,0,Ct,It,Ct,this.f,this.v,this.z),edt(Lt,Nt,Nt,Rt,Pt,Ct,this.f,this.v,this.z);for(let zt=0;zt<Mt;zt++){const Ut=Math.sqrt(Dt[zt])-Math.sqrt(Lt[zt]);Ot[zt]=Math.round(255-255*(Ut/this.radius+this.cutoff))}return kt}}function edt(xt,yt,vt,bt,Tt,Et,wt,St,At){for(let Rt=yt;Rt<yt+bt;Rt++)edt1d(xt,vt*Et+Rt,Et,Tt,wt,St,At);for(let Rt=vt;Rt<vt+Tt;Rt++)edt1d(xt,Rt*Et+yt,1,bt,wt,St,At)}function edt1d(xt,yt,vt,bt,Tt,Et,wt){Et[0]=0,wt[0]=-INF,wt[1]=INF,Tt[0]=xt[yt];for(let St=1,At=0,Rt=0;St<bt;St++){Tt[St]=xt[yt+St*vt];const Pt=St*St;do{const Ct=Et[At];Rt=(Tt[St]-Tt[Ct]+Pt-Ct*Ct)/(St-Ct)/2}while(Rt<=wt[At]&&--At>-1);At++,Et[At]=St,wt[At]=Rt,wt[At+1]=INF}for(let St=0,At=0;St<bt;St++){for(;wt[At+1]<St;)At++;const Rt=Et[At],Pt=St-Rt;xt[yt+St*vt]=Tt[Rt]+Pt*Pt}}const MISSING_CHAR_WIDTH=32,SINGLE_LINE=[];function nextPowOfTwo(xt){return Math.pow(2,Math.ceil(Math.log2(xt)))}function buildMapping({characterSet:xt,getFontWidth:yt,fontHeight:vt,buffer:bt,maxCanvasWidth:Tt,mapping:Et={},xOffset:wt=0,yOffset:St=0}){let At=0,Rt=wt;const Pt=vt+bt*2;for(const Ct of xt)if(!Et[Ct]){const It=yt(Ct);Rt+It+bt*2>Tt&&(Rt=0,At++),Et[Ct]={x:Rt+bt,y:St+At*Pt+bt,width:It,height:Pt,layoutWidth:It,layoutHeight:vt},Rt+=It+bt*2}return{mapping:Et,xOffset:Rt,yOffset:St+At*Pt,canvasHeight:nextPowOfTwo(St+(At+1)*Pt)}}function getTextWidth(xt,yt,vt,bt){var Et;let Tt=0;for(let wt=yt;wt<vt;wt++){const St=xt[wt];Tt+=((Et=bt[St])==null?void 0:Et.layoutWidth)||0}return Tt}function breakAll(xt,yt,vt,bt,Tt,Et){let wt=yt,St=0;for(let At=yt;At<vt;At++){const Rt=getTextWidth(xt,At,At+1,Tt);St+Rt>bt&&(wt<At&&Et.push(At),wt=At,St=0),St+=Rt}return St}function breakWord(xt,yt,vt,bt,Tt,Et){let wt=yt,St=yt,At=yt,Rt=0;for(let Pt=yt;Pt<vt;Pt++)if((xt[Pt]===" "||xt[Pt+1]===" "||Pt+1===vt)&&(At=Pt+1),At>St){let Ct=getTextWidth(xt,St,At,Tt);Rt+Ct>bt&&(wt<St&&(Et.push(St),wt=St,Rt=0),Ct>bt&&(Ct=breakAll(xt,St,At,bt,Tt,Et),wt=Et[Et.length-1])),St=At,Rt+=Ct}return Rt}function autoWrapping(xt,yt,vt,bt,Tt=0,Et){Et===void 0&&(Et=xt.length);const wt=[];return yt==="break-all"?breakAll(xt,Tt,Et,vt,bt,wt):breakWord(xt,Tt,Et,vt,bt,wt),wt}function transformRow(xt,yt,vt,bt,Tt,Et){let wt=0,St=0;for(let At=yt;At<vt;At++){const Rt=xt[At],Pt=bt[Rt];Pt?(St||(St=Pt.layoutHeight),Tt[At]=wt+Pt.layoutWidth/2,wt+=Pt.layoutWidth):(defaultLogger.warn(`Missing character: ${Rt} (${Rt.codePointAt(0)})`)(),Tt[At]=wt,wt+=MISSING_CHAR_WIDTH)}Et[0]=wt,Et[1]=St}function transformParagraph(xt,yt,vt,bt,Tt){var Ft;const Et=Array.from(xt),wt=Et.length,St=new Array(wt),At=new Array(wt),Rt=new Array(wt),Pt=(vt==="break-word"||vt==="break-all")&&isFinite(bt)&&bt>0,Ct=[0,0],It=[0,0];let Mt=0,Ot=0,kt=0;for(let Nt=0;Nt<=wt;Nt++){const Lt=Et[Nt];if((Lt===`
`||Nt===wt)&&(kt=Nt),kt>Ot){const Dt=Pt?autoWrapping(Et,vt,bt,Tt,Ot,kt):SINGLE_LINE;for(let $t=0;$t<=Dt.length;$t++){const zt=$t===0?Ot:Dt[$t-1],Ut=$t<Dt.length?Dt[$t]:kt;transformRow(Et,zt,Ut,Tt,St,It);for(let jt=zt;jt<Ut;jt++){St[jt]-It[0]/2;const Ht=Et[jt],Vt=((Ft=Tt[Ht])==null?void 0:Ft.layoutOffsetY)||0;At[jt]=Mt+It[1]/2+Vt,Rt[jt]=It[0]}Mt=Mt+It[1]*yt,Ct[0]=Math.max(Ct[0],It[0])}Ot=kt}Lt===`
`&&(St[Ot]=0,At[Ot]=0,Rt[Ot]=0,Ot++)}return Ct[1]=Mt,{x:St,y:At,rowWidth:Rt,size:Ct}}function getTextFromBuffer({value:xt,length:yt,stride:vt,offset:bt,startIndices:Tt,characterSet:Et}){const wt=xt.BYTES_PER_ELEMENT,St=vt?vt/wt:1,At=bt?bt/wt:0,Rt=Tt[yt]||Math.ceil((xt.length-At)/St),Pt=Et&&new Set,Ct=new Array(yt);let It=xt;if(St>1||At>0){const Mt=xt.constructor;It=new Mt(Rt);for(let Ot=0;Ot<Rt;Ot++)It[Ot]=xt[Ot*St+At]}for(let Mt=0;Mt<yt;Mt++){const Ot=Tt[Mt],kt=Tt[Mt+1]||Rt,Ft=It.subarray(Ot,kt);Ct[Mt]=String.fromCodePoint.apply(null,Ft),Pt&&Ft.forEach(Pt.add,Pt)}if(Pt)for(const Mt of Pt)Et.add(String.fromCodePoint(Mt));return{texts:Ct,characterCount:Rt}}class LRUCache{constructor(yt=5){this._cache={},this._order=[],this.limit=yt}get(yt){const vt=this._cache[yt];return vt&&(this._deleteOrder(yt),this._appendOrder(yt)),vt}set(yt,vt){this._cache[yt]?(this.delete(yt),this._cache[yt]=vt,this._appendOrder(yt)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[yt]=vt,this._appendOrder(yt))}delete(yt){this._cache[yt]&&(delete this._cache[yt],this._deleteOrder(yt))}_deleteOrder(yt){const vt=this._order.indexOf(yt);vt>=0&&this._order.splice(vt,1)}_appendOrder(yt){this._order.push(yt)}}function getDefaultCharacterSet(){const xt=[];for(let yt=32;yt<128;yt++)xt.push(String.fromCharCode(yt));return xt}const DEFAULT_FONT_SETTINGS={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:getDefaultCharacterSet(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},MAX_CANVAS_WIDTH=1024,BASELINE_SCALE=.9,HEIGHT_SCALE=1.2,CACHE_LIMIT=3;let cache=new LRUCache(CACHE_LIMIT);function getNewChars(xt,yt){let vt;typeof yt=="string"?vt=new Set(Array.from(yt)):vt=new Set(yt);const bt=cache.get(xt);if(!bt)return vt;for(const Tt in bt.mapping)vt.has(Tt)&&vt.delete(Tt);return vt}function populateAlphaChannel(xt,yt){for(let vt=0;vt<xt.length;vt++)yt.data[4*vt+3]=xt[vt]}function setTextStyle(xt,yt,vt,bt){xt.font=`${bt} ${vt}px ${yt}`,xt.fillStyle="#000",xt.textBaseline="alphabetic",xt.textAlign="left"}function setFontAtlasCacheLimit(xt){defaultLogger.assert(Number.isFinite(xt)&&xt>=CACHE_LIMIT,"Invalid cache limit"),cache=new LRUCache(xt)}class FontAtlasManager{constructor(){this.props={...DEFAULT_FONT_SETTINGS}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:yt,buffer:vt}=this.props;return(yt*HEIGHT_SCALE+vt*2)/yt}setProps(yt={}){Object.assign(this.props,yt),this._key=this._getKey();const vt=getNewChars(this._key,this.props.characterSet),bt=cache.get(this._key);if(bt&&vt.size===0){this._atlas!==bt&&(this._atlas=bt);return}const Tt=this._generateFontAtlas(vt,bt);this._atlas=Tt,cache.set(this._key,Tt)}_generateFontAtlas(yt,vt){const{fontFamily:bt,fontWeight:Tt,fontSize:Et,buffer:wt,sdf:St,radius:At,cutoff:Rt}=this.props;let Pt=vt&&vt.data;Pt||(Pt=document.createElement("canvas"),Pt.width=MAX_CANVAS_WIDTH);const Ct=Pt.getContext("2d",{willReadFrequently:!0});setTextStyle(Ct,bt,Et,Tt);const{mapping:It,canvasHeight:Mt,xOffset:Ot,yOffset:kt}=buildMapping({getFontWidth:Ft=>Ct.measureText(Ft).width,fontHeight:Et*HEIGHT_SCALE,buffer:wt,characterSet:yt,maxCanvasWidth:MAX_CANVAS_WIDTH,...vt&&{mapping:vt.mapping,xOffset:vt.xOffset,yOffset:vt.yOffset}});if(Pt.height!==Mt){const Ft=Ct.getImageData(0,0,Pt.width,Pt.height);Pt.height=Mt,Ct.putImageData(Ft,0,0)}if(setTextStyle(Ct,bt,Et,Tt),St){const Ft=new TinySDF({fontSize:Et,buffer:wt,radius:At,cutoff:Rt,fontFamily:bt,fontWeight:`${Tt}`});for(const Nt of yt){const{data:Lt,width:Dt,height:$t,glyphTop:zt}=Ft.draw(Nt);It[Nt].width=Dt,It[Nt].layoutOffsetY=Et*BASELINE_SCALE-zt;const Ut=Ct.createImageData(Dt,$t);populateAlphaChannel(Lt,Ut),Ct.putImageData(Ut,It[Nt].x,It[Nt].y)}}else for(const Ft of yt)Ct.fillText(Ft,It[Ft].x,It[Ft].y+wt+Et*BASELINE_SCALE);return{xOffset:Ot,yOffset:kt,mapping:It,data:Pt,width:Pt.width,height:Pt.height}}_getKey(){const{fontFamily:yt,fontWeight:vt,fontSize:bt,buffer:Tt,sdf:Et,radius:wt,cutoff:St}=this.props;return Et?`${yt} ${vt} ${bt} ${Tt} ${wt} ${St}`:`${yt} ${vt} ${bt} ${Tt}`}}const uniformBlock=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,textBackgroundUniforms={name:"textBackground",vs:uniformBlock,fs:uniformBlock,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},vs=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,fs=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,defaultProps$1={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:xt=>xt.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class TextBackgroundLayer extends Layer{getShaders(){return super.getShaders({vs,fs,modules:[project32,picking,textBackgroundUniforms]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(yt){var bt;super.updateState(yt);const{changeFlags:vt}=yt;vt.extensionsChanged&&((bt=this.state.model)==null||bt.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:yt}){const{billboard:vt,sizeScale:bt,sizeUnits:Tt,sizeMinPixels:Et,sizeMaxPixels:wt,getLineWidth:St}=this.props;let{padding:At,borderRadius:Rt}=this.props;At.length<4&&(At=[At[0],At[1],At[0],At[1]]),Array.isArray(Rt)||(Rt=[Rt,Rt,Rt,Rt]);const Pt=this.state.model,Ct={billboard:vt,stroked:!!St,borderRadius:Rt,padding:At,sizeUnits:UNIT[Tt],sizeScale:bt,sizeMinPixels:Et,sizeMaxPixels:wt};Pt.shaderInputs.setProps({textBackground:Ct}),Pt.draw(this.context.renderPass)}_getModel(){const yt=[0,0,1,0,0,1,1,1];return new Model(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Geometry({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(yt)}}}),isInstanced:!0})}}TextBackgroundLayer.defaultProps=defaultProps$1;TextBackgroundLayer.layerName="TextBackgroundLayer";const TEXT_ANCHOR={start:1,middle:0,end:-1},ALIGNMENT_BASELINE={top:1,center:0,bottom:-1},DEFAULT_COLOR=[0,0,0,255],DEFAULT_LINE_HEIGHT=1,defaultProps={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:DEFAULT_COLOR},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:DEFAULT_FONT_SETTINGS.characterSet},fontFamily:DEFAULT_FONT_SETTINGS.fontFamily,fontWeight:DEFAULT_FONT_SETTINGS.fontWeight,lineHeight:DEFAULT_LINE_HEIGHT,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:DEFAULT_COLOR},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:xt=>xt.text},getPosition:{type:"accessor",value:xt=>xt.position},getColor:{type:"accessor",value:DEFAULT_COLOR},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class TextLayer extends CompositeLayer{constructor(){super(...arguments),this.getBoundingRect=(yt,vt)=>{let{size:[bt,Tt]}=this.transformParagraph(yt,vt);const{fontSize:Et}=this.state.fontAtlasManager.props;bt/=Et,Tt/=Et;const{getTextAnchor:wt,getAlignmentBaseline:St}=this.props,At=TEXT_ANCHOR[typeof wt=="function"?wt(yt,vt):wt],Rt=ALIGNMENT_BASELINE[typeof St=="function"?St(yt,vt):St];return[(At-1)*bt/2,(Rt-1)*Tt/2,bt,Tt]},this.getIconOffsets=(yt,vt)=>{const{getTextAnchor:bt,getAlignmentBaseline:Tt}=this.props,{x:Et,y:wt,rowWidth:St,size:[At,Rt]}=this.transformParagraph(yt,vt),Pt=TEXT_ANCHOR[typeof bt=="function"?bt(yt,vt):bt],Ct=ALIGNMENT_BASELINE[typeof Tt=="function"?Tt(yt,vt):Tt],It=Et.length,Mt=new Array(It*2);let Ot=0;for(let kt=0;kt<It;kt++){const Ft=(1-Pt)*(At-St[kt])/2;Mt[Ot++]=(Pt-1)*At/2+Ft+Et[kt],Mt[Ot++]=(Ct-1)*Rt/2+wt[kt]}return Mt}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new FontAtlasManager},this.props.maxWidth>0&&defaultLogger.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(yt){const{props:vt,oldProps:bt,changeFlags:Tt}=yt;(Tt.dataChanged||Tt.updateTriggersChanged&&(Tt.updateTriggersChanged.all||Tt.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||vt.lineHeight!==bt.lineHeight||vt.wordBreak!==bt.wordBreak||vt.maxWidth!==bt.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:yt}){return yt.object=yt.index>=0?this.props.data[yt.index]:null,yt}_updateFontAtlas(){const{fontSettings:yt,fontFamily:vt,fontWeight:bt}=this.props,{fontAtlasManager:Tt,characterSet:Et}=this.state,wt={...yt,characterSet:Et,fontFamily:vt,fontWeight:bt};if(!Tt.mapping)return Tt.setProps(wt),!0;for(const St in wt)if(wt[St]!==Tt.props[St])return Tt.setProps(wt),!0;return!1}_updateText(){var At;const{data:yt,characterSet:vt}=this.props,bt=(At=yt.attributes)==null?void 0:At.getText;let{getText:Tt}=this.props,Et=yt.startIndices,wt;const St=vt==="auto"&&new Set;if(bt&&Et){const{texts:Rt,characterCount:Pt}=getTextFromBuffer({...ArrayBuffer.isView(bt)?{value:bt}:bt,length:yt.length,startIndices:Et,characterSet:St});wt=Pt,Tt=(Ct,{index:It})=>Rt[It]}else{const{iterable:Rt,objectInfo:Pt}=createIterable(yt);Et=[0],wt=0;for(const Ct of Rt){Pt.index++;const It=Array.from(Tt(Ct,Pt)||"");St&&It.forEach(St.add,St),wt+=It.length,Et.push(wt)}}this.setState({getText:Tt,startIndices:Et,numInstances:wt,characterSet:St||vt})}transformParagraph(yt,vt){const{fontAtlasManager:bt}=this.state,Tt=bt.mapping,Et=this.state.getText,{wordBreak:wt,lineHeight:St,maxWidth:At}=this.props,Rt=Et(yt,vt)||"";return transformParagraph(Rt,St,wt,At*bt.props.fontSize,Tt)}renderLayers(){const{startIndices:yt,numInstances:vt,getText:bt,fontAtlasManager:{scale:Tt,atlas:Et,mapping:wt},styleVersion:St}=this.state,{data:At,_dataDiff:Rt,getPosition:Pt,getColor:Ct,getSize:It,getAngle:Mt,getPixelOffset:Ot,getBackgroundColor:kt,getBorderColor:Ft,getBorderWidth:Nt,backgroundBorderRadius:Lt,backgroundPadding:Dt,background:$t,billboard:zt,fontSettings:Ut,outlineWidth:jt,outlineColor:Ht,sizeScale:Vt,sizeUnits:Wt,sizeMinPixels:Yt,sizeMaxPixels:Kt,transitions:Zt,updateTriggers:Xt}=this.props,en=this.getSubLayerClass("characters",MultiIconLayer),nn=this.getSubLayerClass("background",TextBackgroundLayer);return[$t&&new nn({getFillColor:kt,getLineColor:Ft,getLineWidth:Nt,borderRadius:Lt,padding:Dt,getPosition:Pt,getSize:It,getAngle:Mt,getPixelOffset:Ot,billboard:zt,sizeScale:Vt,sizeUnits:Wt,sizeMinPixels:Yt,sizeMaxPixels:Kt,transitions:Zt&&{getPosition:Zt.getPosition,getAngle:Zt.getAngle,getSize:Zt.getSize,getFillColor:Zt.getBackgroundColor,getLineColor:Zt.getBorderColor,getLineWidth:Zt.getBorderWidth,getPixelOffset:Zt.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Xt.getPosition,getAngle:Xt.getAngle,getSize:Xt.getSize,getFillColor:Xt.getBackgroundColor,getLineColor:Xt.getBorderColor,getLineWidth:Xt.getBorderWidth,getPixelOffset:Xt.getPixelOffset,getBoundingRect:{getText:Xt.getText,getTextAnchor:Xt.getTextAnchor,getAlignmentBaseline:Xt.getAlignmentBaseline,styleVersion:St}}}),{data:At.attributes&&At.attributes.background?{length:At.length,attributes:At.attributes.background}:At,_dataDiff:Rt,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new en({sdf:Ut.sdf,smoothing:Number.isFinite(Ut.smoothing)?Ut.smoothing:DEFAULT_FONT_SETTINGS.smoothing,outlineWidth:jt/(Ut.radius||DEFAULT_FONT_SETTINGS.radius),outlineColor:Ht,iconAtlas:Et,iconMapping:wt,getPosition:Pt,getColor:Ct,getSize:It,getAngle:Mt,getPixelOffset:Ot,billboard:zt,sizeScale:Vt*Tt,sizeUnits:Wt,sizeMinPixels:Yt*Tt,sizeMaxPixels:Kt*Tt,transitions:Zt&&{getPosition:Zt.getPosition,getAngle:Zt.getAngle,getColor:Zt.getColor,getSize:Zt.getSize,getPixelOffset:Zt.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Xt.getText,getPosition:Xt.getPosition,getAngle:Xt.getAngle,getColor:Xt.getColor,getSize:Xt.getSize,getPixelOffset:Xt.getPixelOffset,getIconOffsets:{getTextAnchor:Xt.getTextAnchor,getAlignmentBaseline:Xt.getAlignmentBaseline,styleVersion:St}}}),{data:At,_dataDiff:Rt,startIndices:yt,numInstances:vt,getIconOffsets:this.getIconOffsets,getIcon:bt})]}static set fontAtlasCacheLimit(yt){setFontAtlasCacheLimit(yt)}}TextLayer.defaultProps=defaultProps;TextLayer.layerName="TextLayer";const DAY_COLORS={sky:[135,206,235],ground:[34,139,34],buildings:{residential:[255,228,181],commercial:[176,224,230],industrial:[169,169,169],office:[70,130,180]},roads:{highway:[64,64,64],arterial:[96,96,96],local:[128,128,128]},zones:{residential:[144,238,144,100],commercial:[255,182,193,100],industrial:[192,192,192,100],downtown:[255,215,0,100],park:[34,139,34,100],water:[30,144,255,150]},agents:{car:[255,69,0],bus:[255,215,0],truck:[160,82,45],pedestrian:[0,191,255]}},NIGHT_COLORS={sky:[25,25,112],ground:[20,20,20],buildings:{residential:[255,255,224,200],commercial:[255,255,255,220],industrial:[128,128,128,150],office:[255,255,255,240]},roads:{highway:[40,40,40],arterial:[50,50,50],local:[60,60,60]},zones:{residential:[100,149,237,60],commercial:[255,105,180,60],industrial:[105,105,105,60],downtown:[255,215,0,80],park:[0,100,0,60],water:[0,0,139,120]},agents:{car:[255,255,255],bus:[255,255,0],truck:[255,165,0],pedestrian:[173,216,230]}};function interpolateColors(xt,yt,vt){return xt.map((bt,Tt)=>{const Et=yt[Tt]||0;return Math.round(bt+(Et-bt)*vt)})}function getTimeBasedColors(xt){let yt;xt>=6&&xt<=18?yt=1:xt>=19||xt<=5?yt=0:xt>18?yt=1-(xt-18):yt=xt-5;const vt={sky:interpolateColors(NIGHT_COLORS.sky,DAY_COLORS.sky,yt),ground:interpolateColors(NIGHT_COLORS.ground,DAY_COLORS.ground,yt),buildings:{},roads:{},zones:{},agents:{}};return Object.keys(DAY_COLORS.buildings).forEach(bt=>{vt.buildings[bt]=interpolateColors(NIGHT_COLORS.buildings[bt],DAY_COLORS.buildings[bt],yt)}),["roads","zones","agents"].forEach(bt=>{Object.keys(DAY_COLORS[bt]).forEach(Tt=>{vt[bt][Tt]=interpolateColors(NIGHT_COLORS[bt][Tt],DAY_COLORS[bt][Tt],yt)})}),vt}function createBuildingLayer(xt,yt=12){const vt=getTimeBasedColors(yt);if(console.log(`Creating building layer with ${xt.length} buildings.`),xt.length>0){const bt=xt.slice(0,5);console.log("=== BUILDING HEIGHT DEBUG ==="),bt.forEach((Tt,Et)=>{console.log(`Building ${Et}: ID=${Tt.id}, height=${Tt.height}, footprint=${Array.isArray(Tt.footprint)?Tt.footprint.length+" points":"invalid"}`),Et===0&&Array.isArray(Tt.footprint)&&console.log(`  First footprint sample: ${JSON.stringify(Tt.footprint.slice(0,2))}`)}),console.log("===========================")}return new PolygonLayer({id:"buildings",data:xt,coordinateSystem:2,coordinateOrigin:[-74.006,40.7128,0],getPolygon:bt=>!bt.footprint||!Array.isArray(bt.footprint)?null:bt.footprint.length>0&&typeof bt.footprint[0]=="object"&&"x"in bt.footprint[0]?bt.footprint.map(Tt=>[Tt.x,Tt.y]):Array.isArray(bt.footprint[0])?bt.footprint:(console.warn("Invalid footprint format for building:",bt.id,bt.footprint),null),getElevation:bt=>bt.height||0,getElevationOffset:bt=>Math.max(0,bt.terrain_height||0),getFillColor:bt=>{const Tt=getBuildingType(bt),Et=vt.buildings[Tt]||vt.buildings.residential;if(Array.isArray(Et)&&Et.length>=3)return[Et[0],Et[1],Et[2],255];const St=(bt.id||"").split("").reduce((Rt,Pt)=>(Rt=(Rt<<5)-Rt+Pt.charCodeAt(0),Rt&Rt),0),At=Math.abs(St)%40;switch(Tt){case"office":return[Math.min(255,120+At),Math.min(255,140+At),Math.min(255,200+At),255];case"commercial":return[Math.min(255,140+At),Math.min(255,110+At),Math.min(255,90+At),255];case"residential":return[Math.min(255,160+At),Math.min(255,150+At),Math.min(255,130+At),255];case"industrial":return[Math.min(255,140+At),Math.min(255,140+At),Math.min(255,140+At),255];default:return[Math.min(255,160+At),Math.min(255,160+At),Math.min(255,160+At),255]}},getLineColor:[255,255,255,255],getLineWidth:1,extruded:!0,wireframe:!1,filled:!0,stroked:!0,elevationScale:1,getElevationValue:bt=>bt.height||0,elevationRange:[0,3e3],pickable:!0,material:{ambient:.35,diffuse:.8,shininess:64,specularColor:[80,80,80]},lightSettings:{lightsPosition:[-74.006,40.7128,8e3,-74.006,40.7128,8e3],ambientRatio:.4,diffuseRatio:.6,specularRatio:.2,lightsStrength:[.8,0,.8,0],numberOfLights:2}})}function getBuildingType(xt){if(typeof xt.type=="number")switch(xt.type){case 0:return"residential";case 2:return"office";case 3:return"commercial";case 4:return"industrial"}const yt=xt.height||0;return yt>200?"office":yt>100?"commercial":yt>50?"industrial":"residential"}function createAgentLayer(xt,yt=12){const vt=getTimeBasedColors(yt);return console.log(" Creating agent layer with:",{agentCount:xt.length,firstAgent:xt[0],colors:vt.agents}),new IconLayer({id:"agents",data:xt,getPosition:bt=>{if(!bt.position)return console.log(" Agent missing position:",bt),[0,0,5];const[Tt,Et]=localToLatLng(bt.position.x,bt.position.y),wt=[Tt,Et,5];return bt.id===0&&console.log(" Agent 0 position:",{original:bt.position,converted:wt,localCoords:[bt.position.x,bt.position.y],worldCoords:[Tt,Et]}),wt},getIcon:bt=>getAgentIcon(bt.agent_type),getSize:bt=>getAgentSize(bt.agent_type),getColor:bt=>{var Et;const Tt=((Et=bt.agent_type)==null?void 0:Et.toLowerCase())||"car";return vt.agents[Tt]||vt.agents.car},getAngle:bt=>bt.heading||0,sizeUnits:"meters",sizeScale:1,sizeMinPixels:8,sizeMaxPixels:24,pickable:!0,iconAtlas:"/agent-icons.png",iconMapping:getIconMapping(),updateTriggers:{getPosition:[xt],getColor:[yt],getAngle:[xt]},transitions:{getPosition:{duration:100,easing:bt=>bt},getColor:1e3}})}function getAgentIcon(xt){return{Pedestrian:"person",Car:"car",Bus:"bus",Truck:"truck"}[xt]||"car"}function getAgentSize(xt){return{Pedestrian:8,Car:12,Bus:16,Truck:14}[xt]||12}function getIconMapping(){return{car:{x:0,y:0,width:16,height:16,anchorY:8,anchorX:8},bus:{x:16,y:0,width:16,height:16,anchorY:8,anchorX:8},truck:{x:32,y:0,width:16,height:16,anchorY:8,anchorX:8},person:{x:48,y:0,width:16,height:16,anchorY:8,anchorX:8}}}function noise(xt,yt){const vt=Math.sin(xt*12.9898+yt*78.233)*43758.5453;return vt-Math.floor(vt)}function getTerrainHeightAt(xt,yt){const Et=noise(xt*3e-4,yt*3e-4)*20,wt=noise(xt*.0015,yt*.0015)*12,St=noise(xt*.006,yt*.006)*4,At=2500,Rt=2e3,Pt=-3e3,Ct=-1500,It=1e3,Mt=-3500,Ot=Math.sqrt((xt-At)*(xt-At)+(yt-Rt)*(yt-Rt)),kt=Math.sqrt((xt-Pt)*(xt-Pt)+(yt-Ct)*(yt-Ct)),Ft=Math.sqrt((xt-It)*(xt-It)+(yt-Mt)*(yt-Mt)),Nt=2200,Lt=Math.max(0,180*Math.exp(-Math.pow(Ot/Nt,2))),Dt=Math.max(0,200*Math.exp(-Math.pow(kt/Nt,2))),$t=Math.max(0,160*Math.exp(-Math.pow(Ft/Nt,2))),zt=Lt>5?noise(xt*.002,yt*.002)*Lt*.15:0,Ut=Dt>5?noise(xt*.002+100,yt*.002+100)*Dt*.15:0,jt=$t>5?noise(xt*.002+200,yt*.002+200)*$t*.15:0,Ht=Lt+Dt+$t+zt+Ut+jt,Wt=(Et+wt+St)*.3+Ht,Yt=Math.sqrt(xt*xt+yt*yt),Kt=Math.max(.7,1-Yt/1e4);return Wt*Kt}function createRoadLayer(xt,yt=12){const vt=getTimeBasedColors(yt);return new PathLayer({id:"roads",data:xt,coordinateSystem:2,coordinateOrigin:[-74.006,40.7128,0],getPath:bt=>bt.path?bt.path.map(Tt=>{const wt=getTerrainHeightAt(Tt.x,Tt.y)+.5;return[Tt.x,Tt.y,wt]}):[],getWidth:bt=>getRoadWidth(bt.type,bt.width),getColor:bt=>getRoadColor(bt.type,bt.id,vt),widthUnits:"meters",widthScale:1,widthMinPixels:2,widthMaxPixels:25,pickable:!0,capRounded:!0,jointRounded:!0,billboard:!1,transitions:{getColor:1e3,getWidth:500}})}function getRoadWidth(xt,yt){switch(xt){case 0:return 20;case 1:return 12;case 2:return 10;case 3:return 6;default:return yt||6}}function getRoadColor(xt,yt,vt){const bt=yt&&yt.includes("bridge");switch(xt){case 0:return bt?[70,70,80]:[45,45,45];case 1:return bt?[80,80,90]:[60,60,60];case 2:return bt?[90,90,100]:[75,75,75];case 3:return[95,95,95];default:return vt.roads.local||[128,128,128]}}class TerrainTextureAtlas{constructor(yt=2048){Bt(this,"canvas");Bt(this,"ctx");Bt(this,"textureConfigs");Bt(this,"atlasSize");Bt(this,"textureRegions");this.atlasSize=yt,this.canvas=document.createElement("canvas"),this.canvas.width=yt,this.canvas.height=yt,this.ctx=this.canvas.getContext("2d"),this.textureRegions={},this.textureConfigs={},this.initializeTextureConfigs()}initializeTextureConfigs(){const yt=this.atlasSize/4;this.textureConfigs={lush_grass:{type:"grass",width:yt,height:yt,baseColor:"#4A7C59",accentColors:["#3D6B4A","#5A8B6B","#2F5233","#6B9B7C"],pattern:{type:"organic",scale:.8,density:.7,variation:.9},materials:{roughness:.9,metallic:0,normal:.3,ambient:.5,diffuse:.8,specular:.1}},dry_grass:{type:"grass",width:yt,height:yt,baseColor:"#8B7355",accentColors:["#A0845C","#7A6B47","#6B5D42","#9C8660"],pattern:{type:"organic",scale:.6,density:.5,variation:.8},materials:{roughness:.8,metallic:0,normal:.2,ambient:.6,diffuse:.7,specular:.1}},rich_soil:{type:"dirt",width:yt,height:yt,baseColor:"#8B4513",accentColors:["#A0522D","#654321","#D2691E","#CD853F"],pattern:{type:"noise",scale:.4,density:.8,variation:.6},materials:{roughness:1,metallic:0,normal:.4,ambient:.4,diffuse:.9,specular:.05}},rocky_terrain:{type:"rock",width:yt,height:yt,baseColor:"#696969",accentColors:["#778899","#556B2F","#2F4F4F","#8B7D6B"],pattern:{type:"geometric",scale:1.2,density:.6,variation:.7},materials:{roughness:.7,metallic:.1,normal:.8,ambient:.3,diffuse:.8,specular:.3}},mountain_stone:{type:"rock",width:yt,height:yt,baseColor:"#5F5F5F",accentColors:["#708090","#2F2F2F","#696969","#4A4A4A"],pattern:{type:"mixed",scale:1.5,density:.4,variation:.9},materials:{roughness:.6,metallic:.2,normal:1,ambient:.2,diffuse:.9,specular:.4}},smooth_concrete:{type:"concrete",width:yt,height:yt,baseColor:"#C0C0C0",accentColors:["#D3D3D3","#A9A9A9","#DCDCDC","#B0B0B0"],pattern:{type:"geometric",scale:.2,density:.3,variation:.4},materials:{roughness:.4,metallic:0,normal:.2,ambient:.6,diffuse:.8,specular:.2}},weathered_concrete:{type:"concrete",width:yt,height:yt,baseColor:"#A0A0A0",accentColors:["#909090","#B0B0B0","#808080","#C0C0C0"],pattern:{type:"noise",scale:.6,density:.5,variation:.7},materials:{roughness:.8,metallic:0,normal:.4,ambient:.4,diffuse:.9,specular:.1}},dark_asphalt:{type:"asphalt",width:yt,height:yt,baseColor:"#2F2F2F",accentColors:["#404040","#1A1A1A","#333333","#4A4A4A"],pattern:{type:"noise",scale:.3,density:.4,variation:.5},materials:{roughness:.9,metallic:0,normal:.3,ambient:.3,diffuse:.7,specular:.1}},forest_floor:{type:"forest",width:yt,height:yt,baseColor:"#228B22",accentColors:["#32CD32","#006400","#8FBC8F","#2E7D32"],pattern:{type:"organic",scale:1,density:.9,variation:1},materials:{roughness:1,metallic:0,normal:.5,ambient:.3,diffuse:.9,specular:.05}},sandy_beach:{type:"sand",width:yt,height:yt,baseColor:"#F4A460",accentColors:["#DEB887","#D2B48C","#F5DEB3","#CD853F"],pattern:{type:"noise",scale:.5,density:.6,variation:.4},materials:{roughness:.8,metallic:0,normal:.2,ambient:.7,diffuse:.8,specular:.1}},marsh_wetland:{type:"wetland",width:yt,height:yt,baseColor:"#556B2F",accentColors:["#6B8E23","#808000","#9ACD32","#8FBC8F"],pattern:{type:"mixed",scale:.9,density:.7,variation:.8},materials:{roughness:.9,metallic:0,normal:.4,ambient:.4,diffuse:.8,specular:.3}},coarse_gravel:{type:"gravel",width:yt,height:yt,baseColor:"#808080",accentColors:["#A9A9A9","#696969","#778899","#708090"],pattern:{type:"geometric",scale:.8,density:.8,variation:.6},materials:{roughness:.9,metallic:.1,normal:.6,ambient:.5,diffuse:.8,specular:.2}}}}generateAtlas(){this.ctx.fillStyle="#404040",this.ctx.fillRect(0,0,this.atlasSize,this.atlasSize);const yt=this.atlasSize/4;return Object.entries(this.textureConfigs).forEach(([bt,Tt],Et)=>{const wt=Et%4*yt,St=Math.floor(Et/4)*yt;this.generateTerrainTexture(Tt,wt,St),this.textureRegions[bt]={x:wt/this.atlasSize,y:St/this.atlasSize,width:yt/this.atlasSize,height:yt/this.atlasSize}}),this.canvas}generateTerrainTexture(yt,vt,bt){const{width:Tt,height:Et,baseColor:wt,accentColors:St,pattern:At}=yt;switch(this.ctx.fillStyle=wt,this.ctx.fillRect(vt,bt,Tt,Et),At.type){case"organic":this.applyOrganicPattern(yt,vt,bt,Tt,Et);break;case"geometric":this.applyGeometricPattern(yt,vt,bt,Tt,Et);break;case"noise":this.applyNoisePattern(yt,vt,bt,Tt,Et);break;case"mixed":this.applyMixedPattern(yt,vt,bt,Tt,Et);break}this.addSurfaceDetails(yt,vt,bt,Tt,Et)}applyOrganicPattern(yt,vt,bt,Tt,Et){const{accentColors:wt,pattern:St}=yt,At=wt.length;for(let Rt=0;Rt<Tt*Et*St.density*.01;Rt++){const Pt=vt+Math.random()*Tt,Ct=bt+Math.random()*Et,It=(5+Math.random()*15)*St.scale,Mt=wt[Math.floor(Math.random()*At)];this.ctx.fillStyle=Mt,this.ctx.globalAlpha=.3+Math.random()*.4,this.ctx.beginPath();const Ot=8+Math.floor(Math.random()*8);for(let kt=0;kt<Ot;kt++){const Ft=kt/Ot*Math.PI*2,Nt=It*(.7+Math.random()*.6),Lt=Pt+Math.cos(Ft)*Nt,Dt=Ct+Math.sin(Ft)*Nt;kt===0?this.ctx.moveTo(Lt,Dt):this.ctx.lineTo(Lt,Dt)}this.ctx.closePath(),this.ctx.fill()}this.ctx.globalAlpha=1}applyGeometricPattern(yt,vt,bt,Tt,Et){const{accentColors:wt,pattern:St}=yt,At=20*St.scale,Rt=Math.floor(Tt/At),Pt=Math.floor(Et/At);for(let Ct=0;Ct<Rt;Ct++)for(let It=0;It<Pt;It++)if(Math.random()<St.density){const Mt=vt+Ct*At,Ot=bt+It*At,kt=wt[Math.floor(Math.random()*wt.length)];if(this.ctx.fillStyle=kt,this.ctx.globalAlpha=.2+Math.random()*.3,Math.random()<.5)this.ctx.fillRect(Mt+Math.random()*At*.3,Ot+Math.random()*At*.3,At*(.4+Math.random()*.3),At*(.4+Math.random()*.3));else{this.ctx.beginPath();const Ft=3+Math.floor(Math.random()*3),Nt=Mt+At*.5,Lt=Ot+At*.5,Dt=At*.3;for(let $t=0;$t<Ft;$t++){const zt=$t/Ft*Math.PI*2,Ut=Nt+Math.cos(zt)*Dt,jt=Lt+Math.sin(zt)*Dt;$t===0?this.ctx.moveTo(Ut,jt):this.ctx.lineTo(Ut,jt)}this.ctx.closePath(),this.ctx.fill()}}this.ctx.globalAlpha=1}applyNoisePattern(yt,vt,bt,Tt,Et){const wt=this.ctx.getImageData(vt,bt,Tt,Et),St=wt.data,{pattern:At}=yt;for(let Rt=0;Rt<Et;Rt++)for(let Pt=0;Pt<Tt;Pt++){const Ct=(Rt*Tt+Pt)*4,It=(Pt+vt)*At.scale*.01,Mt=(Rt+bt)*At.scale*.01,Ot=this.simpleNoise(It,Mt)*.5,kt=this.simpleNoise(It*2,Mt*2)*.3,Ft=this.simpleNoise(It*4,Mt*4)*.2,Lt=(Ot+kt+Ft)*At.variation*60;St[Ct]=Math.max(0,Math.min(255,St[Ct]+Lt)),St[Ct+1]=Math.max(0,Math.min(255,St[Ct+1]+Lt)),St[Ct+2]=Math.max(0,Math.min(255,St[Ct+2]+Lt))}this.ctx.putImageData(wt,vt,bt)}applyMixedPattern(yt,vt,bt,Tt,Et){this.applyNoisePattern(yt,vt,bt,Tt,Et);const wt={...yt};wt.pattern={...yt.pattern,density:yt.pattern.density*.3},this.applyOrganicPattern(wt,vt,bt,Tt,Et)}addSurfaceDetails(yt,vt,bt,Tt,Et){const{materials:wt,accentColors:St}=yt;switch(yt.type){case"grass":this.addGrassDetails(vt,bt,Tt,Et,St,wt);break;case"rock":this.addRockDetails(vt,bt,Tt,Et,St,wt);break;case"concrete":this.addConcreteDetails(vt,bt,Tt,Et,St,wt);break;case"dirt":this.addDirtDetails(vt,bt,Tt,Et,St,wt);break;case"asphalt":this.addAsphaltDetails(vt,bt,Tt,Et,St,wt);break}}addGrassDetails(yt,vt,bt,Tt,Et,wt){for(let St=0;St<bt*Tt*.002;St++){const At=yt+Math.random()*bt,Rt=vt+Math.random()*Tt;this.ctx.strokeStyle=Et[Math.floor(Math.random()*Et.length)],this.ctx.lineWidth=.5,this.ctx.globalAlpha=.4,this.ctx.beginPath(),this.ctx.moveTo(At,Rt),this.ctx.lineTo(At+(Math.random()-.5)*4,Rt-Math.random()*8),this.ctx.stroke()}this.ctx.globalAlpha=1}addRockDetails(yt,vt,bt,Tt,Et,wt){for(let St=0;St<10;St++){const At=yt+Math.random()*bt,Rt=vt+Math.random()*Tt;this.ctx.strokeStyle=Et[Math.floor(Math.random()*Et.length)],this.ctx.lineWidth=1+Math.random()*2,this.ctx.globalAlpha=.3,this.ctx.beginPath(),this.ctx.moveTo(At,Rt);let Pt=At,Ct=Rt;const It=3+Math.floor(Math.random()*5);for(let Mt=0;Mt<It;Mt++)Pt+=(Math.random()-.5)*20,Ct+=(Math.random()-.5)*20,this.ctx.lineTo(Pt,Ct);this.ctx.stroke()}this.ctx.globalAlpha=1}addConcreteDetails(yt,vt,bt,Tt,Et,wt){const St=4+Math.floor(Math.random()*4);for(let At=0;At<St;At++)if(this.ctx.strokeStyle=Et[Math.floor(Math.random()*Et.length)],this.ctx.lineWidth=1,this.ctx.globalAlpha=.5,Math.random()<.5){const Rt=vt+Math.random()*Tt;this.ctx.beginPath(),this.ctx.moveTo(yt,Rt),this.ctx.lineTo(yt+bt,Rt),this.ctx.stroke()}else{const Rt=yt+Math.random()*bt;this.ctx.beginPath(),this.ctx.moveTo(Rt,vt),this.ctx.lineTo(Rt,vt+Tt),this.ctx.stroke()}this.ctx.globalAlpha=1}addDirtDetails(yt,vt,bt,Tt,Et,wt){for(let St=0;St<bt*Tt*.001;St++){const At=yt+Math.random()*bt,Rt=vt+Math.random()*Tt,Pt=1+Math.random()*3;this.ctx.fillStyle=Et[Math.floor(Math.random()*Et.length)],this.ctx.globalAlpha=.4,this.ctx.beginPath(),this.ctx.arc(At,Rt,Pt,0,Math.PI*2),this.ctx.fill()}this.ctx.globalAlpha=1}addAsphaltDetails(yt,vt,bt,Tt,Et,wt){for(let St=0;St<bt*Tt*.003;St++){const At=yt+Math.random()*bt,Rt=vt+Math.random()*Tt,Pt=.5+Math.random()*1.5;this.ctx.fillStyle=Et[Math.floor(Math.random()*Et.length)],this.ctx.globalAlpha=.3,this.ctx.fillRect(At,Rt,Pt,Pt)}this.ctx.globalAlpha=1}simpleNoise(yt,vt){const bt=Math.sin(yt*12.9898+vt*78.233)*43758.5453;return(bt-Math.floor(bt))*2-1}getTextureRegions(){return this.textureRegions}getTextureConfig(yt){return this.textureConfigs[yt]}getTextureURL(){return this.canvas.toDataURL("image/png")}downloadAtlas(yt="terrain-texture-atlas.png"){const vt=document.createElement("a");vt.download=yt,vt.href=this.getTextureURL(),vt.click()}}function getTerrainTextureKey(xt,yt,vt,bt=1e3){const Tt=bt<500;return xt<-2?"marsh_wetland":vt>.7?xt>10?"weathered_concrete":"smooth_concrete":vt>.3?xt>5?"dry_grass":"dark_asphalt":xt>150?yt>.3?"mountain_stone":"rocky_terrain":xt>80?yt>.2?"rocky_terrain":"dry_grass":xt>30?"forest_floor":xt>10?Tt?"marsh_wetland":"lush_grass":xt>0?Tt?"sandy_beach":"rich_soil":"marsh_wetland"}const sn=class sn{static perlinNoise(yt,vt){const bt=Math.floor(yt)&255,Tt=Math.floor(vt)&255;yt-=Math.floor(yt),vt-=Math.floor(vt);const Et=sn.fade(yt),wt=sn.fade(vt),St=sn.permutation[bt]+Tt,At=sn.permutation[bt+1]+Tt;return sn.lerp(wt,sn.lerp(Et,sn.grad(sn.permutation[St],yt,vt),sn.grad(sn.permutation[At],yt-1,vt)),sn.lerp(Et,sn.grad(sn.permutation[St+1],yt,vt-1),sn.grad(sn.permutation[At+1],yt-1,vt-1)))}static fractionalBrownianMotion(yt,vt,bt=4,Tt=.5,Et=1){let wt=0,St=1,At=Et,Rt=0;for(let Pt=0;Pt<bt;Pt++)wt+=sn.perlinNoise(yt*At,vt*At)*St,Rt+=St,St*=Tt,At*=2;return wt/Rt}static ridgedNoise(yt,vt,bt=4){let Tt=0,Et=1,wt=1;for(let St=0;St<bt;St++){const At=Math.abs(sn.perlinNoise(yt*wt,vt*wt));Tt+=(1-At)*Et,Et*=.5,wt*=2}return Tt}static fade(yt){return yt*yt*yt*(yt*(yt*6-15)+10)}static lerp(yt,vt,bt){return vt+yt*(bt-vt)}static grad(yt,vt,bt){const Tt=yt&3,Et=Tt<2?vt:bt,wt=Tt<2?bt:vt;return(Tt&1?-Et:Et)+(Tt&2?-wt:wt)}};Bt(sn,"permutation",[]),(()=>{for(let yt=0;yt<256;yt++)sn.permutation[yt]=Math.floor(Math.random()*256)})();let TerrainNoiseGenerator=sn;const pn=class pn{constructor(){Bt(this,"textureAtlas");Bt(this,"terrainCache",new Map);this.textureAtlas=new TerrainTextureAtlas(2048),this.textureAtlas.generateAtlas()}static getInstance(){return pn.instance||(pn.instance=new pn),pn.instance}getTextureAtlas(){return this.textureAtlas}getTerrainData(yt,vt){var Et;const bt=`${Math.floor(yt/10)}_${Math.floor(vt/10)}`;let Tt=this.terrainCache.get(bt);if(!Tt){const wt=this.calculateTerrainHeight(yt,vt),St=this.calculateSlope(yt,vt),At=this.calculateUrbanFactor(yt,vt),Rt=this.calculateDistanceFromWater(yt,vt),Pt=getTerrainTextureKey(wt,St,At,Rt),Ct=(Et=this.textureAtlas.getTextureConfig(Pt))==null?void 0:Et.materials;Tt={elevation:wt,textureKey:Pt,materials:Ct,slope:St},this.terrainCache.set(bt,Tt)}return Tt}calculateTerrainHeight(yt,vt){const Tt=TerrainNoiseGenerator.fractionalBrownianMotion(yt*8e-4,vt*8e-4,6,.6,1)*25,Et=TerrainNoiseGenerator.ridgedNoise(yt*8e-4*.5,vt*8e-4*.5,4)*15,wt=TerrainNoiseGenerator.perlinNoise(yt*8e-4*.3,vt*8e-4*.3)*40,St=this.calculateHillContributions(yt,vt),Rt=(Tt+Et*.7+wt*.4)*.4+St,Pt=Math.sqrt(yt*yt+vt*vt),Ct=this.calculateRiverElevation(yt,vt);if(Pt<3e3){const kt=Math.max(-2,Math.min(2,Rt*.05));return Math.min(kt,Ct)}if(Pt<6e3){const kt=(Pt-3e3)/3e3,Ft=Rt*(.05+kt*.3);return Math.min(Ft,Ct)}const Mt=.35+Math.min(1,(Pt-6e3)/2e3)*.65,Ot=Rt*Mt;return Math.min(Ot,Ct)}calculateHillContributions(yt,vt){const bt=[{x:7e3,y:0,height:1600,radius:4e3},{x:-7e3,y:0,height:1500,radius:3800},{x:0,y:8e3,height:1400,radius:4200},{x:4e3,y:-6e3,height:1300,radius:3600},{x:-4e3,y:6e3,height:1200,radius:3400}];let Tt=0;for(const Et of bt){const wt=exponentialDecayHeight(yt,vt,Et.x,Et.y,Et.height,Et.radius,1.8);if(wt>2){const St=TerrainNoiseGenerator.perlinNoise(yt*.001+Et.x*1e-4,vt*.001+Et.y*1e-4)*wt*.12;Tt+=wt+St}}return Tt}calculateSlope(yt,vt){const Tt=this.calculateTerrainHeight(yt+50,vt),Et=this.calculateTerrainHeight(yt-50,vt),wt=this.calculateTerrainHeight(yt,vt+50),St=this.calculateTerrainHeight(yt,vt-50),At=(Tt-Et)/(50*2),Rt=(wt-St)/(50*2);return Math.sqrt(At*At+Rt*Rt)}calculateUrbanFactor(yt,vt){const bt=Math.sqrt(yt*yt+vt*vt);return Math.max(0,1-bt/5e3)}calculateDistanceFromWater(yt,vt){return Math.min(distance2D(yt,vt,2e3,-1e3),distance2D(yt,vt,-1500,2e3))}calculateRiverElevation(yt,vt){let bt=1e3;const Tt=0,Et=1500,wt=Math.abs(vt-Tt);if(wt<=Et/2){const Ft=wt/(Et/2),Lt=-60*(1-Ft*Ft);bt=Math.min(bt,Lt)}const St=3500,At=800,Rt=Math.abs(vt-St);if(Rt<=At/2){const Ft=Rt/(At/2),Lt=-40*(1-Ft*Ft);bt=Math.min(bt,Lt)}const Pt=-3500,Ct=800,It=Math.abs(vt-Pt);if(It<=Ct/2){const Ft=It/(Ct/2),Lt=-40*(1-Ft*Ft);bt=Math.min(bt,Lt)}const Mt=5e3,Ot=600,kt=Math.abs(yt-Mt);if(kt<=Ot/2){const Ft=kt/(Ot/2),Lt=-35*(1-Ft*Ft);bt=Math.min(bt,Lt)}return bt===1e3?1e3:bt}getDistanceToRiverCenterline(yt,vt){const bt=(yt+vt+8e3)/16e3,Tt=1500,Et=bt*8e3-4e3,wt=bt*8e3-4e3,St=Math.sin(bt*Math.PI*2)*Tt*.3,At=Math.sin(bt*Math.PI*4+1)*Tt*.15,Rt=Et+St,Pt=wt+At;return Math.sqrt((yt-Rt)*(yt-Rt)+(vt-Pt)*(vt-Pt))}getRiverWidth(yt,vt){const bt=Math.sqrt(yt*yt+vt*vt);return bt<2e3?800:bt<5e3?500:Math.sqrt((yt-6e3)*(yt-6e3)+(vt-6e3)*(vt-6e3))<3e3?1200:300}smoothStep(yt,vt,bt){const Tt=Math.max(0,Math.min(1,(bt-yt)/(vt-yt)));return Tt*Tt*(3-2*Tt)}};Bt(pn,"instance");let EnhancedTerrainGenerator=pn;function createTerrainLayer(){const xt=EnhancedTerrainGenerator.getInstance(),vt=xt.getTextureAtlas().getTextureRegions(),bt=12e3,Tt=400,Et=Math.ceil(bt/Tt),wt=bt/2,St=[];for(let At=0;At<Et;At++)for(let Rt=0;Rt<Et;Rt++){const Pt=-wt+(At+.5)*Tt,Ct=-wt+(Rt+.5)*Tt;if(Math.abs(Pt)>wt||Math.abs(Ct)>wt)continue;const It=xt.getTerrainData(Pt,Ct),{elevation:Mt,textureKey:Ot,materials:kt,slope:Ft}=It;if(Mt==null||!isFinite(Mt)){console.warn(`Invalid elevation for terrain tile at ${Pt}, ${Ct}: ${Mt}`);continue}const Nt=vt[Ot];if(!Nt){console.warn(`Missing texture region for key: ${Ot}`);continue}const Lt=Math.sqrt(Pt*Pt+Ct*Ct),Dt=Math.max(0,1-Lt/5e3),$t=calculateSlopeShading(Ft),zt=calculateAtmosphericEffect(Lt),Ut=getTextureBasedColor(Ot,Mt,Dt),jt=[Math.max(20,Math.min(255,Math.floor(Ut[0]*$t*zt.lighting+zt.haze))),Math.max(20,Math.min(255,Math.floor(Ut[1]*$t*zt.lighting+zt.haze))),Math.max(20,Math.min(255,Math.floor(Ut[2]*$t*zt.lighting+zt.haze*1.1))),255],Ht=Tt/2;St.push({id:`terrain-${At}-${Rt}`,polygon:[[Pt-Ht,Ct-Ht],[Pt+Ht,Ct-Ht],[Pt+Ht,Ct+Ht],[Pt-Ht,Ct+Ht]],elevation:Mt,color:jt,textureKey:Ot,textureCoords:[[Nt.x,Nt.y],[Nt.x+Nt.width,Nt.y],[Nt.x+Nt.width,Nt.y+Nt.height],[Nt.x,Nt.y+Nt.height]],materials:kt||{ambient:.4,diffuse:.8,specular:.1,roughness:.8}})}return new PolygonLayer({id:"terrain-layer",data:St,coordinateSystem:2,coordinateOrigin:[-74.006,40.7128,0],getPolygon:At=>At.polygon,getElevation:At=>At.elevation,getFillColor:At=>At.color,getLineColor:[0,0,0,0],getLineWidth:0,extruded:!0,wireframe:!1,filled:!0,stroked:!1,elevationScale:1,pickable:!1,material:At=>{var Rt,Pt,Ct,It;return{ambient:((Rt=At.materials)==null?void 0:Rt.ambient)||.4,diffuse:((Pt=At.materials)==null?void 0:Pt.diffuse)||.8,shininess:1/(((Ct=At.materials)==null?void 0:Ct.roughness)||.8),specularColor:((It=At.materials)==null?void 0:It.metallic)>.1?[100,100,120]:[40,45,50]}},lightSettings:{lightsPosition:[-74.006,40.7128,5e3,-74.006,40.7128,5e3],ambientRatio:.3,diffuseRatio:.7,specularRatio:.05,numberOfLights:2},updateTriggers:{getFillColor:[St.length]}})}function calculateSlopeShading(xt,yt,vt){const bt={x:.5,y:.7},Tt=Math.min(xt,1),Et=1+(Tt*bt.y-Tt*bt.x)*.4;return Math.max(.5,Math.min(1.5,Et))}function calculateAtmosphericEffect(xt){const yt=Math.min(1,xt/1e4);return{lighting:1-yt*.2,haze:yt*15}}function getTextureBasedColor(xt,yt,vt){const Tt={lush_grass:[74,124,89],dry_grass:[139,115,85],rich_soil:[139,69,19],rocky_terrain:[105,105,105],mountain_stone:[95,95,95],smooth_concrete:[192,192,192],weathered_concrete:[160,160,160],dark_asphalt:[47,47,47],forest_floor:[34,139,34],sandy_beach:[244,164,96],marsh_wetland:[85,107,47],coarse_gravel:[128,128,128]}[xt]||[100,100,100],Et=1+yt/1e3,wt=vt>.3?1.1:1;return[Math.min(255,Tt[0]*Et*wt),Math.min(255,Tt[1]*Et*wt),Math.min(255,Tt[2]*Et*wt)]}function createWaterLayer(xt){if(!xt||!xt.path||xt.path.length===0){const Et=[{id:"default-water",polygon:[[-74.026,40.7028],[-73.986,40.7028],[-73.986,40.7228],[-74.026,40.7228]]}];return new PolygonLayer({id:"water-layer",data:Et,getPolygon:wt=>wt.polygon,getFillColor:[64,164,223,180],getLineColor:[255,255,255,0],getLineWidth:0,extruded:!1,wireframe:!1,filled:!0,stroked:!1,pickable:!1})}const yt=[],vt=xt.width||200;for(let bt=0;bt<xt.path.length-1;bt++){const Tt=xt.path[bt],Et=xt.path[bt+1];if(!Tt||!Et)continue;const wt=-74.006,St=40.7128,At=1/111320,Rt=1/110540,Pt=wt+Tt.x*At,Ct=St+Tt.y*Rt,It=wt+Et.x*At,Mt=St+Et.y*Rt,Ot=It-Pt,kt=Mt-Ct,Ft=Math.sqrt(Ot*Ot+kt*kt);if(Ft>0){const Nt=-kt/Ft*(vt*At/2),Lt=Ot/Ft*(vt*Rt/2);yt.push({id:`river-segment-${bt}`,polygon:[[Pt+Nt,Ct+Lt],[Pt-Nt,Ct-Lt],[It-Nt,Mt-Lt],[It+Nt,Mt+Lt]]})}}return new PolygonLayer({id:"water-layer",data:yt,getPolygon:bt=>bt.polygon,getElevation:()=>-2,getFillColor:[30,144,255,200],getLineColor:[0,100,200,255],getLineWidth:2,extruded:!0,wireframe:!1,filled:!0,stroked:!0,elevationScale:1,pickable:!0,material:{ambient:.3,diffuse:.6,shininess:128,specularColor:[255,255,255]}})}function createGroundLayer(){const xt=new TerrainTextureAtlas(1024);xt.generateAtlas();const yt=xt.getTextureRegions(),vt=15e3,bt=500,Tt=Math.ceil(vt/bt),Et=[];for(let wt=0;wt<Tt;wt++)for(let St=0;St<Tt;St++){const At=-7500+(wt+.5)*bt,Rt=-7500+(St+.5)*bt,Pt=Math.sqrt(At*At+Rt*Rt),Ct=Math.max(0,1-Pt/6e3),It=getSimpleTerrainHeight(At,Rt),Mt=calculateSimpleSlope(At,Rt),Ot=getGroundTextureKey(It,Mt,Ct),kt=yt[Ot]||yt.rich_soil,Ft=xt.getTextureConfig(Ot),Nt=getGroundBaseColor(Ot),Lt=calculateGroundEnvironmentalEffects(At,Rt,It),Dt=[Math.max(30,Math.min(255,Math.floor(Nt[0]*Lt.lighting+Lt.ambient))),Math.max(30,Math.min(255,Math.floor(Nt[1]*Lt.lighting+Lt.ambient))),Math.max(30,Math.min(255,Math.floor(Nt[2]*Lt.lighting+Lt.ambient))),255],$t=bt/2;Et.push({id:`ground-${wt}-${St}`,polygon:[[At-$t,Rt-$t],[At+$t,Rt-$t],[At+$t,Rt+$t],[At-$t,Rt+$t]],elevation:It-.5,color:Dt,textureKey:Ot,textureCoords:[[kt.x,kt.y],[kt.x+kt.width,kt.y],[kt.x+kt.width,kt.y+kt.height],[kt.x,kt.y+kt.height]],materials:(Ft==null?void 0:Ft.materials)||{ambient:.5,diffuse:.7,roughness:.9,metallic:0}})}return new PolygonLayer({id:"ground-layer",data:Et,coordinateSystem:2,coordinateOrigin:[-74.006,40.7128,0],getPolygon:wt=>wt.polygon,getElevation:wt=>wt.elevation,getFillColor:wt=>wt.color,getLineColor:[0,0,0,0],getLineWidth:0,extruded:!0,wireframe:!1,filled:!0,stroked:!1,elevationScale:1,pickable:!1,material:wt=>{var St,At,Rt,Pt;return{ambient:((St=wt.materials)==null?void 0:St.ambient)||.5,diffuse:((At=wt.materials)==null?void 0:At.diffuse)||.7,shininess:1/(((Rt=wt.materials)==null?void 0:Rt.roughness)||.9),specularColor:((Pt=wt.materials)==null?void 0:Pt.metallic)>.1?[60,60,70]:[20,20,20]}},lightSettings:{lightsPosition:[-74.006,40.7128,3e3,-74.006,40.7128,3e3],ambientRatio:.4,diffuseRatio:.6,specularRatio:.02,numberOfLights:2},updateTriggers:{getFillColor:[Et.length]}})}function getSimpleTerrainHeight(xt,yt){const bt=Math.sin(xt*5e-4+yt*5e-4*1.3)*8,Tt=Math.cos(xt*5e-4*1.7+yt*5e-4)*5,Et=Math.sin(xt*5e-4*2.1+yt*5e-4*2.3)*3,wt=bt+Tt+Et,St=Math.sqrt(xt*xt+yt*yt),At=Math.max(.8,1-St/12e3);return wt*At}function calculateSimpleSlope(xt,yt){const bt=getSimpleTerrainHeight(xt+100,yt),Tt=getSimpleTerrainHeight(xt-100,yt),Et=getSimpleTerrainHeight(xt,yt+100),wt=getSimpleTerrainHeight(xt,yt-100),St=(bt-Tt)/(100*2),At=(Et-wt)/(100*2);return Math.sqrt(St*St+At*At)}function getGroundTextureKey(xt,yt,vt,bt){return vt>.8?xt>0?"smooth_concrete":"dark_asphalt":vt>.5?"weathered_concrete":vt>.2?xt>10?"dry_grass":"rich_soil":xt>30?yt>.2?"rocky_terrain":"dry_grass":xt>10?"lush_grass":xt>0?"rich_soil":"marsh_wetland"}function getGroundBaseColor(xt,yt,vt){return{lush_grass:[60,100,70],dry_grass:[110,90,65],rich_soil:[100,50,15],rocky_terrain:[85,85,85],smooth_concrete:[160,160,160],weathered_concrete:[130,130,130],dark_asphalt:[35,35,35],marsh_wetland:[70,85,40]}[xt]||[80,80,80]}function calculateGroundEnvironmentalEffects(xt,yt,vt){const bt=Math.sqrt(xt*xt+yt*yt),Tt=.9,Et=Math.min(.1,vt/100),wt=Math.min(.1,bt/15e3);return{lighting:Tt+Et-wt,ambient:10+(vt>0?5:0)}}function createAutonomousAgentLayer(xt){return[new ScatterplotLayer({id:"autonomous-agents",data:xt,getPosition:yt=>yt.position,getRadius:yt=>yt.size,getFillColor:yt=>yt.color,getLineColor:[255,255,255,100],lineWidthMinPixels:1,radiusScale:1,radiusMinPixels:2,radiusMaxPixels:20,pickable:!0,stroked:!0,filled:!0}),new PathLayer({id:"agent-paths",data:xt.filter(yt=>yt.path&&yt.path.length>1),getPath:yt=>yt.path,getColor:yt=>[yt.color[0],yt.color[1],yt.color[2],80],getWidth:yt=>yt.type==="airplane"?5:2,widthScale:1,widthMinPixels:1,pickable:!1})]}function generateAutonomousAgents(xt,yt,vt){var Tt,Et,wt;const bt=[];if(vt!=null&&vt.buildings){const St=vt.buildings.filter(Rt=>{var Pt;return Rt.type===0||((Pt=Rt.zone_id)==null?void 0:Pt.includes("residential"))}),At=Math.min(100,St.length*2);for(let Rt=0;Rt<At;Rt++){const Pt=St[Math.floor(Math.random()*St.length)];if((Tt=Pt==null?void 0:Pt.footprint)!=null&&Tt[0]){const Ct=Pt.footprint[0],It=[Ct.x+(Math.random()-.5)*30,Ct.y+(Math.random()-.5)*30,1];bt.push({id:`car-${Rt}`,type:"car",position:It,velocity:[(Math.random()-.5)*5e-4,(Math.random()-.5)*5e-4,0],color:[Math.random()*100+100,Math.random()*100+100,Math.random()*100+100,255],size:2})}}}else for(let St=0;St<50;St++){const At=(Math.random()-.5)*.01,Rt=[yt+At,xt+(Math.random()-.5)*.01,1];bt.push({id:`car-${St}`,type:"car",position:Rt,velocity:[(Math.random()-.5)*5e-4,(Math.random()-.5)*5e-4,0],color:[150,150,150,255],size:2})}if(vt!=null&&vt.buildings){const St=vt.buildings.filter(Rt=>Rt.height>50),At=Math.min(15,Math.floor(St.length/3));for(let Rt=0;Rt<At;Rt++){const Pt=St[Math.floor(Math.random()*St.length)];if((Et=Pt==null?void 0:Pt.footprint)!=null&&Et[0]&&Pt.height){const Ct=Pt.footprint.reduce((Nt,Lt)=>({x:Nt.x+Lt.x/Pt.footprint.length,y:Nt.y+Lt.y/Pt.footprint.length}),{x:0,y:0}),It=Pt.height+10,Mt=[Ct.x,Ct.y,It],Ot=[],kt=200,Ft=Math.max(It,100);for(let Nt=0;Nt<12;Nt++){const Lt=Nt/12*Math.PI*2;Ot.push([Ct.x+Math.cos(Lt)*kt,Ct.y+Math.sin(Lt)*kt,Ft+Math.sin(Nt*.5)*20])}bt.push({id:`drone-${Rt}`,type:"drone",position:Mt,velocity:[0,0,2],path:Ot,color:[255,150,0,255],size:3})}}}else for(let St=0;St<10;St++){const At=100+Math.random()*100,Rt=[yt+(Math.random()-.5)*.01,xt+(Math.random()-.5)*.01,At];bt.push({id:`drone-${St}`,type:"drone",position:Rt,velocity:[0,0,2],color:[255,150,0,255],size:3})}if(vt!=null&&vt.buildings){const St=vt.buildings,At=Math.min(50,St.length);for(let Rt=0;Rt<At;Rt++){const Pt=St[Math.floor(Math.random()*St.length)];if((wt=Pt==null?void 0:Pt.footprint)!=null&&wt[0]){const Ct=Pt.footprint[0];let It,Mt;typeof Ct=="object"&&"x"in Ct&&"y"in Ct?(It=Ct.x+(Math.random()-.5)*10,Mt=Ct.y+(Math.random()-.5)*10):Array.isArray(Ct)&&Ct.length>=2?(It=Ct[0]+(Math.random()-.5)*1e-4,Mt=Ct[1]+(Math.random()-.5)*1e-4):(It=yt,Mt=xt);const Ot=[It,Mt,.1];bt.push({id:`person-${Rt}`,type:"person",position:Ot,velocity:[(Math.random()-.5)*2e-4,(Math.random()-.5)*2e-4,0],color:[Math.random()*50+50,Math.random()*50+50,Math.random()*50+50,255],size:1})}}}for(let St=0;St<10;St++){const At=1e3+Math.random()*5e3,Rt=yt+(Math.random()-.5)*.1,Pt=xt+(Math.random()-.5)*.1,Ct=[],It=Math.random()*Math.PI*2;for(let Mt=0;Mt<50;Mt++){const Ot=Mt*.002;Ct.push([Rt+Math.cos(It)*Ot,Pt+Math.sin(It)*Ot,At+(Math.random()-.5)*100])}bt.push({id:`airplane-${St}`,type:"airplane",position:Ct[0],velocity:[Math.cos(It)*.01,Math.sin(It)*.01,0],path:Ct,color:[255,255,255,255],size:8})}for(let St=0;St<500;St++){const At=[yt+(Math.random()-.5)*.015,xt+(Math.random()-.5)*.015,1.7];bt.push({id:`person-${St}`,type:"person",position:At,velocity:[(Math.random()-.5)*1e-4,(Math.random()-.5)*1e-4,0],color:[255,200,100,255],size:1})}return bt}function createWeatherLayer(xt){return new ScatterplotLayer({id:"weather-layer",data:xt,getPosition:yt=>yt.position,getRadius:yt=>yt.size*yt.intensity,getFillColor:yt=>[yt.color[0],yt.color[1],yt.color[2],Math.floor(yt.color[3]*yt.intensity*(yt.lifespan/100))],radiusScale:1,radiusMinPixels:1,radiusMaxPixels:15,pickable:!1,stroked:!1,filled:!0})}function generateWeatherSystem(xt,yt,vt="clear"){const bt=[];if(vt==="clear"){for(let Tt=0;Tt<100;Tt++)bt.push({id:`dust-${Tt}`,type:"fog",position:[yt+(Math.random()-.5)*.05,xt+(Math.random()-.5)*.05,100+Math.random()*500],intensity:.1,velocity:[(Math.random()-.5)*1e-4,(Math.random()-.5)*1e-4,0],size:2,color:[200,200,200,30],lifespan:100});return bt}if(vt==="rain"){for(let Tt=0;Tt<2e3;Tt++)bt.push({id:`rain-${Tt}`,type:"rain",position:[yt+(Math.random()-.5)*.08,xt+(Math.random()-.5)*.08,200+Math.random()*800],intensity:.6+Math.random()*.4,velocity:[1e-4,0,-20],size:.5,color:[100,150,255,120],lifespan:50+Math.random()*50});for(let Tt=0;Tt<20;Tt++)bt.push({id:`cloud-${Tt}`,type:"cloud",position:[yt+(Math.random()-.5)*.1,xt+(Math.random()-.5)*.1,800+Math.random()*400],intensity:.3+Math.random()*.4,velocity:[(Math.random()-.5)*.001,(Math.random()-.5)*.001,0],size:50,color:[80,80,80,100],lifespan:100})}if(vt==="snow")for(let Tt=0;Tt<1500;Tt++)bt.push({id:`snow-${Tt}`,type:"snow",position:[yt+(Math.random()-.5)*.08,xt+(Math.random()-.5)*.08,100+Math.random()*600],intensity:.7+Math.random()*.3,velocity:[(Math.random()-.5)*2e-4,(Math.random()-.5)*2e-4,-5-Math.random()*10],size:1+Math.random()*2,color:[255,255,255,180],lifespan:80+Math.random()*40});if(vt==="fog")for(let Tt=0;Tt<500;Tt++)bt.push({id:`fog-${Tt}`,type:"fog",position:[yt+(Math.random()-.5)*.06,xt+(Math.random()-.5)*.06,10+Math.random()*200],intensity:.2+Math.random()*.4,velocity:[(Math.random()-.5)*3e-4,(Math.random()-.5)*3e-4,0],size:10+Math.random()*20,color:[220,220,220,80],lifespan:100});return bt}function createWindLayer(xt,yt){const vt=[];for(let Et=0;Et<20;Et++)for(let wt=0;wt<20;wt++){const St=yt-.04+Et*.004,At=xt-20*.004/2+wt*.004,Rt=Math.sin(Et*.3)*Math.cos(wt*.3)+Math.random()*.5,Pt=.001+Math.random()*.002,Ct=St+Math.cos(Rt)*Pt,It=At+Math.sin(Rt)*Pt;vt.push({id:`wind-${Et}-${wt}`,path:[[St,At,50],[Ct,It,50]],intensity:Math.random()})}return new PathLayer({id:"wind-vectors",data:vt,getPath:Et=>Et.path,getColor:Et=>[100,200,255,Math.floor(100*Et.intensity)],getWidth:2,widthScale:1,pickable:!1})}class SeededRandom{constructor(yt){Bt(this,"seed");this.seed=yt}next(){return this.seed=(this.seed*9301+49297)%233280,this.seed/233280}}class PerlinNoise{constructor(yt){Bt(this,"permutation");Bt(this,"rng");this.rng=new SeededRandom(yt),this.permutation=[];for(let vt=0;vt<256;vt++)this.permutation[vt]=vt;for(let vt=255;vt>0;vt--){const bt=Math.floor(this.rng.next()*(vt+1));[this.permutation[vt],this.permutation[bt]]=[this.permutation[bt],this.permutation[vt]]}for(let vt=0;vt<256;vt++)this.permutation[256+vt]=this.permutation[vt]}fade(yt){return yt*yt*yt*(yt*(yt*6-15)+10)}lerp(yt,vt,bt){return vt+yt*(bt-vt)}grad(yt,vt,bt){const Tt=yt&15,Et=Tt<8?vt:bt,wt=Tt<4?bt:Tt===12||Tt===14?vt:0;return(Tt&1?-Et:Et)+(Tt&2?-wt:wt)}noise2D(yt,vt){const bt=Math.floor(yt)&255,Tt=Math.floor(vt)&255;yt-=Math.floor(yt),vt-=Math.floor(vt);const Et=this.fade(yt),wt=this.fade(vt),St=this.permutation[bt]+Tt,At=this.permutation[St],Rt=this.permutation[St+1],Pt=this.permutation[bt+1]+Tt,Ct=this.permutation[Pt],It=this.permutation[Pt+1];return this.lerp(wt,this.lerp(Et,this.grad(this.permutation[At],yt,vt),this.grad(this.permutation[Ct],yt-1,vt)),this.lerp(Et,this.grad(this.permutation[Rt],yt,vt-1),this.grad(this.permutation[It],yt-1,vt-1)))}octaveNoise2D(yt,vt,bt,Tt){let Et=0,wt=1,St=1,At=0;for(let Rt=0;Rt<bt;Rt++)Et+=this.noise2D(yt*wt,vt*wt)*St,At+=St,St*=Tt,wt*=2;return Et/At}}function generateTerrainLayers(xt,yt=12,vt=12345){const{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=xt,St=Et-bt,At=wt-Tt,Rt=Math.max(St,At)*.4,Pt=[],Ct=new PerlinNoise(vt),It=generateTerrainMesh(xt,Rt,Ct,yt);It.length>0&&Pt.push(new PolygonLayer({id:"continuous_terrain",data:It,getPolygon:kt=>kt.vertices.map(Ft=>{const[Nt,Lt]=localToLatLng(Ft.x,Ft.y);return[Nt,Lt]}),getElevation:kt=>Math.max(0,kt.elevation),getFillColor:kt=>kt.color,getLineColor:[0,0,0,0],filled:!0,stroked:!1,extruded:!0,elevationScale:1,pickable:!1,material:{ambient:.6,diffuse:.8,shininess:32,specularColor:[255,255,255]}}));const Mt=generateRiverLayer(xt,yt,vt);Mt&&Pt.push(Mt);const Ot=generateNaturalVegetation(xt,Ct,yt);return Ot.length>0&&Pt.push(new ScatterplotLayer({id:"natural_vegetation",data:Ot,getPosition:kt=>{const[Ft,Nt]=localToLatLng(kt.x,kt.y),Lt=Ct.octaveNoise2D(kt.x*.001,kt.y*.001,4,.5)*100;return[Ft,Nt,Math.max(0,Lt+kt.size/2)]},getRadius:kt=>kt.size,getFillColor:kt=>kt.color,pickable:!1,radiusMinPixels:3,radiusMaxPixels:12})),Pt}function getTerrainColor$1(xt,yt,vt,bt){const Tt=vt>=6&&vt<=18,Et=Math.max(0,1-bt);let wt;switch(yt){case"water":wt=Tt?[45,85,135]:[20,40,70];break;case"lowland":Et>.4?wt=Tt?[140,135,125]:[70,68,63]:wt=Tt?[100,120,75]:[50,60,38];break;case"grassland":wt=Tt?[95,115,70]:[48,58,35];break;case"forest":wt=Tt?[65,95,55]:[33,48,28];break;case"mountain":wt=Tt?[115,105,90]:[58,53,45];break;default:wt=Tt?[120,118,115]:[60,59,58]}const At=.85+Math.max(0,Math.min(1,(xt+40)/120))*.3;return[Math.round(wt[0]*At),Math.round(wt[1]*At),Math.round(wt[2]*At),240]}function getVegetationColor(xt,yt){const vt=xt>=6&&xt<=18;return yt==="tree"?vt?[60,100,50,180]:[30,50,25,180]:vt?[90,140,70,160]:[45,70,35,160]}function generateTerrainMesh(xt,yt,vt,bt){const{min_x:Tt,min_y:Et,max_x:wt,max_y:St}=xt,At=[],Rt=200,Pt=.001,Ct={};for(let It=Tt-yt;It<=wt+yt;It+=Rt)for(let Mt=Et-yt;Mt<=St+yt;Mt+=Rt){const Ot=vt.octaveNoise2D(It*Pt,Mt*Pt,4,.5)*80,kt=Math.min(Math.abs(It-(Tt+wt)/2)/((wt-Tt)/2),Math.abs(Mt-(Et+St)/2)/((St-Et)/2));let Ft;Ot<-15?Ft="water":Ot<10?Ft="lowland":Ot<25?Ft="grassland":Ot<45?Ft="forest":Ft="mountain";const Nt=`${It},${Mt}`;Ct[Nt]={x:It,y:Mt,elevation:Ot,terrainType:Ft,color:getTerrainColor$1(Ot,Ft,bt,kt)}}for(let It=Tt-yt;It<wt+yt;It+=Rt)for(let Mt=Et-yt;Mt<St+yt;Mt+=Rt){const Ot=Ct[`${It},${Mt}`],kt=Ct[`${It+Rt},${Mt}`],Ft=Ct[`${It},${Mt+Rt}`],Nt=Ct[`${It+Rt},${Mt+Rt}`];if(Ot&&kt&&Ft&&Nt){const Lt=(Ot.elevation+kt.elevation+Ft.elevation)/3,Dt=blendColors$1([Ot.color,kt.color,Ft.color]);At.push({vertices:[{x:Ot.x,y:Ot.y},{x:kt.x,y:kt.y},{x:Ft.x,y:Ft.y}],elevation:Lt,color:Dt});const $t=(kt.elevation+Ft.elevation+Nt.elevation)/3,zt=blendColors$1([kt.color,Ft.color,Nt.color]);At.push({vertices:[{x:kt.x,y:kt.y},{x:Ft.x,y:Ft.y},{x:Nt.x,y:Nt.y}],elevation:$t,color:zt})}}return At}function blendColors$1(xt){if(xt.length===0)return[150,150,150,200];const yt=[0,0,0,0];return xt.forEach(vt=>{yt[0]+=vt[0],yt[1]+=vt[1],yt[2]+=vt[2],yt[3]+=vt[3]}),yt.map(vt=>Math.round(vt/xt.length))}function generateRiverLayer(xt,yt,vt){const{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=xt,St=new SeededRandom(vt),At=[],Rt=120+St.next()*80;for(let It=Tt-1e3;It<=wt+1e3;It+=100){const Mt=Math.sin(It/1200)*600,Ot=(St.next()-.5)*200,kt=Mt+Ot;At.push({x:kt,y:It})}if(At.length===0)return null;const Ct=yt>=6&&yt<=18?[70,130,180,200]:[30,60,90,200];return new PathLayer({id:"river",data:[{path:At}],getPath:It=>It.path.map(Mt=>{const[Ot,kt]=localToLatLng(Mt.x,Mt.y);return[Ot,kt,-2]}),getColor:Ct,getWidth:Rt,widthMinPixels:8,widthMaxPixels:50,pickable:!1,capRounded:!0,jointRounded:!0,material:{ambient:.8,diffuse:.6,shininess:128,specularColor:[200,220,255]}})}function generateNaturalVegetation(xt,yt,vt){const{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=xt,St=[],At=.3,Rt=.2;for(let Pt=bt;Pt<=Et;Pt+=100)for(let Ct=Tt;Ct<=wt;Ct+=100)if(yt.octaveNoise2D(Pt*.003,Ct*.003,3,.6)>Rt&&Math.random()<At){const Ot=yt.noise2D(Pt*.001,Ct*.001)>0?"tree":"bush",kt=Pt+(Math.random()-.5)*80,Ft=Ct+(Math.random()-.5)*80;St.push({x:kt,y:Ft,type:Ot,size:Ot==="tree"?8+Math.random()*6:4+Math.random()*3,color:getVegetationColor(vt,Ot)})}return St}function getTerrainProfilePresets(){return{manhattan:{name:"Manhattan",description:"Dense island city surrounded by rivers and harbors",parameters:{mountainHeight:25,waterLevel:0,hilliness:.1,riverProbability:.9,coastalDistance:800},recommendedScale:1,characteristics:["Island setting","Multiple rivers and harbors","Extremely flat terrain","Dense waterfront development","Bridge and tunnel connections"],realWorldContext:"Manhattan is a narrow island between two rivers, leading to intense vertical development due to limited land area. The flat terrain enabled the famous grid system."},san_francisco:{name:"San Francisco",description:"Hilly peninsula with dramatic elevation changes and bay access",parameters:{mountainHeight:180,waterLevel:0,hilliness:.8,riverProbability:.2,coastalDistance:1500},recommendedScale:1,characteristics:["Extremely steep hills","Peninsula location","San Francisco Bay","Varied neighborhood elevations","Cable car terrain"],realWorldContext:"San Francisco is built on steep hills that dictated its unique development pattern. The peninsula location creates microclimates and stunning water views from elevated areas."},denver:{name:"Denver",description:"High plains city with Rocky Mountain backdrop",parameters:{mountainHeight:200,waterLevel:-1600,hilliness:.3,riverProbability:.4,coastalDistance:16e5},recommendedScale:10,characteristics:["High elevation (mile high)","Great Plains setting","Rocky Mountain foothills","Continental climate","Grid system possible due to flat terrain"],realWorldContext:"Denver sits on the high plains at the base of the Rocky Mountains. The high elevation and continental location create a unique urban environment with dramatic mountain views."},miami:{name:"Miami",description:"Coastal lowlands with barrier islands and wetlands",parameters:{mountainHeight:8,waterLevel:2,hilliness:.02,riverProbability:.6,coastalDistance:400},recommendedScale:1,characteristics:["Extremely flat terrain","Barrier island system","Coastal flooding risk","Subtropical wetlands","Artificial waterways"],realWorldContext:"Miami is built on former swampland with virtually no elevation. The flat terrain and proximity to sea level make it highly vulnerable to flooding and hurricanes."},seattle:{name:"Seattle",description:"Puget Sound hills with multiple water bodies",parameters:{mountainHeight:160,waterLevel:0,hilliness:.6,riverProbability:.5,coastalDistance:1200},recommendedScale:1,characteristics:["Rolling hills","Multiple water bodies","Puget Sound waterfront","Distinct neighborhoods on hills","Rain shadow effects"],realWorldContext:"Seattle is built on hills between Puget Sound and Lake Washington, creating distinct neighborhoods with water views. The terrain influenced the city's organic growth pattern."},chicago:{name:"Chicago",description:"Great Lakes shore on former prairie land",parameters:{mountainHeight:12,waterLevel:0,hilliness:.03,riverProbability:.3,coastalDistance:600},recommendedScale:5,characteristics:["Perfectly flat terrain","Great Lakes shoreline","Former prairie landscape","Grid system enabled by flatness","Engineered river reversal"],realWorldContext:"Chicago was built on flat prairie land next to Lake Michigan. The extremely flat terrain enabled the famous grid system and made large-scale urban planning possible."},las_vegas:{name:"Las Vegas",description:"Desert valley surrounded by mountains",parameters:{mountainHeight:300,waterLevel:-600,hilliness:.4,riverProbability:.1,coastalDistance:4e5},recommendedScale:10,characteristics:["Desert valley setting","Surrounded by mountains","Arid environment","Planned city development","Water scarcity"],realWorldContext:"Las Vegas sits in a desert valley surrounded by mountains. The scarcity of water and extreme climate shaped its development as a modern planned city."},new_orleans:{name:"New Orleans",description:"Below-sea-level bowl shaped city with levees",parameters:{mountainHeight:6,waterLevel:3,hilliness:.05,riverProbability:.8,coastalDistance:16e4},recommendedScale:1,characteristics:["Below sea level","Bowl-shaped topography","Levee system required","Flood risk","River delta location"],realWorldContext:"New Orleans sits in a natural bowl below sea level in the Mississippi River delta. The unique topography requires extensive levee systems and creates perpetual flood risk."},custom:{name:"Custom",description:"User-defined terrain parameters for experimental cities",parameters:{mountainHeight:100,waterLevel:0,hilliness:.5,riverProbability:.3,coastalDistance:5e3},recommendedScale:1,characteristics:["Fully customizable","Experimental terrain","User-defined parameters"],realWorldContext:"Create your own unique geographic setting to explore how different terrain shapes urban development patterns."}}}function getTerrainProfile(xt){return getTerrainProfilePresets()[xt]||null}function createEnhancedTerrainLayer(xt){const{bounds:yt,terrainState:vt,cityData:bt,forceLayer:Tt}=xt;if(!vt.isEnabled)return[];const Et=Tt||determineOptimalTerrainSystem(vt);try{switch(Et){case"planetary":return createPlanetaryTerrainLayers(yt,vt);case"basic":return createBasicTerrainLayers(yt,vt,bt);case"none":default:return[]}}catch(wt){return console.warn("Error creating terrain layers, falling back to basic terrain:",wt),createBasicTerrainLayers(yt,vt)}}function determineOptimalTerrainSystem(xt){const{scale:yt,activeLayer:vt,terrainProfile:bt}=xt;if(vt&&vt!=="none")return vt;if(yt>100)return"planetary";if(yt>10){const Tt=getTerrainProfile(bt);return Tt&&Tt.recommendedScale>5?"planetary":"basic"}else return"basic"}function createPlanetaryTerrainLayers(xt,yt){const{scale:vt,seed:bt,timeOfDay:Tt,showAtmosphere:Et,customParameters:wt}=yt;try{const St={bounds:xt,scale:vt,timeOfDay:Tt,seed:bt,showAtmosphere:Et&&vt>50};return generatePlanetaryStyleLayers(xt,yt)}catch(St){return console.error("Failed to create planetary terrain layers:",St),[]}}function createBasicTerrainLayers(xt,yt,vt){const{timeOfDay:bt,seed:Tt}=yt;try{return generateTerrainLayers(xt||{min_x:-5e3,min_y:-5e3,max_x:5e3,max_y:5e3},bt,Tt)}catch(Et){return console.error("Failed to create basic terrain layers:",Et),[]}}function generatePlanetaryStyleLayers(xt,yt){const{scale:vt,seed:bt,timeOfDay:Tt,customParameters:Et,terrainProfile:wt}=yt,St=getTerrainProfile(wt),At=wt==="custom"?Et:(St==null?void 0:St.parameters)||Et,Rt=new SimplePlanetaryNoise(bt),Pt=[],Ct=generatePlanetaryTerrainMesh(xt,At,Rt,vt,Tt);if(Ct.length>0){const It=new PolygonLayer({id:"enhanced_planetary_terrain",data:Ct,getPolygon:Mt=>Mt.vertices.map(Ot=>[Ot.x/111320,Ot.y/110540]),getElevation:Mt=>Math.max(0,Mt.elevation*(vt>100?.1:2)),getFillColor:Mt=>Mt.color,getLineColor:[0,0,0,0],filled:!0,stroked:!1,extruded:!0,elevationScale:3,pickable:!1,material:{ambient:.4,diffuse:.8,shininess:32,specularColor:[255,255,255]}});Pt.push(It)}return Pt}function generatePlanetaryTerrainMesh(xt,yt,vt,bt,Tt){const{min_x:Et,min_y:wt,max_x:St,max_y:At}=xt,Rt=[];let Pt=bt>100?1e3:bt>10?100:50;const Ct={};for(let It=Et;It<=St;It+=Pt)for(let Mt=wt;Mt<=At;Mt+=Pt){const Ot=generateTerrainElevation(It,Mt,yt,vt,bt),kt=getTerrainType(Ot,yt,bt),Ft=getTerrainColor(Ot,kt,Tt,bt);Ct[`${It},${Mt}`]={x:It,y:Mt,elevation:Ot,terrainType:kt,color:Ft}}for(let It=Et;It<St;It+=Pt)for(let Mt=wt;Mt<At;Mt+=Pt){const Ot=Ct[`${It},${Mt}`],kt=Ct[`${It+Pt},${Mt}`],Ft=Ct[`${It},${Mt+Pt}`],Nt=Ct[`${It+Pt},${Mt+Pt}`];Ot&&kt&&Ft&&Rt.push({vertices:[{x:Ot.x,y:Ot.y,z:Ot.elevation},{x:kt.x,y:kt.y,z:kt.elevation},{x:Ft.x,y:Ft.y,z:Ft.elevation}],elevation:(Ot.elevation+kt.elevation+Ft.elevation)/3,color:blendColors([Ot.color,kt.color,Ft.color])}),kt&&Ft&&Nt&&Rt.push({vertices:[{x:kt.x,y:kt.y,z:kt.elevation},{x:Ft.x,y:Ft.y,z:Ft.elevation},{x:Nt.x,y:Nt.y,z:Nt.elevation}],elevation:(kt.elevation+Ft.elevation+Nt.elevation)/3,color:blendColors([kt.color,Ft.color,Nt.color])})}return Rt}function generateTerrainElevation(xt,yt,vt,bt,Tt){const Et=Tt>100?1e-4:.001,wt=Tt>100?5e-4:.003,St=bt.noise2D(xt*Et,yt*Et),At=bt.ridgedNoise(xt,yt,4,wt,vt.mountainHeight*.5),Rt=bt.noise2D(xt*Et*3,yt*Et*3)*.2;return St*vt.mountainHeight*.3+At+Rt+vt.waterLevel}function getTerrainType(xt,yt,vt){return vt>100?xt<yt.waterLevel-1e3?"deep_ocean":xt<yt.waterLevel?"ocean":xt<yt.waterLevel+100?"coastal":xt<500?"lowlands":xt<1500?"highlands":"mountains":xt<yt.waterLevel-10?"water":xt<yt.waterLevel+5?"lowland":xt<50?"grassland":xt<100?"hills":"mountains"}function getTerrainColor(xt,yt,vt,bt){const Et=vt>=6&&vt<=18?.8:.4;let wt;if(bt>100)switch(yt){case"deep_ocean":wt=[25,25,112];break;case"ocean":wt=[65,105,225];break;case"coastal":wt=[100,149,237];break;case"lowlands":wt=[34,139,34];break;case"highlands":wt=[107,142,35];break;case"mountains":wt=[139,137,137];break;default:wt=[160,160,160]}else switch(yt){case"water":wt=[70,130,180];break;case"lowland":wt=[120,150,80];break;case"grassland":wt=[95,115,70];break;case"hills":wt=[139,119,101];break;case"mountains":wt=[105,105,105];break;default:wt=[150,150,150]}return[...wt.map(At=>Math.round(At*Et)),220]}function blendColors(xt){if(xt.length===0)return[150,150,150,200];const yt=[0,0,0,0];return xt.forEach(vt=>{yt[0]+=vt[0]||0,yt[1]+=vt[1]||0,yt[2]+=vt[2]||0,yt[3]+=vt[3]||0}),yt.map(vt=>Math.round(vt/xt.length))}class SimplePlanetaryNoise{constructor(yt){Bt(this,"seed");Bt(this,"perm");this.seed=yt,this.perm=this.generatePermutation()}generatePermutation(){const yt=Array.from({length:256},(bt,Tt)=>Tt);let vt=this.seed;for(let bt=255;bt>0;bt--){vt=(vt*9301+49297)%233280;const Tt=Math.floor(vt/233280*(bt+1));[yt[bt],yt[Tt]]=[yt[Tt],yt[bt]]}return[...yt,...yt]}noise2D(yt,vt){const bt=Math.floor(yt)&255,Tt=Math.floor(vt)&255;yt-=Math.floor(yt),vt-=Math.floor(vt);const Et=Ct=>Ct*Ct*Ct*(Ct*(Ct*6-15)+10),wt=(Ct,It,Mt)=>It+Ct*(Mt-It),St=Et(yt),At=Et(vt),Rt=this.perm[bt]+Tt,Pt=this.perm[bt+1]+Tt;return wt(At,wt(St,this.grad(this.perm[Rt],yt,vt),this.grad(this.perm[Pt],yt-1,vt)),wt(St,this.grad(this.perm[Rt+1],yt,vt-1),this.grad(this.perm[Pt+1],yt-1,vt-1)))}ridgedNoise(yt,vt,bt,Tt,Et){let wt=0,St=Et,At=Tt;for(let Rt=0;Rt<bt;Rt++){const Pt=this.noise2D(yt*At,vt*At);wt+=Math.abs(Pt)*St,St*=.5,At*=2}return wt}grad(yt,vt,bt){const Tt=yt&3,Et=Tt<2?vt:bt,wt=Tt<1?bt:Tt===2?vt:0;return(Tt&1?-Et:Et)+(Tt&2?-wt:wt)}}const LAYER_DEFINITIONS={sewer_system:{opacity:.6,color:[139,69,19,150]},underground_parking:{opacity:.8,color:[70,70,70,200]},utility_tunnels:{opacity:.7,color:[255,255,0,180]},elevated_highways:{opacity:.9,color:[100,100,100,230]},sky_bridges:{opacity:.8,color:[200,200,255,200]},elevated_transit:{opacity:.9,color:[255,100,100,230]},helicopters:{color:[255,255,0,255]},aircraft:{color:[0,255,255,200]},drones:{color:[255,0,255,230]}};function createSewerLayer(xt){const yt=LAYER_DEFINITIONS.sewer_system;return new PathLayer({id:"sewer_system",data:xt,getPath:vt=>vt.path||vt.coordinates,getWidth:vt=>vt.diameter||2,getColor:yt.color,opacity:yt.opacity,pickable:!0,widthMinPixels:2,widthMaxPixels:10,getElevation:vt=>vt.elevation||-15,extruded:!0,material:{ambient:.1,diffuse:.4,shininess:16,specularColor:[100,60,40]},transitions:{getColor:500,getWidth:300}})}function generateSewerNetwork(xt,yt=.5){const vt=[],{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=xt,St=(Et-bt)/10;for(let At=bt;At<=Et;At+=St)vt.push({id:`sewer_main_ns_${At}`,path:[[At,Tt],[At,wt]],diameter:3,elevation:-18,type:"main",flow_rate:Math.random()*100});for(let At=Tt;At<=wt;At+=St)vt.push({id:`sewer_main_ew_${At}`,path:[[bt,At],[Et,At]],diameter:3,elevation:-18,type:"main",flow_rate:Math.random()*100});for(let At=0;At<yt*50;At++){const Rt=bt+Math.random()*(Et-bt),Pt=Tt+Math.random()*(wt-Tt),Ct=Rt+(Math.random()-.5)*St,It=Pt+(Math.random()-.5)*St;vt.push({id:`sewer_branch_${At}`,path:[[Rt,Pt],[Ct,It]],diameter:1.5,elevation:-12,type:"branch",flow_rate:Math.random()*20})}return vt}function createUtilityTunnelLayer(xt){const yt=LAYER_DEFINITIONS.utility_tunnels;return new PathLayer({id:"utility_tunnels",data:xt,getPath:vt=>vt.path||vt.coordinates,getWidth:vt=>vt.width||1.5,getColor:vt=>{switch(vt.utility_type){case"power":return[255,255,0,200];case"water":return[0,150,255,200];case"gas":return[255,100,0,200];case"telecom":return[128,0,255,200];default:return yt.color}},opacity:yt.opacity,pickable:!0,widthMinPixels:1,widthMaxPixels:8,getElevation:vt=>vt.elevation||-8,extruded:!0,material:{ambient:.2,diffuse:.6,shininess:32,specularColor:[255,255,255]},transitions:{getColor:500,getWidth:300}})}function generateUtilityNetwork(xt,yt=.8){const vt=[],{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=xt,St=["power","water","gas","telecom"];St.forEach((At,Rt)=>{const Pt=(Et-bt)/8,Ct=-5-Rt*2;for(let It=bt+Pt/2;It<Et;It+=Pt)vt.push({id:`${At}_ns_${It}`,path:[[It,Tt],[It,wt]],width:At==="power"?2:1.5,elevation:Ct,utility_type:At,capacity:Math.random()*100,load:Math.random()*80});for(let It=Tt+Pt/2;It<wt;It+=Pt)vt.push({id:`${At}_ew_${It}`,path:[[bt,It],[Et,It]],width:At==="power"?2:1.5,elevation:Ct,utility_type:At,capacity:Math.random()*100,load:Math.random()*80})});for(let At=0;At<yt*100;At++){const Rt=St[Math.floor(Math.random()*St.length)],Pt=bt+Math.random()*(Et-bt),Ct=Tt+Math.random()*(wt-Tt),It=Pt+(Math.random()-.5)*50,Mt=Ct+(Math.random()-.5)*50;vt.push({id:`${Rt}_service_${At}`,path:[[Pt,Ct],[It,Mt]],width:.8,elevation:-3,utility_type:Rt,capacity:Math.random()*20,load:Math.random()*15})}return vt}function createUndergroundParkingLayer(xt){const yt=LAYER_DEFINITIONS.underground_parking;return new PolygonLayer({id:"underground_parking",data:xt,getPolygon:vt=>{const bt=vt.footprint||vt.polygon;return!bt||!Array.isArray(bt)?[]:bt},getElevation:vt=>Math.abs(vt.depth||3),getPosition:vt=>[vt.lng||0,vt.lat||0,vt.elevation||-8],getFillColor:vt=>{const bt=(vt.occupied_spots||0)/(vt.total_spots||1);return bt>.9?[255,0,0,180]:bt>.7?[255,165,0,180]:bt>.3?[255,255,0,180]:yt.color},getLineColor:[0,0,0,100],getLineWidth:1,extruded:!0,wireframe:!1,filled:!0,stroked:!0,pickable:!0,opacity:yt.opacity,material:{ambient:.2,diffuse:.6,shininess:16,specularColor:[150,150,150]},transitions:{getFillColor:600,getElevation:400}})}function generateUndergroundParking(xt,yt=.3){const vt=[];return xt.forEach((bt,Tt)=>{if(Math.random()<yt){const Et=bt.footprint||[];if(Et.length===0)return;const wt=calculatePolygonArea(Et),St=Math.min(3,Math.floor(wt/1e3)+1);for(let At=1;At<=St;At++){const Rt=Math.floor(wt/25),Pt=Math.floor(Math.random()*Rt);vt.push({id:`parking_${bt.id||Tt}_level_${At}`,building_id:bt.id||Tt,footprint:Et,elevation:-3*At,depth:3,level:At,total_spots:Rt,occupied_spots:Pt,hourly_rate:2+Math.random()*3,access_type:At===1?"ramp":"elevator",security_level:Math.random()>.5?"secured":"public"})}}}),vt}function calculatePolygonArea(xt){if(xt.length<3)return 0;let yt=0;for(let vt=0;vt<xt.length;vt++){const bt=(vt+1)%xt.length;yt+=xt[vt].x*xt[bt].y,yt-=xt[bt].x*xt[vt].y}return Math.abs(yt)/2}function createElevatedHighwayLayer(xt){const yt=LAYER_DEFINITIONS.elevated_highways;return new PathLayer({id:"elevated_highways",data:xt,getPath:vt=>vt.path||vt.coordinates,getWidth:vt=>vt.width||8,getColor:vt=>{const bt=vt.traffic_density||0;return bt>.8?[255,0,0,230]:bt>.5?[255,165,0,230]:yt.color},opacity:yt.opacity,pickable:!0,widthMinPixels:4,widthMaxPixels:20,getElevation:vt=>vt.elevation||35,extruded:!0,material:{ambient:.3,diffuse:.7,shininess:48,specularColor:[200,200,200]},transitions:{getColor:500,getWidth:300}})}function generateElevatedHighways(xt,yt=.4){const vt=[],{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=xt,St=(bt+Et)/2,At=(Tt+wt)/2,Rt=Math.min(Et-bt,wt-Tt)*.4,Pt=[];for(let It=0;It<2*Math.PI;It+=Math.PI/8){const Mt=St+Math.cos(It)*Rt,Ot=At+Math.sin(It)*Rt;Pt.push([Mt,Ot])}Pt.push(Pt[0]),vt.push({id:"ring_highway",path:Pt,width:12,elevation:40,lanes:6,speed_limit:80,traffic_density:.3+Math.random()*.4,type:"ring"});const Ct=3e3;vt.push({id:"highway_ns",path:[[St,At-Ct/2],[St,At+Ct/2]],width:10,elevation:35,lanes:4,speed_limit:70,traffic_density:.4+Math.random()*.3,type:"arterial"}),vt.push({id:"highway_ew",path:[[St-Ct/2,At],[St+Ct/2,At]],width:10,elevation:35,lanes:4,speed_limit:70,traffic_density:.4+Math.random()*.3,type:"arterial"});for(let It=0;It<yt*20;It++){const Mt=bt+Math.random()*(Et-bt),Ot=Tt+Math.random()*(wt-Tt),kt=[],Ft=3+Math.floor(Math.random()*4);for(let Nt=0;Nt<=Ft;Nt++){const Lt=Nt/Ft,Dt=200+Math.random()*300,$t=Math.random()*2*Math.PI,zt=Mt+Math.cos($t)*Dt*Lt,Ut=Ot+Math.sin($t)*Dt*Lt,jt=Math.sin(Lt*Math.PI)*50,Ht=zt+Math.cos($t+Math.PI/2)*jt,Vt=Ut+Math.sin($t+Math.PI/2)*jt;kt.push([Ht,Vt])}vt.push({id:`elevated_road_${It}`,path:kt,width:6,elevation:30+Math.random()*20,lanes:2,speed_limit:50,traffic_density:Math.random()*.6,type:"connector"})}return vt}function createSkyBridgeLayer(xt){const yt=LAYER_DEFINITIONS.sky_bridges;return new PathLayer({id:"sky_bridges",data:xt,getPath:vt=>vt.path,getWidth:vt=>vt.width||3,getColor:vt=>{switch(vt.bridge_type){case"pedestrian":return[200,200,255,220];case"enclosed":return[180,180,220,240];case"glass":return[150,200,255,180];default:return yt.color}},opacity:yt.opacity,pickable:!0,widthMinPixels:2,widthMaxPixels:12,getElevation:vt=>vt.elevation||25,extruded:!0,material:{ambient:.4,diffuse:.8,shininess:64,specularColor:[255,255,255]},transitions:{getColor:600,getWidth:400}})}function generateSkyBridges(xt,yt=.2){const vt=[],bt=xt.filter(Tt=>(Tt.height||0)>20);for(let Tt=0;Tt<bt.length;Tt++)for(let Et=Tt+1;Et<bt.length;Et++){const wt=bt[Tt],St=bt[Et];if(!wt.footprint||!St.footprint)continue;const At=calculateBuildingCenter(wt.footprint),Rt=calculateBuildingCenter(St.footprint),Pt=Math.sqrt(Math.pow(Rt.x-At.x,2)+Math.pow(Rt.y-At.y,2));if(Pt<100&&Pt>10&&Math.random()<yt){const Ct=Math.min(wt.height||0,St.height||0),It=Math.max(20,Ct*.7);vt.push({id:`bridge_${wt.id||Tt}_${St.id||Et}`,start_x:At.x,start_y:At.y,end_x:Rt.x,end_y:Rt.y,elevation:It,width:3+Math.random()*2,bridge_type:["pedestrian","enclosed","glass"][Math.floor(Math.random()*3)],length:Pt,building_1:wt.id||Tt,building_2:St.id||Et,capacity:50+Math.random()*100,daily_users:Math.random()*500})}}return vt}function calculateBuildingCenter(xt){if(xt.length===0)return{x:0,y:0};const yt=xt.reduce((vt,bt)=>({x:vt.x+(bt.x||0),y:vt.y+(bt.y||0)}),{x:0,y:0});return{x:yt.x/xt.length,y:yt.y/xt.length}}function createElevatedTransitLayer(xt){const yt=LAYER_DEFINITIONS.elevated_transit,vt=xt.filter(Tt=>Tt.type==="track"),bt=xt.filter(Tt=>Tt.type==="station");return[new PathLayer({id:"elevated_transit_tracks",data:vt,getPath:Tt=>Tt.path||Tt.coordinates,getWidth:Tt=>Tt.width||4,getColor:Tt=>{switch(Tt.transit_type){case"monorail":return[255,100,100,240];case"light_rail":return[100,255,100,240];case"bullet_train":return[100,100,255,240];case"maglev":return[255,100,255,240];default:return yt.color}},opacity:yt.opacity,pickable:!0,widthMinPixels:3,widthMaxPixels:15,getElevation:Tt=>Tt.elevation||45,extruded:!0,material:{ambient:.3,diffuse:.7,shininess:64,specularColor:[255,255,255]},transitions:{getColor:600,getWidth:400}}),new ScatterplotLayer({id:"elevated_transit_stations",data:bt,getPosition:Tt=>[Tt.lng,Tt.lat,Tt.elevation||40],getRadius:Tt=>Tt.size||20,getFillColor:[255,200,100,220],getLineColor:[0,0,0,150],getLineWidth:2,pickable:!0,radiusMinPixels:10,radiusMaxPixels:40,material:{ambient:.4,diffuse:.8,shininess:32}})]}function generateElevatedTransit(xt,yt=3){const vt=[],{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=xt,St=["monorail","light_rail","bullet_train","maglev"];for(let At=0;At<yt;At++){const Rt=St[At%St.length],Pt=`elevated_${Rt}_${At}`,Ct=6+Math.floor(Math.random()*4),It=[],Mt=40+At*10;for(let Ot=0;Ot<Ct;Ot++){const kt=Ot/(Ct-1);let Ft,Nt;At%2===0?(Ft=bt+kt*(Et-bt),Nt=Tt+(wt-Tt)*.5+Math.sin(kt*Math.PI*2)*(wt-Tt)*.2):(Nt=Tt+kt*(wt-Tt),Ft=bt+(Et-bt)*.5+Math.cos(kt*Math.PI*1.5)*(Et-bt)*.2);const Lt={id:`${Pt}_station_${Ot}`,type:"station",x:Ft,y:Nt,elevation:Mt,transit_type:Rt,name:`${Rt.replace("_"," ").toUpperCase()} Station ${Ot+1}`,passenger_capacity:300+Math.random()*700,daily_passengers:Math.random()*5e3,platforms:Rt==="bullet_train"?2:1};It.push(Lt),vt.push(Lt)}for(let Ot=0;Ot<It.length-1;Ot++){const kt=It[Ot],Ft=It[Ot+1],Nt=[],Lt=5;for(let Dt=0;Dt<=Lt;Dt++){const $t=Dt/Lt,zt=(kt.x+Ft.x)/2,Ut=(kt.y+Ft.y)/2,jt=20+Math.random()*30,Ht=-(Ft.y-kt.y),Vt=Ft.x-kt.x,Wt=Math.sqrt(Ht*Ht+Vt*Vt);if(Wt>0){const Yt=zt+Ht/Wt*jt*Math.sin($t*Math.PI),Kt=Ut+Vt/Wt*jt*Math.sin($t*Math.PI),Zt=kt.x*(1-$t)*(1-$t)+2*Yt*(1-$t)*$t+Ft.x*$t*$t,Xt=kt.y*(1-$t)*(1-$t)+2*Kt*(1-$t)*$t+Ft.y*$t*$t;Nt.push([Zt,Xt])}else{const Yt=kt.x+(Ft.x-kt.x)*$t,Kt=kt.y+(Ft.y-kt.y)*$t;Nt.push([Yt,Kt])}}vt.push({id:`${Pt}_track_${Ot}`,type:"track",path:Nt,width:Rt==="bullet_train"?6:4,elevation:Mt,transit_type:Rt,length:Math.sqrt(Math.pow(Ft.x-kt.x,2)+Math.pow(Ft.y-kt.y,2)),max_speed:getMaxSpeed(Rt),capacity:getTrainCapacity(Rt),frequency:5+Math.random()*10})}}return vt}function getMaxSpeed(xt){switch(xt){case"monorail":return 80;case"light_rail":return 60;case"bullet_train":return 200;case"maglev":return 300;default:return 50}}function getTrainCapacity(xt){switch(xt){case"monorail":return 200;case"light_rail":return 300;case"bullet_train":return 800;case"maglev":return 400;default:return 150}}function createHelicopterLayer(xt){const yt=LAYER_DEFINITIONS.helicopters,vt=xt.filter(Tt=>Tt.type==="helicopter"),bt=xt.filter(Tt=>Tt.type==="flight_path");return[new ScatterplotLayer({id:"helicopters",data:vt,getPosition:Tt=>[Tt.lng,Tt.lat,Tt.altitude||100],getRadius:Tt=>Tt.size||8,getFillColor:Tt=>{switch(Tt.helicopter_type){case"emergency":return[255,0,0,255];case"police":return[0,0,255,255];case"news":return[255,255,0,255];case"medical":return[255,255,255,255];case"civilian":return[0,255,0,255];default:return yt.color}},getLineColor:[0,0,0,100],getLineWidth:1,pickable:!0,radiusMinPixels:4,radiusMaxPixels:20,material:{ambient:.6,diffuse:.8,shininess:32},transitions:{getPosition:1e3,getFillColor:500}}),new PathLayer({id:"helicopter_paths",data:bt,getPath:Tt=>Tt.path,getWidth:2,getColor:[255,255,255,100],opacity:.6,pickable:!1,widthMinPixels:1,widthMaxPixels:4})]}function generateHelicopterTraffic(xt,yt=.1){const vt=[],{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=xt,St=["emergency","police","news","medical","civilian"],At=Math.floor(yt*20);for(let Pt=0;Pt<At;Pt++){const Ct=St[Math.floor(Math.random()*St.length)],It=bt+Math.random()*(Et-bt),Mt=Tt+Math.random()*(wt-Tt),Ot=60+Math.random()*240;vt.push({id:`helicopter_${Pt}`,type:"helicopter",x:It,y:Mt,altitude:Ot,helicopter_type:Ct,speed:getHelicopterSpeed(Ct),heading:Math.random()*360,mission:generateMission(Ct),fuel_level:.3+Math.random()*.7,registration:`H-${Math.random().toString(36).substr(2,4).toUpperCase()}`});const kt=[],Ft=3+Math.floor(Math.random()*5);for(let Nt=0;Nt<Ft;Nt++){const Lt=It+(Math.random()-.5)*500,Dt=Mt+(Math.random()-.5)*500,$t=Ot+(Math.random()-.5)*50;kt.push([Math.max(bt,Math.min(Et,Lt)),Math.max(Tt,Math.min(wt,Dt)),Math.max(50,$t)])}vt.push({id:`helicopter_path_${Pt}`,type:"flight_path",helicopter_id:`helicopter_${Pt}`,path:kt})}const Rt=Math.floor(yt*10);for(let Pt=0;Pt<Rt;Pt++){const Ct=bt+Math.random()*(Et-bt),It=Tt+Math.random()*(wt-Tt),Mt=bt+Math.random()*(Et-bt),Ot=Tt+Math.random()*(wt-Tt),kt=[],Ft=5+Math.floor(Math.random()*5);for(let Nt=0;Nt<=Ft;Nt++){const Lt=Nt/Ft,Dt=Ct+(Mt-Ct)*Lt,$t=It+(Ot-It)*Lt,zt=80+Math.random()*120;kt.push([Dt,$t,zt])}vt.push({id:`helicopter_route_${Pt}`,type:"flight_path",path:kt,route_type:"corridor",traffic_level:Math.random()})}return vt}function getHelicopterSpeed(xt){switch(xt){case"emergency":return 180;case"police":return 160;case"news":return 140;case"medical":return 170;case"civilian":return 120;default:return 140}}function generateMission(xt){const yt={emergency:["Fire Response","Rescue Operation","Disaster Relief","Evacuation"],police:["Patrol","Pursuit","Surveillance","Traffic Monitoring"],news:["Live Broadcast","Event Coverage","Traffic Report","Breaking News"],medical:["Medevac","Hospital Transfer","Emergency Transport","Organ Transport"],civilian:["Sightseeing","Business Flight","Private Transport","Training Flight"]},vt=yt[xt]||yt.civilian;return vt[Math.floor(Math.random()*vt.length)]}function createAircraftLayer(xt){const yt=LAYER_DEFINITIONS.aircraft,vt=xt.filter(Tt=>Tt.type==="aircraft"),bt=xt.filter(Tt=>Tt.type==="flight_path");return[new ScatterplotLayer({id:"aircraft",data:vt,getPosition:Tt=>[Tt.lng,Tt.lat,Tt.altitude||3e3],getRadius:Tt=>Math.max(10,(Tt.altitude||3e3)/300),getFillColor:Tt=>{switch(Tt.aircraft_type){case"commercial":return[0,150,255,255];case"cargo":return[255,150,0,255];case"private":return[255,255,255,255];case"military":return[100,100,100,255];default:return yt.color}},getLineColor:[0,0,0,80],getLineWidth:1,pickable:!0,radiusMinPixels:6,radiusMaxPixels:25,material:{ambient:.5,diffuse:.8,shininess:64},transitions:{getPosition:2e3,getFillColor:500}}),new PathLayer({id:"aircraft_paths",data:bt,getPath:Tt=>Tt.path,getWidth:Tt=>Tt.width||3,getColor:Tt=>{const Et=Tt.average_altitude||3e3;return[255,255,255,Math.max(50,255-Et/1e4*200)]},opacity:.4,pickable:!0,widthMinPixels:1,widthMaxPixels:8})]}function generateAirTraffic(xt,yt=.05){const vt=[],{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=xt,St=["commercial","cargo","private","military"],At=Math.floor(yt*15);for(let Pt=0;Pt<At;Pt++){const Ct=St[Math.floor(Math.random()*St.length)],It=bt+Math.random()*(Et-bt),Mt=Tt+Math.random()*(wt-Tt),Ot=getAltitudeRange(Ct);vt.push({id:`aircraft_${Pt}`,type:"aircraft",x:It,y:Mt,altitude:Ot,aircraft_type:Ct,speed:getAircraftSpeed(Ct),heading:Math.random()*360,flight_number:generateFlightNumber(Ct),origin:generateAirport(),destination:generateAirport(),fuel_level:.4+Math.random()*.6,passengers:Ct==="commercial"?Math.floor(50+Math.random()*300):0}),generateFlightPath(vt,Pt,xt,Ct,Ot)}const Rt=Math.floor(yt*8);for(let Pt=0;Pt<Rt;Pt++)generateAirCorridor(vt,Pt,xt);return generateAirportPatterns(vt,xt,yt),vt}function getAltitudeRange(xt){switch(xt){case"commercial":return 8e3+Math.random()*4e3;case"cargo":return 7e3+Math.random()*5e3;case"private":return 3e3+Math.random()*6e3;case"military":return 5e3+Math.random()*1e4;default:return 5e3}}function getAircraftSpeed(xt){switch(xt){case"commercial":return 850;case"cargo":return 800;case"private":return 500;case"military":return 1200;default:return 600}}function generateFlightNumber(xt){const yt={commercial:["AA","UA","DL","SW","JB"],cargo:["FX","UP","CK","GL"],private:["N"],military:["AF","NV","AR"]},vt=yt[xt]||yt.private,bt=vt[Math.floor(Math.random()*vt.length)],Tt=Math.floor(100+Math.random()*8900);return`${bt}${Tt}`}function generateAirport(){const xt=["LAX","JFK","ORD","ATL","DFW","DEN","LAS","PHX","MIA","SEA","BOS","SFO","LGA","BWI","IAD","MSP","DTW","PHL","CLT","MCO"];return xt[Math.floor(Math.random()*xt.length)]}function generateFlightPath(xt,yt,vt,bt,Tt){const{min_x:Et,min_y:wt,max_x:St,max_y:At}=vt,Rt=xt[xt.length-1],Pt=[],Ct=4+Math.floor(Math.random()*6);let It=Rt.x,Mt=Rt.y,Ot=Tt;Pt.push([It,Mt,Ot]);for(let kt=1;kt<Ct;kt++){const Ft=(Math.random()-.5)*1e3,Nt=(Math.random()-.5)*1e3,Lt=(Math.random()-.5)*500;It=Math.max(Et,Math.min(St,It+Ft)),Mt=Math.max(wt,Math.min(At,Mt+Nt)),Ot=Math.max(1e3,Ot+Lt),Pt.push([It,Mt,Ot])}xt.push({id:`aircraft_path_${yt}`,type:"flight_path",aircraft_id:`aircraft_${yt}`,path:Pt,aircraft_type:bt,average_altitude:Tt,width:bt==="commercial"?4:3})}function generateAirCorridor(xt,yt,vt){const{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=vt,St=["east_west","north_south","diagonal"],At=St[yt%St.length],Rt=[],Pt=9e3+Math.random()*3e3,Ct=2e3,It=(bt+Et)/2,Mt=(Tt+wt)/2;switch(At){case"east_west":const Ot=Mt+(Math.random()-.5)*1e3,kt=It-Ct/2,Ft=It+Ct/2;for(let Ut=kt;Ut<=Ft;Ut+=Ct/5)Rt.push([Ut,Ot+(Math.random()-.5)*50,Pt]);break;case"north_south":const Nt=It+(Math.random()-.5)*1e3,Lt=Mt-Ct/2,Dt=Mt+Ct/2;for(let Ut=Lt;Ut<=Dt;Ut+=Ct/5)Rt.push([Nt+(Math.random()-.5)*50,Ut,Pt]);break;case"diagonal":const $t=It-Ct/2,zt=Mt-Ct/2;for(let Ut=0;Ut<=5;Ut++){const jt=Ut/5,Ht=$t+jt*Ct,Vt=zt+jt*Ct;Rt.push([Ht,Vt,Pt])}break}xt.push({id:`air_corridor_${yt}`,type:"flight_path",path:Rt,corridor_type:At,average_altitude:Pt,traffic_density:Math.random(),width:5})}function generateAirportPatterns(xt,yt,vt){const{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=yt,St=Math.floor(vt*3)+1;for(let At=0;At<St;At++){const Rt=bt+(At+1)*(Et-bt)/(St+1),Pt=Tt+Math.random()*(wt-Tt),Ct=4;for(let It=0;It<Ct;It++){const Mt=(It*90+Math.random()*30-15)*Math.PI/180,Ot=[];for(let kt=1e3;kt>=0;kt-=150){const Ft=Rt+Math.cos(Mt)*kt,Nt=Pt+Math.sin(Mt)*kt,Lt=Math.max(100,kt/1e3*2e3);Ft>=bt&&Ft<=Et&&Nt>=Tt&&Nt<=wt&&Ot.push([Ft,Nt,Lt])}Ot.length>0&&xt.push({id:`airport_${At}_approach_${It}`,type:"flight_path",path:Ot,pattern_type:"approach",airport_id:At,average_altitude:1500,width:3})}}}function createDroneLayer(xt){const yt=LAYER_DEFINITIONS.drones,vt=xt.filter(Tt=>Tt.type==="drone"),bt=xt.filter(Tt=>Tt.type==="flight_path");return[new ScatterplotLayer({id:"drones",data:vt,getPosition:Tt=>[Tt.lng,Tt.lat,Tt.altitude||80],getRadius:Tt=>Math.max(3,(Tt.size||1)*2),getFillColor:Tt=>{if(Tt.status==="emergency")return[255,0,0,255];switch(Tt.drone_type){case"delivery":return[0,255,0,255];case"surveillance":return[255,165,0,255];case"inspection":return[0,0,255,255];case"photography":return[255,255,0,255];case"research":return[128,0,128,255];default:return yt.color}},getLineColor:[0,0,0,150],getLineWidth:1,pickable:!0,radiusMinPixels:2,radiusMaxPixels:12,material:{ambient:.7,diffuse:.9,shininess:16},transitions:{getPosition:500,getFillColor:300}}),new PathLayer({id:"drone_paths",data:bt,getPath:Tt=>Tt.path,getWidth:Tt=>Tt.width||1,getColor:Tt=>{switch(Tt.drone_type){case"delivery":return[0,255,0,120];case"surveillance":return[255,165,0,120];case"inspection":return[0,0,255,120];case"photography":return[255,255,0,120];case"research":return[128,0,128,120];default:return[255,255,255,100]}},opacity:.7,pickable:!0,widthMinPixels:1,widthMaxPixels:3})]}function generateDroneTraffic(xt,yt=.3){const vt=[],{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=xt,St=["delivery","surveillance","inspection","photography","research"],At=Math.floor(yt*50);for(let Pt=0;Pt<At;Pt++){const Ct=St[Math.floor(Math.random()*St.length)],It=bt+Math.random()*(Et-bt),Mt=Tt+Math.random()*(wt-Tt),Ot=getDroneAltitude(Ct),kt={id:`drone_${Pt}`,type:"drone",x:It,y:Mt,altitude:Ot,drone_type:Ct,size:getDroneSize(Ct),speed:getDroneSpeed(Ct),heading:Math.random()*360,battery_level:.2+Math.random()*.8,operator:generateOperator(Ct),mission:generateDroneMission(Ct),status:Math.random()>.95?"emergency":"normal",registration:`D-${Math.random().toString(36).substr(2,4).toUpperCase()}`};vt.push(kt),generateDroneFlightPath(vt,kt,xt,Ct)}const Rt=Math.floor(yt*8);for(let Pt=0;Pt<Rt;Pt++)generateDroneCorridor(vt,Pt,xt);return generateDeliveryNetworks(vt,xt,yt),vt}function getDroneAltitude(xt){switch(xt){case"delivery":return 50+Math.random()*100;case"surveillance":return 80+Math.random()*70;case"inspection":return 30+Math.random()*50;case"photography":return 60+Math.random()*90;case"research":return 100+Math.random()*50;default:return 80}}function getDroneSize(xt){switch(xt){case"delivery":return 3;case"surveillance":return 2;case"inspection":return 1.5;case"photography":return 2;case"research":return 2.5;default:return 2}}function getDroneSpeed(xt){switch(xt){case"delivery":return 60;case"surveillance":return 40;case"inspection":return 25;case"photography":return 35;case"research":return 45;default:return 40}}function generateOperator(xt){const yt={delivery:["Amazon Prime Air","UPS Flight Forward","FedEx Wing","DoorDash","DroneUp"],surveillance:["Police Department","Security Corp","Private Investigator","Border Patrol"],inspection:["Utility Company","Construction Corp","Insurance Adjuster","Survey Co"],photography:["News Station","Real Estate","Event Photography","Tourism Board"],research:["University","Weather Service","Environmental Agency","Tech Company"]},vt=yt[xt]||yt.delivery;return vt[Math.floor(Math.random()*vt.length)]}function generateDroneMission(xt){const yt={delivery:["Package Delivery","Food Delivery","Medical Supply","Emergency Supply"],surveillance:["Area Patrol","Traffic Monitoring","Security Watch","Search & Rescue"],inspection:["Infrastructure Check","Damage Assessment","Maintenance Survey","Safety Inspection"],photography:["Aerial Photography","Event Coverage","Property Survey","Documentary Film"],research:["Data Collection","Environmental Monitor","Weather Observation","Traffic Study"]},vt=yt[xt]||yt.delivery;return vt[Math.floor(Math.random()*vt.length)]}function generateDroneFlightPath(xt,yt,vt,bt){const{min_x:Tt,min_y:Et,max_x:wt,max_y:St}=vt,At=[];switch(bt){case"delivery":generateDeliveryPath(At,yt,vt);break;case"surveillance":generateSurveillancePath(At,yt);break;case"inspection":generateInspectionPath(At,yt);break;case"photography":generatePhotographyPath(At,yt);break;case"research":generateResearchPath(At,yt);break;default:generateGenericPath(At,yt)}At.length>0&&xt.push({id:`drone_path_${yt.id}`,type:"flight_path",drone_id:yt.id,path:At,drone_type:bt,width:1})}function generateDeliveryPath(xt,yt,vt){const{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=vt;xt.push([yt.x,yt.y,yt.altitude]);const St=bt+Math.random()*(Et-bt),At=Tt+Math.random()*(wt-Tt),Rt=3;for(let Pt=1;Pt<=Rt;Pt++){const Ct=Pt/Rt,It=yt.x+(St-yt.x)*Ct,Mt=yt.y+(At-yt.y)*Ct,Ot=yt.altitude;xt.push([It,Mt,Ot])}}function generateSurveillancePath(xt,yt,vt){const Tt=yt.x-200,Et=yt.y-200;for(let wt=0;wt<3;wt++){const St=Et+wt*200;if(wt%2===0)for(let At=0;At<3;At++){const Rt=Tt+At*200;xt.push([Rt,St,yt.altitude])}else for(let At=2;At>=0;At--){const Rt=Tt+At*200;xt.push([Rt,St,yt.altitude])}}}function generateInspectionPath(xt,yt,vt){for(let Et=0;Et<8;Et++){const wt=Et*2*Math.PI/8,St=yt.x+Math.cos(wt)*50,At=yt.y+Math.sin(wt)*50,Rt=yt.altitude+Math.sin(wt*2)*10;xt.push([St,At,Rt])}}function generatePhotographyPath(xt,yt,vt){for(let Et=0;Et<=10;Et++){const wt=Et/10,St=yt.x+wt*300-150,At=yt.y+Math.sin(wt*Math.PI*2)*100,Rt=yt.altitude+Math.cos(wt*Math.PI)*20;xt.push([St,At,Rt])}}function generateResearchPath(xt,yt,vt){for(let Et=0;Et<6;Et++){const wt=yt.x+(Et%3-1)*80,St=yt.y+Math.floor(Et/3)*80,At=yt.altitude+Math.random()*20-10;xt.push([wt,St,At])}}function generateGenericPath(xt,yt,vt){for(let bt=0;bt<5;bt++){const Tt=yt.x+(Math.random()-.5)*200,Et=yt.y+(Math.random()-.5)*200,wt=yt.altitude+(Math.random()-.5)*30;xt.push([Tt,Et,wt])}}function generateDroneCorridor(xt,yt,vt){const{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=vt,St=[],At=100+Math.random()*50,Rt=10;for(let Pt=0;Pt<=Rt;Pt++){const Ct=Pt/Rt,It=bt+Ct*(Et-bt),Mt=Tt+Math.random()*(wt-Tt);St.push([It,Mt,At])}xt.push({id:`drone_corridor_${yt}`,type:"flight_path",path:St,corridor_type:"highway",average_altitude:At,traffic_density:Math.random(),width:2})}function generateDeliveryNetworks(xt,yt,vt){const{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=yt,St=Math.floor(vt*3)+1;for(let At=0;At<St;At++){const Rt=bt+(At+1)*(Et-bt)/(St+1),Pt=Tt+Math.random()*(wt-Tt),Ct=8;for(let It=0;It<Ct;It++){const Mt=It*2*Math.PI/Ct,Ot=[];for(let kt=0;kt<=500;kt+=100){const Ft=Rt+Math.cos(Mt)*kt,Nt=Pt+Math.sin(Mt)*kt;Ft>=bt&&Ft<=Et&&Nt>=Tt&&Nt<=wt&&Ot.push([Ft,Nt,80])}Ot.length>1&&xt.push({id:`delivery_hub_${At}_spoke_${It}`,type:"flight_path",path:Ot,network_type:"delivery_hub",hub_id:At,average_altitude:80,width:1})}}}class ChargingStationLayer extends CompositeLayer{renderLayers(){const yt=this.props.data||[],vt=this.props.coverageAreas||[],bt=this.props.showCoverage!==!1,Tt=this.props.showLabels!==!1;if(!yt||yt.length===0)return[];const Et=[];return bt&&vt&&vt.length>0&&Et.push(new ScatterplotLayer({id:"charging-station-coverage",data:vt,getPosition:wt=>[wt.center.x,wt.center.y,1],getRadius:wt=>wt.radius,getFillColor:[100,255,100,30],getLineColor:[50,200,50,120],getLineWidth:2,radiusUnits:"meters",filled:!0,stroked:!0,pickable:!1})),Et.push(new ScatterplotLayer({id:"charging-stations-base",data:yt,getPosition:wt=>[wt.position.x,wt.position.y,5],getRadius:25,getFillColor:[255,255,255,200],getLineColor:[0,0,0,255],getLineWidth:3,radiusUnits:"meters",radiusMinPixels:12,radiusMaxPixels:30,filled:!0,stroked:!0,pickable:!0})),Et.push(new ScatterplotLayer({id:"charging-stations-main",data:yt,getPosition:wt=>[wt.position.x,wt.position.y,10],getRadius:18,getFillColor:[255,215,0,255],getLineColor:[0,0,0,255],getLineWidth:2,radiusUnits:"meters",radiusMinPixels:8,radiusMaxPixels:24,filled:!0,stroked:!0,pickable:!0})),Tt&&Et.push(new TextLayer({id:"charging-station-labels",data:yt,getPosition:wt=>[wt.position.x,wt.position.y,15],getText:()=>"",getSize:20,getColor:[0,0,0,255],getAngle:0,fontFamily:"Arial, sans-serif",fontWeight:"bold",pickable:!1})),Tt&&yt.length<=10&&Et.push(new TextLayer({id:"charging-station-ids",data:yt,getPosition:wt=>[wt.position.x,wt.position.y-40,15],getText:wt=>wt.id.replace("station_","S"),getSize:12,getColor:[255,255,255,200],getAngle:0,fontFamily:"Arial, sans-serif",fontWeight:"bold",pickable:!1,backgroundColor:[0,0,0,100]})),Et}}Bt(ChargingStationLayer,"layerName","ChargingStationLayer");function createChargingStationLayer(xt=[],yt=[],vt=!0,bt=!0){return new ChargingStationLayer({id:"charging-stations-composite",data:xt,coverageAreas:yt,showCoverage:vt,showLabels:bt,visible:xt.length>0})}class QuadTree{constructor(yt,vt=10,bt=8){Bt(this,"root");Bt(this,"maxObjects");Bt(this,"maxLevels");Bt(this,"nodeCount",0);Bt(this,"maxDepth",0);this.maxObjects=vt,this.maxLevels=bt,this.root={bounds:yt,objects:[],level:0},this.nodeCount=1}insert(yt){this.insertIntoNode(this.root,yt)}insertMany(yt){yt.forEach(vt=>this.insert(vt))}query(yt){const vt=[];return this.queryNode(this.root,yt,vt),vt}queryCircle(yt,vt,bt){const Tt={minX:yt-bt,maxX:yt+bt,minY:vt-bt,maxY:vt+bt};return this.query(Tt).filter(wt=>{const St=wt.longitude-yt,At=wt.latitude-vt;return Math.sqrt(St*St+At*At)<=bt})}findNearest(yt,vt,bt=1){const Et=this.getAllObjects().map(wt=>({object:wt,distance:this.getDistance(yt,vt,wt.longitude,wt.latitude)}));return Et.sort((wt,St)=>wt.distance-St.distance),Et.slice(0,bt).map(wt=>wt.object)}getAllObjects(){const yt=[];return this.collectAllObjects(this.root,yt),yt}getObjectsByType(yt){return this.getAllObjects().filter(vt=>vt.type===yt)}clear(){this.root={bounds:this.root.bounds,objects:[],level:0},this.nodeCount=1,this.maxDepth=0}getStats(){const yt=[];this.collectLeafNodes(this.root,yt);const vt=this.getAllObjects().length,bt=yt.length>0?yt.reduce((Tt,Et)=>Tt+Et.objects.length,0)/yt.length:0;return{totalObjects:vt,nodeCount:this.nodeCount,maxDepth:this.maxDepth,averageObjectsPerLeaf:bt}}createClusters(yt=5,vt=.001){const bt=this.getAllObjects(),Tt=[],Et=new Set;for(const wt of bt){if(Et.has(wt.id))continue;const St=this.queryCircle(wt.longitude,wt.latitude,vt);if(St.length>=yt){const At=St.filter(Rt=>!Et.has(Rt.id));if(At.length>=yt){const Rt=this.calculateBounds(At),Pt={id:`cluster_${Tt.length}`,type:this.getMostCommonType(At),position:[(Rt.minX+Rt.maxX)/2,(Rt.minY+Rt.maxY)/2,0],bounds:Rt,objects:At};Tt.push(Pt),At.forEach(Ct=>Et.add(Ct.id))}}}return Tt}insertIntoNode(yt,vt){if(this.boundsContainPoint(yt.bounds,vt.longitude,vt.latitude)){if(!yt.children&&yt.objects.length<this.maxObjects){yt.objects.push(vt);return}if(!yt.children)if(yt.level<this.maxLevels)this.split(yt);else{yt.objects.push(vt);return}if(yt.children){for(const bt of yt.children)if(this.boundsContainPoint(bt.bounds,vt.longitude,vt.latitude)){this.insertIntoNode(bt,vt);break}}}}split(yt){const{bounds:vt,level:bt}=yt,Tt=(vt.minX+vt.maxX)/2,Et=(vt.minY+vt.maxY)/2;yt.children=[{bounds:{minX:vt.minX,maxX:Tt,minY:Et,maxY:vt.maxY},objects:[],level:bt+1},{bounds:{minX:Tt,maxX:vt.maxX,minY:Et,maxY:vt.maxY},objects:[],level:bt+1},{bounds:{minX:vt.minX,maxX:Tt,minY:vt.minY,maxY:Et},objects:[],level:bt+1},{bounds:{minX:Tt,maxX:vt.maxX,minY:vt.minY,maxY:Et},objects:[],level:bt+1}],this.nodeCount+=4,this.maxDepth=Math.max(this.maxDepth,bt+1);const wt=[...yt.objects];yt.objects=[];for(const St of wt)this.insertIntoNode(yt,St)}queryNode(yt,vt,bt){if(this.boundsIntersect(yt.bounds,vt)){for(const Tt of yt.objects)this.boundsContainPoint(vt,Tt.longitude,Tt.latitude)&&bt.push(Tt);if(yt.children)for(const Tt of yt.children)this.queryNode(Tt,vt,bt)}}collectAllObjects(yt,vt){if(vt.push(...yt.objects),yt.children)for(const bt of yt.children)this.collectAllObjects(bt,vt)}collectLeafNodes(yt,vt){if(!yt.children)vt.push(yt);else for(const bt of yt.children)this.collectLeafNodes(bt,vt)}boundsContainPoint(yt,vt,bt){return vt>=yt.minX&&vt<=yt.maxX&&bt>=yt.minY&&bt<=yt.maxY}boundsIntersect(yt,vt){return!(yt.maxX<vt.minX||yt.minX>vt.maxX||yt.maxY<vt.minY||yt.minY>vt.maxY)}getDistance(yt,vt,bt,Tt){const Et=bt-yt,wt=Tt-vt;return Math.sqrt(Et*Et+wt*wt)}calculateBounds(yt){if(yt.length===0)return{minX:0,maxX:0,minY:0,maxY:0};let vt=yt[0].longitude,bt=yt[0].longitude,Tt=yt[0].latitude,Et=yt[0].latitude;for(const wt of yt)vt=Math.min(vt,wt.longitude),bt=Math.max(bt,wt.longitude),Tt=Math.min(Tt,wt.latitude),Et=Math.max(Et,wt.latitude);return{minX:vt,maxX:bt,minY:Tt,maxY:Et}}getMostCommonType(yt){const vt=new Map;for(const Et of yt){const wt=Et.type||"unknown";vt.set(wt,(vt.get(wt)||0)+1)}let bt="unknown",Tt=0;for(const[Et,wt]of vt)wt>Tt&&(Tt=wt,bt=Et);return bt}}function createSpatialObjectsFromLayerData(xt,yt){const vt=[];for(const bt of xt){let Tt,Et;if(bt.longitude!==void 0&&bt.latitude!==void 0)Tt=bt.longitude,Et=bt.latitude;else if(bt.position&&Array.isArray(bt.position))Tt=bt.position[0],Et=bt.position[1];else if(bt.footprint&&Array.isArray(bt.footprint)&&bt.footprint.length>0){const wt=bt.footprint,St=calculatePolygonCentroid(wt);Tt=St[0],Et=St[1]}else if(bt.x!==void 0&&bt.y!==void 0)Tt=bt.x/111320,Et=bt.y/110540;else continue;vt.push({id:bt.id||`${yt}_${vt.length}`,longitude:Tt,latitude:Et,type:yt,data:bt})}return vt}function calculatePolygonCentroid(xt){let yt=0,vt=0;const bt=xt.length;for(const Tt of xt)yt+=Tt[0],vt+=Tt[1];return[yt/bt,vt/bt]}const gn=class gn{constructor(){Bt(this,"layers",new Map);Bt(this,"clusters",[]);Bt(this,"viewState",{longitude:0,latitude:0,zoom:0,pitch:0,bearing:0});Bt(this,"performance",{fps:0,frameTime:0,layerCount:0,totalObjects:0});Bt(this,"spatialIndex");Bt(this,"frameCount",0);Bt(this,"lastFPSUpdate",performance.now());Bt(this,"frameTimeStart",0)}static getInstance(){return gn.instance||(gn.instance=new gn),gn.instance}registerLayer(yt){var vt,bt,Tt,Et,wt,St;try{if(!yt||!yt.id){console.warn("Invalid layer passed to debugManager.registerLayer:",yt);return}const At={id:yt.id||"unknown",type:((vt=yt.constructor)==null?void 0:vt.name)||"Unknown",visible:((bt=yt.props)==null?void 0:bt.visible)!==!1,objectCount:Array.isArray((Tt=yt.props)==null?void 0:Tt.data)?yt.props.data.length:0,props:{extruded:(Et=yt.props)==null?void 0:Et.extruded,elevationScale:(wt=yt.props)==null?void 0:wt.elevationScale,pickable:(St=yt.props)==null?void 0:St.pickable,...yt.props||{}}};this.layers.set(yt.id,At),this.updatePerformance()}catch(At){console.warn("Error registering layer for debugging:",At,yt)}}updateLayerPerformance(yt,vt,bt){const Tt=this.layers.get(yt);Tt&&(Tt.performance={updateTime:vt,renderTime:bt})}registerClusters(yt){this.clusters=yt}updateViewState(yt){this.viewState={...yt}}buildSpatialIndex(){var yt;try{const vt=[];for(const[wt,St]of this.layers)if((yt=St.props)!=null&&yt.data&&Array.isArray(St.props.data))try{const At=createSpatialObjectsFromLayerData(St.props.data,wt);vt.push(...At)}catch(At){console.warn(`Error creating spatial objects for layer ${wt}:`,At)}if(vt.length===0){console.log(" No objects found for spatial indexing");return}const bt={minX:Math.min(...vt.map(wt=>wt.longitude)),maxX:Math.max(...vt.map(wt=>wt.longitude)),minY:Math.min(...vt.map(wt=>wt.latitude)),maxY:Math.max(...vt.map(wt=>wt.latitude))},Tt=(bt.maxX-bt.minX)*.1,Et=(bt.maxY-bt.minY)*.1;bt.minX-=Tt,bt.maxX+=Tt,bt.minY-=Et,bt.maxY+=Et,this.spatialIndex=new QuadTree(bt,10,8),this.spatialIndex.insertMany(vt),this.clusters=this.spatialIndex.createClusters(5,.001),console.log(" Spatial index built:",{objects:vt.length,clusters:this.clusters.length,stats:this.spatialIndex.getStats()})}catch(vt){console.warn("Error building spatial index:",vt),this.spatialIndex=void 0,this.clusters=[]}}updateSpatialIndex(yt){yt?this.spatialIndex=yt:this.buildSpatialIndex()}startFrame(){this.frameTimeStart=performance.now()}endFrame(){const yt=performance.now()-this.frameTimeStart;this.frameCount++;const vt=performance.now();vt-this.lastFPSUpdate>=1e3&&(this.performance.fps=Math.round(this.frameCount*1e3/(vt-this.lastFPSUpdate)),this.frameCount=0,this.lastFPSUpdate=vt),this.performance.frameTime=yt,this.updatePerformance()}updatePerformance(){this.performance.layerCount=this.layers.size,this.performance.totalObjects=Array.from(this.layers.values()).reduce((yt,vt)=>yt+vt.objectCount,0)}getDebugInfo(){let yt;if(this.spatialIndex){const vt=this.spatialIndex.getStats();yt={type:"QuadTree",nodeCount:vt.nodeCount,maxDepth:vt.maxDepth}}return{layers:Array.from(this.layers.values()),clusters:this.clusters,viewState:this.viewState,performance:{...this.performance},spatialIndex:yt}}findObjectsAt(yt,vt,bt=.001){if(this.spatialIndex)return this.spatialIndex.queryCircle(yt,vt,bt).map(wt=>wt.data);const Tt=[];for(const Et of this.clusters)this.isPointInBounds(yt,vt,Et.bounds,bt)&&Tt.push(...Et.objects.filter(wt=>this.getDistance(yt,vt,wt.longitude||wt.x,wt.latitude||wt.y)<=bt));return Tt}searchObjects(yt){const vt=[],bt=yt.toLowerCase();if(this.spatialIndex){const Tt=this.spatialIndex.getAllObjects();for(const Et of Tt){const wt=Et.data;(Et.id&&Et.id.toString().toLowerCase().includes(bt)||Et.type&&Et.type.toLowerCase().includes(bt)||wt&&wt.id&&wt.id.toString().toLowerCase().includes(bt)||wt&&wt.type&&wt.type.toLowerCase().includes(bt)||wt&&wt.name&&wt.name.toLowerCase().includes(bt))&&vt.push(wt)}}else for(const Tt of this.clusters)for(const Et of Tt.objects)(Et.id&&Et.id.toString().toLowerCase().includes(bt)||Et.type&&Et.type.toLowerCase().includes(bt)||Et.name&&Et.name.toLowerCase().includes(bt))&&vt.push(Et);return vt}getViewportObjects(){const{longitude:yt,latitude:vt,zoom:bt}=this.viewState,Tt=this.getViewportRadius(bt);return this.findObjectsAt(yt,vt,Tt)}isPointInBounds(yt,vt,bt,Tt){return yt+Tt>=bt.minX&&yt-Tt<=bt.maxX&&vt+Tt>=bt.minY&&vt-Tt<=bt.maxY}getDistance(yt,vt,bt,Tt){const Et=bt-yt,wt=Tt-vt;return Math.sqrt(Et*Et+wt*wt)}getViewportRadius(yt){return 180/Math.pow(2,yt)}exportDebugData(){return JSON.stringify(this.getDebugInfo(),null,2)}logDebugSummary(){const yt=this.getDebugInfo();console.group(" Debug Summary"),console.log("Layers:",yt.layers.length),console.log("Total Objects:",yt.performance.totalObjects),console.log("FPS:",yt.performance.fps),console.log("Frame Time:",yt.performance.frameTime.toFixed(2)+"ms"),console.log("View State:",yt.viewState),console.table(yt.layers.map(vt=>({id:vt.id,type:vt.type,objects:vt.objectCount,visible:vt.visible,extruded:vt.props.extruded}))),console.groupEnd()}};Bt(gn,"instance");let DebugManager=gn;const debugManager=DebugManager.getInstance();window.urbanSynthDebug={manager:debugManager,getInfo:()=>debugManager.getDebugInfo(),findAt:(xt,yt,vt)=>debugManager.findObjectsAt(xt,yt,vt),search:xt=>debugManager.searchObjects(xt),export:()=>debugManager.exportDebugData(),log:()=>debugManager.logDebugSummary()};console.log(" UrbanSynth Debug Tools loaded. Use `urbanSynthDebug` in console for debugging.");function DebugOverlay({isVisible:xt,onToggle:yt}){var Ot,kt,Ft,Nt,Lt,Dt,$t,zt,Ut,jt,Ht,Vt,Wt,Yt,Kt,Zt;const[vt,bt]=reactExports.useState(debugManager.getDebugInfo()),[Tt,Et]=reactExports.useState(null),[wt,St]=reactExports.useState(""),[At,Rt]=reactExports.useState([]);reactExports.useEffect(()=>{const Xt=setInterval(()=>{bt(debugManager.getDebugInfo())},1e3);return()=>clearInterval(Xt)},[]);const Pt=Xt=>{if(St(Xt),Xt.trim()){const en=debugManager.searchObjects(Xt);Rt(en)}else Rt([])},Ct=()=>{const Xt=debugManager.exportDebugData(),en=new Blob([Xt],{type:"application/json"}),nn=URL.createObjectURL(en),rn=document.createElement("a");rn.href=nn,rn.download=`urbansynth-debug-${Date.now()}.json`,rn.click(),URL.revokeObjectURL(nn)},It=()=>{debugManager.logDebugSummary()},Mt=(Xt,en)=>{const nn=Xt/en;return nn<.5?"#4ade80":nn<.8?"#fbbf24":"#ef4444"};return xt?jsxRuntimeExports.jsxs("div",{style:{position:"fixed",top:10,right:10,width:"400px",maxHeight:"80vh",background:"rgba(0, 0, 0, 0.9)",color:"white",borderRadius:"8px",padding:"16px",fontSize:"12px",overflow:"auto",zIndex:1e3,fontFamily:"monospace"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[jsxRuntimeExports.jsx("h3",{style:{margin:0},children:" Debug Panel"}),jsxRuntimeExports.jsx("button",{onClick:yt,style:{background:"transparent",color:"white",border:"1px solid #666",padding:"4px 8px",borderRadius:"4px",cursor:"pointer"},children:""})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:"16px"},children:[jsxRuntimeExports.jsx("h4",{style:{margin:"0 0 8px 0",color:"#fbbf24"},children:"Performance"}),jsxRuntimeExports.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"},children:[jsxRuntimeExports.jsxs("div",{children:["FPS: ",jsxRuntimeExports.jsx("span",{style:{color:Mt(60-(((Ot=vt.performance)==null?void 0:Ot.fps)||0),60)},children:((kt=vt.performance)==null?void 0:kt.fps)||0})]}),jsxRuntimeExports.jsxs("div",{children:["Frame: ",jsxRuntimeExports.jsxs("span",{style:{color:Mt(((Ft=vt.performance)==null?void 0:Ft.frameTime)||0,16.67)},children:[(((Nt=vt.performance)==null?void 0:Nt.frameTime)||0).toFixed(1),"ms"]})]}),jsxRuntimeExports.jsxs("div",{children:["Layers: ",((Lt=vt.performance)==null?void 0:Lt.layerCount)||0]}),jsxRuntimeExports.jsxs("div",{children:["Objects: ",((Dt=vt.performance)==null?void 0:Dt.totalObjects)||0]})]})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:"16px"},children:[jsxRuntimeExports.jsx("h4",{style:{margin:"0 0 8px 0",color:"#60a5fa"},children:"View State"}),jsxRuntimeExports.jsxs("div",{style:{fontSize:"11px",lineHeight:"1.4"},children:[jsxRuntimeExports.jsxs("div",{children:["Lng: ",((($t=vt.viewState)==null?void 0:$t.longitude)||0).toFixed(4)]}),jsxRuntimeExports.jsxs("div",{children:["Lat: ",(((zt=vt.viewState)==null?void 0:zt.latitude)||0).toFixed(4)]}),jsxRuntimeExports.jsxs("div",{children:["Zoom: ",(((Ut=vt.viewState)==null?void 0:Ut.zoom)||0).toFixed(2)]}),jsxRuntimeExports.jsxs("div",{children:["Pitch: ",(((jt=vt.viewState)==null?void 0:jt.pitch)||0).toFixed(1),""]}),jsxRuntimeExports.jsxs("div",{children:["Bearing: ",(((Ht=vt.viewState)==null?void 0:Ht.bearing)||0).toFixed(1),""]})]})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:"16px"},children:[jsxRuntimeExports.jsxs("h4",{style:{margin:"0 0 8px 0",color:"#34d399"},children:["Layers (",((Vt=vt.layers)==null?void 0:Vt.length)||0,")"]}),jsxRuntimeExports.jsx("div",{style:{maxHeight:"200px",overflow:"auto"},children:(Wt=vt.layers)==null?void 0:Wt.map((Xt,en)=>{var nn,rn,qt,Gt;return jsxRuntimeExports.jsxs("div",{onClick:()=>Et(Tt===Xt.id?null:Xt.id),style:{padding:"4px",margin:"2px 0",background:Tt===Xt.id?"rgba(255, 255, 255, 0.1)":"transparent",cursor:"pointer",borderRadius:"2px",border:Xt.visible?"1px solid #22c55e":"1px solid #666"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[jsxRuntimeExports.jsx("span",{children:Xt.id}),jsxRuntimeExports.jsx("span",{style:{color:Xt.visible?"#22c55e":"#666"},children:Xt.objectCount})]}),Tt===Xt.id&&jsxRuntimeExports.jsxs("div",{style:{marginTop:"4px",fontSize:"10px",color:"#ccc"},children:[jsxRuntimeExports.jsxs("div",{children:["Type: ",Xt.type||"Unknown"]}),jsxRuntimeExports.jsxs("div",{children:["Extruded: ",(nn=Xt.props)!=null&&nn.extruded?"Yes":"No"]}),jsxRuntimeExports.jsxs("div",{children:["Pickable: ",(rn=Xt.props)!=null&&rn.pickable?"Yes":"No"]}),((qt=Xt.props)==null?void 0:qt.elevationScale)&&jsxRuntimeExports.jsxs("div",{children:["Elevation Scale: ",Xt.props.elevationScale]}),((Gt=Xt.performance)==null?void 0:Gt.updateTime)&&jsxRuntimeExports.jsxs("div",{children:["Update: ",Xt.performance.updateTime.toFixed(2),"ms"]})]})]},Xt.id||en)})})]}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:"16px"},children:[jsxRuntimeExports.jsx("h4",{style:{margin:"0 0 8px 0",color:"#f472b6"},children:"Object Search"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search by ID, type, or name...",value:wt,onChange:Xt=>Pt(Xt.target.value),style:{width:"100%",padding:"4px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid #666",borderRadius:"4px",color:"white",fontSize:"12px"}}),At.length>0&&jsxRuntimeExports.jsxs("div",{style:{marginTop:"8px",maxHeight:"100px",overflow:"auto"},children:[At.slice(0,10).map((Xt,en)=>jsxRuntimeExports.jsxs("div",{style:{padding:"2px 0",fontSize:"10px"},children:[Xt.id||Xt.name||"Unknown"," (",Xt.type||"Unknown Type",")"]},en)),At.length>10&&jsxRuntimeExports.jsxs("div",{style:{fontSize:"10px",color:"#666"},children:["...and ",At.length-10," more"]})]})]}),vt.spatialIndex&&jsxRuntimeExports.jsxs("div",{style:{marginBottom:"16px"},children:[jsxRuntimeExports.jsx("h4",{style:{margin:"0 0 8px 0",color:"#a78bfa"},children:"Spatial Index"}),jsxRuntimeExports.jsxs("div",{style:{fontSize:"11px"},children:[jsxRuntimeExports.jsxs("div",{children:["Type: ",((Yt=vt.spatialIndex)==null?void 0:Yt.type)||"None"]}),jsxRuntimeExports.jsxs("div",{children:["Nodes: ",((Kt=vt.spatialIndex)==null?void 0:Kt.nodeCount)||0]}),jsxRuntimeExports.jsxs("div",{children:["Max Depth: ",((Zt=vt.spatialIndex)==null?void 0:Zt.maxDepth)||0]})]})]}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[jsxRuntimeExports.jsx("button",{onClick:It,style:{background:"#1f2937",color:"white",border:"1px solid #666",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:"Log to Console"}),jsxRuntimeExports.jsx("button",{onClick:Ct,style:{background:"#1f2937",color:"white",border:"1px solid #666",padding:"6px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"11px"},children:"Export JSON"})]}),jsxRuntimeExports.jsxs("div",{style:{marginTop:"12px",fontSize:"10px",color:"#999",lineHeight:"1.4"},children:[jsxRuntimeExports.jsxs("div",{children:[" Use ",jsxRuntimeExports.jsx("code",{children:"urbanSynthDebug"})," in console for more tools"]}),jsxRuntimeExports.jsx("div",{children:" Click layers to see details"}),jsxRuntimeExports.jsx("div",{children:" Search objects by ID, type, or name"})]})]}):jsxRuntimeExports.jsx("button",{onClick:yt,style:{position:"fixed",top:10,right:10,zIndex:1e3,background:"rgba(0, 0, 0, 0.8)",color:"white",border:"none",padding:"8px 12px",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:" Debug"})}function Cityscape({optimizationResult:xt,showZones:yt=!1,onToggleZones:vt}){const{state:bt}=useSimulationContext(),{state:Tt}=useTerrainContext(),[Et,wt]=reactExports.useState(!1),St=useCamera({longitude:-74.006,latitude:40.7128,zoom:14,pitch:60,bearing:30,target:[0,0,0]}),At=reactExports.useMemo(()=>{var $t,zt,Ut,jt,Ht,Vt,Wt,Yt,Kt,Zt,Xt,en,nn,rn,qt,Gt,Qt;const It=bt.cityModel||{zones:[],roads:[],pois:[],buildings:[]},Mt=bt.simulationData,Ot=[];if(console.log("Creating layers with city data:",{zones:(($t=It.zones)==null?void 0:$t.length)||0,roads:((zt=It.roads)==null?void 0:zt.length)||0,buildings:((Ut=It.buildings)==null?void 0:Ut.length)||0,agents:((jt=bt.agents)==null?void 0:jt.length)||0,hasEnhancedData:!!Mt}),(Ht=bt.cityModel)!=null&&Ht.bounds){const Jt=createEnhancedTerrainLayer({bounds:bt.cityModel.bounds,terrainState:Tt,cityData:It});Ot.push(...Jt),console.log("Enhanced terrain layers created:",{layerCount:Jt.length,terrainEnabled:Tt.isEnabled,activeTerrainLayer:Tt.activeLayer,terrainProfile:Tt.terrainProfile})}Ot.push(createGroundLayer()),Ot.push(createWaterLayer(It.river)),Ot.push(createTerrainLayer());const kt=40.7128,Ft=-74.006,Nt=generateAutonomousAgents(kt,Ft,It);Ot.push(...createAutonomousAgentLayer(Nt));const Lt=generateWeatherSystem(kt,Ft,"clear");Ot.push(createWeatherLayer(Lt)),Ot.push(createWindLayer(kt,Ft)),Ot.push(createRoadLayer(It.roads||[],bt.currentTime||12)),console.log("Creating building layer with buildings:",(Vt=It.buildings)==null?void 0:Vt.length,(Wt=It.buildings)==null?void 0:Wt.slice(0,2));const Dt=createBuildingLayer(It.buildings||[],bt.currentTime||12);return console.log("Building layer created with",((Yt=It.buildings)==null?void 0:Yt.length)||0,"buildings"),Ot.push(Dt),Ot.push(createAgentLayer(bt.agents,bt.currentTime||12)),Mt!=null&&Mt.infrastructure&&(((Kt=Mt.infrastructure.sewers)==null?void 0:Kt.length)>0&&Ot.push(createSewerLayer(Mt.infrastructure.sewers)),((Zt=Mt.infrastructure.utilities)==null?void 0:Zt.length)>0&&Ot.push(createUtilityTunnelLayer(Mt.infrastructure.utilities)),((Xt=Mt.infrastructure.parking)==null?void 0:Xt.length)>0&&Ot.push(createUndergroundParkingLayer(Mt.infrastructure.parking)),((en=Mt.infrastructure.elevatedRoads)==null?void 0:en.length)>0&&Ot.push(createElevatedHighwayLayer(Mt.infrastructure.elevatedRoads)),((nn=Mt.infrastructure.skyBridges)==null?void 0:nn.length)>0&&Ot.push(createSkyBridgeLayer(Mt.infrastructure.skyBridges)),((rn=Mt.infrastructure.elevatedTransit)==null?void 0:rn.length)>0&&Ot.push(createElevatedTransitLayer(Mt.infrastructure.elevatedTransit))),Mt!=null&&Mt.aerialTraffic&&(((qt=Mt.aerialTraffic.helicopters)==null?void 0:qt.length)>0&&Ot.push(createHelicopterLayer(Mt.aerialTraffic.helicopters)),((Gt=Mt.aerialTraffic.aircraft)==null?void 0:Gt.length)>0&&Ot.push(createAircraftLayer(Mt.aerialTraffic.aircraft)),((Qt=Mt.aerialTraffic.drones)==null?void 0:Qt.length)>0&&Ot.push(createDroneLayer(Mt.aerialTraffic.drones))),xt&&xt.stations.length>0&&Ot.push(createChargingStationLayer(xt.stations,xt.coverage_map,!0,!0)),console.log(`Rendering ${Ot.length} layers (${Ot.map(Jt=>Jt.id).join(", ")})`),Ot.forEach(Jt=>{debugManager.registerLayer(Jt)}),debugManager.buildSpatialIndex(),Ot},[bt.cityModel,bt.agents,bt.simulationData,yt,Tt,xt]),Rt=reactExports.useCallback(({viewState:It})=>{console.log(" ViewState changing:",It),St.setViewState(It),debugManager.updateViewState({longitude:It.longitude,latitude:It.latitude,zoom:It.zoom,pitch:It.pitch,bearing:It.bearing})},[St.setViewState]);console.log(" Current camera viewState:",St.viewState);const Pt=reactExports.useCallback(It=>{var Mt;It.object&&(console.log("Clicked object:",It.object),((Mt=It.layer)==null?void 0:Mt.id)==="agents"&&It.object.id&&(St.controls.followTarget===It.object.id?St.stopFollowing():St.startFollowing(It.object.id)))},[St]);reactExports.useCallback(()=>{vt&&vt()},[vt]);const Ct=reactExports.useCallback(It=>{It.preventDefault()},[]);return reactExports.useEffect(()=>{const It=Mt=>{const Ot=Mt.target;if(!(Ot&&Ot.tagName==="INPUT"&&Ot.type==="text"))switch(Mt.key.toLowerCase()){case"1":St.presets.overview();break;case"2":St.presets.street();break;case"3":St.presets.aerial();break;case"4":St.presets.isometric();break;case"z":vt&&vt();break;case"escape":St.controls.followTarget&&St.stopFollowing();break;case"d":Mt.preventDefault(),wt(!Et);break}};return document.addEventListener("keydown",It,!0),()=>document.removeEventListener("keydown",It,!0)},[St,vt,Et]),jsxRuntimeExports.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},onContextMenu:Ct,children:[jsxRuntimeExports.jsx(DeckGL,{width:"100%",height:"100%",viewState:{...St.viewState,pitch:St.viewState.pitch||60,bearing:St.viewState.bearing||30},onViewStateChange:Rt,onClick:Pt,layers:At,views:[new MapView({id:"map",repeat:!0,nearZMultiplier:.01,farZMultiplier:1e3,orthographic:!1,controller:{maxZoom:25,minZoom:0,maxPitch:85}})],controller:{dragRotate:!0,dragPan:!0,scrollZoom:!0,touchZoom:!0,touchRotate:!0,keyboard:!0,inertia:!1,scrollZoomSpeed:.5,dragRotateSpeed:.01},getCursor:()=>St.controls.followTarget?"crosshair":"grab",getTooltip:({object:It,layer:Mt})=>{var Ot,kt;if(!It)return null;switch(Mt==null?void 0:Mt.id){case"buildings":return`Building: ${It.type||"Unknown"}
Height: ${((Ot=It.height)==null?void 0:Ot.toFixed(1))||0}m`;case"agents":return`Agent: ${It.agent_type||"Unknown"}
Speed: ${((kt=It.speed)==null?void 0:kt.toFixed(1))||0} km/h`;case"roads":return`Road: ${It.road_type||"Unknown"}
Speed Limit: ${It.speed_limit||0} km/h`;default:return`${Mt==null?void 0:Mt.id}: ${It.id||"Unknown"}`}},style:{background:"#1a1a2e"}}),jsxRuntimeExports.jsxs("div",{style:{position:"absolute",bottom:10,right:10,background:"rgba(0, 0, 0, 0.8)",color:"white",padding:"5px 10px",borderRadius:"3px",fontSize:"12px"},children:[At.length," layers active"]}),jsxRuntimeExports.jsx(DebugOverlay,{isVisible:Et,onToggle:()=>wt(!Et)})]})}function PerformanceMonitor({metrics:xt,onClose:yt}){return jsxRuntimeExports.jsx(DraggablePanel,{title:" Performance Monitor",defaultPosition:{x:window.innerWidth-250,y:80},defaultSize:{width:220,height:280},isCollapsible:!0,initiallyCollapsed:!0,storageKey:"performance-monitor",panelType:"performance",children:jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[jsxRuntimeExports.jsxs("div",{style:metricRowStyle,children:[jsxRuntimeExports.jsx("span",{style:labelStyle,children:"FPS:"}),jsxRuntimeExports.jsx("span",{style:getValueStyle(xt.fps,55,30),children:xt.fps})]}),jsxRuntimeExports.jsxs("div",{style:metricRowStyle,children:[jsxRuntimeExports.jsx("span",{style:labelStyle,children:"TPS:"}),jsxRuntimeExports.jsx("span",{style:getValueStyle(xt.tps,55,30),children:xt.tps})]}),jsxRuntimeExports.jsxs("div",{style:metricRowStyle,children:[jsxRuntimeExports.jsx("span",{style:labelStyle,children:"Memory:"}),jsxRuntimeExports.jsxs("span",{style:valueStyle,children:[xt.memoryUsage.toFixed(1)," KB"]})]}),jsxRuntimeExports.jsxs("div",{style:metricRowStyle,children:[jsxRuntimeExports.jsx("span",{style:labelStyle,children:"Agents:"}),jsxRuntimeExports.jsx("span",{style:valueStyle,children:xt.agentCount})]}),jsxRuntimeExports.jsxs("div",{style:metricRowStyle,children:[jsxRuntimeExports.jsx("span",{style:labelStyle,children:"Time:"}),jsxRuntimeExports.jsxs("span",{style:valueStyle,children:[xt.simulationTime.toFixed(1),"h"]})]}),jsxRuntimeExports.jsxs("div",{style:metricRowStyle,children:[jsxRuntimeExports.jsx("span",{style:labelStyle,children:"Seed:"}),jsxRuntimeExports.jsx("span",{style:valueStyle,children:xt.seed})]})]}),jsxRuntimeExports.jsxs("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"0.5rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[jsxRuntimeExports.jsx("button",{onClick:yt,className:"button button-secondary",style:{width:"100%",padding:"0.4rem",fontSize:"0.75rem"},children:"Hide Monitor"}),jsxRuntimeExports.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic"},children:"Press Ctrl+P to toggle"})]})]})})}function getValueStyle(xt,yt,vt,bt=!1){const Tt={...valueStyle};return bt?xt<=yt?Tt.color="#4ade80":xt<=vt?Tt.color="#fbbf24":Tt.color="#f87171":xt>=yt?Tt.color="#4ade80":xt>=vt?Tt.color="#fbbf24":Tt.color="#f87171",Tt}const metricRowStyle={display:"flex",justifyContent:"space-between",alignItems:"center"},labelStyle={color:"var(--text-secondary)",fontSize:"0.75rem",fontWeight:500},valueStyle={fontWeight:"bold",fontSize:"0.75rem",textAlign:"right",color:"var(--text-primary)"};function generateSubwaySystem(xt,yt=4){const vt=[],{min_x:bt,min_y:Tt,max_x:Et,max_y:wt}=xt,St=["red","blue","green","yellow","purple","orange"];for(let At=0;At<yt;At++){const Rt=St[At%St.length],Pt=`line_${Rt}`,Ct=8+Math.floor(Math.random()*5),It=[];for(let Mt=0;Mt<Ct;Mt++){const Ot=Mt/(Ct-1),kt=bt+Ot*(Et-bt),Ft=Tt+Ot*(wt-Tt),Nt=Math.sin(Ot*Math.PI*2)*(Et-bt)*.1,Lt=Math.cos(Ot*Math.PI*1.5)*(wt-Tt)*.1,Dt={id:`${Pt}_station_${Mt}`,type:"station",x:kt+Nt,y:Ft+Lt,elevation:-12,line_color:Rt,name:`${Rt.charAt(0).toUpperCase()+Rt.slice(1)} Line Station ${Mt+1}`,passenger_capacity:500+Math.random()*1e3,daily_passengers:Math.random()*1e4};It.push(Dt),vt.push(Dt)}for(let Mt=0;Mt<It.length-1;Mt++){const Ot=It[Mt],kt=It[Mt+1];vt.push({id:`${Pt}_tunnel_${Mt}`,type:"tunnel",path:[[Ot.x,Ot.y],[kt.x,kt.y]],width:4,elevation:-15,line_color:Rt,length:Math.sqrt(Math.pow(kt.x-Ot.x,2)+Math.pow(kt.y-Ot.y,2)),capacity:2e3,current_load:Math.random()*1500})}if(At>0&&Math.random()>.5){const Mt=It,Ot=vt.filter(kt=>kt.type==="station"&&kt.line_color===St[At-1]);if(Ot.length>0){const kt=Mt[Math.floor(Math.random()*Mt.length)],Ft=Ot[Math.floor(Math.random()*Ot.length)];vt.push({id:`transfer_${Rt}_${St[At-1]}`,type:"tunnel",path:[[kt.x,kt.y],[Ft.x,Ft.y]],width:3,elevation:-13,line_color:"transfer",is_transfer:!0})}}}return vt}function generateMultiLayerCityData(xt){const yt=(xt==null?void 0:xt.bounds)||{min_x:-2e3,min_y:-2e3,max_x:2e3,max_y:2e3},vt=(xt==null?void 0:xt.buildings)||[];console.log("Generating multi-layer city data for bounds:",yt);const bt=generateSewerNetwork(yt,.8),Tt=generateUtilityNetwork(yt,1),Et=generateSubwaySystem(yt,3),wt=generateUndergroundParking(vt,.4);console.log("Generated underground infrastructure:",{sewers:bt.length,utilities:Tt.length,subway:Et.length,parking:wt.length});const St=generateElevatedHighways(yt,.6),At=generateSkyBridges(vt,.3),Rt=generateElevatedTransit(yt,2);console.log("Generated elevated infrastructure:",{elevatedRoads:St.length,skyBridges:At.length,elevatedTransit:Rt.length});const Pt=generateHelicopterTraffic(yt,.15),Ct=generateAirTraffic(yt,.08),It=generateDroneTraffic(yt,.4);console.log("Generated aerial traffic:",{helicopters:Pt.length,aircraft:Ct.length,drones:It.length}),console.log("Converting all coordinates from meters to lat/lng...");const Mt=convertAllCoordinates({sewers:bt,utilities:Tt,subway:Et,parking:wt,elevatedRoads:St,skyBridges:At,elevatedTransit:Rt}),Ot=convertAllCoordinates({helicopters:Pt,aircraft:Ct,drones:It});return console.log(" All coordinates converted to lat/lng"),{infrastructure:Mt,aerialTraffic:Ot,bounds:yt}}function enhanceSimulationDataWithLayers(xt,yt){const vt=generateMultiLayerCityData(yt);return{...xt,infrastructure:vt.infrastructure,aerialTraffic:vt.aerialTraffic,bounds:vt.bounds}}class GeographicCityGenerator{constructor(yt,vt){Bt(this,"terrainState");Bt(this,"context");Bt(this,"noiseGenerator");this.terrainState=yt,this.noiseGenerator=new SimplexNoise(yt.seed),this.context=this.buildGeographicContext(vt)}buildGeographicContext(yt){const{customParameters:vt,terrainProfile:bt,seed:Tt}=this.terrainState,Et=getTerrainProfile(bt),wt=bt==="custom"?vt:(Et==null?void 0:Et.parameters)||vt,St=.001,At=.003,Rt=(kt,Ft)=>{const Nt=this.noiseGenerator.noise2D(kt*St,Ft*St),Lt=this.noiseGenerator.noise2D(kt*At,Ft*At),Dt=this.noiseGenerator.noise2D(kt*St*4,Ft*St*4)*.3;return(Nt+Math.abs(Lt)*.7+Dt)*wt.mountainHeight+wt.waterLevel},Pt=(kt,Ft)=>Rt(kt,Ft)<wt.waterLevel,Ct=(kt,Ft)=>{for(let Nt=100;Nt<=5e3;Nt+=100){const Lt=Math.max(8,Math.floor(Nt/100));for(let Dt=0;Dt<Lt;Dt++){const $t=Dt/Lt*2*Math.PI,zt=kt+Math.cos($t)*Nt,Ut=Ft+Math.sin($t)*Nt;if(Pt(zt,Ut))return Nt}}return wt.coastalDistance},It=(kt,Ft)=>{const Lt=Rt(kt-50,Ft),Dt=Rt(kt+50,Ft),$t=Rt(kt,Ft-50),zt=Rt(kt,Ft+50),Ut=Math.abs(Dt-Lt)/(2*50),jt=Math.abs(zt-$t)/(2*50);return Math.sqrt(Ut*Ut+jt*jt)},Mt=this.generateRiverPaths(yt,wt,Rt),Ot=this.generateCoastlines(yt,Pt);return{terrainHeight:Rt,isWater:Pt,distanceToWater:Ct,slope:It,riverPaths:Mt,coastlines:Ot,bounds:yt}}generateRiverPaths(yt,vt,bt){const Tt=[];if(Math.random()<vt.riverProbability){const Et=[];let wt=yt.min_x+(yt.max_x-yt.min_x)*.3+(Math.random()-.5)*2e3;yt.min_y;const St=150,At=Math.floor((yt.max_y-yt.min_y)/St);for(let Rt=0;Rt<At;Rt++){const Pt=yt.min_y+Rt*St,Ct=8;let It=wt,Mt=bt(wt,Pt);for(let kt=0;kt<Ct;kt++){const Ft=wt+(kt-Ct/2)*100,Nt=bt(Ft,Pt);Nt<Mt&&(Mt=Nt,It=Ft)}const Ot=Math.sin(Pt/1e3)*300+(Math.random()-.5)*200;wt=It+Ot,Et.push({x:wt,y:Pt})}Tt.push(Et)}return Tt}generateCoastlines(yt,vt){return[]}getSuitabilityFactors(yt,vt){const bt=this.context.terrainHeight(yt,vt),Tt=this.context.slope(yt,vt),Et=this.context.distanceToWater(yt,vt),{bounds:wt}=this.context,St=(wt.min_x+wt.max_x)/2,At=(wt.min_y+wt.max_y)/2,Rt=Math.sqrt(Math.pow(yt-St,2)+Math.pow(vt-At,2)),Pt=Math.sqrt(Math.pow(wt.max_x-wt.min_x,2)+Math.pow(wt.max_y-wt.min_y,2))/2;return{flatness:Math.max(0,1-Tt*10),waterAccess:Math.max(0,1-Et/3e3),elevation:Math.max(0,Math.min(1,(bt+50)/200)),accessibility:Math.max(0,1-Rt/Pt),drainage:Math.max(0,1-Math.max(0,-bt/20)),view:Math.max(0,bt/100)}}getZoneSuitability(yt,vt,bt){const Tt=this.context.isWater(yt,vt);if(Tt&&!["port","marina","ferry_terminal"].includes(bt))return 0;const Et=this.getSuitabilityFactors(yt,vt);let wt=1;switch(bt.toLowerCase()){case"downtown":case"commercial":wt*=Et.flatness*.8+.2,wt*=Et.waterAccess*.6+.4,wt*=Et.accessibility*.7+.3,wt*=Et.drainage*.8+.2;break;case"residential":wt*=Et.flatness*.4+.6,wt*=Et.accessibility*.6+.4,wt*=Et.view*.3+.7,wt*=Et.drainage*.9+.1,Et.elevation>.3&&(wt*=1.2);break;case"industrial":wt*=Et.flatness*.9+.1,wt*=Et.waterAccess*.7+.3,wt*=Et.accessibility*.5+.5,wt*=Et.drainage*.8+.2,wt*=1-Et.view*.2;break;case"park":case"recreation":wt*=Et.flatness*.2+.8,wt*=Et.view*.8+.2,wt*=Et.waterAccess*.4+.6,Et.elevation>.5&&(wt*=1.5),Et.flatness<.3&&(wt*=1.3);break;case"airport":wt*=Math.pow(Et.flatness,2),wt*=Et.accessibility*.6+.4,wt*=Et.drainage*.9+.1,Et.flatness<.8&&(wt=0);break;case"port":case"marina":Tt||(wt*=Math.max(0,1-this.context.distanceToWater(yt,vt)/500)),wt*=Et.flatness*.8+.2,wt*=Et.accessibility*.7+.3;break;default:wt*=Et.flatness*.5+.5,wt*=Et.accessibility*.5+.5,wt*=Et.drainage*.7+.3;break}return Math.max(0,Math.min(1,wt))}getOptimalPOILocation(yt,vt,bt,Tt,Et=[]){let wt=null,St=0;const At=30,Rt=yt==="lighthouse"?100:200;for(let Pt=0;Pt<At;Pt++){const Ct=Pt/At*2*Math.PI,It=Math.random()*vt,Mt=bt+Math.cos(Ct)*It,Ot=Tt+Math.sin(Ct)*It;if(Et.some(Nt=>Math.sqrt(Math.pow(Mt-Nt.x,2)+Math.pow(Ot-Nt.y,2))<Rt))continue;let Ft=this.getZoneSuitability(Mt,Ot,yt);switch(yt.toLowerCase()){case"lighthouse":const Nt=this.context.distanceToWater(Mt,Ot);Ft*=Math.max(0,1-Nt/300),Ft*=this.getSuitabilityFactors(Mt,Ot).elevation;break;case"ski_resort":case"observatory":const Lt=this.getSuitabilityFactors(Mt,Ot).elevation;Ft*=Math.pow(Lt,2);break;case"beach":this.context.isWater(Mt,Ot)||(Ft*=Math.max(0,1-this.context.distanceToWater(Mt,Ot)/100));break;case"bridge":this.wouldCrossWater(Mt,Ot,500)&&(Ft*=2);break}Ft>St&&(St=Ft,wt={x:Mt,y:Ot,suitability:Ft})}return wt}generateTerrainAwareRoadPath(yt,vt,bt=.15){const Tt=[yt],Et=Math.max(8,Math.floor(Math.sqrt(Math.pow(vt.x-yt.x,2)+Math.pow(vt.y-yt.y,2))/300));for(let wt=1;wt<Et;wt++){const St=wt/Et,At=yt.x+(vt.x-yt.x)*St,Rt=yt.y+(vt.y-yt.y)*St;let Pt=At,Ct=Rt,It=this.evaluateRoadPoint(At,Rt,bt);const Mt=200,Ot=12;for(let kt=0;kt<Ot;kt++){const Ft=kt/Ot*2*Math.PI,Nt=At+Math.cos(Ft)*Mt,Lt=Rt+Math.sin(Ft)*Mt,Dt=this.evaluateRoadPoint(Nt,Lt,bt);Dt>It&&(It=Dt,Pt=Nt,Ct=Lt)}Tt.push({x:Pt,y:Ct})}return Tt.push(vt),this.smoothPath(Tt)}evaluateRoadPoint(yt,vt,bt){const Tt=this.context.slope(yt,vt);return this.context.isWater(yt,vt)?-1:Tt>bt?0:Math.max(0,1-Tt/bt)}smoothPath(yt){if(yt.length<3)return yt;const vt=[yt[0]];for(let bt=1;bt<yt.length-1;bt++){const Tt=yt[bt-1],Et=yt[bt],wt=yt[bt+1],St=(Tt.x+Et.x*2+wt.x)/4,At=(Tt.y+Et.y*2+wt.y)/4;vt.push({x:St,y:At})}return vt.push(yt[yt.length-1]),vt}wouldCrossWater(yt,vt,bt){for(let Et=0;Et<8;Et++){const wt=Et/8*2*Math.PI,St=yt+Math.cos(wt)*bt,At=vt+Math.sin(wt)*bt;if(this.context.isWater(St,At))return!0}return!1}getTerrainAnalysis(yt,vt){return{height:this.context.terrainHeight(yt,vt),slope:this.context.slope(yt,vt),waterDistance:this.context.distanceToWater(yt,vt),isWater:this.context.isWater(yt,vt),factors:this.getSuitabilityFactors(yt,vt)}}}class SimplexNoise{constructor(yt){Bt(this,"seed");Bt(this,"perm");this.seed=yt,this.perm=this.generatePermutation()}generatePermutation(){const yt=Array.from({length:256},(bt,Tt)=>Tt);let vt=this.seed;for(let bt=255;bt>0;bt--){vt=(vt*9301+49297)%233280;const Tt=Math.floor(vt/233280*(bt+1));[yt[bt],yt[Tt]]=[yt[Tt],yt[bt]]}return[...yt,...yt]}noise2D(yt,vt){const bt=Math.floor(yt)&255,Tt=Math.floor(vt)&255;yt-=Math.floor(yt),vt-=Math.floor(vt);const Et=Ct=>Ct*Ct*Ct*(Ct*(Ct*6-15)+10),wt=(Ct,It,Mt)=>It+Ct*(Mt-It),St=Et(yt),At=Et(vt),Rt=this.perm[bt]+Tt,Pt=this.perm[bt+1]+Tt;return wt(At,wt(St,this.grad(this.perm[Rt],yt,vt),this.grad(this.perm[Pt],yt-1,vt)),wt(St,this.grad(this.perm[Rt+1],yt,vt-1),this.grad(this.perm[Pt+1],yt-1,vt-1)))}grad(yt,vt,bt){const Tt=yt&3,Et=Tt<2?vt:bt,wt=Tt<1?bt:Tt===2?vt:0;return(Tt&1?-Et:Et)+(Tt&2?-wt:wt)}}function enhanceCityWithGeography(xt,yt){var St;if(!yt.isEnabled)return xt;const vt=xt.bounds||{min_x:-5e3,min_y:-5e3,max_x:5e3,max_y:5e3},bt=new GeographicCityGenerator(yt,vt),Tt=((St=xt.zones)==null?void 0:St.map(At=>{var kt,Ft,Nt,Lt;const Rt=((kt=At.boundary)==null?void 0:kt.reduce((Dt,$t)=>Dt+$t.x,0))/(((Ft=At.boundary)==null?void 0:Ft.length)||1),Pt=((Nt=At.boundary)==null?void 0:Nt.reduce((Dt,$t)=>Dt+$t.y,0))/(((Lt=At.boundary)==null?void 0:Lt.length)||1),It=["residential","commercial","industrial","downtown","park"][At.type]||"residential",Mt=bt.getZoneSuitability(Rt,Pt,It),Ot=bt.getTerrainAnalysis(Rt,Pt);return{...At,geographic_suitability:Mt,terrain_analysis:Ot}}))||[],Et=[],wt=getTerrainProfile(yt.terrainProfile);if(wt){if(wt.parameters.coastalDistance<5e3){const At=bt.getOptimalPOILocation("lighthouse",3e3,vt.min_x+1e3,(vt.min_y+vt.max_y)/2);At&&At.suitability>.5&&Et.push({id:`lighthouse_${Date.now()}`,type:5,position:{x:At.x,y:At.y},capacity:50,properties:{name:"Harbor Lighthouse",landmark:!0,terrain_suitability:At.suitability}})}if(wt.parameters.mountainHeight>100){const At=bt.getOptimalPOILocation("observatory",4e3,(vt.min_x+vt.max_x)/2,(vt.min_y+vt.max_y)/2);At&&At.suitability>.7&&Et.push({id:`scenic_overlook_${Date.now()}`,type:5,position:{x:At.x,y:At.y},capacity:100,properties:{name:"Scenic Overlook",landmark:!0,terrain_suitability:At.suitability}})}}return{...xt,zones:Tt,pois:[...xt.pois||[],...Et],geographic_metadata:{terrain_profile:yt.terrainProfile,terrain_seed:yt.seed,geographic_features:Et.length,terrain_enabled:!0,generation_timestamp:new Date().toISOString()}}}function CityVisualization({optimizationResult:xt,onStart:yt,onPause:vt,onSetSpeed:bt,isInitialized:Tt,showPerformance:Et,onTogglePerformance:wt}){const{state:St,dispatch:At}=useSimulationContext(),{state:Rt}=useTerrainContext(),[Pt,Ct]=reactExports.useState(null),[It,Mt]=reactExports.useState(!1),Ot=useCamera({longitude:-74.006,latitude:40.7128,zoom:12,pitch:45,bearing:0}),kt=reactExports.useCallback(()=>{Mt(Lt=>!Lt)},[]),[Ft,Nt]=reactExports.useState(!1);return reactExports.useEffect(()=>{if(St.cityModel&&!Ft){console.log("Updating view state based on city model bounds...");const Lt=getBoundsFromCityModel(St.cityModel),Dt={longitude:Lt.longitude,latitude:Lt.latitude,zoom:12,pitch:45,bearing:0};console.log("Setting camera to working bounds:",Dt),Ot.setViewState(Dt),Nt(!0)}},[St.cityModel,Ft]),reactExports.useEffect(()=>{St.agents&&St.agents.length>0&&St.agents.forEach(Lt=>{Lt.position&&Lt.id&&Ot.updateFollowTarget(Lt.id,[Lt.position.x,Lt.position.y,Lt.position.z||5],"agent")})},[St.agents]),reactExports.useEffect(()=>{var Lt,Dt,$t,zt,Ut;if(St.cityModel){console.log("Enhancing simulation data with multi-layer infrastructure...");let jt=St.cityModel;Rt.isEnabled&&(console.log("Enhancing city model with geographic features..."),jt=enhanceCityWithGeography(St.cityModel,Rt),console.log("Geographic enhancement completed:",{originalZones:((Lt=St.cityModel.zones)==null?void 0:Lt.length)||0,enhancedZones:((Dt=jt.zones)==null?void 0:Dt.length)||0,originalPOIs:(($t=St.cityModel.pois)==null?void 0:$t.length)||0,enhancedPOIs:((zt=jt.pois)==null?void 0:zt.length)||0,geographicFeatures:((Ut=jt.geographic_metadata)==null?void 0:Ut.geographic_features)||0}));const Ht=enhanceSimulationDataWithLayers({buildings:jt.buildings||[],roads:jt.roads||[],agents:St.agents||[],pois:jt.pois||[]},jt);Ct(Ht),console.log("Enhanced data generated:",Ht)}},[St.cityModel,St.agents,Rt.isEnabled,Rt.seed,Rt.terrainProfile]),reactExports.useEffect(()=>{Pt&&At({type:"SET_SIMULATION_DATA",payload:Pt})},[Pt,At]),jsxRuntimeExports.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",minHeight:"100vh"},children:[jsxRuntimeExports.jsx(Cityscape,{optimizationResult:xt,showZones:It,onToggleZones:kt,camera:Ot}),Et&&jsxRuntimeExports.jsx(PerformanceMonitor,{metrics:{fps:60,tps:St.isRunning?60:0,memoryUsage:St.stats.totalAgents*.1,agentCount:St.stats.totalAgents,simulationTime:St.currentTime,seed:0},onClose:wt}),St.selectedTool&&jsxRuntimeExports.jsxs("div",{style:{position:"absolute",bottom:"1rem",left:"50%",transform:"translateX(-50%)",background:"var(--primary-color)",color:"white",padding:"0.75rem 1.5rem",borderRadius:"var(--border-radius)",fontSize:"0.875rem",fontWeight:500,zIndex:1e3,boxShadow:"var(--shadow-lg)"},children:[" ",St.selectedTool.toUpperCase()," tool selected - Click on the map to use"]})]})}var PerformanceLevel=(xt=>(xt[xt.UltraLow=0]="UltraLow",xt[xt.Low=1]="Low",xt[xt.Medium=2]="Medium",xt[xt.High=3]="High",xt[xt.Ultra=4]="Ultra",xt))(PerformanceLevel||{});class PerformanceProfiler{constructor(){Bt(this,"wasmBenchmark");Bt(this,"wasmScaler");Bt(this,"frameTimeHistory",[]);Bt(this,"lastFrameTime",performance.now());Bt(this,"rafId");this.initializeWasm()}async initializeWasm(){try{const yt=await __vitePreload(()=>import("./urbansynth_sim-BJDcseqM.js"),[]);this.wasmBenchmark=new yt.DeviceBenchmark,this.wasmScaler=new yt.AdaptiveScaler}catch{console.warn("WASM performance modules not available, using JS fallback")}}async detectDeviceCapabilities(){const yt={cpu_cores:navigator.hardwareConcurrency||4,memory_gb:navigator.deviceMemory||this.estimateMemory(),gpu_score:await this.benchmarkGPU(),refresh_rate:await this.detectRefreshRate()};if("getBattery"in navigator)try{const vt=await navigator.getBattery();yt.battery_level=vt.level,yt.is_charging=vt.charging}catch{}return yt}estimateMemory(){const yt=document.createElement("canvas"),vt=yt.getContext("webgl")||yt.getContext("experimental-webgl");if(vt){const bt=vt.getExtension("WEBGL_debug_renderer_info");if(bt){const Tt=vt.getParameter(bt.UNMASKED_RENDERER_WEBGL);return Tt.includes("Intel")?8:Tt.includes("RTX")||Tt.includes("RX")?16:4}}return 4}async benchmarkGPU(){return new Promise(yt=>{const vt=document.createElement("canvas");vt.width=256,vt.height=256;const bt=vt.getContext("webgl2")||vt.getContext("webgl");if(!bt){yt(100);return}const Tt=performance.now();let Et=1e3;const wt=bt.createShader(bt.VERTEX_SHADER);bt.shaderSource(wt,`
        attribute vec2 position;
        void main() {
          gl_Position = vec4(position, 0.0, 1.0);
        }
      `),bt.compileShader(wt);const St=bt.createShader(bt.FRAGMENT_SHADER);bt.shaderSource(St,`
        precision mediump float;
        void main() {
          gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
        }
      `),bt.compileShader(St);const At=bt.createProgram();bt.attachShader(At,wt),bt.attachShader(At,St),bt.linkProgram(At),bt.useProgram(At);for(let Pt=0;Pt<1e3;Pt++)bt.drawArrays(bt.TRIANGLES,0,3);bt.finish();const Rt=performance.now()-Tt;Et=Math.max(100,Math.min(1e4,1e4/Rt)),yt(Et)})}async detectRefreshRate(){return new Promise(yt=>{let vt=0;const bt=performance.now(),Tt=()=>{if(vt++,vt<60)requestAnimationFrame(Tt);else{const Et=performance.now()-bt,wt=vt/Et*1e3;wt>200?yt(240):wt>140?yt(165):wt>110?yt(144):wt>100?yt(120):wt>50?yt(60):yt(30)}};requestAnimationFrame(Tt)})}async runBenchmark(){console.log(" Running device benchmark...");const yt=performance.now(),vt=await this.detectDeviceCapabilities(),bt=this.calculateCPUScore(vt),Tt=this.calculateMemoryScore(vt),Et=vt.gpu_score,wt=(bt+Tt+Et)/3,St=this.selectOptimalProfile(wt,vt),At={overall_score:wt,recommended_profile:St,benchmark_duration_ms:performance.now()-yt,test_results:{cpu_score:bt,memory_score:Tt,render_score:Et}};return console.log(" Benchmark complete:",At),At}calculateCPUScore(yt){return Math.min(1e4,yt.cpu_cores*1e3)}calculateMemoryScore(yt){return Math.min(1e4,Math.pow(yt.memory_gb,1.5)*500)}selectOptimalProfile(yt,vt){return yt>8e3&&vt.refresh_rate>=240?{target_fps:240,max_agents:5e4,render_distance:1e3,update_frequency:120,level:PerformanceLevel.Ultra}:yt>6e3&&vt.refresh_rate>=120?{target_fps:120,max_agents:15e3,render_distance:800,update_frequency:60,level:PerformanceLevel.High}:yt>3e3?{target_fps:60,max_agents:5e3,render_distance:600,update_frequency:30,level:PerformanceLevel.Medium}:yt>1500?{target_fps:30,max_agents:2e3,render_distance:400,update_frequency:15,level:PerformanceLevel.Low}:{target_fps:15,max_agents:500,render_distance:200,update_frequency:10,level:PerformanceLevel.UltraLow}}startFrameMonitoring(yt){const vt=()=>{var Rt;const bt=performance.now(),Tt=bt-this.lastFrameTime;this.lastFrameTime=bt,this.frameTimeHistory.push(Tt),this.frameTimeHistory.length>60&&this.frameTimeHistory.shift();const Et=this.frameTimeHistory.reduce((Pt,Ct)=>Pt+Ct,0)/this.frameTimeHistory.length,wt=1e3/Et,St=((Rt=performance.memory)==null?void 0:Rt.usedJSHeapSize)/(1024*1024)||0,At={current_fps:Math.round(wt*10)/10,target_fps:60,frame_time_ms:Math.round(Et*10)/10,agent_count:0,memory_usage_mb:Math.round(St),gpu_utilization:0,cpu_utilization:0};yt(At),this.rafId=requestAnimationFrame(vt)};this.rafId=requestAnimationFrame(vt)}stopFrameMonitoring(){this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=void 0)}createDefaultAdaptationSettings(){return{enable_auto_scaling:!0,fps_tolerance:5,adaptation_delay_ms:2e3,min_stable_frames:30,performance_priority:"balanced"}}}const performanceProfiler=new PerformanceProfiler;function usePerformanceAdaptation(xt={}){const{autoStart:yt=!0,adaptationSettings:vt,onProfileChange:bt,onMetricsUpdate:Tt}=xt,[Et,wt]=reactExports.useState({current_profile:getDefaultProfile(),metrics:getDefaultMetrics(),adaptation_settings:{...performanceProfiler.createDefaultAdaptationSettings(),...vt},is_adapting:!1,last_adaptation_time:0}),[St,At]=reactExports.useState(null),[Rt,Pt]=reactExports.useState(!1),Ct=reactExports.useRef(),It=reactExports.useRef(0),Mt=reactExports.useCallback(async()=>{if(!Rt)try{console.log(" Initializing performance adaptation system...");const zt=await performanceProfiler.runBenchmark();At(zt),wt(Ut=>({...Ut,current_profile:zt.recommended_profile,metrics:{...Ut.metrics,target_fps:zt.recommended_profile.target_fps}})),bt==null||bt(zt.recommended_profile),Pt(!0),console.log(` Performance system initialized with ${PerformanceLevel[zt.recommended_profile.level]} profile`)}catch(zt){console.error(" Failed to initialize performance system:",zt);const Ut=getDefaultProfile();wt(jt=>({...jt,current_profile:Ut})),bt==null||bt(Ut),Pt(!0)}},[Rt,bt]),Ot=reactExports.useCallback(()=>{performanceProfiler.startFrameMonitoring(zt=>{wt(Ut=>{const jt={...zt,target_fps:Ut.current_profile.target_fps,agent_count:Ut.metrics.agent_count};return Ut.adaptation_settings.enable_auto_scaling&&!Ut.is_adapting&&Ft(jt,Ut),Tt==null||Tt(jt),{...Ut,metrics:jt}})})},[Tt]),kt=reactExports.useCallback(()=>{performanceProfiler.stopFrameMonitoring(),Ct.current&&clearTimeout(Ct.current)},[]),Ft=reactExports.useCallback((zt,Ut)=>{const{current_fps:jt,target_fps:Ht}=zt,{adaptation_settings:Vt,last_adaptation_time:Wt}=Ut;if(Date.now()-Wt<Vt.adaptation_delay_ms)return;const Kt=Ht-jt,Zt=Kt>Vt.fps_tolerance,Xt=Kt<-Vt.fps_tolerance;Zt||Xt?(It.current++,It.current>=Vt.min_stable_frames&&(Nt(Zt?"down":"up"),It.current=0)):It.current=0},[]),Nt=reactExports.useCallback(zt=>{wt(Ut=>{if(Ut.is_adapting)return Ut;const jt=Ut.current_profile.level;let Ht=jt;if(zt==="down"&&jt>PerformanceLevel.UltraLow)Ht=jt-1;else if(zt==="up"&&jt<PerformanceLevel.Ultra)Ht=jt+1;else return Ut;const Vt=createProfileForLevel(Ht);console.log(` Adapting performance ${zt}: ${PerformanceLevel[jt]}  ${PerformanceLevel[Ht]}`);const Wt={...Ut,current_profile:Vt,is_adapting:!0,last_adaptation_time:Date.now(),metrics:{...Ut.metrics,target_fps:Vt.target_fps}};return Ct.current&&clearTimeout(Ct.current),Ct.current=setTimeout(()=>{wt(Yt=>({...Yt,is_adapting:!1}))},1e3),bt==null||bt(Vt),Wt})},[bt]),Lt=reactExports.useCallback(zt=>{wt(Ut=>({...Ut,current_profile:zt,metrics:{...Ut.metrics,target_fps:zt.target_fps},last_adaptation_time:Date.now()})),bt==null||bt(zt)},[bt]),Dt=reactExports.useCallback(zt=>{wt(Ut=>({...Ut,metrics:{...Ut.metrics,agent_count:zt}}))},[]),$t=reactExports.useCallback(zt=>{wt(Ut=>({...Ut,adaptation_settings:{...Ut.adaptation_settings,...zt}}))},[]);return reactExports.useEffect(()=>(yt&&Mt().then(()=>{Ot()}),()=>{kt()}),[yt,Mt,Ot,kt]),{performanceState:Et,benchmarkResult:St,isInitialized:Rt,initialize:Mt,startMonitoring:Ot,stopMonitoring:kt,setProfile:Lt,updateAgentCount:Dt,updateSettings:$t,adaptPerformance:Nt,currentLevel:PerformanceLevel[Et.current_profile.level],isPerformingWell:Math.abs(Et.metrics.current_fps-Et.metrics.target_fps)<=Et.adaptation_settings.fps_tolerance,canAdaptUp:Et.current_profile.level<PerformanceLevel.Ultra,canAdaptDown:Et.current_profile.level>PerformanceLevel.UltraLow}}function getDefaultProfile(){return{target_fps:60,max_agents:5e3,render_distance:600,update_frequency:30,level:PerformanceLevel.Medium}}function getDefaultMetrics(){return{current_fps:60,target_fps:60,frame_time_ms:16.67,agent_count:0,memory_usage_mb:0,gpu_utilization:0,cpu_utilization:0}}function createProfileForLevel(xt){switch(xt){case PerformanceLevel.UltraLow:return{target_fps:15,max_agents:500,render_distance:200,update_frequency:10,level:xt};case PerformanceLevel.Low:return{target_fps:30,max_agents:2e3,render_distance:400,update_frequency:15,level:xt};case PerformanceLevel.Medium:return{target_fps:60,max_agents:5e3,render_distance:600,update_frequency:30,level:xt};case PerformanceLevel.High:return{target_fps:120,max_agents:15e3,render_distance:800,update_frequency:60,level:xt};case PerformanceLevel.Ultra:return{target_fps:240,max_agents:5e4,render_distance:1e3,update_frequency:120,level:xt};default:return getDefaultProfile()}}function processTrafficData(xt,yt,vt){const bt=[],Et=calculateBounds(yt,vt);for(let wt=Et.minX;wt<Et.maxX;wt+=200)for(let St=Et.minY;St<Et.maxY;St+=200){const At={x:wt+100,y:St+100},Rt=calculateTrafficDensityAt(At,vt,yt),Pt=calculateFlowVolumeAt(At,vt,yt);Rt>.5&&bt.push({position:At,density:Rt,flow_volume:Pt,peak_hours:[8,9,17,18]})}return bt.sort((wt,St)=>St.density-wt.density).slice(0,50)}function calculateBounds(xt,yt){let vt=1/0,bt=1/0,Tt=-1/0,Et=-1/0;return xt.forEach(wt=>{wt.path&&Array.isArray(wt.path)&&wt.path.forEach(St=>{const At=St.x||St[0]||0,Rt=St.y||St[1]||0;vt=Math.min(vt,At),bt=Math.min(bt,Rt),Tt=Math.max(Tt,At),Et=Math.max(Et,Rt)})}),yt.forEach(wt=>{wt.position&&(vt=Math.min(vt,wt.position.x||0),bt=Math.min(bt,wt.position.y||0),Tt=Math.max(Tt,wt.position.x||0),Et=Math.max(Et,wt.position.y||0))}),isFinite(vt)||(vt=-1e3,bt=-1e3,Tt=1e3,Et=1e3),{minX:vt,minY:bt,maxX:Tt,maxY:Et}}function calculateTrafficDensityAt(xt,yt,vt){let Tt=0;return yt.forEach(Et=>{if(!Et.position)return;if(Math.sqrt(Math.pow((Et.position.x||0)-xt.x,2)+Math.pow((Et.position.y||0)-xt.y,2))<=150){const St=Math.max(.1,1-(Et.speed||0)/50);Tt+=St}}),vt.forEach(Et=>{if(!Et.path||!Array.isArray(Et.path))return;const wt=distanceToRoad(xt,Et.path);if(wt<=150){const St=1-wt/150,At=Et.lanes||2;Tt+=St*At*.3}}),Tt}function calculateFlowVolumeAt(xt,yt,vt){let Tt=0;return yt.forEach(Et=>{if(!Et.position)return;const wt=Math.sqrt(Math.pow((Et.position.x||0)-xt.x,2)+Math.pow((Et.position.y||0)-xt.y,2));if(wt<=200){const St=1-wt/200;Tt+=St*(Et.speed||0)}}),vt.forEach(Et=>{const wt=distanceToRoad(xt,Et.path||[]);if(wt<=200){const St=1-wt/200;Tt+=St*(Et.traffic_density||10)}}),Tt}function distanceToRoad(xt,yt){if(yt.length<2)return 1/0;let vt=1/0;for(let bt=0;bt<yt.length-1;bt++){const Tt=distanceToLineSegment(xt,{x:yt[bt].x||yt[bt][0]||0,y:yt[bt].y||yt[bt][1]||0},{x:yt[bt+1].x||yt[bt+1][0]||0,y:yt[bt+1].y||yt[bt+1][1]||0});vt=Math.min(vt,Tt)}return vt}function distanceToLineSegment(xt,yt,vt){const bt=vt.x-yt.x,Tt=vt.y-yt.y;if(bt===0&&Tt===0){const Pt=xt.x-yt.x,Ct=xt.y-yt.y;return Math.sqrt(Pt*Pt+Ct*Ct)}const Et=Math.max(0,Math.min(1,((xt.x-yt.x)*bt+(xt.y-yt.y)*Tt)/(bt*bt+Tt*Tt))),wt=yt.x+Et*bt,St=yt.y+Et*Tt,At=xt.x-wt,Rt=xt.y-St;return Math.sqrt(At*At+Rt*Rt)}function generateCandidateLocations(xt,yt,vt=[]){const bt=[],Et=xt.filter(wt=>wt.density>2).slice(0,30);for(const wt of Et)if(!vt.some(At=>{var Pt,Ct;return Math.sqrt(Math.pow((((Pt=At.position)==null?void 0:Pt.x)||0)-wt.position.x,2)+Math.pow((((Ct=At.position)==null?void 0:Ct.y)||0)-wt.position.y,2))<500})){const At=findNearestRoadPoint(wt.position,yt);At&&bt.push(At)}return bt.slice(0,20)}function findNearestRoadPoint(xt,yt){let vt=null,bt=1/0;return yt.forEach(Tt=>{!Tt.path||!Array.isArray(Tt.path)||Tt.path.forEach(Et=>{const wt=Et.x||Et[0]||0,St=Et.y||Et[1]||0,At=Math.sqrt(Math.pow(wt-xt.x,2)+Math.pow(St-xt.y,2));At<bt&&(bt=At,vt={x:wt,y:St})})}),vt}class FacilityLocationProblem{constructor(yt){Bt(this,"input");Bt(this,"candidateLocations");Bt(this,"coverageMatrix");this.input=yt,this.candidateLocations=this.generateCandidates(),this.coverageMatrix=this.calculateCoverageMatrix()}generateCandidates(){return generateCandidateLocations(this.input.traffic_data,this.input.roads,this.input.existing_stations)}calculateCoverageMatrix(){const{traffic_data:yt,config:vt}=this.input,bt=[];return this.candidateLocations.forEach((Tt,Et)=>{bt[Et]=[],yt.forEach((wt,St)=>{Math.sqrt(Math.pow(Tt.x-wt.position.x,2)+Math.pow(Tt.y-wt.position.y,2))<=vt.coverage_radius?bt[Et][St]=wt.density*wt.flow_volume:bt[Et][St]=0})}),bt}getProblemData(){return{candidates:this.candidateLocations,coverageMatrix:this.coverageMatrix,trafficPoints:this.input.traffic_data,config:this.input.config}}calculateCoverage(yt){const vt=new Set,{traffic_data:bt}=this.input;yt.forEach(wt=>{var St;(St=this.coverageMatrix[wt])==null||St.forEach((At,Rt)=>{At>0&&vt.add(Rt)})});const Tt=bt.reduce((wt,St)=>wt+St.density,0),Et=Array.from(vt).reduce((wt,St)=>wt+bt[St].density,0);return Tt>0?Et/Tt:0}calculateCost(yt){return yt.length*this.input.config.cost_per_station}calculateObjectiveValue(yt){const vt=this.calculateCoverage(yt),bt=this.calculateCost(yt),{weight_coverage:Tt,weight_cost:Et}=this.input.config;return vt*Tt-bt/1e5*Et}getCandidateCount(){return this.candidateLocations.length}getTrafficPointCount(){return this.input.traffic_data.length}}function formatSolutionForVisualization(xt,yt){return yt.map((vt,bt)=>{const Tt=xt.candidates[vt],wt=(xt.coverageMatrix[vt]||[]).reduce((At,Rt)=>At+Rt,0),St=[];return{id:`station_${bt+1}`,position:Tt,capacity:4,cost:xt.config.cost_per_station,coverage_radius:xt.config.coverage_radius,traffic_coverage:wt,poi_ids_covered:St}})}class EVChargingOptimizer{constructor(yt){Bt(this,"onProgress");this.onProgress=yt}async optimize(yt){const vt=Date.now();this.reportProgress("preparing",0,"Analyzing traffic data...");const bt=new FacilityLocationProblem(yt),Tt=bt.getProblemData();if(this.reportProgress("preparing",20,`Found ${Tt.candidates.length} candidate locations`),Tt.candidates.length===0)throw new Error("No suitable candidate locations found. Make sure the simulation is running with agents.");this.reportProgress("solving",25,"Running greedy optimization algorithm...");const Et=await this.greedyFacilityLocation(bt,yt.config.max_stations);this.reportProgress("processing",75,"Processing optimization results...");const wt=formatSolutionForVisualization(Tt,Et),St=bt.calculateCoverage(Et),At=bt.calculateCost(Et),Rt=bt.calculateObjectiveValue(Et),Pt=wt.map(Ct=>({center:Ct.position,radius:Ct.coverage_radius,traffic_covered:Ct.traffic_coverage,station_id:Ct.id}));return this.reportProgress("complete",100,`Optimization complete! Placed ${wt.length} stations`),{stations:wt,total_coverage:St,total_cost:At,objective_value:Rt,solve_time_ms:Date.now()-vt,solution_status:Et.length>0?"OPTIMAL":"INFEASIBLE",coverage_map:Pt}}async greedyFacilityLocation(yt,vt){var At,Rt;const bt=[],Tt=yt.getProblemData(),{candidates:Et,coverageMatrix:wt}=Tt,St=new Set;for(let Pt=0;Pt<vt&&Pt<Et.length;Pt++){let Ct=-1,It=0,Mt=-1/0;for(let Ot=0;Ot<Et.length;Ot++){if(bt.includes(Ot))continue;let kt=0;const Ft=new Set;(At=wt[Ot])==null||At.forEach((zt,Ut)=>{zt>0&&!St.has(Ut)&&(kt+=zt,Ft.add(Ut))});const Nt=[...bt,Ot],Lt=yt.calculateObjectiveValue(Nt),Dt=bt.length>0?yt.calculateObjectiveValue(bt):0,$t=Lt-Dt;($t>Mt||Math.abs($t-Mt)<.001&&kt>It)&&(Mt=$t,It=kt,Ct=Ot)}if(Ct>=0&&Mt>0){bt.push(Ct),(Rt=wt[Ct])==null||Rt.forEach((kt,Ft)=>{kt>0&&St.add(Ft)});const Ot=25+50*(Pt+1)/vt;this.reportProgress("solving",Ot,`Placed station ${Pt+1}/${vt} at optimal location`),await new Promise(kt=>setTimeout(kt,100))}else break}return bt}reportProgress(yt,vt,bt){this.onProgress&&this.onProgress({phase:yt,progress:vt,message:bt})}}function AppContent(){const{state:xt,dispatch:yt}=useSimulationContext(),{initialize:vt,start:bt,pause:Tt,setSpeed:Et}=useSimulation(),[wt,St]=reactExports.useState(!0),[At,Rt]=reactExports.useState(null),{performanceState:Pt,isInitialized:Ct,updateAgentCount:It,currentLevel:Mt}=usePerformanceAdaptation({onProfileChange:Lt=>{console.log(` Performance adapted to ${Mt} profile:`,Lt),yt({type:"UPDATE_PERFORMANCE_PROFILE",payload:Lt})},onMetricsUpdate:Lt=>{xt.performance&&yt({type:"SET_PERFORMANCE_STATE",payload:{...xt.performance,metrics:Lt}})}}),[Ot,kt]=reactExports.useState(!1),[Ft,Nt]=reactExports.useState();return reactExports.useEffect(()=>{vt()},[vt]),reactExports.useEffect(()=>{Ct&&Pt&&!xt.performance&&yt({type:"SET_PERFORMANCE_STATE",payload:Pt})},[Ct,Pt,xt.performance,yt]),reactExports.useEffect(()=>{Ct&&xt.agents.length>0&&It(xt.agents.length)},[xt.agents.length,It,Ct]),reactExports.useEffect(()=>{const Lt=Dt=>{(Dt.ctrlKey||Dt.metaKey)&&Dt.key==="p"&&(Dt.preventDefault(),St($t=>!$t))};return window.addEventListener("keydown",Lt),()=>window.removeEventListener("keydown",Lt)},[]),reactExports.useCallback(async Lt=>{if(!(!xt.cityModel||xt.agents.length===0)){kt(!0),Nt({phase:"preparing",progress:0,message:"Starting optimization..."});try{const $t={traffic_data:processTrafficData({congestion_points:[],road_densities:{},poi_popularity:{},flow_matrix:[]},xt.cityModel.roads||[],xt.agents),roads:xt.cityModel.roads||[],pois:[],existing_stations:[],config:Lt},Ut=await new EVChargingOptimizer(Nt).optimize($t);Rt(Ut)}catch(Dt){console.error("Optimization failed:",Dt),yt({type:"SET_ERROR",payload:`Optimization failed: ${Dt instanceof Error?Dt.message:"Unknown error"}`})}finally{kt(!1)}}},[xt.cityModel,xt.agents,yt]),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(LoadingScreen,{isVisible:xt.isLoading,message:"Loading city simulation"}),jsxRuntimeExports.jsx(StatusBar,{}),jsxRuntimeExports.jsxs("div",{className:"app",style:{paddingTop:"60px"},children:[jsxRuntimeExports.jsxs("header",{className:"app-header",style:{height:"50px",padding:"0.5rem 1.5rem"},children:[jsxRuntimeExports.jsx("h1",{className:"app-title",style:{fontSize:"1.25rem"},children:"UrbanSynth"}),jsxRuntimeExports.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"City Simulation Platform"})]}),jsxRuntimeExports.jsx("main",{className:"app-main",children:jsxRuntimeExports.jsxs("div",{className:"visualization-container","data-testid":xt.isInitialized?"city-loaded":"city-loading",children:[jsxRuntimeExports.jsx(CityVisualization,{optimizationResult:At,onStart:bt,onPause:Tt,onSetSpeed:Et,isInitialized:xt.isInitialized,showPerformance:wt,onTogglePerformance:()=>St(Lt=>!Lt)}),jsxRuntimeExports.jsx(ControlPanel,{})]})})]})]})}function App(){return jsxRuntimeExports.jsx(ErrorBoundary,{children:jsxRuntimeExports.jsx(TerrainProvider,{children:jsxRuntimeExports.jsx(SimulationProvider,{children:jsxRuntimeExports.jsx(AppContent,{})})})})}client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
